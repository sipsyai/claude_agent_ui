{
  "file_path": "src/web/manager/components/chat/SystemMessageDisplay.tsx",
  "main_branch_history": [],
  "task_views": {
    "004-document-frontend-react-components-and-hooks": {
      "task_id": "004-document-frontend-react-components-and-hooks",
      "branch_point": {
        "commit_hash": "34a3f60da53773d90bd6579cb1cfd8417a1dd0b9",
        "content": "/**\n * SystemMessageDisplay Component\n * Displays SDK system messages (init, result, etc.) in a collapsible format\n */\n\nimport React from 'react';\n\nexport interface SystemMessageDisplayProps {\n  messageType: string;\n  content: any;\n  timestamp: Date;\n  className?: string;\n}\n\nconst SystemMessageDisplay: React.FC<SystemMessageDisplayProps> = ({\n  messageType,\n  content,\n  timestamp,\n  className = '',\n}) => {\n  // Get icon and color based on message type\n  const getMessageStyle = (\n    type: string\n  ): { icon: string; color: string; label: string } => {\n    const styles: Record<string, { icon: string; color: string; label: string }> = {\n      init: { icon: '\u2699\ufe0f', color: 'text-blue-400', label: 'Session Init' },\n      result: { icon: '\u2705', color: 'text-green-400', label: 'Result' },\n      error: { icon: '\u274c', color: 'text-red-400', label: 'Error' },\n      stream_event: { icon: '\ud83d\udce1', color: 'text-purple-400', label: 'Stream Event' },\n      permission_request: { icon: '\ud83d\udd10', color: 'text-yellow-400', label: 'Permission Request' },\n      permission_response: { icon: '\u2713', color: 'text-green-400', label: 'Permission Granted' },\n    };\n\n    return (\n      styles[type] || { icon: '\ud83d\udccc', color: 'text-gray-400', label: 'System Message' }\n    );\n  };\n\n  const style = getMessageStyle(messageType);\n\n  const formatTimestamp = (date: Date): string => {\n    return date.toLocaleTimeString('en-US', {\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n      hour12: false,\n    });\n  };\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text).then(() => {\n      // Could add toast notification\n    });\n  };\n\n  // Format content for display\n  const getDisplayContent = (): string => {\n    if (typeof content === 'string') {\n      return content;\n    }\n\n    // For init messages, show key info\n    if (messageType === 'init' && content.session_id) {\n      return `Session ID: ${content.session_id}\\nModel: ${content.model || 'N/A'}\\nTools: ${(content.tools || []).join(', ')}`;\n    }\n\n    // For result messages, show outcome\n    if (messageType === 'result' && content.is_error !== undefined) {\n      return `Status: ${content.is_error ? 'Error' : 'Success'}\\nResult: ${content.result || 'N/A'}`;\n    }\n\n    // Default: stringify\n    return JSON.stringify(content, null, 2);\n  };\n\n  return (\n    <details className={`text-xs space-y-1 group ${className}`}>\n      <summary className={`cursor-pointer select-none hover:bg-gray-800/50 p-2 rounded flex items-center gap-2 ${style.color}`}>\n        <span className=\"group-open:rotate-90 transition-transform inline-block text-gray-500\">\n          \u25b6\n        </span>\n        <span>{style.icon}</span>\n        <span className=\"font-medium\">{style.label}</span>\n        <span className=\"text-gray-500 ml-auto\">{formatTimestamp(timestamp)}</span>\n      </summary>\n\n      <div className=\"ml-4 mt-2 space-y-2\">\n        {/* Content Display */}\n        <div className=\"relative\">\n          <button\n            onClick={() => copyToClipboard(getDisplayContent())}\n            className=\"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-700 hover:bg-gray-600 text-gray-300 rounded transition-colors\"\n            title=\"Copy to clipboard\"\n          >\n            \ud83d\udccb Copy\n          </button>\n          <pre className=\"text-xs bg-black/40 p-3 pr-16 rounded overflow-x-auto border border-gray-700 max-h-64 overflow-y-auto\">\n            {getDisplayContent()}\n          </pre>\n        </div>\n\n        {/* Raw Data (collapsed by default) */}\n        <details className=\"cursor-pointer\">\n          <summary className=\"text-xs text-gray-500 hover:text-gray-300 select-none\">\n            View Raw Data\n          </summary>\n          <pre className=\"mt-1 text-xs bg-black/40 p-2 rounded overflow-x-auto border border-gray-700 max-h-48 overflow-y-auto\">\n            {JSON.stringify(content, null, 2)}\n          </pre>\n        </details>\n      </div>\n    </details>\n  );\n};\n\nexport default SystemMessageDisplay;\n",
        "timestamp": "2026-01-02T14:22:14.293924"
      },
      "worktree_state": {
        "content": "/**\n * SystemMessageDisplay Component\n *\n * Displays SDK system messages (init, result, error, stream events, permission requests/responses)\n * in a collapsible, color-coded format with copy-to-clipboard functionality. System messages\n * provide visibility into the conversation lifecycle and SDK events for debugging and monitoring.\n *\n * ## Features\n * - Collapsible message display with expandable details\n * - Type-based visual styling (icon, color, label)\n * - Timestamp display with 24-hour format\n * - Copy-to-clipboard functionality for message content\n * - Smart content formatting based on message type\n * - Raw JSON data viewer (nested collapsible section)\n * - Dark theme styling with Tailwind CSS\n *\n * ## System Message Rendering\n * Messages are displayed in a `<details>` element with a summary header and expandable content:\n *\n * **Summary Header:**\n * - Collapsible arrow indicator (\u25b6, rotates 90\u00b0 when open)\n * - Message type icon (emoji)\n * - Message type label (e.g., \"Session Init\", \"Result\")\n * - Timestamp in HH:MM:SS format (24-hour)\n * - Hover effect (bg-gray-800/50)\n * - Color-coded text based on message type\n *\n * **Expandable Content:**\n * - Formatted content display in code block with syntax highlighting\n * - Copy button (absolute positioned, top-right)\n * - Max height with scroll (max-h-64)\n * - Raw data viewer (nested details, max-h-48)\n *\n * ## Message Types\n * Each message type has a unique icon, color, and label:\n *\n * - **init** (\u2699\ufe0f, blue): Session initialization messages\n *   - Shows session ID, model, and available tools\n *   - Formatted as: `Session ID: ...\\nModel: ...\\nTools: ...`\n *\n * - **result** (\u2705, green): Result messages from tool executions or operations\n *   - Shows success/error status and result content\n *   - Formatted as: `Status: Success/Error\\nResult: ...`\n *\n * - **error** (\u274c, red): Error messages from SDK or system\n *   - Displays error details and stack traces\n *   - Uses JSON stringification for complex error objects\n *\n * - **stream_event** (\ud83d\udce1, purple): Streaming events during message generation\n *   - Shows real-time updates from SSE streams\n *   - Raw JSON display for event payload\n *\n * - **permission_request** (\ud83d\udd10, yellow): Permission requests requiring user approval\n *   - Shows what permission is being requested\n *   - Typically followed by permission_response\n *\n * - **permission_response** (\u2713, green): Permission granted/denied responses\n *   - Shows user's decision on permission request\n *   - Green color indicates approval\n *\n * - **default** (\ud83d\udccc, gray): Unknown or generic system messages\n *   - Fallback for unrecognized message types\n *   - Uses generic \"System Message\" label\n *\n * ## Styling Behavior\n * The component uses Tailwind CSS for dark theme styling:\n *\n * - Text size: `text-xs` (small, 12px) for compact display\n * - Summary hover: `hover:bg-gray-800/50` (subtle highlight on hover)\n * - Arrow rotation: `group-open:rotate-90` (90\u00b0 rotation when expanded)\n * - Content background: `bg-black/40` (semi-transparent black)\n * - Border color: `border-gray-700` (medium gray)\n * - Code block: `overflow-x-auto` (horizontal scroll) and `overflow-y-auto` (vertical scroll)\n * - Copy button: `bg-gray-700 hover:bg-gray-600` (gray with hover effect)\n * - Color-coded text: Blue (init), Green (result, permission_response), Red (error), Purple (stream_event), Yellow (permission_request), Gray (default)\n *\n * ## Copy Functionality\n * Messages can be copied to clipboard via a button in the content section:\n *\n * - Button positioned absolutely in top-right corner\n * - Uses Clipboard API (navigator.clipboard.writeText)\n * - Copies formatted content (not raw JSON)\n * - Icon: \ud83d\udccb Copy\n * - Hover effect for visual feedback\n * - Requires HTTPS or localhost for security\n *\n * ## Content Formatting\n * Content is formatted intelligently based on message type:\n *\n * **String Content:**\n * - Displayed as-is in pre-formatted text\n *\n * **Init Messages (content.session_id):**\n * - Extracts: session_id, model, tools array\n * - Formats as multi-line text with labels\n * - Tools array joined with commas\n *\n * **Result Messages (content.is_error):**\n * - Shows status (Success/Error) based on is_error flag\n * - Displays result content or \"N/A\"\n * - Formatted as multi-line text\n *\n * **Other Objects:**\n * - JSON stringified with 2-space indentation\n * - Pretty-printed for readability\n * - Syntax highlighting via pre element\n *\n * @example\n * // Basic usage with session init message\n * <SystemMessageDisplay\n *   messageType=\"init\"\n *   content={{\n *     session_id: \"abc123\",\n *     model: \"claude-3-5-sonnet\",\n *     tools: [\"read_file\", \"write_file\", \"execute_code\"]\n *   }}\n *   timestamp={new Date()}\n * />\n *\n * @example\n * // Result message with success status\n * <SystemMessageDisplay\n *   messageType=\"result\"\n *   content={{\n *     is_error: false,\n *     result: \"File written successfully\"\n *   }}\n *   timestamp={new Date()}\n * />\n *\n * @example\n * // Error message with stack trace\n * <SystemMessageDisplay\n *   messageType=\"error\"\n *   content={{\n *     message: \"File not found\",\n *     stack: \"Error: File not found\\n  at readFile (...)\"\n *   }}\n *   timestamp={new Date()}\n * />\n *\n * @example\n * // Permission request with custom className\n * <SystemMessageDisplay\n *   messageType=\"permission_request\"\n *   content={{\n *     action: \"write_file\",\n *     path: \"/home/user/document.txt\"\n *   }}\n *   timestamp={new Date()}\n *   className=\"my-4\"\n * />\n */\n\nimport React from 'react';\n\n/**\n * Props for the SystemMessageDisplay component.\n *\n * @property {string} messageType - Type of system message (init, result, error, stream_event, permission_request, permission_response, or custom)\n * @property {any} content - Message content (string, object, or structured data). Format varies by messageType.\n * @property {Date} timestamp - Time when the message was created\n * @property {string} [className] - Optional CSS classes to apply to the root element\n */\nexport interface SystemMessageDisplayProps {\n  messageType: string;\n  content: any;\n  timestamp: Date;\n  className?: string;\n}\n\nconst SystemMessageDisplay: React.FC<SystemMessageDisplayProps> = ({\n  messageType,\n  content,\n  timestamp,\n  className = '',\n}) => {\n  /**\n   * Maps message type to visual styling configuration.\n   *\n   * Returns an object with icon (emoji), color (Tailwind class), and label (display name)\n   * for the given message type. Falls back to default styling for unknown types.\n   *\n   * @internal\n   * @param {string} type - The message type (init, result, error, stream_event, permission_request, permission_response)\n   * @returns {{ icon: string; color: string; label: string }} Styling configuration object\n   */\n  const getMessageStyle = (\n    type: string\n  ): { icon: string; color: string; label: string } => {\n    const styles: Record<string, { icon: string; color: string; label: string }> = {\n      init: { icon: '\u2699\ufe0f', color: 'text-blue-400', label: 'Session Init' },\n      result: { icon: '\u2705', color: 'text-green-400', label: 'Result' },\n      error: { icon: '\u274c', color: 'text-red-400', label: 'Error' },\n      stream_event: { icon: '\ud83d\udce1', color: 'text-purple-400', label: 'Stream Event' },\n      permission_request: { icon: '\ud83d\udd10', color: 'text-yellow-400', label: 'Permission Request' },\n      permission_response: { icon: '\u2713', color: 'text-green-400', label: 'Permission Granted' },\n    };\n\n    return (\n      styles[type] || { icon: '\ud83d\udccc', color: 'text-gray-400', label: 'System Message' }\n    );\n  };\n\n  const style = getMessageStyle(messageType);\n\n  /**\n   * Formats a Date object as a 24-hour time string (HH:MM:SS).\n   *\n   * Uses the browser's locale with forced 24-hour format for consistent display.\n   *\n   * @internal\n   * @param {Date} date - The date/time to format\n   * @returns {string} Formatted time string (e.g., \"14:32:05\")\n   */\n  const formatTimestamp = (date: Date): string => {\n    return date.toLocaleTimeString('en-US', {\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n      hour12: false,\n    });\n  };\n\n  /**\n   * Copies text to the system clipboard using the Clipboard API.\n   *\n   * Requires HTTPS or localhost for security. Silently handles errors.\n   * Could be extended to show toast notification on success/failure.\n   *\n   * @internal\n   * @param {string} text - The text to copy to clipboard\n   */\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text).then(() => {\n      // Could add toast notification\n    });\n  };\n\n  /**\n   * Formats message content for display based on message type.\n   *\n   * Applies intelligent formatting rules:\n   * - String content: returned as-is\n   * - Init messages: extracts session_id, model, tools into multi-line format\n   * - Result messages: formats is_error flag and result into status display\n   * - Other objects: JSON stringified with 2-space indentation\n   *\n   * @internal\n   * @returns {string} Formatted content string for display in pre element\n   */\n  const getDisplayContent = (): string => {\n    if (typeof content === 'string') {\n      return content;\n    }\n\n    // For init messages, show key info\n    if (messageType === 'init' && content.session_id) {\n      return `Session ID: ${content.session_id}\\nModel: ${content.model || 'N/A'}\\nTools: ${(content.tools || []).join(', ')}`;\n    }\n\n    // For result messages, show outcome\n    if (messageType === 'result' && content.is_error !== undefined) {\n      return `Status: ${content.is_error ? 'Error' : 'Success'}\\nResult: ${content.result || 'N/A'}`;\n    }\n\n    // Default: stringify\n    return JSON.stringify(content, null, 2);\n  };\n\n  return (\n    <details className={`text-xs space-y-1 group ${className}`}>\n      <summary className={`cursor-pointer select-none hover:bg-gray-800/50 p-2 rounded flex items-center gap-2 ${style.color}`}>\n        <span className=\"group-open:rotate-90 transition-transform inline-block text-gray-500\">\n          \u25b6\n        </span>\n        <span>{style.icon}</span>\n        <span className=\"font-medium\">{style.label}</span>\n        <span className=\"text-gray-500 ml-auto\">{formatTimestamp(timestamp)}</span>\n      </summary>\n\n      <div className=\"ml-4 mt-2 space-y-2\">\n        {/* Content Display */}\n        <div className=\"relative\">\n          <button\n            onClick={() => copyToClipboard(getDisplayContent())}\n            className=\"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-700 hover:bg-gray-600 text-gray-300 rounded transition-colors\"\n            title=\"Copy to clipboard\"\n          >\n            \ud83d\udccb Copy\n          </button>\n          <pre className=\"text-xs bg-black/40 p-3 pr-16 rounded overflow-x-auto border border-gray-700 max-h-64 overflow-y-auto\">\n            {getDisplayContent()}\n          </pre>\n        </div>\n\n        {/* Raw Data (collapsed by default) */}\n        <details className=\"cursor-pointer\">\n          <summary className=\"text-xs text-gray-500 hover:text-gray-300 select-none\">\n            View Raw Data\n          </summary>\n          <pre className=\"mt-1 text-xs bg-black/40 p-2 rounded overflow-x-auto border border-gray-700 max-h-48 overflow-y-auto\">\n            {JSON.stringify(content, null, 2)}\n          </pre>\n        </details>\n      </div>\n    </details>\n  );\n};\n\nSystemMessageDisplay.displayName = 'SystemMessageDisplay';\n\nexport default SystemMessageDisplay;\n",
        "last_modified": "2026-01-02T15:11:36.290451"
      },
      "task_intent": {
        "title": "Document Frontend React Components and Hooks",
        "description": "Add comprehensive JSDoc documentation to all React components and custom hooks in the frontend, including prop types, usage examples, component purposes, state management, and side effects.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T14:01:11.620741",
  "last_updated": "2026-01-02T14:22:15.141518"
}