{
  "file_path": "src/web/manager/components/AgentsPage.tsx",
  "main_branch_history": [],
  "task_views": {
    "004-document-frontend-react-components-and-hooks": {
      "task_id": "004-document-frontend-react-components-and-hooks",
      "branch_point": {
        "commit_hash": "34a3f60da53773d90bd6579cb1cfd8417a1dd0b9",
        "content": "import React, { useState, useEffect } from 'react';\nimport type { Agent } from '../../../types/agent.types';\nimport * as api from '../services/api';\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from './ui/Card';\nimport { Button } from './ui/Button';\nimport AgentExecutionModal from './AgentExecutionModal';\nimport AgentCreatorForm from './AgentCreatorForm';\nimport AgentCreatorChatPanel from './AgentCreatorChatPanel';\nimport { CpuChipIcon, PuzzlePieceIcon, ServerIcon, ClipboardListIcon, SparklesIcon } from './ui/Icons';\n\ninterface AgentsPageProps {\n  agents: Agent[];\n  directory?: string;\n  onAgentCreated?: () => void;\n}\n\nconst AgentsPage: React.FC<AgentsPageProps> = ({ agents: initialAgents, directory, onAgentCreated }) => {\n  const [agents, setAgents] = useState<Agent[]>(initialAgents);\n  const [selectedAgent, setSelectedAgent] = useState<Agent | null>(null);\n  const [showCreatorForm, setShowCreatorForm] = useState(false);\n  const [showCreatorChat, setShowCreatorChat] = useState(false);\n  const [editingAgent, setEditingAgent] = useState<Agent | null>(null);\n\n  // Load agents from Strapi\n  const loadAgents = async () => {\n    try {\n      const fetchedAgents = await api.getAgents(directory);\n      setAgents(fetchedAgents);\n    } catch (error) {\n      console.error('Failed to load agents:', error);\n    }\n  };\n\n  // Load agents when component mounts or initialAgents/directory changes\n  useEffect(() => {\n    loadAgents();\n  }, [initialAgents, directory]);\n\n  const handleAgentCreated = () => {\n    setShowCreatorForm(false);\n    setEditingAgent(null);\n    loadAgents(); // Reload agents list\n    if (onAgentCreated) {\n      onAgentCreated();\n    }\n  };\n\n  const handleEditClick = (agent: Agent) => {\n    setEditingAgent(agent);\n    setShowCreatorForm(true);\n  };\n\n  return (\n    <div className=\"animate-fade-in\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex-1 text-center\">\n          <h1 className=\"text-3xl sm:text-4xl font-bold mb-2\">Agents</h1>\n          <p className=\"text-muted-foreground\">\n            Discovered {agents.length} agents in .claude/agents/\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button\n            onClick={() => setShowCreatorChat(true)}\n            className=\"flex items-center gap-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700\"\n          >\n            <SparklesIcon className=\"h-4 w-4\" />\n            Create with Claude Manager\n          </Button>\n          <Button\n            onClick={() => {\n              setEditingAgent(null);\n              setShowCreatorForm(true);\n            }}\n            variant=\"secondary\"\n            className=\"flex items-center gap-2\"\n          >\n            <span className=\"text-lg\">+</span>\n            Create New Agent\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {agents.length === 0 ? (\n          <div className=\"col-span-full text-center text-muted-foreground py-12\">\n            No agents found in .claude/agents/\n          </div>\n        ) : (\n          agents.map((agent) => {\n            // Calculate counts from Strapi component-based structure\n            const toolsCount = agent.toolConfig?.allowedTools?.length || 0;\n            const mcpServersCount = agent.mcpConfig?.length || 0;\n            const mcpToolsCount = agent.mcpConfig?.reduce((sum, config) =>\n              sum + (config.selectedTools?.length || 0), 0) || 0;\n            const skillsCount = agent.skillSelection?.length || 0;\n            const inputFieldsCount = 0; // inputFields not yet in Strapi schema\n\n            return (\n              <Card key={agent.id} className=\"flex flex-col hover:border-primary/80 transition-colors duration-300 group\">\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <CardTitle className=\"flex items-center gap-2 flex-1\">\n                      <span className=\"text-primary\">\ud83e\udd16</span>\n                      <span className=\"truncate\">{agent.name}</span>\n                    </CardTitle>\n                    {agent.modelConfig?.model && (\n                      <span className=\"text-xs px-2 py-1 bg-purple-100 text-purple-700 rounded-full font-medium flex-shrink-0\">\n                        {agent.modelConfig.model}\n                      </span>\n                    )}\n                  </div>\n                  <CardDescription className=\"line-clamp-2\">{agent.description}</CardDescription>\n                </CardHeader>\n\n                <CardContent className=\"flex-grow space-y-3\">\n                  {/* Quick Stats */}\n                  <div className=\"grid grid-cols-2 gap-2 pb-3 border-b border-border\">\n                    {/* Skills Count */}\n                    {skillsCount > 0 && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <PuzzlePieceIcon className=\"h-4 w-4 text-green-600 flex-shrink-0\" />\n                        <span className=\"text-muted-foreground\">{skillsCount} Skill{skillsCount !== 1 ? 's' : ''}</span>\n                      </div>\n                    )}\n\n                    {/* Tools Count */}\n                    {toolsCount > 0 && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <CpuChipIcon className=\"h-4 w-4 text-blue-600 flex-shrink-0\" />\n                        <span className=\"text-muted-foreground\">{toolsCount} Tool{toolsCount !== 1 ? 's' : ''}</span>\n                      </div>\n                    )}\n\n                    {/* MCP Tools Count */}\n                    {mcpToolsCount > 0 && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <ServerIcon className=\"h-4 w-4 text-indigo-600 flex-shrink-0\" />\n                        <span className=\"text-muted-foreground\">{mcpToolsCount} MCP Tool{mcpToolsCount !== 1 ? 's' : ''}</span>\n                      </div>\n                    )}\n\n                    {/* Input Fields Count */}\n                    {inputFieldsCount > 0 && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <ClipboardListIcon className=\"h-4 w-4 text-orange-600 flex-shrink-0\" />\n                        <span className=\"text-muted-foreground\">{inputFieldsCount} Input{inputFieldsCount > 1 ? 's' : ''}</span>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Skills Section */}\n                  {agent.skillSelection && agent.skillSelection.length > 0 && (\n                    <div>\n                      <div className=\"flex items-center gap-1.5 mb-1.5\">\n                        <PuzzlePieceIcon className=\"h-3.5 w-3.5 text-green-600\" />\n                        <h4 className=\"font-semibold text-xs text-muted-foreground uppercase\">Skills</h4>\n                      </div>\n                      <div className=\"flex flex-wrap gap-1\">\n                        {agent.skillSelection.slice(0, 3).map((selection, idx) => {\n                          const skillName = typeof selection.skill === 'string' ? selection.skill : selection.skill.name;\n                          return (\n                            <span key={idx} className=\"text-xs bg-green-50 text-green-700 border border-green-200 px-2 py-0.5 rounded font-medium\">\n                              {skillName}\n                            </span>\n                          );\n                        })}\n                        {agent.skillSelection.length > 3 && (\n                          <span className=\"text-xs text-green-600 px-2 py-0.5 font-medium\">\n                            +{agent.skillSelection.length - 3} more\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Claude Tools */}\n                  {agent.toolConfig?.allowedTools && Array.isArray(agent.toolConfig.allowedTools) && agent.toolConfig.allowedTools.length > 0 && (\n                    <div>\n                      <div className=\"flex items-center gap-1.5 mb-1.5\">\n                        <CpuChipIcon className=\"h-3.5 w-3.5 text-blue-600\" />\n                        <h4 className=\"font-semibold text-xs text-muted-foreground uppercase\">Claude Tools</h4>\n                      </div>\n                      <div className=\"flex flex-wrap gap-1\">\n                        {agent.toolConfig.allowedTools.slice(0, 4).map((tool, idx) => (\n                          <span key={idx} className=\"text-xs bg-blue-50 text-blue-700 border border-blue-200 px-2 py-0.5 rounded\">\n                            {tool}\n                          </span>\n                        ))}\n                        {agent.toolConfig.allowedTools.length > 4 && (\n                          <span className=\"text-xs text-blue-600 px-2 py-0.5\">\n                            +{agent.toolConfig.allowedTools.length - 4}\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* MCP Tools */}\n                  {agent.mcpConfig && agent.mcpConfig.length > 0 && (\n                    <div>\n                      <div className=\"flex items-center gap-1.5 mb-1.5\">\n                        <ServerIcon className=\"h-3.5 w-3.5 text-indigo-600\" />\n                        <h4 className=\"font-semibold text-xs text-muted-foreground uppercase\">MCP Servers</h4>\n                      </div>\n                      <div className=\"space-y-1.5\">\n                        {agent.mcpConfig.slice(0, 2).map((config, idx) => {\n                          if (!config.mcpServer) return null;\n                          const serverName = typeof config.mcpServer === 'string' ? config.mcpServer : config.mcpServer.name;\n                          const toolsCount = config.selectedTools?.length || 0;\n                          return (\n                            <div key={idx}>\n                              <div className=\"text-xs font-medium text-indigo-600 mb-0.5\">{serverName}</div>\n                              {toolsCount > 0 && (\n                                <div className=\"flex flex-wrap gap-1\">\n                                  {config.selectedTools!.slice(0, 3).map((toolSel, tidx) => {\n                                    if (!toolSel.mcpTool) return null;\n                                    const toolName = typeof toolSel.mcpTool === 'string' ? toolSel.mcpTool : toolSel.mcpTool.name;\n                                    return (\n                                      <span key={tidx} className=\"text-xs bg-indigo-50 text-indigo-700 border border-indigo-200 px-2 py-0.5 rounded\">\n                                        {toolName}\n                                      </span>\n                                    );\n                                  })}\n                                  {toolsCount > 3 && (\n                                    <span className=\"text-xs text-indigo-600 px-2 py-0.5\">\n                                      +{toolsCount - 3}\n                                    </span>\n                                  )}\n                                </div>\n                              )}\n                            </div>\n                          );\n                        })}\n                        {agent.mcpConfig.length > 2 && (\n                          <div className=\"text-xs text-indigo-600 font-medium\">\n                            +{agent.mcpConfig.length - 2} more server(s)\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* File Info */}\n                  <div className=\"text-xs text-muted-foreground pt-2 border-t border-border\">\n                    \ud83d\udcc4 {agent.id}.md\n                  </div>\n                </CardContent>\n\n                <CardFooter className=\"flex gap-2 pt-3\">\n                  <Button\n                    className=\"flex-1\"\n                    size=\"sm\"\n                    onClick={() => setSelectedAgent(agent)}\n                  >\n                    Run Agent\n                  </Button>\n                  <Button\n                    variant=\"secondary\"\n                    size=\"sm\"\n                    onClick={() => handleEditClick(agent)}\n                  >\n                    Edit\n                  </Button>\n                </CardFooter>\n              </Card>\n            );\n          })\n        )}\n      </div>\n\n      {/* Agent Execution Modal */}\n      {selectedAgent && (\n        <AgentExecutionModal\n          agent={selectedAgent}\n          isOpen={!!selectedAgent}\n          onClose={() => setSelectedAgent(null)}\n          directory={directory}\n        />\n      )}\n\n      {/* Agent Creator/Editor Form */}\n      <AgentCreatorForm\n        isOpen={showCreatorForm}\n        onClose={() => {\n          setShowCreatorForm(false);\n          setEditingAgent(null);\n        }}\n        onSuccess={handleAgentCreated}\n        directory={directory}\n        editAgent={editingAgent || undefined}\n      />\n\n      {/* Agent Creator Chat Panel */}\n      <AgentCreatorChatPanel\n        isOpen={showCreatorChat}\n        onClose={() => setShowCreatorChat(false)}\n        onAgentCreated={handleAgentCreated}\n        directory={directory}\n      />\n    </div>\n  );\n};\n\nexport default AgentsPage;\n",
        "timestamp": "2026-01-02T14:22:14.293924"
      },
      "worktree_state": {
        "content": "/**\n * AgentsPage - Agent Management Dashboard\n *\n * A comprehensive page component for managing agents in the Claude Manager UI. Provides agent listing,\n * creation, editing, execution, and configuration preview functionality.\n *\n * ## Features\n *\n * - **Agent Listing**: Grid-based display of all available agents with metadata and statistics\n * - **CRUD Operations**: Create (form or chat), Read (listing), Update (edit), Execute (run agent)\n * - **Agent Creation Modes**: Dual creation interface (form-based or chat-based with AI assistant)\n * - **Agent Execution**: Modal-based agent execution with real-time message streaming\n * - **Configuration Preview**: Visual display of agent skills, tools, MCP servers, and input fields\n * - **Directory Integration**: Automatic agent loading based on selected directory\n * - **Real-time Updates**: Automatic agent list refresh after create/edit operations\n *\n * ## Agent Listing\n *\n * Displays agents in a responsive grid layout (1 column mobile, 2 columns tablet, 3 columns desktop).\n * Each agent card shows:\n *\n * - **Header**: Agent name (with robot emoji), description (2-line clamp), model badge (if configured)\n * - **Statistics**: Counts for skills, Claude tools, MCP tools, and input fields\n * - **Skills Section**: First 3 skills with overflow indicator (\"+N more\")\n * - **Claude Tools Section**: First 4 allowed tools with overflow indicator\n * - **MCP Servers Section**: First 2 servers with their tools (first 3 per server)\n * - **File Info**: Agent file name (e.g., \"my-agent.md\")\n * - **Actions**: \"Run Agent\" button (primary) and \"Edit\" button (secondary)\n *\n * ## CRUD Operations\n *\n * ### Create\n * Two creation modes available via header buttons:\n *\n * 1. **Chat-based Creation** (Primary button with gradient):\n *    - Opens AgentCreatorChatPanel with AI assistant\n *    - Conversational workflow with SSE streaming\n *    - Auto-generates agent file on completion\n *\n * 2. **Form-based Creation** (Secondary button):\n *    - Opens AgentCreatorForm with comprehensive configuration fields\n *    - Manual configuration of all agent settings\n *    - Validates and saves agent file\n *\n * ### Read\n * - Automatic loading on mount via `loadAgents()`\n * - Reloads when `directory` or `initialAgents` props change\n * - Displays all agents from `.claude/agents/` directory\n * - Shows count in header (\"Discovered N agents\")\n *\n * ### Update (Edit)\n * - Click \"Edit\" button on any agent card\n * - Opens AgentCreatorForm with pre-populated fields\n * - Saves changes and reloads agent list\n *\n * ### Execute\n * - Click \"Run Agent\" button on any agent card\n * - Opens AgentExecutionModal with real-time message streaming\n * - Supports permission modes and tool execution tracking\n *\n * ## Directory Integration\n *\n * The component automatically loads agents based on the `directory` prop:\n *\n * 1. **Initial Load**: Fetches agents from API on mount\n * 2. **Directory Changes**: Reloads agents when directory prop changes\n * 3. **API Integration**: Uses `api.getAgents(directory)` for data fetching\n * 4. **Error Handling**: Logs errors to console, maintains current state on failure\n *\n * ## State Management\n *\n * The component manages five categories of state:\n *\n * 1. **Agent List State** (`agents`):\n *    - Initialized from `initialAgents` prop\n *    - Updated via `loadAgents()` API calls\n *    - Displayed in responsive grid layout\n *\n * 2. **Execution State** (`selectedAgent`):\n *    - Tracks agent selected for execution\n *    - Controls AgentExecutionModal visibility\n *    - Reset to null on modal close\n *\n * 3. **Creator Form State** (`showCreatorForm`, `editingAgent`):\n *    - Controls AgentCreatorForm modal visibility\n *    - Tracks agent being edited (null for create mode)\n *    - Reset on form close or successful submission\n *\n * 4. **Creator Chat State** (`showCreatorChat`):\n *    - Controls AgentCreatorChatPanel visibility\n *    - Slide-in panel for AI-assisted creation\n *    - Reset to false on panel close\n *\n * 5. **Loading State**: Implicit via API calls (no explicit loading spinner)\n *\n * ## Styling Behavior\n *\n * The component uses Tailwind CSS classes for styling:\n *\n * - **Container**: `animate-fade-in` for smooth page entrance\n * - **Header**: `flex items-center justify-between mb-6` with centered title\n * - **Title**: Responsive typography (`text-3xl sm:text-4xl font-bold`)\n * - **Grid Layout**: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6`\n * - **Cards**: `hover:border-primary/80 transition-colors duration-300` for interactive feedback\n * - **Badges**: Color-coded by type (green=skills, blue=tools, indigo=MCP, purple=model)\n * - **Empty State**: Centered text with muted color and padding\n * - **Buttons**: Gradient for primary action (chat creation), secondary for form creation\n *\n * @example\n * // Basic usage in ManagerApp dashboard phase\n * <AgentsPage\n *   agents={agents}\n *   directory=\"/path/to/project\"\n *   onAgentCreated={handleAgentsReload}\n * />\n *\n * @example\n * // Understanding agent creation workflow\n * // 1. User clicks \"Create with Claude Manager\" button\n * //    \u2192 setShowCreatorChat(true)\n * //    \u2192 AgentCreatorChatPanel opens with AI assistant\n * //    \u2192 User describes agent via chat\n * //    \u2192 AI generates agent file\n * //    \u2192 handleAgentCreated() called\n * //    \u2192 loadAgents() refreshes list\n * //    \u2192 onAgentCreated() callback invoked (if provided)\n * //\n * // 2. User clicks \"Create New Agent\" button\n * //    \u2192 setEditingAgent(null), setShowCreatorForm(true)\n * //    \u2192 AgentCreatorForm opens in create mode\n * //    \u2192 User fills form fields\n * //    \u2192 Form validates and saves\n * //    \u2192 handleAgentCreated() called\n * //    \u2192 loadAgents() refreshes list\n * //    \u2192 onAgentCreated() callback invoked (if provided)\n *\n * @example\n * // Understanding agent edit workflow\n * // 1. User clicks \"Edit\" button on agent card\n * //    \u2192 handleEditClick(agent) called\n * //    \u2192 setEditingAgent(agent), setShowCreatorForm(true)\n * //    \u2192 AgentCreatorForm opens with pre-populated fields\n * //    \u2192 User modifies fields\n * //    \u2192 Form validates and saves\n * //    \u2192 handleAgentCreated() called\n * //    \u2192 editingAgent reset to null\n * //    \u2192 loadAgents() refreshes list\n *\n * @example\n * // Understanding agent execution workflow\n * // 1. User clicks \"Run Agent\" button on agent card\n * //    \u2192 setSelectedAgent(agent)\n * //    \u2192 AgentExecutionModal opens\n * //    \u2192 User selects permission mode\n * //    \u2192 Agent executes with SSE streaming\n * //    \u2192 Real-time messages displayed\n * //    \u2192 User clicks close\n * //    \u2192 setSelectedAgent(null)\n */\n\nimport React, { useState, useEffect } from 'react';\nimport type { Agent } from '../../../types/agent.types';\nimport * as api from '../services/api';\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from './ui/Card';\nimport { Button } from './ui/Button';\nimport AgentExecutionModal from './AgentExecutionModal';\nimport AgentCreatorForm from './AgentCreatorForm';\nimport AgentCreatorChatPanel from './AgentCreatorChatPanel';\nimport { CpuChipIcon, PuzzlePieceIcon, ServerIcon, ClipboardListIcon, SparklesIcon } from './ui/Icons';\n\n/**\n * Props for the AgentsPage component.\n *\n * @property {Agent[]} agents - Initial array of agents to display (will be overridden by API fetch)\n * @property {string} [directory] - Optional directory path for filtering agents (e.g., \"/path/to/project\")\n * @property {() => void} [onAgentCreated] - Optional callback invoked after successful agent creation or edit\n */\ninterface AgentsPageProps {\n  agents: Agent[];\n  directory?: string;\n  onAgentCreated?: () => void;\n}\n\nconst AgentsPage: React.FC<AgentsPageProps> = ({ agents: initialAgents, directory, onAgentCreated }) => {\n  const [agents, setAgents] = useState<Agent[]>(initialAgents);\n  const [selectedAgent, setSelectedAgent] = useState<Agent | null>(null);\n  const [showCreatorForm, setShowCreatorForm] = useState(false);\n  const [showCreatorChat, setShowCreatorChat] = useState(false);\n  const [editingAgent, setEditingAgent] = useState<Agent | null>(null);\n\n  /**\n   * Loads agents from the API based on the current directory.\n   *\n   * Fetches agents from the backend API and updates the local state. If the API call fails,\n   * the error is logged to console and the current agent list is maintained.\n   *\n   * @internal\n   * @async\n   * @returns {Promise<void>}\n   */\n  const loadAgents = async () => {\n    try {\n      const fetchedAgents = await api.getAgents(directory);\n      setAgents(fetchedAgents);\n    } catch (error) {\n      console.error('Failed to load agents:', error);\n    }\n  };\n\n  /**\n   * Effect hook that loads agents when the component mounts or when dependencies change.\n   *\n   * Triggers agent reload in the following scenarios:\n   * - Component mounts (initial load)\n   * - `directory` prop changes (user selects different directory)\n   * - `initialAgents` prop changes (parent component updates agents)\n   *\n   * @internal\n   */\n  useEffect(() => {\n    loadAgents();\n  }, [initialAgents, directory]);\n\n  /**\n   * Handles successful agent creation or edit.\n   *\n   * This callback is invoked by AgentCreatorForm and AgentCreatorChatPanel after a successful\n   * agent creation or edit operation. It performs the following actions:\n   * 1. Closes the creator form modal\n   * 2. Resets the editing agent state to null\n   * 3. Reloads the agents list from the API\n   * 4. Invokes the parent's onAgentCreated callback (if provided)\n   *\n   * @internal\n   * @returns {void}\n   */\n  const handleAgentCreated = () => {\n    setShowCreatorForm(false);\n    setEditingAgent(null);\n    loadAgents(); // Reload agents list\n    if (onAgentCreated) {\n      onAgentCreated();\n    }\n  };\n\n  /**\n   * Handles click on the \"Edit\" button for an agent card.\n   *\n   * Sets the agent to be edited and opens the AgentCreatorForm in edit mode.\n   * The form will be pre-populated with the agent's current configuration.\n   *\n   * @internal\n   * @param {Agent} agent - The agent to edit\n   * @returns {void}\n   */\n  const handleEditClick = (agent: Agent) => {\n    setEditingAgent(agent);\n    setShowCreatorForm(true);\n  };\n\n  return (\n    <div className=\"animate-fade-in\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex-1 text-center\">\n          <h1 className=\"text-3xl sm:text-4xl font-bold mb-2\">Agents</h1>\n          <p className=\"text-muted-foreground\">\n            Discovered {agents.length} agents in .claude/agents/\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button\n            onClick={() => setShowCreatorChat(true)}\n            className=\"flex items-center gap-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700\"\n          >\n            <SparklesIcon className=\"h-4 w-4\" />\n            Create with Claude Manager\n          </Button>\n          <Button\n            onClick={() => {\n              setEditingAgent(null);\n              setShowCreatorForm(true);\n            }}\n            variant=\"secondary\"\n            className=\"flex items-center gap-2\"\n          >\n            <span className=\"text-lg\">+</span>\n            Create New Agent\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {agents.length === 0 ? (\n          <div className=\"col-span-full text-center text-muted-foreground py-12\">\n            No agents found in .claude/agents/\n          </div>\n        ) : (\n          agents.map((agent) => {\n            // Calculate counts from Strapi component-based structure\n            const toolsCount = agent.toolConfig?.allowedTools?.length || 0;\n            const mcpServersCount = agent.mcpConfig?.length || 0;\n            const mcpToolsCount = agent.mcpConfig?.reduce((sum, config) =>\n              sum + (config.selectedTools?.length || 0), 0) || 0;\n            const skillsCount = agent.skillSelection?.length || 0;\n            const inputFieldsCount = 0; // inputFields not yet in Strapi schema\n\n            return (\n              <Card key={agent.id} className=\"flex flex-col hover:border-primary/80 transition-colors duration-300 group\">\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <CardTitle className=\"flex items-center gap-2 flex-1\">\n                      <span className=\"text-primary\">\ud83e\udd16</span>\n                      <span className=\"truncate\">{agent.name}</span>\n                    </CardTitle>\n                    {agent.modelConfig?.model && (\n                      <span className=\"text-xs px-2 py-1 bg-purple-100 text-purple-700 rounded-full font-medium flex-shrink-0\">\n                        {agent.modelConfig.model}\n                      </span>\n                    )}\n                  </div>\n                  <CardDescription className=\"line-clamp-2\">{agent.description}</CardDescription>\n                </CardHeader>\n\n                <CardContent className=\"flex-grow space-y-3\">\n                  {/* Quick Stats */}\n                  <div className=\"grid grid-cols-2 gap-2 pb-3 border-b border-border\">\n                    {/* Skills Count */}\n                    {skillsCount > 0 && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <PuzzlePieceIcon className=\"h-4 w-4 text-green-600 flex-shrink-0\" />\n                        <span className=\"text-muted-foreground\">{skillsCount} Skill{skillsCount !== 1 ? 's' : ''}</span>\n                      </div>\n                    )}\n\n                    {/* Tools Count */}\n                    {toolsCount > 0 && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <CpuChipIcon className=\"h-4 w-4 text-blue-600 flex-shrink-0\" />\n                        <span className=\"text-muted-foreground\">{toolsCount} Tool{toolsCount !== 1 ? 's' : ''}</span>\n                      </div>\n                    )}\n\n                    {/* MCP Tools Count */}\n                    {mcpToolsCount > 0 && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <ServerIcon className=\"h-4 w-4 text-indigo-600 flex-shrink-0\" />\n                        <span className=\"text-muted-foreground\">{mcpToolsCount} MCP Tool{mcpToolsCount !== 1 ? 's' : ''}</span>\n                      </div>\n                    )}\n\n                    {/* Input Fields Count */}\n                    {inputFieldsCount > 0 && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <ClipboardListIcon className=\"h-4 w-4 text-orange-600 flex-shrink-0\" />\n                        <span className=\"text-muted-foreground\">{inputFieldsCount} Input{inputFieldsCount > 1 ? 's' : ''}</span>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Skills Section */}\n                  {agent.skillSelection && agent.skillSelection.length > 0 && (\n                    <div>\n                      <div className=\"flex items-center gap-1.5 mb-1.5\">\n                        <PuzzlePieceIcon className=\"h-3.5 w-3.5 text-green-600\" />\n                        <h4 className=\"font-semibold text-xs text-muted-foreground uppercase\">Skills</h4>\n                      </div>\n                      <div className=\"flex flex-wrap gap-1\">\n                        {agent.skillSelection.slice(0, 3).map((selection, idx) => {\n                          const skillName = typeof selection.skill === 'string' ? selection.skill : selection.skill.name;\n                          return (\n                            <span key={idx} className=\"text-xs bg-green-50 text-green-700 border border-green-200 px-2 py-0.5 rounded font-medium\">\n                              {skillName}\n                            </span>\n                          );\n                        })}\n                        {agent.skillSelection.length > 3 && (\n                          <span className=\"text-xs text-green-600 px-2 py-0.5 font-medium\">\n                            +{agent.skillSelection.length - 3} more\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Claude Tools */}\n                  {agent.toolConfig?.allowedTools && Array.isArray(agent.toolConfig.allowedTools) && agent.toolConfig.allowedTools.length > 0 && (\n                    <div>\n                      <div className=\"flex items-center gap-1.5 mb-1.5\">\n                        <CpuChipIcon className=\"h-3.5 w-3.5 text-blue-600\" />\n                        <h4 className=\"font-semibold text-xs text-muted-foreground uppercase\">Claude Tools</h4>\n                      </div>\n                      <div className=\"flex flex-wrap gap-1\">\n                        {agent.toolConfig.allowedTools.slice(0, 4).map((tool, idx) => (\n                          <span key={idx} className=\"text-xs bg-blue-50 text-blue-700 border border-blue-200 px-2 py-0.5 rounded\">\n                            {tool}\n                          </span>\n                        ))}\n                        {agent.toolConfig.allowedTools.length > 4 && (\n                          <span className=\"text-xs text-blue-600 px-2 py-0.5\">\n                            +{agent.toolConfig.allowedTools.length - 4}\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* MCP Tools */}\n                  {agent.mcpConfig && agent.mcpConfig.length > 0 && (\n                    <div>\n                      <div className=\"flex items-center gap-1.5 mb-1.5\">\n                        <ServerIcon className=\"h-3.5 w-3.5 text-indigo-600\" />\n                        <h4 className=\"font-semibold text-xs text-muted-foreground uppercase\">MCP Servers</h4>\n                      </div>\n                      <div className=\"space-y-1.5\">\n                        {agent.mcpConfig.slice(0, 2).map((config, idx) => {\n                          if (!config.mcpServer) return null;\n                          const serverName = typeof config.mcpServer === 'string' ? config.mcpServer : config.mcpServer.name;\n                          const toolsCount = config.selectedTools?.length || 0;\n                          return (\n                            <div key={idx}>\n                              <div className=\"text-xs font-medium text-indigo-600 mb-0.5\">{serverName}</div>\n                              {toolsCount > 0 && (\n                                <div className=\"flex flex-wrap gap-1\">\n                                  {config.selectedTools!.slice(0, 3).map((toolSel, tidx) => {\n                                    if (!toolSel.mcpTool) return null;\n                                    const toolName = typeof toolSel.mcpTool === 'string' ? toolSel.mcpTool : toolSel.mcpTool.name;\n                                    return (\n                                      <span key={tidx} className=\"text-xs bg-indigo-50 text-indigo-700 border border-indigo-200 px-2 py-0.5 rounded\">\n                                        {toolName}\n                                      </span>\n                                    );\n                                  })}\n                                  {toolsCount > 3 && (\n                                    <span className=\"text-xs text-indigo-600 px-2 py-0.5\">\n                                      +{toolsCount - 3}\n                                    </span>\n                                  )}\n                                </div>\n                              )}\n                            </div>\n                          );\n                        })}\n                        {agent.mcpConfig.length > 2 && (\n                          <div className=\"text-xs text-indigo-600 font-medium\">\n                            +{agent.mcpConfig.length - 2} more server(s)\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* File Info */}\n                  <div className=\"text-xs text-muted-foreground pt-2 border-t border-border\">\n                    \ud83d\udcc4 {agent.id}.md\n                  </div>\n                </CardContent>\n\n                <CardFooter className=\"flex gap-2 pt-3\">\n                  <Button\n                    className=\"flex-1\"\n                    size=\"sm\"\n                    onClick={() => setSelectedAgent(agent)}\n                  >\n                    Run Agent\n                  </Button>\n                  <Button\n                    variant=\"secondary\"\n                    size=\"sm\"\n                    onClick={() => handleEditClick(agent)}\n                  >\n                    Edit\n                  </Button>\n                </CardFooter>\n              </Card>\n            );\n          })\n        )}\n      </div>\n\n      {/* Agent Execution Modal */}\n      {selectedAgent && (\n        <AgentExecutionModal\n          agent={selectedAgent}\n          isOpen={!!selectedAgent}\n          onClose={() => setSelectedAgent(null)}\n          directory={directory}\n        />\n      )}\n\n      {/* Agent Creator/Editor Form */}\n      <AgentCreatorForm\n        isOpen={showCreatorForm}\n        onClose={() => {\n          setShowCreatorForm(false);\n          setEditingAgent(null);\n        }}\n        onSuccess={handleAgentCreated}\n        directory={directory}\n        editAgent={editingAgent || undefined}\n      />\n\n      {/* Agent Creator Chat Panel */}\n      <AgentCreatorChatPanel\n        isOpen={showCreatorChat}\n        onClose={() => setShowCreatorChat(false)}\n        onAgentCreated={handleAgentCreated}\n        directory={directory}\n      />\n    </div>\n  );\n};\n\nAgentsPage.displayName = 'AgentsPage';\n\nexport default AgentsPage;\n",
        "last_modified": "2026-01-02T14:22:15.550947"
      },
      "task_intent": {
        "title": "Document Frontend React Components and Hooks",
        "description": "Add comprehensive JSDoc documentation to all React components and custom hooks in the frontend, including prop types, usage examples, component purposes, state management, and side effects.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T14:01:10.896779",
  "last_updated": "2026-01-02T14:22:14.576513"
}