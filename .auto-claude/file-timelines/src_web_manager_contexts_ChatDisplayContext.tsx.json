{
  "file_path": "src/web/manager/contexts/ChatDisplayContext.tsx",
  "main_branch_history": [],
  "task_views": {
    "004-document-frontend-react-components-and-hooks": {
      "task_id": "004-document-frontend-react-components-and-hooks",
      "branch_point": {
        "commit_hash": "34a3f60da53773d90bd6579cb1cfd8417a1dd0b9",
        "content": "/**\n * Chat Display Context\n * Manages view mode and SDK event data for chat display\n */\n\nimport React, { createContext, useContext, useState, ReactNode } from 'react';\nimport type { ToolUseData, SystemMessageData, SDKEvent } from '../utils/sdk-event-parser';\n\nexport type ViewMode = 'simple' | 'detailed';\n\nexport interface ChatDisplayContextValue {\n  // View mode\n  viewMode: ViewMode;\n  setViewMode: (mode: ViewMode) => void;\n\n  // SDK event data\n  toolUses: Map<string, ToolUseData>;\n  setToolUses: React.Dispatch<React.SetStateAction<Map<string, ToolUseData>>>;\n\n  systemMessages: SystemMessageData[];\n  setSystemMessages: React.Dispatch<React.SetStateAction<SystemMessageData[]>>;\n\n  sdkEvents: SDKEvent[];\n  setSdkEvents: React.Dispatch<React.SetStateAction<SDKEvent[]>>;\n\n  // Helper functions\n  getToolUsesForMessage: (messageId: string) => ToolUseData[];\n  getSystemMessagesForMessage: (messageId: string) => SystemMessageData[];\n  clearEventData: () => void;\n}\n\nconst ChatDisplayContext = createContext<ChatDisplayContextValue | undefined>(undefined);\n\nexport interface ChatDisplayProviderProps {\n  children: ReactNode;\n}\n\nexport const ChatDisplayProvider: React.FC<ChatDisplayProviderProps> = ({ children }) => {\n  const [viewMode, setViewMode] = useState<ViewMode>('simple');\n  const [toolUses, setToolUses] = useState<Map<string, ToolUseData>>(new Map());\n  const [systemMessages, setSystemMessages] = useState<SystemMessageData[]>([]);\n  const [sdkEvents, setSdkEvents] = useState<SDKEvent[]>([]);\n\n  /**\n   * Get tool uses associated with a specific message\n   */\n  const getToolUsesForMessage = (messageId: string): ToolUseData[] => {\n    const result: ToolUseData[] = [];\n\n    for (const [, toolUse] of toolUses) {\n      if (toolUse.parentMessageId === messageId) {\n        result.push(toolUse);\n      }\n    }\n\n    // Sort by timestamp\n    return result.sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime());\n  };\n\n  /**\n   * Get system messages associated with a specific message\n   */\n  const getSystemMessagesForMessage = (messageId: string): SystemMessageData[] => {\n    return systemMessages\n      .filter(msg => msg.parentMessageId === messageId)\n      .sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime());\n  };\n\n  /**\n   * Clear all event data (e.g., when switching sessions)\n   */\n  const clearEventData = () => {\n    setToolUses(new Map());\n    setSystemMessages([]);\n    setSdkEvents([]);\n  };\n\n  const value: ChatDisplayContextValue = {\n    viewMode,\n    setViewMode,\n    toolUses,\n    setToolUses,\n    systemMessages,\n    setSystemMessages,\n    sdkEvents,\n    setSdkEvents,\n    getToolUsesForMessage,\n    getSystemMessagesForMessage,\n    clearEventData,\n  };\n\n  return <ChatDisplayContext.Provider value={value}>{children}</ChatDisplayContext.Provider>;\n};\n\n/**\n * Hook to use chat display context\n */\nexport const useChatDisplay = (): ChatDisplayContextValue => {\n  const context = useContext(ChatDisplayContext);\n\n  if (!context) {\n    throw new Error('useChatDisplay must be used within ChatDisplayProvider');\n  }\n\n  return context;\n};\n\nexport default ChatDisplayContext;\n",
        "timestamp": "2026-01-02T14:22:14.293924"
      },
      "worktree_state": {
        "content": "/**\n * Chat Display Context\n *\n * A React Context that manages the display state and SDK event data for the chat interface.\n * This context provides centralized state management for chat view modes (simple vs detailed)\n * and SDK-generated event data including tool uses, system messages, and raw SDK events.\n *\n * ## Features\n * - **View Mode Management**: Toggle between 'simple' and 'detailed' chat display modes\n * - **Tool Use Tracking**: Store and retrieve tool invocations associated with messages\n * - **System Message Storage**: Manage system-generated messages linked to parent messages\n * - **SDK Event Collection**: Track all SDK events for debugging and display purposes\n * - **Message Association**: Helper functions to query events by parent message ID\n * - **Session Management**: Clear all event data when switching chat sessions\n * - **Type-Safe API**: Fully typed context values with TypeScript interfaces\n *\n * ## Context Values\n * The context provides the following state and functions:\n *\n * ### View Mode State\n * - `viewMode`: Current display mode ('simple' shows basic messages, 'detailed' shows SDK events)\n * - `setViewMode`: Function to switch between view modes\n *\n * ### SDK Event Data State\n * - `toolUses`: Map of tool invocations indexed by tool use ID\n * - `setToolUses`: State setter for updating tool use data\n * - `systemMessages`: Array of system-generated messages\n * - `setSystemMessages`: State setter for updating system messages\n * - `sdkEvents`: Array of all SDK events in chronological order\n * - `setSdkEvents`: State setter for updating SDK events\n *\n * ### Helper Functions\n * - `getToolUsesForMessage`: Retrieve all tool uses for a specific message (sorted by timestamp)\n * - `getSystemMessagesForMessage`: Retrieve all system messages for a specific message (sorted by timestamp)\n * - `clearEventData`: Reset all event data (used when switching sessions or clearing chat)\n *\n * ## Provider Usage\n * Wrap your chat components with ChatDisplayProvider to provide context access:\n *\n * ```tsx\n * import { ChatDisplayProvider } from './contexts/ChatDisplayContext';\n *\n * function App() {\n *   return (\n *     <ChatDisplayProvider>\n *       <ChatPage />\n *     </ChatDisplayProvider>\n *   );\n * }\n * ```\n *\n * ## Consumer Patterns\n * Use the `useChatDisplay` hook to access context values in child components:\n *\n * ```tsx\n * import { useChatDisplay } from './contexts/ChatDisplayContext';\n *\n * function ChatMessage({ messageId }) {\n *   const { viewMode, getToolUsesForMessage } = useChatDisplay();\n *   const toolUses = getToolUsesForMessage(messageId);\n *\n *   return (\n *     <div>\n *       {viewMode === 'detailed' && toolUses.map(tool => (\n *         <ToolDisplay key={tool.id} data={tool} />\n *       ))}\n *     </div>\n *   );\n * }\n * ```\n *\n * ## State Management\n * The context uses React useState hooks internally to manage:\n * - View mode preference (persists during session)\n * - Tool use Map for efficient lookups by ID\n * - System messages array sorted by timestamp\n * - SDK events array maintaining chronological order\n *\n * All state setters follow React's immutability patterns, ensuring predictable updates\n * and proper re-renders when data changes.\n *\n * @example\n * // Basic provider setup\n * <ChatDisplayProvider>\n *   <ChatInterface />\n * </ChatDisplayProvider>\n *\n * @example\n * // Switching view modes\n * function ViewModeToggle() {\n *   const { viewMode, setViewMode } = useChatDisplay();\n *\n *   return (\n *     <button onClick={() => setViewMode(viewMode === 'simple' ? 'detailed' : 'simple')}>\n *       {viewMode === 'simple' ? 'Show Details' : 'Hide Details'}\n *     </button>\n *   );\n * }\n *\n * @example\n * // Accessing tool uses for a message\n * function MessageWithTools({ messageId }) {\n *   const { getToolUsesForMessage } = useChatDisplay();\n *   const tools = getToolUsesForMessage(messageId);\n *\n *   return (\n *     <div>\n *       <MessageContent id={messageId} />\n *       {tools.length > 0 && (\n *         <div className=\"tools\">\n *           {tools.map(tool => (\n *             <ToolUseDisplay key={tool.id} data={tool} />\n *           ))}\n *         </div>\n *       )}\n *     </div>\n *   );\n * }\n *\n * @example\n * // Clearing event data when switching sessions\n * function SessionSwitcher({ sessionId }) {\n *   const { clearEventData } = useChatDisplay();\n *\n *   useEffect(() => {\n *     // Clear previous session's event data\n *     clearEventData();\n *   }, [sessionId, clearEventData]);\n *\n *   return <ChatSession id={sessionId} />;\n * }\n *\n * @example\n * // Adding tool use data from SDK events\n * function ChatEventHandler() {\n *   const { setToolUses } = useChatDisplay();\n *\n *   const handleSDKEvent = (event: SDKEvent) => {\n *     if (event.type === 'tool_use') {\n *       setToolUses(prev => {\n *         const next = new Map(prev);\n *         next.set(event.toolUse.id, event.toolUse);\n *         return next;\n *       });\n *     }\n *   };\n *\n *   return <EventListener onEvent={handleSDKEvent} />;\n * }\n */\n\nimport React, { createContext, useContext, useState, ReactNode } from 'react';\nimport type { ToolUseData, SystemMessageData, SDKEvent } from '../utils/sdk-event-parser';\n\n/**\n * View mode for chat display\n * - `simple`: Shows only user and assistant messages (clean, minimal interface)\n * - `detailed`: Shows all SDK events, tool uses, and system messages (debugging/development mode)\n */\nexport type ViewMode = 'simple' | 'detailed';\n\n/**\n * Shape of the ChatDisplayContext value\n *\n * This interface defines all state and functions available to consumers of the\n * ChatDisplayContext. Components can access these values by using the useChatDisplay hook.\n */\nexport interface ChatDisplayContextValue {\n  /**\n   * Current view mode for the chat interface\n   *\n   * Controls what level of detail is shown in the chat:\n   * - `simple`: User/assistant messages only (default, clean UX)\n   * - `detailed`: Shows SDK events, tool invocations, system messages\n   */\n  viewMode: ViewMode;\n\n  /**\n   * Function to change the view mode\n   *\n   * @param mode - The new view mode to set ('simple' or 'detailed')\n   */\n  setViewMode: (mode: ViewMode) => void;\n\n  /**\n   * Map of tool use data indexed by tool use ID\n   *\n   * Each tool use represents a function/tool invocation by the AI assistant.\n   * The Map structure enables O(1) lookup by ID. Keys are tool use IDs,\n   * values are ToolUseData objects containing input, output, and metadata.\n   */\n  toolUses: Map<string, ToolUseData>;\n\n  /**\n   * State setter for tool uses Map\n   *\n   * Use this to add, update, or remove tool use data. Follow React's\n   * immutability pattern by creating a new Map instance:\n   *\n   * ```tsx\n   * setToolUses(prev => {\n   *   const next = new Map(prev);\n   *   next.set(toolId, toolData);\n   *   return next;\n   * });\n   * ```\n   */\n  setToolUses: React.Dispatch<React.SetStateAction<Map<string, ToolUseData>>>;\n\n  /**\n   * Array of system-generated messages\n   *\n   * System messages are generated by the SDK or backend, not by users or the assistant.\n   * Examples include status updates, warnings, or internal state changes.\n   * Each message has a parentMessageId linking it to the user/assistant message that triggered it.\n   */\n  systemMessages: SystemMessageData[];\n\n  /**\n   * State setter for system messages array\n   *\n   * Use this to add or update system messages. Follow React's immutability:\n   *\n   * ```tsx\n   * setSystemMessages(prev => [...prev, newMessage]);\n   * ```\n   */\n  setSystemMessages: React.Dispatch<React.SetStateAction<SystemMessageData[]>>;\n\n  /**\n   * Array of all SDK events in chronological order\n   *\n   * Raw SDK events include all event types emitted during chat interaction:\n   * message chunks, tool uses, completions, errors, etc. Useful for debugging\n   * and detailed event analysis.\n   */\n  sdkEvents: SDKEvent[];\n\n  /**\n   * State setter for SDK events array\n   *\n   * Use this to append new SDK events as they arrive:\n   *\n   * ```tsx\n   * setSdkEvents(prev => [...prev, newEvent]);\n   * ```\n   */\n  setSdkEvents: React.Dispatch<React.SetStateAction<SDKEvent[]>>;\n\n  /**\n   * Get all tool uses associated with a specific message\n   *\n   * Returns tool invocations that have the given messageId as their parent,\n   * sorted by timestamp (earliest first). This is useful for displaying\n   * tools that were called as part of processing a particular message.\n   *\n   * @param messageId - The ID of the parent message\n   * @returns Array of ToolUseData sorted by timestamp (ascending)\n   *\n   * @example\n   * const tools = getToolUsesForMessage('msg_123');\n   * // Returns: [{ id: 'tool_1', name: 'search', ... }, { id: 'tool_2', name: 'calculate', ... }]\n   */\n  getToolUsesForMessage: (messageId: string) => ToolUseData[];\n\n  /**\n   * Get all system messages associated with a specific message\n   *\n   * Returns system messages that have the given messageId as their parent,\n   * sorted by timestamp (earliest first). Useful for displaying system-generated\n   * notifications or status updates related to a message.\n   *\n   * @param messageId - The ID of the parent message\n   * @returns Array of SystemMessageData sorted by timestamp (ascending)\n   *\n   * @example\n   * const sysMessages = getSystemMessagesForMessage('msg_123');\n   * // Returns: [{ id: 'sys_1', content: 'Processing...', ... }, { id: 'sys_2', content: 'Complete', ... }]\n   */\n  getSystemMessagesForMessage: (messageId: string) => SystemMessageData[];\n\n  /**\n   * Clear all event data (tool uses, system messages, SDK events)\n   *\n   * Resets all event-related state to empty. Call this when:\n   * - Switching to a different chat session\n   * - Starting a new conversation\n   * - Clearing the chat history\n   * - Resetting the chat interface\n   *\n   * This ensures old event data doesn't leak into new sessions.\n   *\n   * @example\n   * // Clear when switching sessions\n   * useEffect(() => {\n   *   clearEventData();\n   * }, [sessionId]);\n   */\n  clearEventData: () => void;\n}\n\nconst ChatDisplayContext = createContext<ChatDisplayContextValue | undefined>(undefined);\n\n/**\n * Props for the ChatDisplayProvider component\n */\nexport interface ChatDisplayProviderProps {\n  /**\n   * Child components that will have access to the chat display context\n   *\n   * Any component rendered within this provider can access the context\n   * values using the useChatDisplay hook.\n   */\n  children: ReactNode;\n}\n\n/**\n * ChatDisplayProvider Component\n *\n * Provider component that manages and exposes chat display state to child components.\n * Wrap your chat interface with this provider to enable access to view modes, SDK events,\n * tool uses, and system messages throughout the component tree.\n *\n * ## Internal State\n * The provider initializes and manages the following state:\n * - `viewMode`: Defaults to 'simple' (minimal view)\n * - `toolUses`: Empty Map for tool invocation tracking\n * - `systemMessages`: Empty array for system message collection\n * - `sdkEvents`: Empty array for SDK event logging\n *\n * ## Helper Functions\n * The provider implements three helper functions:\n * - `getToolUsesForMessage`: Filters and sorts tool uses by parent message ID\n * - `getSystemMessagesForMessage`: Filters and sorts system messages by parent message ID\n * - `clearEventData`: Resets all event-related state to empty\n *\n * ## Usage\n * Place this provider high in your component tree, typically at the app or page level:\n *\n * @example\n * // At the app level\n * function App() {\n *   return (\n *     <ChatDisplayProvider>\n *       <ChatPage />\n *       <SettingsPanel />\n *     </ChatDisplayProvider>\n *   );\n * }\n *\n * @example\n * // At the page level for isolated chat instances\n * function ChatPage() {\n *   return (\n *     <ChatDisplayProvider>\n *       <ChatHeader />\n *       <ChatMessageList />\n *       <ChatInput />\n *     </ChatDisplayProvider>\n *   );\n * }\n */\nexport const ChatDisplayProvider: React.FC<ChatDisplayProviderProps> = ({ children }) => {\n  const [viewMode, setViewMode] = useState<ViewMode>('simple');\n  const [toolUses, setToolUses] = useState<Map<string, ToolUseData>>(new Map());\n  const [systemMessages, setSystemMessages] = useState<SystemMessageData[]>([]);\n  const [sdkEvents, setSdkEvents] = useState<SDKEvent[]>([]);\n\n  /**\n   * Get tool uses associated with a specific message\n   *\n   * Iterates through all tool uses in the Map and returns those whose\n   * parentMessageId matches the given messageId. Results are sorted by\n   * timestamp in ascending order (earliest first).\n   *\n   * @param messageId - The ID of the parent message to query\n   * @returns Array of ToolUseData objects sorted by timestamp (ascending)\n   */\n  const getToolUsesForMessage = (messageId: string): ToolUseData[] => {\n    const result: ToolUseData[] = [];\n\n    for (const [, toolUse] of toolUses) {\n      if (toolUse.parentMessageId === messageId) {\n        result.push(toolUse);\n      }\n    }\n\n    // Sort by timestamp (earliest first)\n    return result.sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime());\n  };\n\n  /**\n   * Get system messages associated with a specific message\n   *\n   * Filters the systemMessages array to find all messages whose\n   * parentMessageId matches the given messageId. Results are sorted by\n   * timestamp in ascending order (earliest first).\n   *\n   * @param messageId - The ID of the parent message to query\n   * @returns Array of SystemMessageData objects sorted by timestamp (ascending)\n   */\n  const getSystemMessagesForMessage = (messageId: string): SystemMessageData[] => {\n    return systemMessages\n      .filter(msg => msg.parentMessageId === messageId)\n      .sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime());\n  };\n\n  /**\n   * Clear all event data (tool uses, system messages, SDK events)\n   *\n   * Resets all event-related state to their initial empty values:\n   * - toolUses \u2192 new empty Map()\n   * - systemMessages \u2192 empty array []\n   * - sdkEvents \u2192 empty array []\n   *\n   * Call this function when switching chat sessions, clearing chat history,\n   * or resetting the chat interface to prevent old data from persisting.\n   */\n  const clearEventData = () => {\n    setToolUses(new Map());\n    setSystemMessages([]);\n    setSdkEvents([]);\n  };\n\n  const value: ChatDisplayContextValue = {\n    viewMode,\n    setViewMode,\n    toolUses,\n    setToolUses,\n    systemMessages,\n    setSystemMessages,\n    sdkEvents,\n    setSdkEvents,\n    getToolUsesForMessage,\n    getSystemMessagesForMessage,\n    clearEventData,\n  };\n\n  return <ChatDisplayContext.Provider value={value}>{children}</ChatDisplayContext.Provider>;\n};\n\n/**\n * useChatDisplay Hook\n *\n * Custom React hook to access the ChatDisplayContext values in child components.\n * This hook provides access to all chat display state, setters, and helper functions\n * defined in the context.\n *\n * ## Return Value\n * Returns the complete ChatDisplayContextValue object containing:\n * - View mode state (viewMode, setViewMode)\n * - SDK event data state (toolUses, systemMessages, sdkEvents, and their setters)\n * - Helper functions (getToolUsesForMessage, getSystemMessagesForMessage, clearEventData)\n *\n * ## Error Handling\n * Throws an error if called outside of a ChatDisplayProvider. Always ensure this hook\n * is used within a component tree wrapped by ChatDisplayProvider.\n *\n * ## Usage\n * Call this hook at the top level of your component (following React Hooks rules):\n *\n * @throws {Error} If used outside of ChatDisplayProvider\n * @returns {ChatDisplayContextValue} The chat display context values\n *\n * @example\n * // Basic usage - accessing view mode\n * function ChatHeader() {\n *   const { viewMode, setViewMode } = useChatDisplay();\n *\n *   return (\n *     <header>\n *       <h1>Chat</h1>\n *       <button onClick={() => setViewMode(viewMode === 'simple' ? 'detailed' : 'simple')}>\n *         Toggle View: {viewMode}\n *       </button>\n *     </header>\n *   );\n * }\n *\n * @example\n * // Accessing tool uses for a message\n * function MessageBubble({ messageId, content }) {\n *   const { getToolUsesForMessage, viewMode } = useChatDisplay();\n *   const toolUses = getToolUsesForMessage(messageId);\n *\n *   return (\n *     <div className=\"message\">\n *       <p>{content}</p>\n *       {viewMode === 'detailed' && toolUses.length > 0 && (\n *         <div className=\"tools\">\n *           <h4>Tools Used:</h4>\n *           {toolUses.map(tool => (\n *             <ToolDisplay key={tool.id} data={tool} />\n *           ))}\n *         </div>\n *       )}\n *     </div>\n *   );\n * }\n *\n * @example\n * // Using multiple context values\n * function ChatDebugPanel() {\n *   const {\n *     viewMode,\n *     setViewMode,\n *     toolUses,\n *     systemMessages,\n *     sdkEvents,\n *     clearEventData\n *   } = useChatDisplay();\n *\n *   return (\n *     <div className=\"debug-panel\">\n *       <h2>Debug Information</h2>\n *       <p>View Mode: {viewMode}</p>\n *       <p>Tool Uses: {toolUses.size}</p>\n *       <p>System Messages: {systemMessages.length}</p>\n *       <p>SDK Events: {sdkEvents.length}</p>\n *       <button onClick={() => setViewMode('detailed')}>Show Details</button>\n *       <button onClick={clearEventData}>Clear All Events</button>\n *     </div>\n *   );\n * }\n *\n * @example\n * // Clearing events on session change\n * function ChatSession({ sessionId }) {\n *   const { clearEventData } = useChatDisplay();\n *\n *   useEffect(() => {\n *     // Clear old session's event data when session changes\n *     clearEventData();\n *   }, [sessionId, clearEventData]);\n *\n *   return <ChatMessages sessionId={sessionId} />;\n * }\n */\nexport const useChatDisplay = (): ChatDisplayContextValue => {\n  const context = useContext(ChatDisplayContext);\n\n  if (!context) {\n    throw new Error('useChatDisplay must be used within ChatDisplayProvider');\n  }\n\n  return context;\n};\n\nexport default ChatDisplayContext;\n",
        "last_modified": "2026-01-02T15:11:36.297321"
      },
      "task_intent": {
        "title": "Document Frontend React Components and Hooks",
        "description": "Add comprehensive JSDoc documentation to all React components and custom hooks in the frontend, including prop types, usage examples, component purposes, state management, and side effects.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T14:01:12.046473",
  "last_updated": "2026-01-02T14:22:15.376273"
}