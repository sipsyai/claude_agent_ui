{
  "file_path": "src/web/manager/components/flow/FlowScheduleConfig.tsx",
  "main_branch_history": [],
  "task_views": {
    "007-uygulaman-n-genel-yap-s-n-d-zenleyece-iz-yani-uygu": {
      "task_id": "007-uygulaman-n-genel-yap-s-n-d-zenleyece-iz-yani-uygu",
      "branch_point": {
        "commit_hash": "9355e1f79162ecd7611ae3213457e87085b7fe4d",
        "content": "",
        "timestamp": "2026-01-02T15:21:46.864601"
      },
      "worktree_state": {
        "content": "import React from 'react';\nimport type {\n  FlowSchedule,\n  FlowScheduleType,\n  FlowIntervalUnit,\n} from '../../types';\nimport { Input } from '../ui/Input';\nimport { Select } from '../ui/Select';\nimport { Textarea } from '../ui/Textarea';\n\n// Schedule type options\nconst SCHEDULE_TYPE_OPTIONS: { value: FlowScheduleType; label: string; description: string }[] = [\n  { value: 'once', label: 'One Time', description: 'Execute once at a specific date/time' },\n  { value: 'cron', label: 'Cron Expression', description: 'Advanced scheduling with cron syntax' },\n  { value: 'interval', label: 'Interval', description: 'Execute repeatedly at fixed intervals' },\n];\n\n// Interval unit options\nconst INTERVAL_UNIT_OPTIONS: { value: FlowIntervalUnit; label: string }[] = [\n  { value: 'minutes', label: 'Minutes' },\n  { value: 'hours', label: 'Hours' },\n  { value: 'days', label: 'Days' },\n  { value: 'weeks', label: 'Weeks' },\n];\n\n// Common timezone options\nconst TIMEZONE_OPTIONS = [\n  { value: 'UTC', label: 'UTC' },\n  { value: 'Europe/Istanbul', label: 'Europe/Istanbul (GMT+3)' },\n  { value: 'Europe/London', label: 'Europe/London (GMT)' },\n  { value: 'Europe/Berlin', label: 'Europe/Berlin (GMT+1)' },\n  { value: 'America/New_York', label: 'America/New York (EST)' },\n  { value: 'America/Los_Angeles', label: 'America/Los Angeles (PST)' },\n  { value: 'Asia/Tokyo', label: 'Asia/Tokyo (JST)' },\n  { value: 'Asia/Shanghai', label: 'Asia/Shanghai (CST)' },\n  { value: 'Australia/Sydney', label: 'Australia/Sydney (AEDT)' },\n];\n\n// Common cron presets\nconst CRON_PRESETS: { value: string; label: string; description: string }[] = [\n  { value: '0 * * * *', label: 'Every Hour', description: 'At minute 0 of every hour' },\n  { value: '0 9 * * *', label: 'Daily at 9 AM', description: 'Every day at 09:00' },\n  { value: '0 9 * * 1-5', label: 'Weekdays at 9 AM', description: 'Mon-Fri at 09:00' },\n  { value: '0 0 * * 0', label: 'Weekly (Sunday)', description: 'Every Sunday at midnight' },\n  { value: '0 0 1 * *', label: 'Monthly', description: 'First day of each month at midnight' },\n  { value: '', label: 'Custom', description: 'Enter a custom cron expression' },\n];\n\n/**\n * Default schedule configuration\n */\nexport const createDefaultSchedule = (): FlowSchedule => ({\n  isEnabled: false,\n  scheduleType: 'interval',\n  intervalValue: 1,\n  intervalUnit: 'hours',\n  timezone: 'UTC',\n  runCount: 0,\n  defaultInput: {},\n  retryOnFailure: false,\n  maxRetries: 3,\n  retryDelayMinutes: 5,\n});\n\nexport interface FlowScheduleConfigProps {\n  schedule: FlowSchedule | undefined;\n  onChange: (schedule: FlowSchedule) => void;\n  className?: string;\n}\n\n/**\n * Configuration panel for Flow scheduling in the flow editor.\n * Allows users to configure automated execution schedules.\n */\nconst FlowScheduleConfig: React.FC<FlowScheduleConfigProps> = ({\n  schedule,\n  onChange,\n  className = '',\n}) => {\n  // Initialize schedule if undefined\n  const currentSchedule = schedule || createDefaultSchedule();\n\n  // Update handler that ensures we always have a complete schedule object\n  const handleChange = (updates: Partial<FlowSchedule>) => {\n    onChange({ ...currentSchedule, ...updates });\n  };\n\n  // Format date for datetime-local input\n  const formatDateForInput = (dateStr?: string): string => {\n    if (!dateStr) return '';\n    try {\n      const date = new Date(dateStr);\n      return date.toISOString().slice(0, 16);\n    } catch {\n      return '';\n    }\n  };\n\n  // Parse date from datetime-local input\n  const parseDateFromInput = (value: string): string | undefined => {\n    if (!value) return undefined;\n    return new Date(value).toISOString();\n  };\n\n  return (\n    <div className={`space-y-4 ${className}`}>\n      {/* Enable Schedule Toggle */}\n      <div className=\"flex items-center justify-between p-4 bg-secondary/30 rounded-lg\">\n        <div>\n          <label className=\"block font-medium\">Enable Scheduled Execution</label>\n          <p className=\"text-sm text-muted-foreground\">\n            Automatically run this flow on a schedule\n          </p>\n        </div>\n        <label className=\"relative inline-flex items-center cursor-pointer\">\n          <input\n            type=\"checkbox\"\n            checked={currentSchedule.isEnabled}\n            onChange={(e) => handleChange({ isEnabled: e.target.checked })}\n            className=\"sr-only peer\"\n          />\n          <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600\"></div>\n        </label>\n      </div>\n\n      {/* Schedule Configuration (only show if enabled) */}\n      {currentSchedule.isEnabled && (\n        <>\n          {/* Schedule Type */}\n          <div>\n            <label className=\"block text-sm font-medium mb-1\">Schedule Type</label>\n            <Select\n              value={currentSchedule.scheduleType}\n              onChange={(e) => handleChange({ scheduleType: e.target.value as FlowScheduleType })}\n            >\n              {SCHEDULE_TYPE_OPTIONS.map((opt) => (\n                <option key={opt.value} value={opt.value}>\n                  {opt.label}\n                </option>\n              ))}\n            </Select>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {SCHEDULE_TYPE_OPTIONS.find((o) => o.value === currentSchedule.scheduleType)?.description}\n            </p>\n          </div>\n\n          {/* One-Time Execution Settings */}\n          {currentSchedule.scheduleType === 'once' && (\n            <OneTimeScheduleSettings\n              startDate={currentSchedule.startDate}\n              timezone={currentSchedule.timezone}\n              onChange={handleChange}\n              formatDateForInput={formatDateForInput}\n              parseDateFromInput={parseDateFromInput}\n            />\n          )}\n\n          {/* Cron Expression Settings */}\n          {currentSchedule.scheduleType === 'cron' && (\n            <CronScheduleSettings\n              cronExpression={currentSchedule.cronExpression}\n              timezone={currentSchedule.timezone}\n              onChange={handleChange}\n            />\n          )}\n\n          {/* Interval Settings */}\n          {currentSchedule.scheduleType === 'interval' && (\n            <IntervalScheduleSettings\n              intervalValue={currentSchedule.intervalValue}\n              intervalUnit={currentSchedule.intervalUnit}\n              timezone={currentSchedule.timezone}\n              onChange={handleChange}\n            />\n          )}\n\n          {/* Date Range (for cron and interval) */}\n          {currentSchedule.scheduleType !== 'once' && (\n            <DateRangeSettings\n              startDate={currentSchedule.startDate}\n              endDate={currentSchedule.endDate}\n              maxRuns={currentSchedule.maxRuns}\n              onChange={handleChange}\n              formatDateForInput={formatDateForInput}\n              parseDateFromInput={parseDateFromInput}\n            />\n          )}\n\n          {/* Retry Settings */}\n          <RetrySettings\n            retryOnFailure={currentSchedule.retryOnFailure}\n            maxRetries={currentSchedule.maxRetries}\n            retryDelayMinutes={currentSchedule.retryDelayMinutes}\n            onChange={handleChange}\n          />\n\n          {/* Default Input Values */}\n          <div>\n            <label className=\"block text-sm font-medium mb-1\">\n              Default Input Values (JSON)\n              <span className=\"text-muted-foreground font-normal ml-1\">- Optional</span>\n            </label>\n            <Textarea\n              value={\n                Object.keys(currentSchedule.defaultInput || {}).length > 0\n                  ? JSON.stringify(currentSchedule.defaultInput, null, 2)\n                  : ''\n              }\n              onChange={(e) => {\n                try {\n                  const input = e.target.value ? JSON.parse(e.target.value) : {};\n                  handleChange({ defaultInput: input });\n                } catch {\n                  // Invalid JSON, ignore\n                }\n              }}\n              placeholder='{\"field1\": \"default value\", \"field2\": 123}'\n              className=\"min-h-[80px] font-mono text-sm\"\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Input values to use when the schedule triggers execution\n            </p>\n          </div>\n\n          {/* Schedule Info (read-only) */}\n          {(currentSchedule.nextRunAt || currentSchedule.lastRunAt || currentSchedule.runCount > 0) && (\n            <ScheduleInfoDisplay schedule={currentSchedule} />\n          )}\n        </>\n      )}\n    </div>\n  );\n};\n\n/**\n * One-time schedule settings\n */\ninterface OneTimeScheduleSettingsProps {\n  startDate?: string;\n  timezone: string;\n  onChange: (updates: Partial<FlowSchedule>) => void;\n  formatDateForInput: (dateStr?: string) => string;\n  parseDateFromInput: (value: string) => string | undefined;\n}\n\nconst OneTimeScheduleSettings: React.FC<OneTimeScheduleSettingsProps> = ({\n  startDate,\n  timezone,\n  onChange,\n  formatDateForInput,\n  parseDateFromInput,\n}) => (\n  <div className=\"p-4 bg-secondary/30 rounded-lg space-y-3\">\n    <h5 className=\"font-medium text-sm\">One-Time Execution</h5>\n    <div className=\"grid grid-cols-2 gap-3\">\n      <div>\n        <label className=\"block text-xs font-medium mb-1\">Execute At</label>\n        <Input\n          type=\"datetime-local\"\n          value={formatDateForInput(startDate)}\n          onChange={(e) => onChange({ startDate: parseDateFromInput(e.target.value) })}\n        />\n      </div>\n      <div>\n        <label className=\"block text-xs font-medium mb-1\">Timezone</label>\n        <Select\n          value={timezone}\n          onChange={(e) => onChange({ timezone: e.target.value })}\n        >\n          {TIMEZONE_OPTIONS.map((tz) => (\n            <option key={tz.value} value={tz.value}>\n              {tz.label}\n            </option>\n          ))}\n        </Select>\n      </div>\n    </div>\n  </div>\n);\n\n/**\n * Cron expression schedule settings\n */\ninterface CronScheduleSettingsProps {\n  cronExpression?: string;\n  timezone: string;\n  onChange: (updates: Partial<FlowSchedule>) => void;\n}\n\nconst CronScheduleSettings: React.FC<CronScheduleSettingsProps> = ({\n  cronExpression,\n  timezone,\n  onChange,\n}) => {\n  // Check if current expression matches a preset\n  const currentPreset = CRON_PRESETS.find((p) => p.value === cronExpression)?.value || '';\n\n  return (\n    <div className=\"p-4 bg-secondary/30 rounded-lg space-y-3\">\n      <h5 className=\"font-medium text-sm\">Cron Schedule</h5>\n\n      {/* Preset Selection */}\n      <div>\n        <label className=\"block text-xs font-medium mb-1\">Preset</label>\n        <Select\n          value={currentPreset}\n          onChange={(e) => {\n            if (e.target.value) {\n              onChange({ cronExpression: e.target.value });\n            }\n          }}\n        >\n          {CRON_PRESETS.map((preset) => (\n            <option key={preset.value || 'custom'} value={preset.value}>\n              {preset.label} - {preset.description}\n            </option>\n          ))}\n        </Select>\n      </div>\n\n      {/* Cron Expression Input */}\n      <div className=\"grid grid-cols-2 gap-3\">\n        <div>\n          <label className=\"block text-xs font-medium mb-1\">Cron Expression</label>\n          <Input\n            value={cronExpression || ''}\n            onChange={(e) => onChange({ cronExpression: e.target.value })}\n            placeholder=\"0 9 * * 1-5\"\n            className=\"font-mono\"\n          />\n          <p className=\"text-xs text-muted-foreground mt-1\">\n            Format: minute hour day month weekday\n          </p>\n        </div>\n        <div>\n          <label className=\"block text-xs font-medium mb-1\">Timezone</label>\n          <Select\n            value={timezone}\n            onChange={(e) => onChange({ timezone: e.target.value })}\n          >\n            {TIMEZONE_OPTIONS.map((tz) => (\n              <option key={tz.value} value={tz.value}>\n                {tz.label}\n              </option>\n            ))}\n          </Select>\n        </div>\n      </div>\n\n      {/* Cron Help */}\n      <div className=\"text-xs text-muted-foreground bg-secondary/50 p-2 rounded\">\n        <strong>Cron fields:</strong> minute (0-59), hour (0-23), day of month (1-31), month (1-12), day of week (0-6, 0=Sun)\n        <br />\n        <strong>Special chars:</strong> * (any), , (list), - (range), / (step)\n        <br />\n        <strong>Example:</strong> <code>0 9 * * 1-5</code> = Weekdays at 9:00 AM\n      </div>\n    </div>\n  );\n};\n\n/**\n * Interval-based schedule settings\n */\ninterface IntervalScheduleSettingsProps {\n  intervalValue: number;\n  intervalUnit: FlowIntervalUnit;\n  timezone: string;\n  onChange: (updates: Partial<FlowSchedule>) => void;\n}\n\nconst IntervalScheduleSettings: React.FC<IntervalScheduleSettingsProps> = ({\n  intervalValue,\n  intervalUnit,\n  timezone,\n  onChange,\n}) => (\n  <div className=\"p-4 bg-secondary/30 rounded-lg space-y-3\">\n    <h5 className=\"font-medium text-sm\">Interval Schedule</h5>\n    <div className=\"grid grid-cols-3 gap-3\">\n      <div>\n        <label className=\"block text-xs font-medium mb-1\">Every</label>\n        <Input\n          type=\"number\"\n          min={1}\n          value={intervalValue}\n          onChange={(e) =>\n            onChange({ intervalValue: Math.max(1, parseInt(e.target.value) || 1) })\n          }\n        />\n      </div>\n      <div>\n        <label className=\"block text-xs font-medium mb-1\">Unit</label>\n        <Select\n          value={intervalUnit}\n          onChange={(e) => onChange({ intervalUnit: e.target.value as FlowIntervalUnit })}\n        >\n          {INTERVAL_UNIT_OPTIONS.map((unit) => (\n            <option key={unit.value} value={unit.value}>\n              {unit.label}\n            </option>\n          ))}\n        </Select>\n      </div>\n      <div>\n        <label className=\"block text-xs font-medium mb-1\">Timezone</label>\n        <Select\n          value={timezone}\n          onChange={(e) => onChange({ timezone: e.target.value })}\n        >\n          {TIMEZONE_OPTIONS.map((tz) => (\n            <option key={tz.value} value={tz.value}>\n              {tz.label}\n            </option>\n          ))}\n        </Select>\n      </div>\n    </div>\n    <p className=\"text-xs text-muted-foreground\">\n      Execute every {intervalValue} {intervalUnit.toLowerCase()}\n    </p>\n  </div>\n);\n\n/**\n * Date range settings for recurring schedules\n */\ninterface DateRangeSettingsProps {\n  startDate?: string;\n  endDate?: string;\n  maxRuns?: number;\n  onChange: (updates: Partial<FlowSchedule>) => void;\n  formatDateForInput: (dateStr?: string) => string;\n  parseDateFromInput: (value: string) => string | undefined;\n}\n\nconst DateRangeSettings: React.FC<DateRangeSettingsProps> = ({\n  startDate,\n  endDate,\n  maxRuns,\n  onChange,\n  formatDateForInput,\n  parseDateFromInput,\n}) => (\n  <div className=\"grid grid-cols-3 gap-4\">\n    <div>\n      <label className=\"block text-sm font-medium mb-1\">\n        Start Date\n        <span className=\"text-muted-foreground font-normal ml-1\">- Optional</span>\n      </label>\n      <Input\n        type=\"datetime-local\"\n        value={formatDateForInput(startDate)}\n        onChange={(e) => onChange({ startDate: parseDateFromInput(e.target.value) })}\n      />\n      <p className=\"text-xs text-muted-foreground mt-1\">\n        When to start the schedule\n      </p>\n    </div>\n    <div>\n      <label className=\"block text-sm font-medium mb-1\">\n        End Date\n        <span className=\"text-muted-foreground font-normal ml-1\">- Optional</span>\n      </label>\n      <Input\n        type=\"datetime-local\"\n        value={formatDateForInput(endDate)}\n        onChange={(e) => onChange({ endDate: parseDateFromInput(e.target.value) })}\n      />\n      <p className=\"text-xs text-muted-foreground mt-1\">\n        When to stop the schedule\n      </p>\n    </div>\n    <div>\n      <label className=\"block text-sm font-medium mb-1\">\n        Max Runs\n        <span className=\"text-muted-foreground font-normal ml-1\">- Optional</span>\n      </label>\n      <Input\n        type=\"number\"\n        min={0}\n        value={maxRuns ?? ''}\n        onChange={(e) =>\n          onChange({ maxRuns: e.target.value ? parseInt(e.target.value) : undefined })\n        }\n        placeholder=\"Unlimited\"\n      />\n      <p className=\"text-xs text-muted-foreground mt-1\">\n        Maximum number of executions\n      </p>\n    </div>\n  </div>\n);\n\n/**\n * Retry settings for failed executions\n */\ninterface RetrySettingsProps {\n  retryOnFailure: boolean;\n  maxRetries: number;\n  retryDelayMinutes: number;\n  onChange: (updates: Partial<FlowSchedule>) => void;\n}\n\nconst RetrySettings: React.FC<RetrySettingsProps> = ({\n  retryOnFailure,\n  maxRetries,\n  retryDelayMinutes,\n  onChange,\n}) => (\n  <div className=\"p-4 bg-secondary/30 rounded-lg space-y-3\">\n    <div className=\"flex items-center gap-2\">\n      <input\n        type=\"checkbox\"\n        id=\"retryOnFailure\"\n        checked={retryOnFailure}\n        onChange={(e) => onChange({ retryOnFailure: e.target.checked })}\n        className=\"w-4 h-4 rounded\"\n      />\n      <label htmlFor=\"retryOnFailure\" className=\"font-medium text-sm cursor-pointer\">\n        Retry on Failure\n      </label>\n    </div>\n\n    {retryOnFailure && (\n      <div className=\"grid grid-cols-2 gap-3\">\n        <div>\n          <label className=\"block text-xs font-medium mb-1\">Max Retries</label>\n          <Input\n            type=\"number\"\n            min={1}\n            max={10}\n            value={maxRetries}\n            onChange={(e) =>\n              onChange({ maxRetries: Math.min(10, Math.max(1, parseInt(e.target.value) || 3)) })\n            }\n          />\n        </div>\n        <div>\n          <label className=\"block text-xs font-medium mb-1\">Retry Delay (minutes)</label>\n          <Input\n            type=\"number\"\n            min={1}\n            max={60}\n            value={retryDelayMinutes}\n            onChange={(e) =>\n              onChange({\n                retryDelayMinutes: Math.min(60, Math.max(1, parseInt(e.target.value) || 5)),\n              })\n            }\n          />\n        </div>\n      </div>\n    )}\n  </div>\n);\n\n/**\n * Display read-only schedule info\n */\ninterface ScheduleInfoDisplayProps {\n  schedule: FlowSchedule;\n}\n\nconst ScheduleInfoDisplay: React.FC<ScheduleInfoDisplayProps> = ({ schedule }) => {\n  const formatDate = (dateStr?: string): string => {\n    if (!dateStr) return 'N/A';\n    try {\n      return new Date(dateStr).toLocaleString();\n    } catch {\n      return 'N/A';\n    }\n  };\n\n  return (\n    <div className=\"p-4 bg-blue-50 border border-blue-200 rounded-lg space-y-2\">\n      <h5 className=\"font-medium text-sm text-blue-800\">Schedule Status</h5>\n      <div className=\"grid grid-cols-3 gap-4 text-sm\">\n        <div>\n          <span className=\"text-blue-600\">Next Run:</span>{' '}\n          <span className=\"font-medium\">{formatDate(schedule.nextRunAt)}</span>\n        </div>\n        <div>\n          <span className=\"text-blue-600\">Last Run:</span>{' '}\n          <span className=\"font-medium\">{formatDate(schedule.lastRunAt)}</span>\n        </div>\n        <div>\n          <span className=\"text-blue-600\">Run Count:</span>{' '}\n          <span className=\"font-medium\">\n            {schedule.runCount}\n            {schedule.maxRuns ? ` / ${schedule.maxRuns}` : ''}\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default FlowScheduleConfig;\n",
        "last_modified": "2026-01-02T17:55:06.531720"
      },
      "task_intent": {
        "title": "007-uygulaman-n-genel-yap-s-n-d-zenleyece-iz-yani-uygu",
        "description": "Implement a workflow/flow system for organizing agents and skills into reusable, schedulable processes with input/output handling. This transforms the application from a simple agent manager to a process automation tool where users can define workflows like 'Web Scraper' that take input, run agents with skills, and produce structured outputs.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T15:21:47.157558",
  "last_updated": "2026-01-02T15:21:47.168407"
}