{
  "file_path": "src/web/manager/components/SkillTrainingChatPanel.tsx",
  "main_branch_history": [],
  "task_views": {
    "004-document-frontend-react-components-and-hooks": {
      "task_id": "004-document-frontend-react-components-and-hooks",
      "branch_point": {
        "commit_hash": "34a3f60da53773d90bd6579cb1cfd8417a1dd0b9",
        "content": "import React, { useRef, useEffect } from 'react';\nimport { Button } from './ui/Button';\nimport { Input } from './ui/Input';\nimport { XCircleIcon, SparklesIcon, CheckCircleIcon, ExclamationCircleIcon, PlayIcon } from './ui/Icons';\nimport ReactMarkdown from 'react-markdown';\nimport { useSkillTraining } from '../hooks/useSkillTraining';\nimport { ProgressBar } from './ui/ProgressBar';\n\ninterface Skill {\n  id: string;\n  name: string;\n  description: string;\n  experienceScore?: number;\n}\n\ninterface SkillTrainingChatPanelProps {\n  isOpen: boolean;\n  onClose: () => void;\n  skill: Skill | null;\n  directory?: string;\n  onTrainingComplete?: () => void;\n}\n\nconst SkillTrainingChatPanel: React.FC<SkillTrainingChatPanelProps> = ({\n  isOpen,\n  onClose,\n  skill,\n  directory,\n  onTrainingComplete,\n}) => {\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [inputValue, setInputValue] = React.useState('');\n\n  const {\n    messages,\n    trainingStatus,\n    isProcessing,\n    error,\n    startTraining,\n    sendMessage,\n    reset\n  } = useSkillTraining({\n    skillId: skill?.id || '',\n    directory,\n    onTrainingComplete: (oldScore, newScore) => {\n      console.log('[Training] Completed:', { oldScore, newScore });\n      if (onTrainingComplete) {\n        onTrainingComplete();\n      }\n    },\n    onError: (err) => {\n      console.error('[Training] Error:', err);\n    }\n  });\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  const handleClose = () => {\n    onClose();\n    // Reset state after animation\n    setTimeout(() => {\n      reset();\n      setInputValue('');\n    }, 300);\n  };\n\n  const handleStartTraining = () => {\n    startTraining();\n  };\n\n  const handleSendMessage = async () => {\n    if (!inputValue.trim() || isProcessing) return;\n    const content = inputValue;\n    setInputValue('');\n    try {\n      await sendMessage(content);\n    } catch (error) {\n      console.error('[Training] Failed to send message:', error);\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  if (!isOpen || !skill) return null;\n\n  // Status label\n  const getStatusLabel = () => {\n    switch (trainingStatus.status) {\n      case 'idle':\n        return 'Ready to train';\n      case 'starting':\n        return 'Initializing...';\n      case 'analyzing':\n        return 'Analyzing skill...';\n      case 'training':\n        return 'Executing skill...';\n      case 'evaluating':\n        return 'Evaluating results...';\n      case 'updating':\n        return 'Updating skill...';\n      case 'completed':\n        return 'Training completed!';\n      case 'error':\n        return 'Training failed';\n      default:\n        return 'Training...';\n    }\n  };\n\n  // Status icon\n  const getStatusIcon = () => {\n    if (trainingStatus.status === 'completed') {\n      return <CheckCircleIcon className=\"h-5 w-5 text-green-600\" />;\n    }\n    if (trainingStatus.status === 'error') {\n      return <ExclamationCircleIcon className=\"h-5 w-5 text-red-600\" />;\n    }\n    if (isProcessing) {\n      return (\n        <div className=\"h-5 w-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin\" />\n      );\n    }\n    return <SparklesIcon className=\"h-5 w-5 text-purple-600\" />;\n  };\n\n  return (\n    <>\n      {/* Overlay */}\n      <div\n        className=\"fixed inset-0 bg-black/20 z-40 transition-opacity duration-300\"\n        onClick={handleClose}\n      />\n\n      {/* Slide-in Panel */}\n      <div\n        className={`fixed right-0 top-0 h-full w-full sm:w-[700px] bg-background border-l border-border shadow-2xl z-50 transform transition-transform duration-300 ease-in-out ${\n          isOpen ? 'translate-x-0' : 'translate-x-full'\n        }`}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-border bg-gradient-to-r from-purple-50 to-blue-50\">\n          <div className=\"flex items-center gap-3\">\n            {getStatusIcon()}\n            <div>\n              <h2 className=\"text-lg font-semibold text-foreground\">Training: {skill.name}</h2>\n              <p className=\"text-sm text-muted-foreground\">{getStatusLabel()}</p>\n            </div>\n          </div>\n          <button\n            onClick={handleClose}\n            className=\"text-muted-foreground hover:text-foreground transition-colors p-2 rounded-md hover:bg-background/50\"\n            aria-label=\"Close panel\"\n          >\n            <XCircleIcon className=\"h-6 w-6\" />\n          </button>\n        </div>\n\n        {/* Skill Info */}\n        <div className=\"p-4 border-b border-border bg-background\">\n          <div className=\"space-y-3\">\n            <div>\n              <p className=\"text-sm text-muted-foreground mb-2\">{skill.description}</p>\n            </div>\n            <ProgressBar\n              value={trainingStatus.newScore !== undefined ? trainingStatus.newScore : skill.experienceScore || 0}\n              showLabel={true}\n              size=\"md\"\n            />\n            {trainingStatus.newScore !== undefined && trainingStatus.newScore !== trainingStatus.currentScore && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <span className=\"text-muted-foreground\">Score updated:</span>\n                <span className=\"font-medium text-foreground\">\n                  {trainingStatus.currentScore}% \u2192 {trainingStatus.newScore}%\n                </span>\n                <span className=\"text-green-600 font-medium\">\n                  (+{trainingStatus.newScore - trainingStatus.currentScore}%)\n                </span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Messages Area */}\n        <div className=\"flex-1 overflow-y-auto p-4 space-y-4 h-[calc(100vh-280px)]\">\n          {messages.length === 0 && trainingStatus.status === 'idle' && (\n            <div className=\"flex flex-col items-center justify-center h-full text-center space-y-4\">\n              <SparklesIcon className=\"h-16 w-16 text-purple-300\" />\n              <div>\n                <h3 className=\"text-lg font-semibold text-foreground mb-2\">Ready to Train</h3>\n                <p className=\"text-sm text-muted-foreground max-w-md\">\n                  The Training Agent will analyze this skill, execute it, evaluate the results, and update the documentation and experience score.\n                </p>\n              </div>\n              <Button onClick={handleStartTraining} size=\"lg\" className=\"gap-2\">\n                <PlayIcon className=\"h-5 w-5\" />\n                Start Training\n              </Button>\n            </div>\n          )}\n\n          {messages.map((message) => (\n            <div\n              key={message.id}\n              className={`flex ${\n                message.role === 'user' ? 'justify-end' : 'justify-start'\n              }`}\n            >\n              <div\n                className={`max-w-[85%] rounded-lg p-3 ${\n                  message.role === 'user'\n                    ? 'bg-primary text-primary-foreground ml-4'\n                    : message.role === 'system'\n                    ? `border ${\n                        message.type === 'error'\n                          ? 'border-red-200 bg-red-50 text-red-900'\n                          : message.type === 'success'\n                          ? 'border-green-200 bg-green-50 text-green-900'\n                          : message.type === 'warning'\n                          ? 'border-yellow-200 bg-yellow-50 text-yellow-900'\n                          : 'border-blue-200 bg-blue-50 text-blue-900'\n                      }`\n                    : 'bg-muted text-foreground mr-4'\n                }`}\n              >\n                {message.role === 'assistant' ? (\n                  <div className=\"prose prose-sm max-w-none\">\n                    <ReactMarkdown>\n                      {message.content}\n                    </ReactMarkdown>\n                  </div>\n                ) : (\n                  <p className=\"text-sm whitespace-pre-wrap\">{message.content}</p>\n                )}\n                <span className=\"text-xs opacity-70 mt-1 block\">\n                  {message.timestamp.toLocaleTimeString()}\n                </span>\n              </div>\n            </div>\n          ))}\n\n          {isProcessing && messages.length > 0 && trainingStatus.status !== 'completed' && (\n            <div className=\"flex justify-start\">\n              <div className=\"bg-muted text-foreground rounded-lg p-3 max-w-[85%]\">\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }} />\n                  <div className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }} />\n                  <div className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }} />\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div ref={messagesEndRef} />\n        </div>\n\n        {/* Footer */}\n        <div className=\"border-t border-border p-4 bg-background\">\n          {trainingStatus.status === 'completed' ? (\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2 text-green-600\">\n                <CheckCircleIcon className=\"h-5 w-5\" />\n                <span className=\"text-sm font-medium\">Training completed successfully!</span>\n              </div>\n              <Button onClick={handleClose}>Close</Button>\n            </div>\n          ) : trainingStatus.status === 'error' ? (\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2 text-red-600\">\n                <ExclamationCircleIcon className=\"h-5 w-5\" />\n                <span className=\"text-sm font-medium\">\n                  {error?.message || 'Training failed'}\n                </span>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button variant=\"secondary\" onClick={() => reset()}>\n                  Reset\n                </Button>\n                <Button onClick={handleClose}>Close</Button>\n              </div>\n            </div>\n          ) : trainingStatus.status === 'idle' ? (\n            <div className=\"flex justify-center\">\n              <Button onClick={handleStartTraining} disabled={isProcessing} size=\"lg\" className=\"gap-2\">\n                <PlayIcon className=\"h-5 w-5\" />\n                Start Training\n              </Button>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-2 text-blue-600\">\n                <div className=\"h-4 w-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin\" />\n                <span className=\"text-sm font-medium\">{getStatusLabel()}</span>\n              </div>\n              <div className=\"flex gap-2\">\n                <Input\n                  ref={inputRef}\n                  value={inputValue}\n                  onChange={(e) => setInputValue(e.target.value)}\n                  onKeyPress={handleKeyPress}\n                  placeholder=\"Respond to training agent...\"\n                  disabled={isProcessing}\n                  className=\"flex-1\"\n                />\n                <Button onClick={handleSendMessage} disabled={!inputValue.trim() || isProcessing}>\n                  Send\n                </Button>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </>\n  );\n};\n\nexport default SkillTrainingChatPanel;\n",
        "timestamp": "2026-01-02T14:22:14.293924"
      },
      "worktree_state": {
        "content": "/**\n * @file SkillTrainingChatPanel.tsx\n * @description Interactive slide-in panel for training existing skills through a conversational interface\n * with the Training Agent. This component provides a chat-based workflow powered by the useSkillTraining\n * hook, guiding users through skill improvement with real-time feedback, status tracking, and score updates.\n *\n * ## Features\n * - **Interactive Training Interface**: Conversational workflow for skill training and improvement\n * - **SSE Streaming Integration**: Real-time message streaming via useSkillTraining hook\n * - **Status Tracking**: Visual indicators for training phases (analyzing, training, evaluating, updating)\n * - **Score Progression**: Real-time experience score tracking with before/after comparison\n * - **Multi-State UI**: Dynamic UI adapting to training status (idle, training, completed, error)\n * - **Auto-Scroll**: Automatic scrolling to latest messages\n * - **Keyboard Shortcuts**: Enter to send, Shift+Enter for new line\n * - **Slide-In Animation**: Smooth right-to-left panel animation\n * - **Overlay Backdrop**: Click-outside-to-close functionality\n * - **State Persistence**: Panel state management across training lifecycle\n * - **Error Recovery**: Reset and retry functionality on failure\n *\n * ## Training Workflow\n * The component orchestrates a comprehensive skill training workflow:\n *\n * ### Workflow Steps\n * 1. **Panel Opens**: User opens panel with existing skill, displays initial state\n * 2. **Idle State**: Shows \"Ready to Train\" screen with skill info and Start Training button\n * 3. **User Starts**: User clicks \"Start Training\" button (or auto-starts via conversation)\n * 4. **Analyzing Phase**: Training Agent analyzes skill implementation and test results\n * 5. **Training Phase**: Agent executes training iterations and improvements\n * 6. **Evaluating Phase**: Agent evaluates performance and calculates new score\n * 7. **Updating Phase**: Agent updates skill files with improvements\n * 8. **Completed State**: Shows success message with score improvement (e.g., 75% \u2192 85%)\n * 9. **Callback Invoked**: onTrainingComplete callback triggers for parent refresh\n *\n * ### Auto-Start Behavior\n * - When panel opens (`isOpen: true`) with skill, displays idle state\n * - User clicks \"Start Training\" button to initiate training\n * - Calls `startTraining()` which sends \"__START_TRAINING__\" message\n * - Training Agent begins analysis within ~1-2 seconds via SSE streaming\n * - Status updates appear automatically as training progresses\n *\n * ## Message Flow\n * The component handles bidirectional message exchange with training status integration:\n *\n * ### User Messages\n * - User types in input field (only enabled during active training, not idle/completed/error)\n * - `handleSendMessage()` called with input value\n * - Input cleared immediately (optimistic UI)\n * - Message sent to backend via `sendMessage(content)`\n * - User message appears in chat with right-aligned blue background\n * - Timestamp displayed below message (HH:MM:SS format)\n *\n * ### Assistant Messages\n * - Received via SSE streaming from useSkillTraining hook\n * - Messages array updated in real-time as chunks arrive\n * - Assistant messages appear with left-aligned muted background\n * - Content rendered as markdown using ReactMarkdown\n * - Timestamp displayed below message (HH:MM:SS format)\n * - Auto-scroll triggers on each new message\n * - Messages parsed for training status keywords and score updates\n *\n * ### System Messages\n * - Generated for status changes (analyzing, training, evaluating, updating)\n * - Color-coded based on type:\n *   - Info (blue): Status updates\n *   - Success (green): Training completed\n *   - Warning (yellow): Warnings during training\n *   - Error (red): Training failures\n * - Centered with pill-shaped background\n *\n * ### Processing Indicator\n * - When `isProcessing: true` and training active, displays animated dots\n * - Three bouncing dots with staggered animation delays (0ms, 150ms, 300ms)\n * - Input field disabled during processing\n * - Send button disabled during processing\n *\n * ## Integration with useSkillTraining\n * The component deeply integrates with the useSkillTraining hook:\n *\n * ### Hook Setup\n * ```typescript\n * const {\n *   messages,        // Conversation history\n *   trainingStatus,  // Current training phase and scores\n *   isProcessing,    // True when waiting for response\n *   error,           // Error object if training fails\n *   startTraining,   // Initiates training session\n *   sendMessage,     // Sends user message\n *   reset            // Clears state for new session\n * } = useSkillTraining({ skillId, directory, onTrainingComplete, onError });\n * ```\n *\n * ### Hook Callbacks\n * - **onTrainingComplete**: Called when training finishes successfully\n *   - Receives oldScore and newScore parameters\n *   - Triggers parent `onTrainingComplete()` callback\n *   - Hook extracts scores from training status\n *\n * - **onError**: Called when training fails\n *   - Logs error to console\n *   - Shows error UI with reset button\n *\n * ### Training Status Tracking\n * - `trainingStatus.status`: Current phase (idle, starting, analyzing, training, evaluating, updating, completed, error)\n * - `trainingStatus.currentScore`: Current skill experience score (0-100)\n * - `trainingStatus.newScore`: Updated score after training completes (0-100)\n * - `trainingStatus.issuesFound`: Optional array of issues detected during analysis\n *\n * ### State Synchronization\n * - Hook automatically updates `trainingStatus` based on backend events\n * - Component renders different UI based on status:\n *   - `idle` \u2192 \"Ready to Train\" screen with Start button\n *   - `starting`, `analyzing`, `training`, `evaluating`, `updating` \u2192 Chat with status indicator\n *   - `completed` \u2192 Success message with score comparison\n *   - `error` \u2192 Error message with reset and retry buttons\n *\n * ## Panel States\n * The component adapts its UI based on training status:\n *\n * ### 1. Idle State (`trainingStatus.status === 'idle'`)\n * - **Display**: \"Ready to Train\" screen with skill info\n * - **Behavior**: Waiting for user to start training\n * - **UI Elements**:\n *   - Sparkles icon (64px, purple)\n *   - Heading: \"Ready to Train\"\n *   - Description: Training workflow explanation\n *   - Start Training button (large, with Play icon)\n *   - Skill description and current experience score in header\n * - **Footer**: Centered Start Training button\n *\n * ### 2. Active Training States (`starting`, `analyzing`, `training`, `evaluating`, `updating`)\n * - **Display**: Chat interface with status indicator\n * - **Behavior**: Active conversation with status updates\n * - **UI Elements**:\n *   - Messages area: Scrollable with auto-scroll\n *   - Processing indicator: Animated dots when isProcessing\n *   - Status label: \"Initializing...\", \"Analyzing skill...\", \"Executing skill...\", etc.\n *   - Status icon: Spinning circle (blue) for active phases\n *   - Input field: Enabled for user interaction\n *   - Send button: Enabled when input has content and not processing\n * - **Footer**: Input field with status indicator (blue spinner + status text)\n *\n * ### 3. Completed State (`trainingStatus.status === 'completed'`)\n * - **Display**: Success banner in footer\n * - **Trigger**: Hook detects training completion with new score\n * - **UI Elements**:\n *   - Green checkmark icon\n *   - Success text: \"Training completed successfully!\"\n *   - Score comparison: \"75% \u2192 85% (+10%)\" in header\n *   - Close button\n * - **Styling**: Green color scheme (green-600)\n *\n * ### 4. Error State (`trainingStatus.status === 'error'`)\n * - **Display**: Error banner in footer\n * - **Trigger**: Hook encounters error during training\n * - **UI Elements**:\n *   - Red exclamation icon\n *   - Error message: Error text or \"Training failed\"\n *   - Reset button (secondary variant)\n *   - Close button (primary variant)\n * - **Styling**: Red color scheme (red-600)\n *\n * ## Status Indicators\n * The component provides rich visual feedback for training status:\n *\n * ### Status Labels\n * - **idle**: \"Ready to train\"\n * - **starting**: \"Initializing...\"\n * - **analyzing**: \"Analyzing skill...\"\n * - **training**: \"Executing skill...\"\n * - **evaluating**: \"Evaluating results...\"\n * - **updating**: \"Updating skill...\"\n * - **completed**: \"Training completed!\"\n * - **error**: \"Training failed\"\n *\n * ### Status Icons\n * - **idle**: Purple sparkles icon (SparklesIcon)\n * - **starting/analyzing/training/evaluating/updating**: Blue spinning circle\n * - **completed**: Green checkmark (CheckCircleIcon)\n * - **error**: Red exclamation mark (ExclamationCircleIcon)\n *\n * ### Progress Bar\n * - Displays current skill experience score (0-100)\n * - Color-coded based on score:\n *   - 0-33%: Red\n *   - 34-66%: Yellow\n *   - 67-100%: Green\n * - Shows percentage label\n * - Updates in real-time as newScore changes\n *\n * ### Score Updates\n * - When newScore !== currentScore, shows comparison:\n *   - \"Score updated: 75% \u2192 85%\"\n *   - Green \"(+10%)\" for improvements\n * - Displayed below progress bar in skill info section\n *\n * ## Auto-Scroll Behavior\n * The component implements smooth auto-scrolling to keep latest messages visible:\n *\n * ### Implementation\n * - `messagesEndRef` positioned at bottom of message list\n * - `useEffect` watches `messages` array for changes\n * - When messages update, calls `scrollIntoView({ behavior: 'smooth' })`\n * - Scrolls to bottom of chat area within ~300ms smooth animation\n *\n * ### Scroll Triggers\n * - New assistant message arrives via SSE\n * - User sends message (optimistically added to array)\n * - System message added for status change\n * - Processing indicator appears/disappears\n *\n * ## Keyboard Shortcuts\n * The component supports keyboard shortcuts for efficient interaction:\n *\n * ### Enter Key\n * - **Action**: Send message\n * - **Condition**: Not holding Shift key, input has content, not processing\n * - **Handler**: `handleKeyPress(e)` \u2192 `e.preventDefault()` \u2192 `handleSendMessage()`\n * - **Note**: Prevents default form submission behavior\n *\n * ### Shift+Enter\n * - **Action**: Insert new line (not functional with single-line Input component)\n * - **Condition**: Holding Shift key\n * - **Behavior**: Default browser behavior would insert newline\n * - **Note**: Currently input is single-line, so this may not function as expected\n *\n * ## Styling Behavior\n * The component uses Tailwind CSS for theming and layout:\n *\n * ### Panel Layout\n * - **Position**: Fixed right side, full height\n * - **Width**: Full width on mobile (`w-full`), 700px on desktop (`sm:w-[700px]`)\n * - **Z-Index**: 50 (above overlay at z-40)\n * - **Animation**: `translate-x-full` (hidden) \u2192 `translate-x-0` (visible)\n * - **Duration**: 300ms ease-in-out transition\n *\n * ### Overlay\n * - **Background**: `bg-black/20` (20% opacity black)\n * - **Z-Index**: 40 (below panel)\n * - **Interaction**: Clickable to close panel\n * - **Transition**: 300ms opacity fade\n *\n * ### Header\n * - **Gradient**: Purple to blue gradient background (`from-purple-50 to-blue-50`)\n * - **Icon**: Dynamic based on status (sparkles/spinner/checkmark/exclamation)\n * - **Title**: \"Training: {skill.name}\" (lg semibold)\n * - **Subtitle**: Dynamic status label (sm muted)\n * - **Close Button**: X icon with hover background\n *\n * ### Skill Info Section\n * - **Border**: Bottom border separator\n * - **Background**: bg-background\n * - **Padding**: 16px all sides\n * - **Elements**:\n *   - Skill description (sm muted)\n *   - ProgressBar with current/new score\n *   - Score comparison (when newScore available)\n *\n * ### Messages\n * - **User**: Right-aligned, blue background (`bg-primary`), white text\n * - **Assistant**: Left-aligned, muted background with markdown prose\n * - **System**: Color-coded pill shape based on message type (info/success/warning/error)\n * - **Width**: Max 85% of container width for readability\n * - **Padding**: 12px horizontal, 12px vertical\n * - **Timestamp**: Small text, 70% opacity, below content\n *\n * ### Footer\n * - **Border**: Top border separator\n * - **Padding**: 16px all sides\n * - **Background**: bg-background\n * - **Dynamic Content**:\n *   - Idle: Centered Start Training button\n *   - Active: Status indicator + input field + send button\n *   - Completed: Success message + close button\n *   - Error: Error message + reset/close buttons\n */\n\nimport React, { useRef, useEffect } from 'react';\nimport { Button } from './ui/Button';\nimport { Input } from './ui/Input';\nimport { XCircleIcon, SparklesIcon, CheckCircleIcon, ExclamationCircleIcon, PlayIcon } from './ui/Icons';\nimport ReactMarkdown from 'react-markdown';\nimport { useSkillTraining } from '../hooks/useSkillTraining';\nimport { ProgressBar } from './ui/ProgressBar';\n\n/**\n * Skill object representing the skill being trained\n */\ninterface Skill {\n  /** Unique skill identifier (used for API calls) */\n  id: string;\n  /** Human-readable skill name */\n  name: string;\n  /** Skill description explaining its purpose */\n  description: string;\n  /** Current experience score (0-100), optional */\n  experienceScore?: number;\n}\n\n/**\n * Props for the SkillTrainingChatPanel component.\n *\n * @property {boolean} isOpen - Controls panel visibility and slide-in animation.\n *   When true, panel slides in from right; when false, panel slides out.\n *   Panel renders null when false for performance.\n *\n * @property {() => void} onClose - Callback invoked when panel should close.\n *   Called when user clicks overlay, close button, or completion close button.\n *   Parent should set `isOpen: false` in response to this callback.\n *\n * @property {Skill | null} skill - The skill to train, or null if no skill selected.\n *   Must have id, name, description, and optionally experienceScore.\n *   Panel renders null when skill is null.\n *\n * @property {string} [directory] - Optional directory path for training context.\n *   Passed to useSkillTraining hook for directory-specific operations.\n *   Defaults to current working directory if not provided.\n *\n * @property {() => void} [onTrainingComplete] - Optional callback invoked when training completes successfully.\n *   Called after useSkillTraining hook detects completion with new score.\n *   Parent can use this to refresh skill list or update skill details.\n *   Called with no arguments (scores available via hook).\n *\n * @example\n * // Basic usage\n * <SkillTrainingChatPanel\n *   isOpen={isOpen}\n *   onClose={() => setIsOpen(false)}\n *   skill={selectedSkill}\n * />\n *\n * @example\n * // With training complete callback\n * <SkillTrainingChatPanel\n *   isOpen={isOpen}\n *   onClose={() => setIsOpen(false)}\n *   skill={selectedSkill}\n *   onTrainingComplete={() => {\n *     refetchSkills(); // Refresh skill list\n *     setIsOpen(false); // Close panel\n *   }}\n * />\n *\n * @example\n * // With custom directory\n * <SkillTrainingChatPanel\n *   isOpen={isOpen}\n *   onClose={() => setIsOpen(false)}\n *   skill={selectedSkill}\n *   directory=\"/projects/my-app\"\n *   onTrainingComplete={() => console.log('Skill trained in /projects/my-app')}\n * />\n */\ninterface SkillTrainingChatPanelProps {\n  isOpen: boolean;\n  onClose: () => void;\n  skill: Skill | null;\n  directory?: string;\n  onTrainingComplete?: () => void;\n}\n\n/**\n * Interactive slide-in panel component for training skills through conversation with the Training Agent.\n *\n * This component provides a chat-based interface for skill training, integrating with the\n * useSkillTraining hook for SSE streaming, status tracking, and score updates. The panel slides\n * in from the right side and guides users through a training workflow with real-time progress\n * indicators and visual feedback.\n *\n * The component manages multiple UI states based on training status (idle, active training,\n * completed, error) and handles message flow, auto-scrolling, keyboard shortcuts, and score\n * tracking.\n *\n * @param {SkillTrainingChatPanelProps} props - Component props\n * @returns {React.ReactElement | null} Rendered panel or null if not open or skill is null\n *\n * @example\n * // Basic usage with skill training\n * function SkillsPage() {\n *   const [isPanelOpen, setIsPanelOpen] = useState(false);\n *   const [selectedSkill, setSelectedSkill] = useState(null);\n *\n *   return (\n *     <>\n *       <button onClick={() => {\n *         setSelectedSkill(skill);\n *         setIsPanelOpen(true);\n *       }}>\n *         Train Skill\n *       </button>\n *\n *       <SkillTrainingChatPanel\n *         isOpen={isPanelOpen}\n *         onClose={() => setIsPanelOpen(false)}\n *         skill={selectedSkill}\n *       />\n *     </>\n *   );\n * }\n *\n * @example\n * // With training complete callback to refresh list\n * function SkillsPage() {\n *   const [skills, setSkills] = useState([]);\n *   const [isPanelOpen, setIsPanelOpen] = useState(false);\n *   const [selectedSkill, setSelectedSkill] = useState(null);\n *\n *   const fetchSkills = async () => {\n *     const response = await fetch('/api/manager/skills');\n *     const data = await response.json();\n *     setSkills(data);\n *   };\n *\n *   return (\n *     <SkillTrainingChatPanel\n *       isOpen={isPanelOpen}\n *       onClose={() => setIsPanelOpen(false)}\n *       skill={selectedSkill}\n *       onTrainingComplete={() => {\n *         fetchSkills(); // Refresh the skill list with updated scores\n *         setIsPanelOpen(false); // Close the panel\n *       }}\n *     />\n *   );\n * }\n *\n * @example\n * // With custom directory for project-specific training\n * function ProjectSettings({ projectPath }) {\n *   const [showTraining, setShowTraining] = useState(false);\n *   const [skill, setSkill] = useState(null);\n *\n *   return (\n *     <SkillTrainingChatPanel\n *       isOpen={showTraining}\n *       onClose={() => setShowTraining(false)}\n *       skill={skill}\n *       directory={projectPath}\n *       onTrainingComplete={() => {\n *         console.log('Skill trained in', projectPath);\n *         setShowTraining(false);\n *       }}\n *     />\n *   );\n * }\n *\n * @example\n * // Understanding the training flow\n * // 1. User clicks \"Train\" button for a skill\n * // 2. Panel opens (isOpen: true) with skill data\n * // 3. Panel displays \"Ready to Train\" screen with skill info and progress bar\n * // 4. User clicks \"Start Training\" button\n * // 5. Training Agent begins analysis (status: \"analyzing\")\n * // 6. Agent executes training iterations (status: \"training\")\n * // 7. Agent evaluates results (status: \"evaluating\")\n * // 8. Agent updates skill files (status: \"updating\")\n * // 9. Training completes, score updates (75% \u2192 85%, +10%)\n * // 10. Panel shows success banner: \"Training completed successfully!\"\n * // 11. User clicks \"Close\" button\n * // 12. onTrainingComplete() callback fires (parent refreshes skill list)\n */\nconst SkillTrainingChatPanel: React.FC<SkillTrainingChatPanelProps> = ({\n  isOpen,\n  onClose,\n  skill,\n  directory,\n  onTrainingComplete,\n}) => {\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [inputValue, setInputValue] = React.useState('');\n\n  const {\n    messages,\n    trainingStatus,\n    isProcessing,\n    error,\n    startTraining,\n    sendMessage,\n    reset\n  } = useSkillTraining({\n    skillId: skill?.id || '',\n    directory,\n    onTrainingComplete: (oldScore, newScore) => {\n      console.log('[Training] Completed:', { oldScore, newScore });\n      if (onTrainingComplete) {\n        onTrainingComplete();\n      }\n    },\n    onError: (err) => {\n      console.error('[Training] Error:', err);\n    }\n  });\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  /**\n   * Handles closing the panel and resetting state.\n   *\n   * Immediately calls onClose() to trigger parent state update and slide-out animation.\n   * After 300ms (matching animation duration), resets all internal state including\n   * conversation messages, training status, and input value.\n   *\n   * @internal\n   *\n   * Workflow:\n   * 1. Invokes onClose() callback (parent sets isOpen: false)\n   * 2. Panel slides out over 300ms (CSS transition)\n   * 3. After 300ms timeout:\n   *    - Calls reset() from useSkillTraining hook (clears messages, errors, status, etc.)\n   *    - Clears inputValue\n   * 4. Panel ready for next open with clean state\n   */\n  const handleClose = () => {\n    onClose();\n    // Reset state after animation\n    setTimeout(() => {\n      reset();\n      setInputValue('');\n    }, 300);\n  };\n\n  /**\n   * Handles starting the training session.\n   *\n   * Calls the startTraining() function from useSkillTraining hook, which:\n   * - Resets messages array to empty\n   * - Sets trainingStatus to 'starting' with currentScore 0\n   * - Sends \"__START_TRAINING__\" auto-start message to Training Agent\n   * - Initiates SSE streaming for training workflow\n   *\n   * @internal\n   */\n  const handleStartTraining = () => {\n    startTraining();\n  };\n\n  /**\n   * Handles sending a user message to the training conversation.\n   *\n   * This function validates the input, clears the input field (optimistic UI),\n   * and sends the message via the useSkillTraining hook's sendMessage function.\n   * On error, logs to console (hook handles error state updates).\n   *\n   * @internal\n   * @async\n   * @returns {Promise<void>}\n   *\n   * Workflow:\n   * 1. Validates input (must have content and not be processing)\n   * 2. Captures input value and clears input field immediately\n   * 3. Calls sendMessage() from useSkillTraining hook\n   * 4. Hook handles SSE streaming and message state updates\n   * 5. On error, logs to console (hook sets error state)\n   */\n  const handleSendMessage = async () => {\n    if (!inputValue.trim() || isProcessing) return;\n    const content = inputValue;\n    setInputValue('');\n    try {\n      await sendMessage(content);\n    } catch (error) {\n      console.error('[Training] Failed to send message:', error);\n    }\n  };\n\n  /**\n   * Handles keyboard shortcuts in the input field.\n   *\n   * Supports Enter to send and Shift+Enter for new line (though input is currently\n   * single-line, so Shift+Enter behavior may not be functional).\n   *\n   * @internal\n   * @param {React.KeyboardEvent<HTMLInputElement>} e - Keyboard event from input field\n   *\n   * Keyboard Actions:\n   * - Enter (without Shift): Prevents default, sends message\n   * - Shift+Enter: Allows default behavior (new line, not functional with Input component)\n   */\n  const handleKeyPress = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  if (!isOpen || !skill) return null;\n\n  /**\n   * Get human-readable label for current training status.\n   *\n   * Maps trainingStatus.status enum values to user-friendly display strings\n   * with appropriate tense and detail level.\n   *\n   * @internal\n   * @returns {string} Display label for current status\n   */\n  const getStatusLabel = () => {\n    switch (trainingStatus.status) {\n      case 'idle':\n        return 'Ready to train';\n      case 'starting':\n        return 'Initializing...';\n      case 'analyzing':\n        return 'Analyzing skill...';\n      case 'training':\n        return 'Executing skill...';\n      case 'evaluating':\n        return 'Evaluating results...';\n      case 'updating':\n        return 'Updating skill...';\n      case 'completed':\n        return 'Training completed!';\n      case 'error':\n        return 'Training failed';\n      default:\n        return 'Training...';\n    }\n  };\n\n  /**\n   * Get icon component for current training status.\n   *\n   * Returns an appropriate icon component based on the current training status,\n   * providing visual feedback for different phases and outcomes.\n   *\n   * @internal\n   * @returns {React.ReactElement} Icon component with appropriate color and animation\n   *\n   * Icon Mapping:\n   * - **completed**: Green checkmark (CheckCircleIcon, text-green-600)\n   * - **error**: Red exclamation mark (ExclamationCircleIcon, text-red-600)\n   * - **isProcessing (any active phase)**: Blue spinning circle (animate-spin)\n   * - **idle/default**: Purple sparkles (SparklesIcon, text-purple-600)\n   */\n  const getStatusIcon = () => {\n    if (trainingStatus.status === 'completed') {\n      return <CheckCircleIcon className=\"h-5 w-5 text-green-600\" />;\n    }\n    if (trainingStatus.status === 'error') {\n      return <ExclamationCircleIcon className=\"h-5 w-5 text-red-600\" />;\n    }\n    if (isProcessing) {\n      return (\n        <div className=\"h-5 w-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin\" />\n      );\n    }\n    return <SparklesIcon className=\"h-5 w-5 text-purple-600\" />;\n  };\n\n  return (\n    <>\n      {/* Overlay */}\n      <div\n        className=\"fixed inset-0 bg-black/20 z-40 transition-opacity duration-300\"\n        onClick={handleClose}\n      />\n\n      {/* Slide-in Panel */}\n      <div\n        className={`fixed right-0 top-0 h-full w-full sm:w-[700px] bg-background border-l border-border shadow-2xl z-50 transform transition-transform duration-300 ease-in-out ${\n          isOpen ? 'translate-x-0' : 'translate-x-full'\n        }`}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-border bg-gradient-to-r from-purple-50 to-blue-50\">\n          <div className=\"flex items-center gap-3\">\n            {getStatusIcon()}\n            <div>\n              <h2 className=\"text-lg font-semibold text-foreground\">Training: {skill.name}</h2>\n              <p className=\"text-sm text-muted-foreground\">{getStatusLabel()}</p>\n            </div>\n          </div>\n          <button\n            onClick={handleClose}\n            className=\"text-muted-foreground hover:text-foreground transition-colors p-2 rounded-md hover:bg-background/50\"\n            aria-label=\"Close panel\"\n          >\n            <XCircleIcon className=\"h-6 w-6\" />\n          </button>\n        </div>\n\n        {/* Skill Info */}\n        <div className=\"p-4 border-b border-border bg-background\">\n          <div className=\"space-y-3\">\n            <div>\n              <p className=\"text-sm text-muted-foreground mb-2\">{skill.description}</p>\n            </div>\n            <ProgressBar\n              value={trainingStatus.newScore !== undefined ? trainingStatus.newScore : skill.experienceScore || 0}\n              showLabel={true}\n              size=\"md\"\n            />\n            {trainingStatus.newScore !== undefined && trainingStatus.newScore !== trainingStatus.currentScore && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <span className=\"text-muted-foreground\">Score updated:</span>\n                <span className=\"font-medium text-foreground\">\n                  {trainingStatus.currentScore}% \u2192 {trainingStatus.newScore}%\n                </span>\n                <span className=\"text-green-600 font-medium\">\n                  (+{trainingStatus.newScore - trainingStatus.currentScore}%)\n                </span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Messages Area */}\n        <div className=\"flex-1 overflow-y-auto p-4 space-y-4 h-[calc(100vh-280px)]\">\n          {messages.length === 0 && trainingStatus.status === 'idle' && (\n            <div className=\"flex flex-col items-center justify-center h-full text-center space-y-4\">\n              <SparklesIcon className=\"h-16 w-16 text-purple-300\" />\n              <div>\n                <h3 className=\"text-lg font-semibold text-foreground mb-2\">Ready to Train</h3>\n                <p className=\"text-sm text-muted-foreground max-w-md\">\n                  The Training Agent will analyze this skill, execute it, evaluate the results, and update the documentation and experience score.\n                </p>\n              </div>\n              <Button onClick={handleStartTraining} size=\"lg\" className=\"gap-2\">\n                <PlayIcon className=\"h-5 w-5\" />\n                Start Training\n              </Button>\n            </div>\n          )}\n\n          {messages.map((message) => (\n            <div\n              key={message.id}\n              className={`flex ${\n                message.role === 'user' ? 'justify-end' : 'justify-start'\n              }`}\n            >\n              <div\n                className={`max-w-[85%] rounded-lg p-3 ${\n                  message.role === 'user'\n                    ? 'bg-primary text-primary-foreground ml-4'\n                    : message.role === 'system'\n                    ? `border ${\n                        message.type === 'error'\n                          ? 'border-red-200 bg-red-50 text-red-900'\n                          : message.type === 'success'\n                          ? 'border-green-200 bg-green-50 text-green-900'\n                          : message.type === 'warning'\n                          ? 'border-yellow-200 bg-yellow-50 text-yellow-900'\n                          : 'border-blue-200 bg-blue-50 text-blue-900'\n                      }`\n                    : 'bg-muted text-foreground mr-4'\n                }`}\n              >\n                {message.role === 'assistant' ? (\n                  <div className=\"prose prose-sm max-w-none\">\n                    <ReactMarkdown>\n                      {message.content}\n                    </ReactMarkdown>\n                  </div>\n                ) : (\n                  <p className=\"text-sm whitespace-pre-wrap\">{message.content}</p>\n                )}\n                <span className=\"text-xs opacity-70 mt-1 block\">\n                  {message.timestamp.toLocaleTimeString()}\n                </span>\n              </div>\n            </div>\n          ))}\n\n          {isProcessing && messages.length > 0 && trainingStatus.status !== 'completed' && (\n            <div className=\"flex justify-start\">\n              <div className=\"bg-muted text-foreground rounded-lg p-3 max-w-[85%]\">\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }} />\n                  <div className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }} />\n                  <div className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }} />\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div ref={messagesEndRef} />\n        </div>\n\n        {/* Footer */}\n        <div className=\"border-t border-border p-4 bg-background\">\n          {trainingStatus.status === 'completed' ? (\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2 text-green-600\">\n                <CheckCircleIcon className=\"h-5 w-5\" />\n                <span className=\"text-sm font-medium\">Training completed successfully!</span>\n              </div>\n              <Button onClick={handleClose}>Close</Button>\n            </div>\n          ) : trainingStatus.status === 'error' ? (\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2 text-red-600\">\n                <ExclamationCircleIcon className=\"h-5 w-5\" />\n                <span className=\"text-sm font-medium\">\n                  {error?.message || 'Training failed'}\n                </span>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button variant=\"secondary\" onClick={() => reset()}>\n                  Reset\n                </Button>\n                <Button onClick={handleClose}>Close</Button>\n              </div>\n            </div>\n          ) : trainingStatus.status === 'idle' ? (\n            <div className=\"flex justify-center\">\n              <Button onClick={handleStartTraining} disabled={isProcessing} size=\"lg\" className=\"gap-2\">\n                <PlayIcon className=\"h-5 w-5\" />\n                Start Training\n              </Button>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-2 text-blue-600\">\n                <div className=\"h-4 w-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin\" />\n                <span className=\"text-sm font-medium\">{getStatusLabel()}</span>\n              </div>\n              <div className=\"flex gap-2\">\n                <Input\n                  ref={inputRef}\n                  value={inputValue}\n                  onChange={(e) => setInputValue(e.target.value)}\n                  onKeyPress={handleKeyPress}\n                  placeholder=\"Respond to training agent...\"\n                  disabled={isProcessing}\n                  className=\"flex-1\"\n                />\n                <Button onClick={handleSendMessage} disabled={!inputValue.trim() || isProcessing}>\n                  Send\n                </Button>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </>\n  );\n};\n\nSkillTrainingChatPanel.displayName = 'SkillTrainingChatPanel';\n\nexport default SkillTrainingChatPanel;\n",
        "last_modified": "2026-01-02T14:22:15.562021"
      },
      "task_intent": {
        "title": "Document Frontend React Components and Hooks",
        "description": "Add comprehensive JSDoc documentation to all React components and custom hooks in the frontend, including prop types, usage examples, component purposes, state management, and side effects.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T14:01:11.491227",
  "last_updated": "2026-01-02T14:22:15.066860"
}