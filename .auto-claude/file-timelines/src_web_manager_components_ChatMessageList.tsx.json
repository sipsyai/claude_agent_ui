{
  "file_path": "src/web/manager/components/ChatMessageList.tsx",
  "main_branch_history": [],
  "task_views": {
    "004-document-frontend-react-components-and-hooks": {
      "task_id": "004-document-frontend-react-components-and-hooks",
      "branch_point": {
        "commit_hash": "34a3f60da53773d90bd6579cb1cfd8417a1dd0b9",
        "content": "import React, { useEffect, useRef } from 'react';\nimport type { ChatMessage } from '../services/chat-api';\n\ninterface ChatMessageListProps {\n  messages: ChatMessage[];\n  loading: boolean;\n}\n\nconst ChatMessageList: React.FC<ChatMessageListProps> = ({ messages, loading }) => {\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-gray-500\">Loading messages...</div>\n      </div>\n    );\n  }\n\n  if (messages.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-center text-gray-500\">\n          <p className=\"text-lg mb-2\">No messages yet</p>\n          <p className=\"text-sm\">Start the conversation below</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full overflow-y-auto p-4 space-y-4\">\n      {messages.map((message) => (\n        <MessageBubble key={message.documentId} message={message} />\n      ))}\n      <div ref={messagesEndRef} />\n    </div>\n  );\n};\n\ninterface MessageBubbleProps {\n  message: ChatMessage;\n}\n\nconst MessageBubble: React.FC<MessageBubbleProps> = ({ message }) => {\n  const isUser = message.role === 'user';\n  const isSystem = message.role === 'system';\n\n  if (isSystem) {\n    return (\n      <div className=\"flex justify-center\">\n        <div className=\"bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full\">\n          {message.content}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`flex ${isUser ? 'justify-end' : 'justify-start'}`}>\n      <div className={`max-w-3xl ${isUser ? 'order-2' : 'order-1'}`}>\n        {/* Message Header */}\n        <div className={`flex items-center gap-2 mb-1 ${isUser ? 'justify-end' : 'justify-start'}`}>\n          <span className=\"text-xs font-medium text-gray-600\">\n            {isUser ? 'You' : 'Assistant'}\n          </span>\n          <span className=\"text-xs text-gray-400\">\n            {new Date(message.timestamp).toLocaleTimeString()}\n          </span>\n        </div>\n\n        {/* Message Content */}\n        <div\n          className={`rounded-lg px-4 py-3 ${\n            isUser\n              ? 'bg-blue-600 text-white'\n              : 'bg-white border border-gray-200 text-gray-900'\n          }`}\n        >\n          {/* Attachments */}\n          {message.attachments && message.attachments.length > 0 && (\n            <div className=\"mb-3 space-y-2\">\n              {message.attachments.map((attachment) => (\n                <AttachmentPreview\n                  key={attachment.documentId}\n                  attachment={attachment}\n                  isUser={isUser}\n                />\n              ))}\n            </div>\n          )}\n\n          {/* Text Content */}\n          <div className=\"whitespace-pre-wrap break-words\">\n            {message.content}\n          </div>\n\n          {/* Tool Uses */}\n          {message.metadata?.toolUses && message.metadata.toolUses.length > 0 && (\n            <div className=\"mt-3 pt-3 border-t border-gray-200 space-y-2\">\n              <div className=\"text-xs font-medium text-gray-600 mb-2\">\n                Tool Uses:\n              </div>\n              {message.metadata.toolUses.map((toolUse: any, index: number) => (\n                <div\n                  key={index}\n                  className=\"bg-gray-50 rounded p-2 text-xs\"\n                >\n                  <div className=\"font-medium text-gray-700 mb-1\">\n                    {toolUse.name}\n                  </div>\n                  {toolUse.input && (\n                    <div className=\"text-gray-600 font-mono text-xs overflow-x-auto\">\n                      <pre>{JSON.stringify(toolUse.input, null, 2)}</pre>\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n          )}\n\n          {/* Cost Info */}\n          {message.metadata?.cost !== undefined && (\n            <div className=\"mt-2 text-xs opacity-70\">\n              Cost: ${message.metadata.cost.toFixed(4)}\n            </div>\n          )}\n\n          {/* Token Usage */}\n          {message.metadata?.usage && (\n            <div className=\"mt-1 text-xs opacity-70\">\n              Tokens: {message.metadata.usage.input_tokens} in / {message.metadata.usage.output_tokens} out\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\ninterface AttachmentPreviewProps {\n  attachment: {\n    documentId: string;\n    name: string;\n    url: string;\n    mime: string;\n    size: number;\n  };\n  isUser: boolean;\n}\n\nconst AttachmentPreview: React.FC<AttachmentPreviewProps> = ({ attachment, isUser }) => {\n  const isImage = attachment.mime.startsWith('image/');\n  const isPDF = attachment.mime === 'application/pdf';\n\n  if (isImage) {\n    return (\n      <div className=\"rounded overflow-hidden\">\n        <img\n          src={attachment.url}\n          alt={attachment.name}\n          className=\"max-w-full h-auto max-h-64 object-contain\"\n        />\n        <div className={`text-xs mt-1 ${isUser ? 'text-blue-100' : 'text-gray-500'}`}>\n          {attachment.name}\n        </div>\n      </div>\n    );\n  }\n\n  if (isPDF) {\n    return (\n      <a\n        href={attachment.url}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className={`flex items-center gap-2 p-2 rounded ${\n          isUser ? 'bg-blue-500 hover:bg-blue-400' : 'bg-gray-100 hover:bg-gray-200'\n        }`}\n      >\n        <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n          <path d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" />\n        </svg>\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"text-sm font-medium truncate\">{attachment.name}</div>\n          <div className=\"text-xs opacity-75\">\n            {(attachment.size / 1024).toFixed(1)} KB\n          </div>\n        </div>\n      </a>\n    );\n  }\n\n  // Generic file attachment\n  return (\n    <a\n      href={attachment.url}\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      className={`flex items-center gap-2 p-2 rounded ${\n        isUser ? 'bg-blue-500 hover:bg-blue-400' : 'bg-gray-100 hover:bg-gray-200'\n      }`}\n    >\n      <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n        <path fillRule=\"evenodd\" d=\"M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a1 1 0 112 0v4a7 7 0 11-14 0V7a5 5 0 0110 0v4a3 3 0 11-6 0V7a1 1 0 012 0v4a1 1 0 102 0V7a3 3 0 00-3-3z\" clipRule=\"evenodd\" />\n      </svg>\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"text-sm font-medium truncate\">{attachment.name}</div>\n        <div className=\"text-xs opacity-75\">\n          {(attachment.size / 1024).toFixed(1)} KB\n        </div>\n      </div>\n    </a>\n  );\n};\n\nexport default ChatMessageList;\n",
        "timestamp": "2026-01-02T14:22:14.293924"
      },
      "worktree_state": {
        "content": "/**\n * ChatMessageList Component\n *\n * A comprehensive chat message list component that displays chat messages with role-based\n * styling, automatic scrolling, attachment previews, and metadata display (tool uses, cost,\n * token usage). Handles empty and loading states gracefully.\n *\n * ## Features\n * - Auto-scroll to bottom when new messages arrive (smooth scrolling)\n * - Role-based message styling (user, assistant, system)\n * - Attachment previews (images, PDFs, generic files)\n * - Tool use display with formatted JSON input\n * - Cost and token usage metadata display\n * - Loading and empty state handling\n * - Responsive layout with overflow scrolling\n * - Timestamp display in local time format\n *\n * ## Message Rendering\n * The component renders three types of messages based on role:\n *\n * **User Messages**:\n * - Aligned to the right (justify-end)\n * - Blue background (bg-blue-600)\n * - White text (text-white)\n * - Label: \"You\"\n * - Timestamp on the right\n *\n * **Assistant Messages**:\n * - Aligned to the left (justify-start)\n * - White background (bg-white) with border\n * - Dark text (text-gray-900)\n * - Label: \"Assistant\"\n * - Timestamp on the left\n * - May include tool uses and cost/usage metadata\n *\n * **System Messages**:\n * - Centered alignment (justify-center)\n * - Small pill-shaped badge (rounded-full)\n * - Gray background (bg-gray-100)\n * - Gray text (text-gray-600)\n * - Small font size (text-xs)\n * - No header or metadata\n *\n * Each message includes:\n * - **Header**: Role label and timestamp (except system messages)\n * - **Attachments**: File previews displayed above content (if present)\n * - **Content**: Message text with whitespace preservation (whitespace-pre-wrap)\n * - **Tool Uses**: Expandable tool use display with name and JSON input (if present in metadata)\n * - **Cost**: Message cost in dollars (if present in metadata)\n * - **Usage**: Input/output token counts (if present in metadata)\n *\n * ## Scroll Behavior\n * The component implements automatic scrolling to keep the latest message visible:\n *\n * **Auto-scroll Mechanism**:\n * - Uses a ref (`messagesEndRef`) positioned at the bottom of the message list\n * - `useEffect` hook monitors changes to the `messages` array\n * - When messages change (new message added, message updated):\n *   1. Triggers `scrollIntoView` on the bottom ref\n *   2. Uses `behavior: 'smooth'` for animated scrolling\n *   3. Scrolls the viewport to bring the ref into view\n *\n * **Overflow Handling**:\n * - Container uses `overflow-y-auto` to enable vertical scrolling\n * - Container takes full height (`h-full`) of parent\n * - Messages are spaced with `space-y-4` (1rem gap between messages)\n * - Padding `p-4` provides comfortable margins\n *\n * The auto-scroll ensures users always see the latest message without manual scrolling,\n * improving UX in active conversations.\n *\n * ## Message Types\n * Messages use the `ChatMessage` interface from chat-api:\n *\n * **ChatMessage Properties**:\n * - `id`: Database ID (number)\n * - `documentId`: Unique string identifier\n * - `role`: Message role - 'user' | 'assistant' | 'system'\n * - `content`: Message text content (string)\n * - `timestamp`: ISO 8601 timestamp string\n * - `attachments`: Optional array of file attachments\n *   - Each attachment has: documentId, name, url, mime, size\n * - `metadata`: Optional object with:\n *   - `toolUses`: Array of tool invocations with name and input\n *   - `cost`: Message cost in dollars (number)\n *   - `usage`: Token usage object with input_tokens, output_tokens, cache tokens\n *   - `duration`: Message processing duration (number)\n *\n * **Attachment Structure**:\n * - `documentId`: Unique identifier\n * - `name`: Original filename\n * - `url`: Accessible URL for download/preview\n * - `mime`: MIME type (e.g., 'image/png', 'application/pdf')\n * - `size`: File size in bytes\n *\n * **Tool Use Structure** (in metadata):\n * - `name`: Tool name (e.g., 'Read', 'Write', 'Bash')\n * - `input`: Tool input parameters (object)\n * - Additional properties may be present\n *\n * ## Styling Behavior\n * The component uses Tailwind CSS with:\n * - **Container**: Full height (`h-full`), vertical overflow (`overflow-y-auto`), padding (`p-4`), vertical spacing (`space-y-4`)\n * - **Loading state**: Centered flex container with gray text\n * - **Empty state**: Centered flex container with multi-line gray text\n * - **User messages**: Right-aligned, blue background, white text, max-width 3xl\n * - **Assistant messages**: Left-aligned, white background with border, dark text, max-width 3xl\n * - **System messages**: Centered, pill-shaped, gray badge with small text\n * - **Attachments**: Display above message content with margin-bottom\n * - **Tool uses**: Border-top separator, gray background, code formatting\n * - **Metadata**: Small text with reduced opacity (70%)\n *\n * @example\n * // Basic usage with message array\n * function ChatContainer() {\n *   const [messages, setMessages] = useState<ChatMessage[]>([]);\n *   const [loading, setLoading] = useState(true);\n *\n *   useEffect(() => {\n *     fetchMessages().then(msgs => {\n *       setMessages(msgs);\n *       setLoading(false);\n *     });\n *   }, []);\n *\n *   return <ChatMessageList messages={messages} loading={loading} />;\n * }\n *\n * @example\n * // With real-time message updates\n * function LiveChat() {\n *   const [messages, setMessages] = useState<ChatMessage[]>([]);\n *\n *   const handleNewMessage = (msg: ChatMessage) => {\n *     setMessages(prev => [...prev, msg]);\n *     // Auto-scroll will trigger automatically\n *   };\n *\n *   return (\n *     <div className=\"h-screen flex flex-col\">\n *       <div className=\"flex-1\">\n *         <ChatMessageList messages={messages} loading={false} />\n *       </div>\n *       <ChatInput onSend={handleNewMessage} />\n *     </div>\n *   );\n * }\n *\n * @example\n * // With loading and empty states\n * function ChatView({ sessionId }: { sessionId: string }) {\n *   const { messages, loading } = useChatSession(sessionId);\n *\n *   // Component automatically handles:\n *   // - loading=true: Shows \"Loading messages...\" centered\n *   // - messages.length=0: Shows \"No messages yet\" with hint\n *   // - messages.length>0: Renders message list with auto-scroll\n *\n *   return <ChatMessageList messages={messages} loading={loading} />;\n * }\n *\n * @example\n * // With message metadata display\n * function DetailedChat() {\n *   const messages: ChatMessage[] = [\n *     {\n *       id: 1,\n *       documentId: 'msg_1',\n *       role: 'user',\n *       content: 'Read the config file',\n *       timestamp: new Date().toISOString(),\n *       createdAt: new Date().toISOString(),\n *       updatedAt: new Date().toISOString(),\n *     },\n *     {\n *       id: 2,\n *       documentId: 'msg_2',\n *       role: 'assistant',\n *       content: 'Here are the contents...',\n *       timestamp: new Date().toISOString(),\n *       createdAt: new Date().toISOString(),\n *       updatedAt: new Date().toISOString(),\n *       metadata: {\n *         toolUses: [{ name: 'Read', input: { file_path: './config.json' } }],\n *         cost: 0.0025,\n *         usage: { input_tokens: 150, output_tokens: 300 },\n *       },\n *     },\n *   ];\n *\n *   // Tool uses, cost, and usage will be automatically displayed\n *   return <ChatMessageList messages={messages} loading={false} />;\n * }\n */\n\nimport React, { useEffect, useRef } from 'react';\nimport type { ChatMessage } from '../services/chat-api';\n\n/**\n * Props for the ChatMessageList component\n */\ninterface ChatMessageListProps {\n  /**\n   * Array of chat messages to display.\n   *\n   * Messages are rendered in array order (oldest to newest).\n   * Each message must have a unique documentId for React keys.\n   *\n   * Auto-scroll triggers when this array changes (new message added or message updated).\n   *\n   * @see ChatMessage for the message structure\n   */\n  messages: ChatMessage[];\n\n  /**\n   * Loading state for the message list.\n   *\n   * When true:\n   * - Displays centered \"Loading messages...\" text\n   * - Hides message list and empty state\n   *\n   * When false:\n   * - Shows message list if messages.length > 0\n   * - Shows empty state if messages.length === 0\n   */\n  loading: boolean;\n}\n\nconst ChatMessageList: React.FC<ChatMessageListProps> = ({ messages, loading }) => {\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-gray-500\">Loading messages...</div>\n      </div>\n    );\n  }\n\n  if (messages.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-center text-gray-500\">\n          <p className=\"text-lg mb-2\">No messages yet</p>\n          <p className=\"text-sm\">Start the conversation below</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full overflow-y-auto p-4 space-y-4\">\n      {messages.map((message) => (\n        <MessageBubble key={message.documentId} message={message} />\n      ))}\n      <div ref={messagesEndRef} />\n    </div>\n  );\n};\n\n/**\n * Props for the MessageBubble component\n */\ninterface MessageBubbleProps {\n  /**\n   * The chat message to render.\n   *\n   * Used to determine:\n   * - Message role (user, assistant, system) for styling\n   * - Message content for display\n   * - Timestamp for header\n   * - Attachments for preview rendering\n   * - Metadata for tool uses, cost, and usage display\n   */\n  message: ChatMessage;\n}\n\n/**\n * MessageBubble Component\n *\n * Renders an individual chat message with role-based styling and layout.\n * Displays message header, content, attachments, tool uses, and metadata.\n *\n * ## Message Role Styling\n * - **User messages**: Right-aligned, blue background, white text\n * - **Assistant messages**: Left-aligned, white background with border, dark text\n * - **System messages**: Centered, pill-shaped badge with gray styling\n *\n * ## Content Structure\n * For user and assistant messages:\n * 1. Message Header: Role label (\"You\" or \"Assistant\") + timestamp\n * 2. Attachments: File previews (if present)\n * 3. Content: Message text with whitespace preservation\n * 4. Tool Uses: Collapsible tool use display (if present)\n * 5. Cost: Cost in dollars (if present)\n * 6. Usage: Token counts (if present)\n *\n * For system messages:\n * - Only message content in small pill-shaped badge\n * - No header, attachments, or metadata\n *\n * ## Styling Behavior\n * - **Container**: Flex layout with role-based justification\n * - **Max width**: 3xl (48rem) to prevent overly wide messages\n * - **Header**: Small text with role and timestamp\n * - **Content bubble**: Rounded corners (rounded-lg), padding (px-4 py-3)\n * - **Attachments**: Margin-bottom spacing from content\n * - **Tool uses**: Border-top separator, gray background, code formatting\n * - **Metadata**: Small text with reduced opacity\n *\n * @internal\n */\nconst MessageBubble: React.FC<MessageBubbleProps> = ({ message }) => {\n  const isUser = message.role === 'user';\n  const isSystem = message.role === 'system';\n\n  if (isSystem) {\n    return (\n      <div className=\"flex justify-center\">\n        <div className=\"bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full\">\n          {message.content}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`flex ${isUser ? 'justify-end' : 'justify-start'}`}>\n      <div className={`max-w-3xl ${isUser ? 'order-2' : 'order-1'}`}>\n        {/* Message Header */}\n        <div className={`flex items-center gap-2 mb-1 ${isUser ? 'justify-end' : 'justify-start'}`}>\n          <span className=\"text-xs font-medium text-gray-600\">\n            {isUser ? 'You' : 'Assistant'}\n          </span>\n          <span className=\"text-xs text-gray-400\">\n            {new Date(message.timestamp).toLocaleTimeString()}\n          </span>\n        </div>\n\n        {/* Message Content */}\n        <div\n          className={`rounded-lg px-4 py-3 ${\n            isUser\n              ? 'bg-blue-600 text-white'\n              : 'bg-white border border-gray-200 text-gray-900'\n          }`}\n        >\n          {/* Attachments */}\n          {message.attachments && message.attachments.length > 0 && (\n            <div className=\"mb-3 space-y-2\">\n              {message.attachments.map((attachment) => (\n                <AttachmentPreview\n                  key={attachment.documentId}\n                  attachment={attachment}\n                  isUser={isUser}\n                />\n              ))}\n            </div>\n          )}\n\n          {/* Text Content */}\n          <div className=\"whitespace-pre-wrap break-words\">\n            {message.content}\n          </div>\n\n          {/* Tool Uses */}\n          {message.metadata?.toolUses && message.metadata.toolUses.length > 0 && (\n            <div className=\"mt-3 pt-3 border-t border-gray-200 space-y-2\">\n              <div className=\"text-xs font-medium text-gray-600 mb-2\">\n                Tool Uses:\n              </div>\n              {message.metadata.toolUses.map((toolUse: any, index: number) => (\n                <div\n                  key={index}\n                  className=\"bg-gray-50 rounded p-2 text-xs\"\n                >\n                  <div className=\"font-medium text-gray-700 mb-1\">\n                    {toolUse.name}\n                  </div>\n                  {toolUse.input && (\n                    <div className=\"text-gray-600 font-mono text-xs overflow-x-auto\">\n                      <pre>{JSON.stringify(toolUse.input, null, 2)}</pre>\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n          )}\n\n          {/* Cost Info */}\n          {message.metadata?.cost !== undefined && (\n            <div className=\"mt-2 text-xs opacity-70\">\n              Cost: ${message.metadata.cost.toFixed(4)}\n            </div>\n          )}\n\n          {/* Token Usage */}\n          {message.metadata?.usage && (\n            <div className=\"mt-1 text-xs opacity-70\">\n              Tokens: {message.metadata.usage.input_tokens} in / {message.metadata.usage.output_tokens} out\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Props for the AttachmentPreview component\n */\ninterface AttachmentPreviewProps {\n  /**\n   * The file attachment to preview.\n   *\n   * Contains:\n   * - `documentId`: Unique identifier for the attachment\n   * - `name`: Original filename for display\n   * - `url`: Accessible URL for download/preview\n   * - `mime`: MIME type to determine rendering approach\n   * - `size`: File size in bytes for display\n   */\n  attachment: {\n    documentId: string;\n    name: string;\n    url: string;\n    mime: string;\n    size: number;\n  };\n\n  /**\n   * Whether the attachment belongs to a user message.\n   *\n   * Determines styling:\n   * - User attachments: Blue background, lighter text colors\n   * - Assistant attachments: Gray background, darker text colors\n   */\n  isUser: boolean;\n}\n\n/**\n * AttachmentPreview Component\n *\n * Renders a file attachment preview based on its MIME type.\n * Supports images (inline preview), PDFs (download card), and generic files (download card).\n *\n * ## Rendering Modes\n * The component renders differently based on MIME type:\n *\n * **Image Attachments** (mime starts with 'image/'):\n * - Displays inline image preview with <img> tag\n * - Image is constrained: max-w-full, max-h-64, object-contain\n * - Rounded overflow container\n * - Filename shown below image\n * - Text color adapts to parent (blue-100 for user, gray-500 for assistant)\n *\n * **PDF Attachments** (mime is 'application/pdf'):\n * - Clickable download card with file icon\n * - Opens in new tab (target=\"_blank\", rel=\"noopener noreferrer\")\n * - Shows PDF icon (document icon)\n * - Displays filename (truncated if too long)\n * - Shows file size in KB\n * - Background color adapts (blue-500 for user, gray-100 for assistant)\n * - Hover effect (darker background)\n *\n * **Generic File Attachments** (other MIME types):\n * - Clickable download card with attachment icon\n * - Opens in new tab (target=\"_blank\", rel=\"noopener noreferrer\")\n * - Shows generic attachment icon (paperclip)\n * - Displays filename (truncated if too long)\n * - Shows file size in KB\n * - Background color adapts (blue-500 for user, gray-100 for assistant)\n * - Hover effect (darker background)\n *\n * ## File Size Display\n * File size is converted from bytes to kilobytes:\n * - Divides size by 1024\n * - Formats with 1 decimal place (toFixed(1))\n * - Appends \" KB\" unit\n *\n * ## Styling Behavior\n * - **Images**: Rounded container, constrained dimensions, responsive sizing\n * - **Download cards**: Flex layout with icon, filename, and size\n * - **User files**: Blue background (bg-blue-500), blue text for images (text-blue-100)\n * - **Assistant files**: Gray background (bg-gray-100), gray text for images (text-gray-500)\n * - **Hover**: Background darkens (hover:bg-blue-400 or hover:bg-gray-200)\n * - **Icons**: 5x5 size (w-5 h-5), filled with currentColor\n * - **Filename**: Truncated with ellipsis if too long (truncate class)\n * - **File size**: Small text (text-xs) with reduced opacity (opacity-75)\n *\n * @internal\n */\nconst AttachmentPreview: React.FC<AttachmentPreviewProps> = ({ attachment, isUser }) => {\n  const isImage = attachment.mime.startsWith('image/');\n  const isPDF = attachment.mime === 'application/pdf';\n\n  if (isImage) {\n    return (\n      <div className=\"rounded overflow-hidden\">\n        <img\n          src={attachment.url}\n          alt={attachment.name}\n          className=\"max-w-full h-auto max-h-64 object-contain\"\n        />\n        <div className={`text-xs mt-1 ${isUser ? 'text-blue-100' : 'text-gray-500'}`}>\n          {attachment.name}\n        </div>\n      </div>\n    );\n  }\n\n  if (isPDF) {\n    return (\n      <a\n        href={attachment.url}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className={`flex items-center gap-2 p-2 rounded ${\n          isUser ? 'bg-blue-500 hover:bg-blue-400' : 'bg-gray-100 hover:bg-gray-200'\n        }`}\n      >\n        <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n          <path d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" />\n        </svg>\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"text-sm font-medium truncate\">{attachment.name}</div>\n          <div className=\"text-xs opacity-75\">\n            {(attachment.size / 1024).toFixed(1)} KB\n          </div>\n        </div>\n      </a>\n    );\n  }\n\n  // Generic file attachment\n  return (\n    <a\n      href={attachment.url}\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      className={`flex items-center gap-2 p-2 rounded ${\n        isUser ? 'bg-blue-500 hover:bg-blue-400' : 'bg-gray-100 hover:bg-gray-200'\n      }`}\n    >\n      <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n        <path fillRule=\"evenodd\" d=\"M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a1 1 0 112 0v4a7 7 0 11-14 0V7a5 5 0 0110 0v4a3 3 0 11-6 0V7a1 1 0 012 0v4a1 1 0 102 0V7a3 3 0 00-3-3z\" clipRule=\"evenodd\" />\n      </svg>\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"text-sm font-medium truncate\">{attachment.name}</div>\n        <div className=\"text-xs opacity-75\">\n          {(attachment.size / 1024).toFixed(1)} KB\n        </div>\n      </div>\n    </a>\n  );\n};\n\nChatMessageList.displayName = 'ChatMessageList';\nMessageBubble.displayName = 'MessageBubble';\nAttachmentPreview.displayName = 'AttachmentPreview';\n\nexport default ChatMessageList;\n",
        "last_modified": "2026-01-02T14:22:15.552010"
      },
      "task_intent": {
        "title": "Document Frontend React Components and Hooks",
        "description": "Add comprehensive JSDoc documentation to all React components and custom hooks in the frontend, including prop types, usage examples, component purposes, state management, and side effects.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T14:01:10.982788",
  "last_updated": "2026-01-02T14:22:14.626770"
}