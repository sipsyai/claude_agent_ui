# ============================================================
# Claude Agent UI - Environment Variables
# ============================================================
#
# INSTRUCTIONS:
# 1. Copy this file to .env: cp .env.example .env
# 2. Run: npm run generate-secrets (or ./scripts/generate-secrets.sh)
# 3. Update ANTHROPIC_API_KEY with your actual key
# 4. Update any custom values as needed
#
# SECURITY WARNING:
# - Never commit .env file to version control
# - Use strong, randomly generated secrets in production
# - Rotate secrets regularly
# ============================================================

# ------------------------------------------------------------
# Application Settings
# ------------------------------------------------------------
NODE_ENV=development
LOG_LEVEL=info

# Optional: Project directory
# Defaults to current working directory
# PROJECT_DIR=/path/to/your/project

# ------------------------------------------------------------
# Claude API Configuration
# ------------------------------------------------------------
# Required for agent execution with Claude SDK
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# ------------------------------------------------------------
# PostgreSQL Database Configuration
# ------------------------------------------------------------
POSTGRES_DB=claude_agent_ui
POSTGRES_USER=postgres
POSTGRES_PASSWORD=CHANGE_ME_GENERATE_RANDOM_PASSWORD_32_CHARS
POSTGRES_PORT=5432

# Database connection (for application use)
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=claude_agent_ui
DATABASE_USERNAME=postgres
DATABASE_PASSWORD=CHANGE_ME_GENERATE_RANDOM_PASSWORD_32_CHARS
DATABASE_SSL=false

# ------------------------------------------------------------
# PostgreSQL Connection Pool Configuration
# ------------------------------------------------------------
# Connection pooling optimizes database performance by reusing connections
# instead of creating new ones for each request. These settings control
# pool behavior and prevent connection leaks.
#
# PRODUCTION RECOMMENDATIONS:
# - Use defaults (min=2, max=10) for typical workloads
# - Increase max to 20-50 for high-traffic applications (100+ concurrent ops)
# - Monitor pool utilization via health check: http://localhost:1337/_health
# - Ensure max < PostgreSQL max_connections (default: 100)
#
# DEVELOPMENT RECOMMENDATIONS:
# - Use defaults for consistency with production
# - Set DATABASE_DEBUG=true to troubleshoot connection issues
# - Lower min to 0 if memory is constrained
#
# For detailed tuning guidance, see:
# docs/database/CONNECTION_POOL_VERIFICATION.md
# ------------------------------------------------------------

# Pool size - Number of connections to maintain
# min: Connections kept warm (reduces latency, uses ~1.3MB each)
# max: Maximum concurrent connections (prevents resource exhaustion)
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10

# Acquisition timeout - Maximum time (ms) to wait for an available connection
# If all connections are busy, new requests wait up to this duration
# Default: 60000 (60s) - Generous timeout prevents false failures during spikes
# Increase for slower workloads, decrease to fail fast
DATABASE_ACQUIRE_TIMEOUT=60000

# Creation timeout - Maximum time (ms) to establish a new database connection
# Accounts for network latency and connection handshake (typical: 20-30ms)
# Default: 30000 (30s) - Allows for slower networks/high latency
# Lower for local deployments, increase for remote databases
DATABASE_CREATE_TIMEOUT=30000

# Destroy timeout - Maximum time (ms) to close a connection gracefully
# Ensures clean shutdown without hanging
# Default: 5000 (5s) - Quick enough to prevent hangs during shutdown
DATABASE_DESTROY_TIMEOUT=5000

# Idle timeout - Time (ms) before unused connections are closed
# Releases resources from idle connections while maintaining warmth for bursts
# Default: 30000 (30s) - Balances resource efficiency with responsiveness
# Lower (10s) for aggressive cleanup, higher (60s) for bursty traffic
DATABASE_IDLE_TIMEOUT=30000

# Reap interval - How often (ms) to scan for idle connections to close
# More frequent scanning = faster cleanup but slightly higher CPU usage
# Default: 1000 (1s) - Aggressive cleanup prevents resource leaks
# Increase to 5000 (5s) if CPU usage is a concern
DATABASE_REAP_INTERVAL=1000

# Retry interval - Time (ms) between connection creation retry attempts
# When connection creation fails, wait this long before retrying
# Default: 200 (200ms) - Fast retry without thundering herd problems
# Increase if database is slow to recover from failures
DATABASE_RETRY_INTERVAL=200

# Debug mode - Enable verbose connection pool logging
# Logs all connection acquisitions, releases, and pool state changes
# Default: false - Only enable for troubleshooting (very verbose)
# WARNING: May expose sensitive connection details in logs
DATABASE_DEBUG=false

# ------------------------------------------------------------
# Strapi Configuration (for future tasks)
# ------------------------------------------------------------
# Strapi Admin
STRAPI_ADMIN_PATH=/admin
STRAPI_PORT=1337

# Strapi Secrets (REQUIRED - Generate with ./scripts/generate-secrets.sh)
STRAPI_APP_KEYS=CHANGE_ME_GENERATE_RANDOM_64_CHARS
STRAPI_API_TOKEN_SALT=CHANGE_ME_GENERATE_RANDOM_32_CHARS
STRAPI_ADMIN_JWT_SECRET=CHANGE_ME_GENERATE_RANDOM_64_CHARS
STRAPI_TRANSFER_TOKEN_SALT=CHANGE_ME_GENERATE_RANDOM_32_CHARS
STRAPI_JWT_SECRET=CHANGE_ME_GENERATE_RANDOM_64_CHARS

# CORS configuration
CORS_ORIGIN=http://localhost:5173,http://localhost:3001

# File upload
MAX_FILE_SIZE=52428800

# ------------------------------------------------------------
# Express Backend Configuration
# ------------------------------------------------------------
EXPRESS_PORT=3001
EXPRESS_HOST=0.0.0.0
PORT=3001
HOST=0.0.0.0

# Strapi API connection (from Express)
STRAPI_API_URL=http://localhost:1337/api
STRAPI_API_TOKEN=CHANGE_ME_GENERATE_IN_STRAPI_ADMIN

# ------------------------------------------------------------
# Frontend Configuration (Hybrid Architecture)
# ------------------------------------------------------------
# Express API for execution and streaming
VITE_EXPRESS_URL=http://localhost:3001/api

# Strapi API for CRUD operations
VITE_STRAPI_URL=http://localhost:1337/api

# Legacy (deprecated - use VITE_EXPRESS_URL instead)
VITE_API_URL=http://localhost:3001

# ------------------------------------------------------------
# Docker Build Metadata
# ------------------------------------------------------------
BUILD_DATE=
VCS_REF=
