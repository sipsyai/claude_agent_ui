{
  "file_path": "src/web/manager/components/SkillCreationModal.tsx",
  "main_branch_history": [],
  "task_views": {
    "004-document-frontend-react-components-and-hooks": {
      "task_id": "004-document-frontend-react-components-and-hooks",
      "branch_point": {
        "commit_hash": "34a3f60da53773d90bd6579cb1cfd8417a1dd0b9",
        "content": "import React, { useState, useCallback, useEffect } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from './ui/Dialog';\nimport { Button } from './ui/Button';\nimport { Input } from './ui/Input';\nimport { Textarea } from './ui/Textarea';\nimport { SpinnerIcon, CheckCircleIcon, XCircleIcon } from './ui/Icons';\nimport { createSkill, updateSkill, getTools, uploadFile, deleteFile, type Tool, type InputField, type SkillFileUpload } from '../services/api';\nimport type { Skill } from '../../../types/agent.types';\nimport MCPToolsSelector from './MCPToolsSelector';\n\ninterface SkillCreationModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSkillCreated: () => void;\n  editSkill?: Skill; // Optional: If provided, modal will be in edit mode\n}\n\ntype CreationStatus = 'idle' | 'loading' | 'success' | 'error';\n\ninterface FormState {\n  name: string;\n  description: string;\n  skillmd: string;\n  category: 'general-purpose' | 'code-analysis' | 'data-processing' | 'web-scraping' | 'file-manipulation' | 'api-integration' | 'browser-automation' | 'testing' | 'custom';\n  isPublic: boolean;\n  version: string;\n  license: string;\n}\n\nconst SkillCreationModal: React.FC<SkillCreationModalProps> = ({ isOpen, onClose, onSkillCreated, editSkill }) => {\n  const isEditMode = !!editSkill;\n\n  const [formState, setFormState] = useState<FormState>({\n    name: '',\n    description: '',\n    skillmd: '',\n    category: 'custom',\n    isPublic: true,\n    version: '1.0.0',\n    license: ''\n  });\n  const [selectedTools, setSelectedTools] = useState<string[]>([]);\n  const [disallowedTools, setDisallowedTools] = useState<string[]>([]); // Phase 2\n  const [selectedMCPTools, setSelectedMCPTools] = useState<Record<string, string[]>>({});\n  const [inputFields, setInputFields] = useState<InputField[]>([]);\n  const [availableTools, setAvailableTools] = useState<Tool[]>([]);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [creationStatus, setCreationStatus] = useState<CreationStatus>('idle');\n  const [creationResult, setCreationResult] = useState<string>('');\n\n  // Phase 2: Model configuration state\n  const [modelConfigEnabled, setModelConfigEnabled] = useState(false);\n  const [modelConfig, setModelConfig] = useState({\n    model: 'sonnet' as 'haiku' | 'sonnet' | 'sonnet-4' | 'opus' | 'opus-4',\n    temperature: 1.0,\n    maxTokens: undefined as number | undefined,\n    timeout: undefined as number | undefined,\n  });\n\n  // Phase 2: UI state\n  const [showAdvanced, setShowAdvanced] = useState(false);\n  const [activeToolTab, setActiveToolTab] = useState<'allowed' | 'disallowed'>('allowed');\n\n  // Phase 3: Additional files state\n  const [additionalFiles, setAdditionalFiles] = useState<SkillFileUpload[]>([]);\n  const [fileUploadLoading, setFileUploadLoading] = useState(false);\n\n  // Load available tools when modal opens\n  useEffect(() => {\n    if (isOpen) {\n      getTools()\n        .then(setAvailableTools)\n        .catch((err) => console.error('Failed to load tools:', err));\n    }\n  }, [isOpen]);\n\n  // Populate form when editing an existing skill\n  useEffect(() => {\n    if (isEditMode && editSkill) {\n      console.log('Edit Skill Data:', {\n        name: editSkill.name,\n        toolConfig: editSkill.toolConfig,\n        allowedTools: editSkill.toolConfig?.allowedTools,\n        mcpConfig: editSkill.mcpConfig\n      });\n\n      setFormState({\n        name: editSkill.name,\n        description: editSkill.description,\n        skillmd: editSkill.skillmd,\n        category: editSkill.category || 'custom',\n        isPublic: editSkill.isPublic !== undefined ? editSkill.isPublic : true,\n        version: editSkill.version || '1.0.0',\n        license: editSkill.license || ''\n      });\n\n      // Transform component-based structure to form state\n      setSelectedTools(editSkill.toolConfig?.allowedTools || []);\n      setDisallowedTools(editSkill.toolConfig?.disallowedTools || []); // Phase 2\n\n      // Phase 2: Load model configuration\n      if (editSkill.modelConfig) {\n        setModelConfigEnabled(true);\n        setModelConfig({\n          model: editSkill.modelConfig.model || 'sonnet',\n          temperature: editSkill.modelConfig.temperature !== undefined ? editSkill.modelConfig.temperature : 1.0,\n          maxTokens: editSkill.modelConfig.maxTokens,\n          timeout: editSkill.modelConfig.timeout,\n        });\n      }\n\n      // Transform mcpConfig (component array) to Record<serverId, toolNames[]>\n      const mcpToolsRecord: Record<string, string[]> = {};\n      if (editSkill.mcpConfig) {\n        editSkill.mcpConfig.forEach((config) => {\n          // Use documentId as serverId (frontend uses documentId everywhere)\n          // Strapi returns raw response with both id (integer) and documentId (string)\n          const serverId = typeof config.mcpServer === 'string'\n            ? config.mcpServer\n            : ((config.mcpServer as any).documentId || String(config.mcpServer.id));\n          if (config.selectedTools) {\n            mcpToolsRecord[serverId] = config.selectedTools.map((toolSel) =>\n              typeof toolSel.mcpTool === 'string' ? toolSel.mcpTool : toolSel.mcpTool.name\n            );\n          }\n        });\n      }\n      setSelectedMCPTools(mcpToolsRecord);\n\n      // Load input fields\n      setInputFields(editSkill.inputFields || []);\n\n      // Phase 3: Load additional files\n      if (editSkill.additionalFiles && editSkill.additionalFiles.length > 0) {\n        console.log('[DEBUG] Loading additionalFiles from edit mode:', editSkill.additionalFiles);\n\n        setAdditionalFiles(editSkill.additionalFiles.map(f => {\n          // Extract fileId - could be number, string, or object\n          let fileId = '';\n          if (typeof f.file === 'number') {\n            fileId = f.file.toString();\n          } else if (typeof f.file === 'string') {\n            fileId = f.file;\n          } else if (f.file && typeof f.file === 'object') {\n            fileId = f.file.id ? f.file.id.toString() : '';\n          }\n\n          console.log('[DEBUG] Mapped file:', { originalFile: f.file, extractedFileId: fileId });\n\n          return {\n            fileId,\n            fileType: f.fileType,\n            description: f.description || '',\n            displayOrder: f.displayOrder\n          };\n        }));\n      }\n    }\n  }, [isEditMode, editSkill]);\n\n  const handleInputChange = (field: keyof FormState, value: string) => {\n    setFormState(prev => ({ ...prev, [field]: value }));\n    if (errors[field]) {\n      setErrors(prev => {\n        const newErrors = { ...prev };\n        delete newErrors[field];\n        return newErrors;\n      });\n    }\n  };\n\n  const handleToolToggle = (toolName: string) => {\n    setSelectedTools((prev) =>\n      prev.includes(toolName)\n        ? prev.filter((t) => t !== toolName)\n        : [...prev, toolName]\n    );\n  };\n\n  const validateForm = (): boolean => {\n    const newErrors: Record<string, string> = {};\n\n    // Name validation (only in create mode)\n    if (!isEditMode) {\n      if (!formState.name.trim()) {\n        newErrors.name = 'Skill name is required.';\n      } else if (!/^[a-z0-9-]+$/.test(formState.name)) {\n        newErrors.name = 'Name must contain only lowercase letters, numbers, and hyphens.';\n      } else if (formState.name.length > 64) {\n        newErrors.name = 'Name must be 64 characters or less.';\n      }\n    }\n\n    // Description validation\n    if (!formState.description.trim()) {\n      newErrors.description = 'Description is required.';\n    } else if (formState.description.length > 1024) {\n      newErrors.description = 'Description must be 1024 characters or less.';\n    }\n\n    // Skill instructions validation\n    if (!formState.skillmd.trim()) {\n      newErrors.skillmd = 'Skill instructions are required.';\n    } else if (formState.skillmd.length < 50) {\n      newErrors.skillmd = 'Skill instructions must be at least 50 characters.';\n    }\n\n    // Version validation\n    if (!formState.version.trim()) {\n      newErrors.version = 'Version is required.';\n    } else if (!/^\\d+\\.\\d+\\.\\d+$/.test(formState.version)) {\n      newErrors.version = 'Version must follow semantic versioning (e.g., 1.0.0).';\n    }\n\n    // License validation (optional, but if provided check length)\n    if (formState.license && formState.license.length > 100) {\n      newErrors.license = 'License must be less than 100 characters.';\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = useCallback(async () => {\n    if (!validateForm()) {\n      return;\n    }\n\n    setCreationStatus('loading');\n    setCreationResult('');\n\n    try {\n      let data;\n\n      if (isEditMode && editSkill) {\n        // DEBUG: Log additionalFiles state before update\n        console.log('[DEBUG] additionalFiles state before update:', {\n          length: additionalFiles.length,\n          files: additionalFiles,\n          willSend: additionalFiles.length > 0\n        });\n\n        // Update existing skill\n        const updatePayload = {\n          description: formState.description,\n          allowedTools: selectedTools.length > 0 ? selectedTools : undefined,\n          disallowedTools: disallowedTools.length > 0 ? disallowedTools : undefined, // Phase 2\n          mcpTools: Object.keys(selectedMCPTools).length > 0 ? selectedMCPTools : undefined,\n          inputFields: inputFields.length > 0 ? inputFields : undefined,\n          skillmd: formState.skillmd,\n          category: formState.category,\n          isPublic: formState.isPublic,\n          version: formState.version,\n          license: formState.license || undefined,\n          // Phase 2: Model configuration\n          modelConfig: modelConfigEnabled ? modelConfig : undefined,\n          // Phase 3: Additional files\n          additionalFiles: additionalFiles.length > 0 ? additionalFiles : undefined,\n        };\n\n        console.log('[DEBUG] Update payload:', {\n          hasAdditionalFiles: 'additionalFiles' in updatePayload,\n          additionalFiles: updatePayload.additionalFiles\n        });\n\n        data = await updateSkill(editSkill.id, updatePayload);\n      } else {\n        // Create new skill\n        // Generate displayName from name (e.g., \"test-skill\" -> \"Test Skill\")\n        const displayName = formState.name\n          .split('-')\n          .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n          .join(' ');\n\n        data = await createSkill({\n          name: formState.name,\n          displayName: displayName,\n          description: formState.description,\n          allowedTools: selectedTools.length > 0 ? selectedTools : undefined,\n          disallowedTools: disallowedTools.length > 0 ? disallowedTools : undefined, // Phase 2\n          mcpTools: Object.keys(selectedMCPTools).length > 0 ? selectedMCPTools : undefined,\n          inputFields: inputFields.length > 0 ? inputFields : undefined,\n          skillmd: formState.skillmd,\n          category: formState.category,\n          isPublic: formState.isPublic,\n          version: formState.version,\n          license: formState.license || undefined,\n          // Phase 2: Model configuration\n          modelConfig: modelConfigEnabled ? modelConfig : undefined,\n          // Phase 3: Additional files\n          additionalFiles: additionalFiles.length > 0 ? additionalFiles : undefined,\n        });\n      }\n\n      if (data.success) {\n        setCreationStatus('success');\n        const action = isEditMode ? 'updated' : 'created';\n        setCreationResult(`Skill \"${formState.name}\" ${action} successfully at ${data.path}`);\n        onSkillCreated();\n\n        // Close modal after 2 seconds\n        setTimeout(() => {\n          handleClose();\n        }, 2000);\n      } else {\n        setCreationStatus('error');\n        const action = isEditMode ? 'update' : 'create';\n        setCreationResult(data.error || `Failed to ${action} skill. Please try again.`);\n      }\n    } catch (error) {\n      setCreationStatus('error');\n      setCreationResult(error instanceof Error ? error.message : 'Network error. Please check your connection and try again.');\n      console.error('Skill operation error:', error);\n    }\n  }, [isEditMode, editSkill, formState, selectedTools, disallowedTools, selectedMCPTools, inputFields, modelConfigEnabled, modelConfig, additionalFiles, onSkillCreated]);\n\n  const handleClose = () => {\n    setFormState({\n      name: '',\n      description: '',\n      skillmd: '',\n      category: 'custom',\n      isPublic: true,\n      version: '1.0.0',\n      license: ''\n    });\n    setSelectedTools([]);\n    setDisallowedTools([]); // Phase 2\n    setSelectedMCPTools({});\n    setInputFields([]);\n    setErrors({});\n    setCreationStatus('idle');\n    setCreationResult('');\n    // Phase 2: Reset model config\n    setModelConfigEnabled(false);\n    setModelConfig({\n      model: 'sonnet',\n      temperature: 1.0,\n      maxTokens: undefined,\n      timeout: undefined,\n    });\n    setShowAdvanced(false);\n    setActiveToolTab('allowed');\n    // Phase 3: Reset additional files\n    setAdditionalFiles([]);\n    setFileUploadLoading(false);\n    onClose();\n  };\n\n  const renderResult = () => {\n    if (creationStatus === 'idle') return null;\n\n    const baseClasses = \"mt-4 p-4 rounded-md text-sm flex items-start space-x-3\";\n\n    if (creationStatus === 'success') {\n      return (\n        <div className={`${baseClasses} bg-green-900/50 text-green-300`}>\n          <CheckCircleIcon className=\"h-5 w-5 mt-0.5 flex-shrink-0\" />\n          <p>{creationResult}</p>\n        </div>\n      );\n    }\n\n    if (creationStatus === 'error') {\n      return (\n        <div className={`${baseClasses} bg-red-900/50 text-red-300`}>\n          <XCircleIcon className=\"h-5 w-5 mt-0.5 flex-shrink-0\" />\n          <p>{creationResult}</p>\n        </div>\n      );\n    }\n\n    return null;\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={(open) => !open && handleClose()}>\n      <DialogContent className=\"sm:max-w-[700px]\">\n        <DialogHeader>\n          <DialogTitle>{isEditMode ? 'Edit Skill' : 'Create New Skill'}</DialogTitle>\n          <DialogDescription>\n            {isEditMode\n              ? 'Update the skill details. The skill name cannot be changed.'\n              : 'Create a new Agent Skill that extends Claude\\'s capabilities. Skills are automatically discovered and used when relevant.'}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"grid gap-4 py-4 max-h-[60vh] overflow-y-auto pr-3\">\n          {/* Name Field */}\n          <div>\n            <label htmlFor=\"name\" className=\"block text-sm font-medium text-muted-foreground mb-1\">\n              Skill Name <span className=\"text-red-400\">*</span>\n            </label>\n            <Input\n              id=\"name\"\n              type=\"text\"\n              value={formState.name}\n              onChange={(e) => handleInputChange('name', e.target.value)}\n              placeholder=\"pdf-processor, git-commit-helper, excel-analyzer...\"\n              className={errors.name ? 'border-red-500' : ''}\n              disabled={isEditMode}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {isEditMode\n                ? 'Skill name cannot be changed (used as directory name and ID)'\n                : 'Use lowercase letters, numbers, and hyphens only (max 64 characters)'}\n            </p>\n            {errors.name && <p className=\"text-red-500 text-xs mt-1\">{errors.name}</p>}\n          </div>\n\n          {/* Description Field */}\n          <div>\n            <label htmlFor=\"description\" className=\"block text-sm font-medium text-muted-foreground mb-1\">\n              Description <span className=\"text-red-400\">*</span>\n            </label>\n            <Textarea\n              id=\"description\"\n              value={formState.description}\n              onChange={(e) => handleInputChange('description', e.target.value)}\n              placeholder='Extract text and tables from PDFs. Use when working with PDF files or document extraction.'\n              rows={3}\n              className={errors.description ? 'border-red-500' : ''}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Describe what the skill does and when to use it (max 1024 characters)\n            </p>\n            {errors.description && <p className=\"text-red-500 text-xs mt-1\">{errors.description}</p>}\n          </div>\n\n          {/* Category Field */}\n          <div>\n            <label htmlFor=\"category\" className=\"block text-sm font-medium text-muted-foreground mb-1\">\n              Category <span className=\"text-red-400\">*</span>\n            </label>\n            <select\n              id=\"category\"\n              value={formState.category}\n              onChange={(e) => handleInputChange('category', e.target.value as any)}\n              className=\"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground\"\n              disabled={creationStatus === 'loading'}\n            >\n              <option value=\"custom\">Custom</option>\n              <option value=\"general-purpose\">General Purpose</option>\n              <option value=\"code-analysis\">Code Analysis</option>\n              <option value=\"data-processing\">Data Processing</option>\n              <option value=\"web-scraping\">Web Scraping</option>\n              <option value=\"file-manipulation\">File Manipulation</option>\n              <option value=\"api-integration\">API Integration</option>\n              <option value=\"browser-automation\">Browser Automation</option>\n              <option value=\"testing\">Testing</option>\n            </select>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Select the category that best describes this skill's purpose\n            </p>\n            {errors.category && <p className=\"text-red-500 text-xs mt-1\">{errors.category}</p>}\n          </div>\n\n          {/* Version and License Row */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            {/* Version Field */}\n            <div>\n              <label htmlFor=\"version\" className=\"block text-sm font-medium text-muted-foreground mb-1\">\n                Version <span className=\"text-red-400\">*</span>\n              </label>\n              <Input\n                id=\"version\"\n                type=\"text\"\n                value={formState.version}\n                onChange={(e) => handleInputChange('version', e.target.value)}\n                placeholder=\"1.0.0\"\n                className={errors.version ? 'border-red-500' : ''}\n                disabled={creationStatus === 'loading'}\n              />\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Semantic versioning (e.g., 1.0.0)\n              </p>\n              {errors.version && <p className=\"text-red-500 text-xs mt-1\">{errors.version}</p>}\n            </div>\n\n            {/* License Field */}\n            <div>\n              <label htmlFor=\"license\" className=\"block text-sm font-medium text-muted-foreground mb-1\">\n                License <span className=\"text-muted-foreground text-xs\">(Optional)</span>\n              </label>\n              <Input\n                id=\"license\"\n                type=\"text\"\n                value={formState.license}\n                onChange={(e) => handleInputChange('license', e.target.value)}\n                placeholder=\"MIT, Apache-2.0, GPL-3.0...\"\n                className={errors.license ? 'border-red-500' : ''}\n                disabled={creationStatus === 'loading'}\n              />\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                License type (max 100 characters)\n              </p>\n              {errors.license && <p className=\"text-red-500 text-xs mt-1\">{errors.license}</p>}\n            </div>\n          </div>\n\n          {/* Is Public Toggle */}\n          <div className=\"flex items-center justify-between p-3 border border-border rounded-md bg-secondary/10\">\n            <div>\n              <label htmlFor=\"isPublic\" className=\"text-sm font-medium\">\n                Public Skill\n              </label>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Make this skill available to all agents in the system\n              </p>\n            </div>\n            <input\n              id=\"isPublic\"\n              type=\"checkbox\"\n              checked={formState.isPublic}\n              onChange={(e) => handleInputChange('isPublic', e.target.checked as any)}\n              disabled={creationStatus === 'loading'}\n              className=\"w-5 h-5\"\n            />\n          </div>\n\n          {/* Tool Configuration - Phase 2: Tab System */}\n          <div>\n            <label className=\"block text-sm font-medium text-muted-foreground mb-1\">\n              Tool Configuration <span className=\"text-muted-foreground text-xs\">(Optional)</span>\n            </label>\n\n            {/* Tab Headers */}\n            <div className=\"flex border-b border-border mb-2\">\n              <button\n                type=\"button\"\n                onClick={() => setActiveToolTab('allowed')}\n                className={`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${\n                  activeToolTab === 'allowed'\n                    ? 'border-primary text-primary'\n                    : 'border-transparent text-muted-foreground hover:text-foreground'\n                }`}\n              >\n                Allowed Tools ({selectedTools.length})\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setActiveToolTab('disallowed')}\n                className={`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${\n                  activeToolTab === 'disallowed'\n                    ? 'border-primary text-primary'\n                    : 'border-transparent text-muted-foreground hover:text-foreground'\n                }`}\n              >\n                Disallowed Tools ({disallowedTools.length})\n              </button>\n            </div>\n\n            {/* Tab Content */}\n            <div className=\"border border-border rounded-md p-3 max-h-48 overflow-y-auto\">\n              {availableTools.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">Loading tools...</p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {activeToolTab === 'allowed' ? (\n                    // Allowed Tools Tab\n                    availableTools.map((tool) => (\n                      <label\n                        key={tool.name}\n                        className=\"flex items-start gap-2 cursor-pointer hover:bg-secondary/50 p-2 rounded\"\n                      >\n                        <input\n                          type=\"checkbox\"\n                          checked={selectedTools.includes(tool.name)}\n                          onChange={() => handleToolToggle(tool.name)}\n                          disabled={creationStatus === 'loading'}\n                          className=\"mt-1 w-4 h-4\"\n                        />\n                        <div className=\"flex-1\">\n                          <div className=\"font-medium text-sm\">{tool.name}</div>\n                          <div className=\"text-xs text-muted-foreground\">{tool.description}</div>\n                        </div>\n                      </label>\n                    ))\n                  ) : (\n                    // Disallowed Tools Tab\n                    availableTools.map((tool) => (\n                      <label\n                        key={tool.name}\n                        className=\"flex items-start gap-2 cursor-pointer hover:bg-secondary/50 p-2 rounded\"\n                      >\n                        <input\n                          type=\"checkbox\"\n                          checked={disallowedTools.includes(tool.name)}\n                          onChange={() => {\n                            if (disallowedTools.includes(tool.name)) {\n                              setDisallowedTools(disallowedTools.filter(t => t !== tool.name));\n                            } else {\n                              setDisallowedTools([...disallowedTools, tool.name]);\n                            }\n                          }}\n                          disabled={creationStatus === 'loading'}\n                          className=\"mt-1 w-4 h-4\"\n                        />\n                        <div className=\"flex-1\">\n                          <div className=\"font-medium text-sm\">{tool.name}</div>\n                          <div className=\"text-xs text-muted-foreground\">{tool.description}</div>\n                        </div>\n                      </label>\n                    ))\n                  )}\n                </div>\n              )}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {activeToolTab === 'allowed'\n                ? (selectedTools.length > 0\n                    ? `Selected: ${selectedTools.join(', ')}`\n                    : 'Leave empty to allow all tools. Select specific tools to restrict what the skill can use.')\n                : (disallowedTools.length > 0\n                    ? `Disallowed: ${disallowedTools.join(', ')}`\n                    : 'Leave empty to allow all tools. Select specific tools to explicitly block.')\n              }\n            </p>\n          </div>\n\n          {/* MCP Server Tools */}\n          <div>\n            <label className=\"block text-sm font-medium text-muted-foreground mb-1\">\n              MCP Server Tools <span className=\"text-muted-foreground text-xs\">(Optional)</span>\n            </label>\n            <MCPToolsSelector\n              selectedMCPTools={selectedMCPTools}\n              onChange={setSelectedMCPTools}\n              disabled={creationStatus === 'loading'}\n              directory={undefined}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Select specific MCP tools this skill can use. Leave empty to allow all MCP tools.\n            </p>\n          </div>\n\n          {/* Input Fields */}\n          <div>\n            <div className=\"flex items-center justify-between mb-2\">\n              <label className=\"block text-sm font-medium text-muted-foreground\">\n                Input Fields <span className=\"text-muted-foreground text-xs\">(Optional)</span>\n              </label>\n              <Button\n                type=\"button\"\n                size=\"sm\"\n                onClick={() => {\n                  setInputFields([...inputFields, {\n                    name: '',\n                    type: 'text',\n                    label: '',\n                    required: false,\n                  }]);\n                }}\n                disabled={creationStatus === 'loading'}\n              >\n                + Add Field\n              </Button>\n            </div>\n\n            {inputFields.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground p-3 border border-dashed border-border rounded\">\n                No input fields defined. Click \"+ Add Field\" to add fields that users will fill when executing this skill.\n              </p>\n            ) : (\n              <div className=\"space-y-3 border border-border rounded p-3\">\n                {inputFields.map((field, index) => (\n                  <div key={index} className=\"border border-border rounded p-3 space-y-2\">\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Field Name *</label>\n                        <Input\n                          type=\"text\"\n                          value={field.name}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].name = e.target.value;\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"target_path\"\n                          disabled={creationStatus === 'loading'}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Label *</label>\n                        <Input\n                          type=\"text\"\n                          value={field.label}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].label = e.target.value;\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"Target Path\"\n                          disabled={creationStatus === 'loading'}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Type *</label>\n                        <select\n                          value={field.type}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].type = e.target.value as any;\n                            setInputFields(newFields);\n                          }}\n                          disabled={creationStatus === 'loading'}\n                          className=\"w-full px-2 py-1 text-sm border border-border rounded-md bg-background\"\n                        >\n                          <option value=\"text\">Text</option>\n                          <option value=\"textarea\">Textarea</option>\n                          <option value=\"dropdown\">Dropdown</option>\n                          <option value=\"multiselect\">Multiselect</option>\n                          <option value=\"checkbox\">Checkbox</option>\n                          <option value=\"number\">Number</option>\n                          <option value=\"filepath\">File Path</option>\n                        </select>\n                      </div>\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Placeholder</label>\n                        <Input\n                          type=\"text\"\n                          value={field.placeholder || ''}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].placeholder = e.target.value;\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"/path/to/file\"\n                          disabled={creationStatus === 'loading'}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                    </div>\n\n                    {(field.type === 'dropdown' || field.type === 'multiselect') && (\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Options (comma-separated) *</label>\n                        <Input\n                          type=\"text\"\n                          value={field.options?.join(', ') || ''}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].options = e.target.value.split(',').map(o => o.trim()).filter(Boolean);\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"json, markdown, html\"\n                          disabled={creationStatus === 'loading'}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                    )}\n\n                    <div>\n                      <label className=\"block text-xs font-medium mb-1\">Description</label>\n                      <Input\n                        type=\"text\"\n                        value={field.description || ''}\n                        onChange={(e) => {\n                          const newFields = [...inputFields];\n                          newFields[index].description = e.target.value;\n                          setInputFields(newFields);\n                        }}\n                        placeholder=\"Additional help text for this field\"\n                        disabled={creationStatus === 'loading'}\n                        className=\"text-sm\"\n                      />\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <label className=\"flex items-center gap-2 text-xs\">\n                        <input\n                          type=\"checkbox\"\n                          checked={field.required || false}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].required = e.target.checked;\n                            setInputFields(newFields);\n                          }}\n                          disabled={creationStatus === 'loading'}\n                          className=\"w-3 h-3\"\n                        />\n                        Required\n                      </label>\n                      <Button\n                        type=\"button\"\n                        size=\"sm\"\n                        variant=\"secondary\"\n                        onClick={() => {\n                          setInputFields(inputFields.filter((_, i) => i !== index));\n                        }}\n                        disabled={creationStatus === 'loading'}\n                      >\n                        Remove\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Define form fields that users will fill when executing this skill. Use template variables like {`{{field_name}}`} in your skill instructions.\n            </p>\n          </div>\n\n          {/* Phase 2: Advanced Settings - Collapsible */}\n          <div className=\"border border-border rounded-md\">\n            <button\n              type=\"button\"\n              onClick={() => setShowAdvanced(!showAdvanced)}\n              className=\"w-full flex items-center justify-between p-3 hover:bg-secondary/50 rounded-t-md transition-colors\"\n            >\n              <span className=\"text-sm font-medium\">\u2699\ufe0f Advanced Settings</span>\n              <span className=\"text-muted-foreground\">{showAdvanced ? '\u25bc' : '\u25b6'}</span>\n            </button>\n\n            {showAdvanced && (\n              <div className=\"p-4 space-y-4 border-t border-border\">\n                {/* Model Configuration */}\n                <div>\n                  <label className=\"flex items-center gap-2 mb-3\">\n                    <input\n                      type=\"checkbox\"\n                      checked={modelConfigEnabled}\n                      onChange={(e) => setModelConfigEnabled(e.target.checked)}\n                      disabled={creationStatus === 'loading'}\n                      className=\"w-4 h-4\"\n                    />\n                    <span className=\"text-sm font-medium\">Override Model Configuration</span>\n                  </label>\n\n                  {modelConfigEnabled && (\n                    <div className=\"ml-6 space-y-3 p-3 border border-border rounded bg-secondary/10\">\n                      {/* Model Selection */}\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Model</label>\n                        <select\n                          value={modelConfig.model}\n                          onChange={(e) => setModelConfig({ ...modelConfig, model: e.target.value as any })}\n                          disabled={creationStatus === 'loading'}\n                          className=\"w-full px-2 py-1 text-sm border border-border rounded-md bg-background\"\n                        >\n                          <option value=\"haiku\">Claude Haiku 3.5</option>\n                          <option value=\"sonnet\">Claude Sonnet 4.5</option>\n                          <option value=\"sonnet-4\">Claude Sonnet 4</option>\n                          <option value=\"opus\">Claude Opus 4</option>\n                          <option value=\"opus-4\">Claude Opus 4 (Latest)</option>\n                        </select>\n                      </div>\n\n                      {/* Temperature Slider */}\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">\n                          Temperature: {modelConfig.temperature.toFixed(2)}\n                        </label>\n                        <input\n                          type=\"range\"\n                          min=\"0\"\n                          max=\"1\"\n                          step=\"0.01\"\n                          value={modelConfig.temperature}\n                          onChange={(e) => setModelConfig({ ...modelConfig, temperature: parseFloat(e.target.value) })}\n                          disabled={creationStatus === 'loading'}\n                          className=\"w-full\"\n                        />\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Lower = more focused and deterministic, Higher = more creative and random\n                        </p>\n                      </div>\n\n                      {/* Max Tokens */}\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Max Tokens (Optional)</label>\n                        <Input\n                          type=\"number\"\n                          value={modelConfig.maxTokens || ''}\n                          onChange={(e) => setModelConfig({ ...modelConfig, maxTokens: e.target.value ? parseInt(e.target.value) : undefined })}\n                          placeholder=\"Leave empty for default\"\n                          disabled={creationStatus === 'loading'}\n                          className=\"text-sm\"\n                          min=\"1\"\n                          max=\"200000\"\n                        />\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Maximum number of tokens to generate (1-200000)\n                        </p>\n                      </div>\n\n                      {/* Timeout */}\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Timeout (ms, Optional)</label>\n                        <Input\n                          type=\"number\"\n                          value={modelConfig.timeout || ''}\n                          onChange={(e) => setModelConfig({ ...modelConfig, timeout: e.target.value ? parseInt(e.target.value) : undefined })}\n                          placeholder=\"Leave empty for default (300000ms)\"\n                          disabled={creationStatus === 'loading'}\n                          className=\"text-sm\"\n                          min=\"1000\"\n                        />\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Request timeout in milliseconds (minimum 1000ms)\n                        </p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Phase 3: Analytics Display (Read-only, Edit Mode Only) */}\n          {isEditMode && editSkill?.analytics && (\n            <div className=\"border border-border rounded-md p-4 bg-secondary/10\">\n              <h3 className=\"text-sm font-medium mb-3\">\ud83d\udcca Analytics</h3>\n              <div className=\"grid grid-cols-2 gap-3 text-xs\">\n                <div>\n                  <span className=\"text-muted-foreground\">Executions:</span>\n                  <span className=\"ml-2 font-medium\">{editSkill.analytics.executionCount}</span>\n                </div>\n                <div>\n                  <span className=\"text-muted-foreground\">Success Rate:</span>\n                  <span className=\"ml-2 font-medium\">{editSkill.analytics.successRate.toFixed(1)}%</span>\n                </div>\n                <div>\n                  <span className=\"text-muted-foreground\">Avg Time:</span>\n                  <span className=\"ml-2 font-medium\">{editSkill.analytics.averageExecutionTime}ms</span>\n                </div>\n                <div>\n                  <span className=\"text-muted-foreground\">Last Executed:</span>\n                  <span className=\"ml-2 font-medium\">\n                    {editSkill.analytics.lastExecutedAt\n                      ? new Date(editSkill.analytics.lastExecutedAt).toLocaleDateString()\n                      : 'Never'}\n                  </span>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Phase 3: Training History Display (Read-only, Edit Mode Only) */}\n          {isEditMode && editSkill?.trainingHistory && editSkill.trainingHistory.length > 0 && (\n            <div className=\"border border-border rounded-md p-4 bg-secondary/10\">\n              <h3 className=\"text-sm font-medium mb-3\">\ud83c\udf93 Training History</h3>\n              <div className=\"space-y-2 max-h-48 overflow-y-auto\">\n                {editSkill.trainingHistory.map((session, idx) => (\n                  <div key={session.id || idx} className=\"border-l-2 border-primary pl-3 py-2 text-xs\">\n                    <div className=\"flex items-center justify-between mb-1\">\n                      <span className=\"font-medium\">{session.trainingType}</span>\n                      <span className={`px-2 py-0.5 rounded ${session.success ? 'bg-green-500/20 text-green-700' : 'bg-red-500/20 text-red-700'}`}>\n                        {session.success ? '\u2713 Success' : '\u2717 Failed'}\n                      </span>\n                    </div>\n                    {session.score !== undefined && (\n                      <div className=\"text-muted-foreground\">Score: {session.score}/100</div>\n                    )}\n                    {session.notes && (\n                      <div className=\"text-muted-foreground mt-1\">{session.notes}</div>\n                    )}\n                    <div className=\"text-muted-foreground text-[10px] mt-1\">\n                      {new Date(session.timestamp).toLocaleString()}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Phase 4: Additional Files (Full File Upload) */}\n          <div className=\"border border-border rounded-md p-4\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h3 className=\"text-sm font-medium\">\ud83d\udcce Additional Files</h3>\n              <Button\n                type=\"button\"\n                size=\"sm\"\n                onClick={() => {\n                  const input = document.createElement('input');\n                  input.type = 'file';\n                  input.accept = '.md,.pdf,.txt,.json';\n                  input.onchange = async (e: Event) => {\n                    const file = (e.target as HTMLInputElement).files?.[0];\n                    if (!file) return;\n\n                    try {\n                      setFileUploadLoading(true);\n                      const uploadedFile = await uploadFile(file);\n\n                      // Use callback to get accurate length\n                      setAdditionalFiles(prev => {\n                        const newFile = {\n                          fileId: uploadedFile.id.toString(),\n                          fileType: 'CUSTOM' as const,\n                          description: '',\n                          displayOrder: prev.length,\n                        };\n\n                        const updated = [...prev, newFile];\n                        console.log('[DEBUG] File added to state:', {\n                          uploadedFile,\n                          newFile,\n                          previousLength: prev.length,\n                          updatedLength: updated.length,\n                          updated\n                        });\n                        return updated;\n                      });\n                    } catch (error: any) {\n                      console.error('File upload error:', error);\n                      alert(`Failed to upload file: ${error.message}`);\n                    } finally {\n                      setFileUploadLoading(false);\n                    }\n                  };\n                  input.click();\n                }}\n                disabled={creationStatus === 'loading' || fileUploadLoading}\n                className=\"h-7 px-3 text-xs\"\n              >\n                {fileUploadLoading ? 'Uploading...' : '+ Upload File'}\n              </Button>\n            </div>\n\n            <p className=\"text-xs text-muted-foreground mb-3\">\n              Upload reference documentation, examples, troubleshooting guides, and other supporting files.\n            </p>\n\n            {additionalFiles.length > 0 ? (\n              <div className=\"space-y-3\">\n                {additionalFiles.map((file, idx) => (\n                  <div key={idx} className=\"border border-border rounded-md p-3 bg-secondary/10\">\n                    <div className=\"grid grid-cols-2 gap-2 mb-2\">\n                      {/* File Type Dropdown */}\n                      <div>\n                        <label className=\"text-xs font-medium text-muted-foreground block mb-1\">\n                          File Type *\n                        </label>\n                        <select\n                          value={file.fileType}\n                          onChange={(e) => {\n                            setAdditionalFiles(prev => {\n                              const newFiles = [...prev];\n                              newFiles[idx].fileType = e.target.value as any;\n                              return newFiles;\n                            });\n                          }}\n                          disabled={creationStatus === 'loading'}\n                          className=\"w-full px-2 py-1 text-xs border border-border rounded-md bg-background\"\n                        >\n                          <option value=\"REFERENCE\">Reference Documentation</option>\n                          <option value=\"EXAMPLES\">Usage Examples</option>\n                          <option value=\"TROUBLESHOOTING\">Troubleshooting Guide</option>\n                          <option value=\"CHANGELOG\">Changelog</option>\n                          <option value=\"FAQ\">FAQ</option>\n                          <option value=\"API_DOCS\">API Documentation</option>\n                          <option value=\"TUTORIAL\">Tutorial</option>\n                          <option value=\"CUSTOM\">Custom</option>\n                        </select>\n                      </div>\n\n                      {/* Remove Button */}\n                      <div className=\"flex items-end\">\n                        <Button\n                          type=\"button\"\n                          variant=\"destructive\"\n                          size=\"sm\"\n                          onClick={async () => {\n                            try {\n                              // Optionally delete from Strapi if already uploaded\n                              // await deleteFile(file.fileId);\n                              setAdditionalFiles(prev => prev.filter((_, i) => i !== idx));\n                            } catch (error: any) {\n                              console.error('File delete error:', error);\n                            }\n                          }}\n                          disabled={creationStatus === 'loading'}\n                          className=\"h-7 px-3 text-xs w-full\"\n                        >\n                          Remove\n                        </Button>\n                      </div>\n                    </div>\n\n                    {/* Description Textarea */}\n                    <div>\n                      <label className=\"text-xs font-medium text-muted-foreground block mb-1\">\n                        Description (Optional)\n                      </label>\n                      <Textarea\n                        value={file.description || ''}\n                        onChange={(e) => {\n                          setAdditionalFiles(prev => {\n                            const newFiles = [...prev];\n                            newFiles[idx].description = e.target.value;\n                            return newFiles;\n                          });\n                        }}\n                        placeholder=\"Brief description of this file...\"\n                        disabled={creationStatus === 'loading'}\n                        className=\"text-xs h-16 resize-none\"\n                      />\n                    </div>\n\n                    {/* File ID Display (for debugging) */}\n                    <div className=\"text-xs text-muted-foreground mt-2\">\n                      File ID: {file.fileId}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-6 border-2 border-dashed border-border rounded-md\">\n                <p className=\"text-xs text-muted-foreground\">No files uploaded yet</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Click \"Upload File\" to add reference documentation\n                </p>\n              </div>\n            )}\n          </div>\n\n          {/* Skill Instructions Field */}\n          <div>\n            <label htmlFor=\"skillmd\" className=\"block text-sm font-medium text-muted-foreground mb-1\">\n              Skill Instructions <span className=\"text-red-400\">*</span>\n            </label>\n            <Textarea\n              id=\"skillmd\"\n              value={formState.skillmd}\n              onChange={(e) => handleInputChange('skillmd', e.target.value)}\n              placeholder={'# Skill Title\\n\\n## Instructions\\n\\n1. Step by step guidance on what Claude should do\\n2. Provide detailed context and requirements\\n3. Include specific examples and use cases\\n\\n## Examples\\n\\nProvide concrete examples and edge cases here...\\n\\n(Minimum 50 characters required)'}\n              rows={10}\n              className={`font-mono text-xs ${errors.skillmd ? 'border-red-500' : ''}`}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Write clear, step-by-step instructions in Markdown format (minimum 50 characters). Include examples and best practices.\n            </p>\n            {errors.skillmd && <p className=\"text-red-500 text-xs mt-1\">{errors.skillmd}</p>}\n          </div>\n        </div>\n\n        {renderResult()}\n\n        <DialogFooter>\n          <Button variant=\"secondary\" onClick={handleClose} disabled={creationStatus === 'loading'}>\n            Cancel\n          </Button>\n          <Button onClick={handleSubmit} disabled={creationStatus === 'loading'}>\n            {creationStatus === 'loading' && <SpinnerIcon className=\"h-4 w-4 mr-2\" />}\n            {isEditMode ? 'Update Skill' : 'Create Skill'}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default SkillCreationModal;\n",
        "timestamp": "2026-01-02T14:22:14.293924"
      },
      "worktree_state": {
        "content": "/**\n * @file SkillCreationModal.tsx\n * @description Modal dialog for creating and editing agent skills through a comprehensive form interface.\n * This component provides a multi-section configuration form with validation, tool selection, input field\n * builder, advanced settings, and file upload capabilities for extending Claude's capabilities.\n *\n * ## Features\n * - **Dual-Mode Operation**: Create new skills or edit existing ones\n * - **Comprehensive Form**: 10+ configuration sections (core, tools, MCP, inputs, advanced, files, instructions)\n * - **Multi-Level Validation**: Required fields, pattern matching, length constraints, semantic versioning\n * - **Tool Configuration**: Tab-based allowed/disallowed tool selection\n * - **MCP Integration**: Select specific MCP server tools\n * - **Input Field Builder**: Dynamic form field creation with 7 field types\n * - **Advanced Settings**: Collapsible model configuration override (model, temperature, maxTokens, timeout)\n * - **File Upload**: Additional files for reference documentation, examples, troubleshooting guides\n * - **Analytics Display**: Read-only execution stats in edit mode\n * - **Training History**: Read-only training session records in edit mode\n * - **Auto-Close**: Modal auto-closes 2 seconds after successful creation/update\n * - **Form Reset**: Complete state reset on close\n * - **Color-Coded Feedback**: Green success, red error messages with icons\n *\n * ## Skill Creation Workflow\n * The component supports two distinct operational modes:\n *\n * ### Create Mode Workflow\n * 1. **Modal Opens**: User clicks \"Create New Skill\" button\n * 2. **Empty Form Loads**: All fields initialize to default values\n * 3. **User Fills Form**: Enters skill name, description, instructions, selects tools\n * 4. **Validation**: Client-side validation on submit (required fields, patterns, lengths)\n * 5. **API Call**: POST request to `/skills/create` with form data\n * 6. **File Creation**: Backend creates `.claude/skills/{name}/skill.md` file\n * 7. **Data Transform**: Form state \u2192 Strapi API payload format\n * 8. **Success Feedback**: Green banner with file path, auto-close after 2s\n * 9. **Callback Invoked**: `onSkillCreated()` triggers parent refresh\n * 10. **Modal Closes**: Form state reset, modal closes\n *\n * ### Edit Mode Workflow\n * 1. **Modal Opens**: User clicks \"Edit\" on existing skill\n * 2. **Pre-Population**: `useEffect` loads existing skill data into form fields\n * 3. **Data Transform**: Strapi API format \u2192 Form state (complex transformations for MCP tools, files)\n * 4. **User Edits**: Modifies description, tools, instructions (name field disabled)\n * 5. **Validation**: Client-side validation on submit (excludes name validation)\n * 6. **API Call**: PUT request to `/skills/{id}` with updated data\n * 7. **File Update**: Backend updates existing skill.md file\n * 8. **Success Feedback**: Green banner with \"updated successfully\", auto-close after 2s\n * 9. **Callback Invoked**: `onSkillCreated()` triggers parent refresh\n * 10. **Modal Closes**: Form state reset, modal closes\n *\n * ### Data Transformation (Edit Mode)\n * Complex transformations when loading edit data:\n * - **MCP Tools**: `mcpConfig` array \u2192 `Record<serverId, toolNames[]>` (uses documentId as key)\n * - **Additional Files**: API file objects \u2192 `SkillFileUpload[]` (extracts fileId from number/string/object)\n * - **Tool Config**: `toolConfig.allowedTools` array \u2192 `selectedTools` state\n * - **Model Config**: `modelConfig` object \u2192 `modelConfig` state with enabled flag\n *\n * ## Form Handling\n * The component manages complex form state across multiple configuration sections:\n *\n * ### Form State Management\n * - **Core State**: `formState` object with 7 properties (name, description, skillmd, category, isPublic, version, license)\n * - **Tool State**: `selectedTools`, `disallowedTools` arrays\n * - **MCP State**: `selectedMCPTools` Record<serverId, toolNames[]>\n * - **Input Fields State**: `inputFields` array with dynamic field definitions\n * - **Model Config State**: `modelConfigEnabled` boolean, `modelConfig` object\n * - **File State**: `additionalFiles` array, `fileUploadLoading` boolean\n * - **Validation State**: `errors` object with field-level error messages\n * - **Creation State**: `creationStatus` ('idle' | 'loading' | 'success' | 'error')\n * - **Result State**: `creationResult` string for success/error messages\n *\n * ### Input Change Handler\n * ```typescript\n * handleInputChange(field, value)\n * ```\n * - Updates specific field in `formState`\n * - Clears error for that field (real-time error clearing)\n * - Provides immediate user feedback\n *\n * ### Form Validation\n * Multi-level validation with specific rules:\n * - **Name** (create mode only): Required, lowercase letters/numbers/hyphens only, max 64 chars\n * - **Description**: Required, max 1024 chars\n * - **Skill Instructions**: Required, min 50 chars\n * - **Version**: Required, semantic versioning format (e.g., \"1.0.0\")\n * - **License**: Optional, max 100 chars if provided\n * - Returns boolean, sets `errors` object with field-specific messages\n *\n * ## Modal Behavior\n * The component provides controlled modal interactions:\n *\n * ### Opening/Closing\n * - Controlled by parent via `isOpen` prop\n * - Dialog `onOpenChange` handler calls `handleClose()` when backdrop clicked\n * - Manual close via Cancel button or X button (from Dialog component)\n * - Auto-close after 2 seconds on success (setTimeout in handleSubmit)\n * - Close disabled when `creationStatus === 'loading'` (prevents accidental close during save)\n *\n * ### Form Reset on Close\n * `handleClose()` resets all state to defaults:\n * - Core form fields \u2192 empty strings, defaults\n * - Tool selections \u2192 empty arrays\n * - MCP tools \u2192 empty object\n * - Input fields \u2192 empty array\n * - Errors \u2192 empty object\n * - Creation status \u2192 'idle'\n * - Model config \u2192 disabled, defaults\n * - Advanced settings \u2192 collapsed\n * - Active tab \u2192 'allowed'\n * - Additional files \u2192 empty array\n *\n * ### Layout Structure\n * - **Header**: Title (Create New Skill / Edit Skill), description\n * - **Content**: Scrollable form area (max-h-[60vh]) with 10+ configuration sections\n * - **Result Banner**: Color-coded feedback (green success / red error) with icons\n * - **Footer**: Cancel button, Submit button (Create Skill / Update Skill)\n *\n * ## Form Fields\n * The modal contains 10+ configuration sections:\n *\n * ### 1. Core Configuration\n * - **Skill Name** (required, disabled in edit mode): Lowercase letters, numbers, hyphens, max 64 chars\n * - **Description** (required): Multi-line description, max 1024 chars, textarea with 3 rows\n * - **Category** (required): Dropdown with 9 categories (custom, general-purpose, code-analysis, data-processing, etc.)\n * - **Version** (required): Semantic versioning (e.g., \"1.0.0\"), validated with regex `/^\\d+\\.\\d+\\.\\d+$/`\n * - **License** (optional): Text input, max 100 chars (MIT, Apache-2.0, GPL-3.0, etc.)\n * - **Is Public** (required): Checkbox toggle for availability to all agents\n *\n * ### 2. Tool Configuration (Tab System)\n * - **Allowed Tools Tab**: Multi-select checkboxes for tools the skill can use\n *   - Empty selection = allow all tools\n *   - Specific selection = restrict to selected tools\n *   - Counter badge shows selected count\n * - **Disallowed Tools Tab**: Multi-select checkboxes for explicitly blocked tools\n *   - Empty selection = allow all tools\n *   - Specific selection = block selected tools\n *   - Counter badge shows disallowed count\n * - **Tool List**: Scrollable area (max-h-48) with tool name and description\n * - **Toggle Handler**: `handleToolToggle(toolName)` adds/removes from selectedTools\n *\n * ### 3. MCP Server Tools\n * - **MCPToolsSelector Component**: Separate component for MCP tool selection\n * - **State**: `selectedMCPTools` Record<serverId, toolNames[]>\n * - **Description**: \"Select specific MCP tools this skill can use. Leave empty to allow all MCP tools.\"\n *\n * ### 4. Input Fields Builder\n * - **Dynamic Field Creation**: \"+ Add Field\" button appends new InputField to array\n * - **Field Configuration**: Each field has:\n *   - Name (required): Field identifier for template variables\n *   - Label (required): Display label in forms\n *   - Type (required): Dropdown with 7 types (text, textarea, dropdown, multiselect, checkbox, number, filepath)\n *   - Placeholder (optional): Input placeholder text\n *   - Options (required for dropdown/multiselect): Comma-separated list\n *   - Description (optional): Help text for field\n *   - Required (optional): Checkbox for required validation\n * - **Remove Button**: Deletes field from array\n * - **Template Variables**: Instructions use `{{field_name}}` syntax for field values\n * - **Empty State**: Dashed border with \"No input fields defined\" message\n *\n * ### 5. Advanced Settings (Collapsible)\n * - **Collapsible Section**: Arrow icon (\u25b6 / \u25bc) indicates expand/collapse state\n * - **Model Configuration Override**: Checkbox to enable custom model settings\n *   - **Model Dropdown**: haiku, sonnet, sonnet-4, opus, opus-4\n *   - **Temperature Slider**: 0.00 - 1.00 range with 0.01 step, real-time value display\n *   - **Max Tokens**: Number input, 1-200000 range, optional\n *   - **Timeout**: Number input, minimum 1000ms, optional\n * - **Default State**: Collapsed on open, expanded state persists until form reset\n *\n * ### 6. Analytics Display (Edit Mode Only)\n * - **Read-Only Section**: Shows execution statistics\n * - **Metrics Grid**: 2x2 grid with 4 metrics:\n *   - Executions: Total execution count\n *   - Success Rate: Percentage with 1 decimal place\n *   - Avg Time: Average execution time in milliseconds\n *   - Last Executed: Date string (toLocaleDateString) or \"Never\"\n * - **Styling**: Gray background (bg-secondary/10) with border\n *\n * ### 7. Training History Display (Edit Mode Only)\n * - **Read-Only Section**: Shows past training sessions\n * - **Session List**: Scrollable area (max-h-48) with session cards\n * - **Session Card**: Each session shows:\n *   - Training Type: Session type label\n *   - Success Badge: Green (\u2713 Success) or Red (\u2717 Failed)\n *   - Score: Training score out of 100 (if available)\n *   - Notes: Session notes (if available)\n *   - Timestamp: Date and time of session\n * - **Border Indicator**: Left border (border-primary) on each card\n *\n * ### 8. Additional Files\n * - **File Upload Button**: \"+ Upload File\" triggers hidden file input\n * - **Accepted Types**: .md, .pdf, .txt, .json files\n * - **Upload Workflow**:\n *   1. User clicks \"Upload File\"\n *   2. File input dialog opens\n *   3. User selects file\n *   4. `uploadFile()` API call with FormData\n *   5. Loading state shows \"Uploading...\"\n *   6. File added to `additionalFiles` array with fileId\n *   7. Button returns to \"Upload File\"\n * - **File Configuration**: Each file has:\n *   - File Type dropdown (8 types: REFERENCE, EXAMPLES, TROUBLESHOOTING, CHANGELOG, FAQ, API_DOCS, TUTORIAL, CUSTOM)\n *   - Description textarea (optional)\n *   - Remove button (destructive variant)\n *   - File ID display (for debugging)\n * - **Display Order**: Auto-incremented based on array index\n * - **Empty State**: Dashed border with \"No files uploaded yet\" message\n *\n * ### 9. Skill Instructions\n * - **Markdown Textarea**: Large textarea (10 rows) for skill instructions\n * - **Monospace Font**: font-mono class for code-like appearance\n * - **Validation**: Required, minimum 50 characters\n * - **Placeholder**: Multi-line example with markdown structure\n * - **Template Variables**: Supports `{{field_name}}` for input field values\n * - **Format**: Encourages markdown with headings, lists, examples\n *\n * ## Styling Behavior\n * The component uses Tailwind CSS for styling:\n *\n * ### Dialog Styling\n * - **Max Width**: sm:max-w-[700px] for spacious layout\n * - **Content Area**: max-h-[60vh] with overflow-y-auto for scrolling\n * - **Padding**: p-4 for content area, pr-3 for scrollbar spacing\n * - **Grid Layout**: grid gap-4 for vertical spacing between sections\n *\n * ### Form Controls\n * - **Labels**: text-sm font-medium text-muted-foreground\n * - **Required Indicator**: text-red-400 asterisk (*)\n * - **Help Text**: text-xs text-muted-foreground below inputs\n * - **Error Messages**: text-red-500 text-xs with red border on input\n * - **Disabled State**: Disabled cursor and opacity for loading state\n *\n * ### Tab System\n * - **Tab Headers**: flex border-b for tab bar\n * - **Active Tab**: border-primary text-primary with bottom border-b-2\n * - **Inactive Tab**: border-transparent text-muted-foreground with hover:text-foreground\n * - **Tab Content**: border border-border rounded-md p-3 for content area\n *\n * ### Result Banner\n * - **Success**: bg-green-900/50 text-green-300 with CheckCircleIcon\n * - **Error**: bg-red-900/50 text-red-300 with XCircleIcon\n * - **Layout**: flex items-start space-x-3 for icon and text alignment\n *\n * ### Collapsible Sections\n * - **Header Button**: w-full flex items-center justify-between hover:bg-secondary/50\n * - **Collapsed Indicator**: \u25b6 (right arrow)\n * - **Expanded Indicator**: \u25bc (down arrow)\n * - **Content**: Border-t separator when expanded\n *\n * @interface SkillCreationModalProps\n * @property {boolean} isOpen - Controls modal visibility\n * @property {() => void} onClose - Callback when modal closes (via backdrop, cancel button, or auto-close)\n * @property {() => void} onSkillCreated - Callback after successful skill creation/update, used to refresh parent skill list\n * @property {Skill} [editSkill] - Optional skill object for edit mode. If provided, modal enters edit mode with pre-populated fields\n *\n * @example\n * // Basic usage - Create new skill\n * function SkillsPage() {\n *   const [isModalOpen, setIsModalOpen] = useState(false);\n *\n *   const handleSkillCreated = () => {\n *     // Refresh skills list\n *     loadSkills();\n *   };\n *\n *   return (\n *     <>\n *       <Button onClick={() => setIsModalOpen(true)}>Create Skill</Button>\n *       <SkillCreationModal\n *         isOpen={isModalOpen}\n *         onClose={() => setIsModalOpen(false)}\n *         onSkillCreated={handleSkillCreated}\n *       />\n *     </>\n *   );\n * }\n *\n * @example\n * // Edit existing skill\n * function SkillList({ skills }: { skills: Skill[] }) {\n *   const [editingSkill, setEditingSkill] = useState<Skill | undefined>();\n *\n *   return (\n *     <>\n *       {skills.map(skill => (\n *         <div key={skill.id}>\n *           <h3>{skill.name}</h3>\n *           <Button onClick={() => setEditingSkill(skill)}>Edit</Button>\n *         </div>\n *       ))}\n *       <SkillCreationModal\n *         isOpen={!!editingSkill}\n *         onClose={() => setEditingSkill(undefined)}\n *         onSkillCreated={() => {\n *           setEditingSkill(undefined);\n *           loadSkills();\n *         }}\n *         editSkill={editingSkill}\n *       />\n *     </>\n *   );\n * }\n *\n * @example\n * // Understanding input fields builder\n * // When user creates input fields like:\n * // - name: \"target_path\", type: \"text\", label: \"Target Path\", required: true\n * // - name: \"format\", type: \"dropdown\", options: [\"json\", \"csv\"], required: false\n * //\n * // The skill.md can use template variables:\n * // \"Process the file at {{target_path}} and convert to {{format}} format\"\n * //\n * // When skill is executed, user sees form with:\n * // - Text input labeled \"Target Path\" (required)\n * // - Dropdown labeled \"Format\" with json/csv options (optional)\n * //\n * // Submitted values replace template variables in instructions\n *\n * @example\n * // Understanding tool configuration workflow\n * // Skill creator wants to restrict skill to specific tools:\n * //\n * // 1. User clicks \"Allowed Tools\" tab\n * // 2. Selects \"Read\", \"Write\", \"Grep\" from available tools\n * // 3. Badge shows \"Allowed Tools (3)\"\n * // 4. Help text shows: \"Selected: Read, Write, Grep\"\n * // 5. When skill executes, only these 3 tools are available\n * //\n * // Alternatively, user can block specific tools:\n * // 1. User clicks \"Disallowed Tools\" tab\n * // 2. Selects \"Bash\", \"WebFetch\" to block\n * // 3. Badge shows \"Disallowed Tools (2)\"\n * // 4. Help text shows: \"Disallowed: Bash, WebFetch\"\n * // 5. When skill executes, all tools EXCEPT these 2 are available\n */\nimport React, { useState, useCallback, useEffect } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from './ui/Dialog';\nimport { Button } from './ui/Button';\nimport { Input } from './ui/Input';\nimport { Textarea } from './ui/Textarea';\nimport { SpinnerIcon, CheckCircleIcon, XCircleIcon } from './ui/Icons';\nimport { createSkill, updateSkill, getTools, uploadFile, deleteFile, type Tool, type InputField, type SkillFileUpload } from '../services/api';\nimport type { Skill } from '../../../types/agent.types';\nimport MCPToolsSelector from './MCPToolsSelector';\n\ninterface SkillCreationModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSkillCreated: () => void;\n  editSkill?: Skill; // Optional: If provided, modal will be in edit mode\n}\n\n/**\n * Creation status type for tracking form submission state\n * @typedef {'idle' | 'loading' | 'success' | 'error'} CreationStatus\n */\ntype CreationStatus = 'idle' | 'loading' | 'success' | 'error';\n\n/**\n * Form state interface containing all skill configuration fields\n * @interface FormState\n * @property {string} name - Skill identifier (lowercase, hyphens, max 64 chars) - immutable in edit mode\n * @property {string} description - Skill description for discovery (max 1024 chars)\n * @property {string} skillmd - Markdown instructions for skill execution (min 50 chars)\n * @property {string} category - Skill category for organization\n * @property {boolean} isPublic - Whether skill is available to all agents\n * @property {string} version - Semantic version (e.g., \"1.0.0\")\n * @property {string} license - Optional license type (e.g., \"MIT\", max 100 chars)\n */\ninterface FormState {\n  name: string;\n  description: string;\n  skillmd: string;\n  category: 'general-purpose' | 'code-analysis' | 'data-processing' | 'web-scraping' | 'file-manipulation' | 'api-integration' | 'browser-automation' | 'testing' | 'custom';\n  isPublic: boolean;\n  version: string;\n  license: string;\n}\n\nconst SkillCreationModal: React.FC<SkillCreationModalProps> = ({ isOpen, onClose, onSkillCreated, editSkill }) => {\n  const isEditMode = !!editSkill;\n\n  const [formState, setFormState] = useState<FormState>({\n    name: '',\n    description: '',\n    skillmd: '',\n    category: 'custom',\n    isPublic: true,\n    version: '1.0.0',\n    license: ''\n  });\n  const [selectedTools, setSelectedTools] = useState<string[]>([]);\n  const [disallowedTools, setDisallowedTools] = useState<string[]>([]); // Phase 2\n  const [selectedMCPTools, setSelectedMCPTools] = useState<Record<string, string[]>>({});\n  const [inputFields, setInputFields] = useState<InputField[]>([]);\n  const [availableTools, setAvailableTools] = useState<Tool[]>([]);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [creationStatus, setCreationStatus] = useState<CreationStatus>('idle');\n  const [creationResult, setCreationResult] = useState<string>('');\n\n  // Phase 2: Model configuration state\n  const [modelConfigEnabled, setModelConfigEnabled] = useState(false);\n  const [modelConfig, setModelConfig] = useState({\n    model: 'sonnet' as 'haiku' | 'sonnet' | 'sonnet-4' | 'opus' | 'opus-4',\n    temperature: 1.0,\n    maxTokens: undefined as number | undefined,\n    timeout: undefined as number | undefined,\n  });\n\n  // Phase 2: UI state\n  const [showAdvanced, setShowAdvanced] = useState(false);\n  const [activeToolTab, setActiveToolTab] = useState<'allowed' | 'disallowed'>('allowed');\n\n  // Phase 3: Additional files state\n  const [additionalFiles, setAdditionalFiles] = useState<SkillFileUpload[]>([]);\n  const [fileUploadLoading, setFileUploadLoading] = useState(false);\n\n  // Load available tools when modal opens\n  useEffect(() => {\n    if (isOpen) {\n      getTools()\n        .then(setAvailableTools)\n        .catch((err) => console.error('Failed to load tools:', err));\n    }\n  }, [isOpen]);\n\n  // Populate form when editing an existing skill\n  useEffect(() => {\n    if (isEditMode && editSkill) {\n      console.log('Edit Skill Data:', {\n        name: editSkill.name,\n        toolConfig: editSkill.toolConfig,\n        allowedTools: editSkill.toolConfig?.allowedTools,\n        mcpConfig: editSkill.mcpConfig\n      });\n\n      setFormState({\n        name: editSkill.name,\n        description: editSkill.description,\n        skillmd: editSkill.skillmd,\n        category: editSkill.category || 'custom',\n        isPublic: editSkill.isPublic !== undefined ? editSkill.isPublic : true,\n        version: editSkill.version || '1.0.0',\n        license: editSkill.license || ''\n      });\n\n      // Transform component-based structure to form state\n      setSelectedTools(editSkill.toolConfig?.allowedTools || []);\n      setDisallowedTools(editSkill.toolConfig?.disallowedTools || []); // Phase 2\n\n      // Phase 2: Load model configuration\n      if (editSkill.modelConfig) {\n        setModelConfigEnabled(true);\n        setModelConfig({\n          model: editSkill.modelConfig.model || 'sonnet',\n          temperature: editSkill.modelConfig.temperature !== undefined ? editSkill.modelConfig.temperature : 1.0,\n          maxTokens: editSkill.modelConfig.maxTokens,\n          timeout: editSkill.modelConfig.timeout,\n        });\n      }\n\n      // Transform mcpConfig (component array) to Record<serverId, toolNames[]>\n      const mcpToolsRecord: Record<string, string[]> = {};\n      if (editSkill.mcpConfig) {\n        editSkill.mcpConfig.forEach((config) => {\n          // Use documentId as serverId (frontend uses documentId everywhere)\n          // Strapi returns raw response with both id (integer) and documentId (string)\n          const serverId = typeof config.mcpServer === 'string'\n            ? config.mcpServer\n            : ((config.mcpServer as any).documentId || String(config.mcpServer.id));\n          if (config.selectedTools) {\n            mcpToolsRecord[serverId] = config.selectedTools.map((toolSel) =>\n              typeof toolSel.mcpTool === 'string' ? toolSel.mcpTool : toolSel.mcpTool.name\n            );\n          }\n        });\n      }\n      setSelectedMCPTools(mcpToolsRecord);\n\n      // Load input fields\n      setInputFields(editSkill.inputFields || []);\n\n      // Phase 3: Load additional files\n      if (editSkill.additionalFiles && editSkill.additionalFiles.length > 0) {\n        console.log('[DEBUG] Loading additionalFiles from edit mode:', editSkill.additionalFiles);\n\n        setAdditionalFiles(editSkill.additionalFiles.map(f => {\n          // Extract fileId - could be number, string, or object\n          let fileId = '';\n          if (typeof f.file === 'number') {\n            fileId = f.file.toString();\n          } else if (typeof f.file === 'string') {\n            fileId = f.file;\n          } else if (f.file && typeof f.file === 'object') {\n            fileId = f.file.id ? f.file.id.toString() : '';\n          }\n\n          console.log('[DEBUG] Mapped file:', { originalFile: f.file, extractedFileId: fileId });\n\n          return {\n            fileId,\n            fileType: f.fileType,\n            description: f.description || '',\n            displayOrder: f.displayOrder\n          };\n        }));\n      }\n    }\n  }, [isEditMode, editSkill]);\n\n  /**\n   * Handles input field changes for form state\n   * @internal\n   * @param field - Form field name to update\n   * @param value - New value for the field\n   *\n   * Updates the specified field in formState and clears any associated error\n   * for real-time error feedback. Provides immediate user feedback when\n   * correcting validation errors.\n   */\n  const handleInputChange = (field: keyof FormState, value: string) => {\n    setFormState(prev => ({ ...prev, [field]: value }));\n    if (errors[field]) {\n      setErrors(prev => {\n        const newErrors = { ...prev };\n        delete newErrors[field];\n        return newErrors;\n      });\n    }\n  };\n\n  /**\n   * Toggles tool selection in allowed tools list\n   * @internal\n   * @param toolName - Name of the tool to toggle\n   *\n   * Adds or removes tool from selectedTools array. If tool is already selected,\n   * removes it; otherwise adds it to the selection.\n   */\n  const handleToolToggle = (toolName: string) => {\n    setSelectedTools((prev) =>\n      prev.includes(toolName)\n        ? prev.filter((t) => t !== toolName)\n        : [...prev, toolName]\n    );\n  };\n\n  /**\n   * Validates all form fields before submission\n   * @internal\n   * @returns {boolean} True if all validations pass, false otherwise\n   *\n   * Performs comprehensive validation:\n   * - Name (create mode): required, lowercase/numbers/hyphens only, max 64 chars\n   * - Description: required, max 1024 chars\n   * - Skill Instructions: required, min 50 chars\n   * - Version: required, semantic versioning format (e.g., \"1.0.0\")\n   * - License: optional, max 100 chars if provided\n   *\n   * Sets errors object with field-specific messages for any validation failures.\n   */\n  const validateForm = (): boolean => {\n    const newErrors: Record<string, string> = {};\n\n    // Name validation (only in create mode)\n    if (!isEditMode) {\n      if (!formState.name.trim()) {\n        newErrors.name = 'Skill name is required.';\n      } else if (!/^[a-z0-9-]+$/.test(formState.name)) {\n        newErrors.name = 'Name must contain only lowercase letters, numbers, and hyphens.';\n      } else if (formState.name.length > 64) {\n        newErrors.name = 'Name must be 64 characters or less.';\n      }\n    }\n\n    // Description validation\n    if (!formState.description.trim()) {\n      newErrors.description = 'Description is required.';\n    } else if (formState.description.length > 1024) {\n      newErrors.description = 'Description must be 1024 characters or less.';\n    }\n\n    // Skill instructions validation\n    if (!formState.skillmd.trim()) {\n      newErrors.skillmd = 'Skill instructions are required.';\n    } else if (formState.skillmd.length < 50) {\n      newErrors.skillmd = 'Skill instructions must be at least 50 characters.';\n    }\n\n    // Version validation\n    if (!formState.version.trim()) {\n      newErrors.version = 'Version is required.';\n    } else if (!/^\\d+\\.\\d+\\.\\d+$/.test(formState.version)) {\n      newErrors.version = 'Version must follow semantic versioning (e.g., 1.0.0).';\n    }\n\n    // License validation (optional, but if provided check length)\n    if (formState.license && formState.license.length > 100) {\n      newErrors.license = 'License must be less than 100 characters.';\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  /**\n   * Handles form submission for creating or updating a skill\n   * @internal\n   *\n   * Workflow:\n   * 1. Validates form fields using validateForm()\n   * 2. Sets loading state and clears previous results\n   * 3. Builds API payload based on mode (create vs edit)\n   * 4. Calls createSkill() or updateSkill() API\n   * 5. Handles success: sets success state, shows message, auto-closes after 2s\n   * 6. Handles error: sets error state, shows error message\n   * 7. Invokes onSkillCreated callback on success\n   *\n   * Create Mode:\n   * - Generates displayName from name (e.g., \"test-skill\" \u2192 \"Test Skill\")\n   * - Includes all form fields in payload\n   * - Creates new skill file at .claude/skills/{name}/skill.md\n   *\n   * Edit Mode:\n   * - Excludes name from payload (immutable)\n   * - Updates existing skill file\n   * - Preserves existing skill.id for API call\n   *\n   * Data Transformations:\n   * - Empty arrays/objects excluded from payload (undefined)\n   * - Model config included only if enabled\n   * - Additional files included only if non-empty\n   * - MCP tools transformed to API format\n   */\n  const handleSubmit = useCallback(async () => {\n    if (!validateForm()) {\n      return;\n    }\n\n    setCreationStatus('loading');\n    setCreationResult('');\n\n    try {\n      let data;\n\n      if (isEditMode && editSkill) {\n        // DEBUG: Log additionalFiles state before update\n        console.log('[DEBUG] additionalFiles state before update:', {\n          length: additionalFiles.length,\n          files: additionalFiles,\n          willSend: additionalFiles.length > 0\n        });\n\n        // Update existing skill\n        const updatePayload = {\n          description: formState.description,\n          allowedTools: selectedTools.length > 0 ? selectedTools : undefined,\n          disallowedTools: disallowedTools.length > 0 ? disallowedTools : undefined, // Phase 2\n          mcpTools: Object.keys(selectedMCPTools).length > 0 ? selectedMCPTools : undefined,\n          inputFields: inputFields.length > 0 ? inputFields : undefined,\n          skillmd: formState.skillmd,\n          category: formState.category,\n          isPublic: formState.isPublic,\n          version: formState.version,\n          license: formState.license || undefined,\n          // Phase 2: Model configuration\n          modelConfig: modelConfigEnabled ? modelConfig : undefined,\n          // Phase 3: Additional files\n          additionalFiles: additionalFiles.length > 0 ? additionalFiles : undefined,\n        };\n\n        console.log('[DEBUG] Update payload:', {\n          hasAdditionalFiles: 'additionalFiles' in updatePayload,\n          additionalFiles: updatePayload.additionalFiles\n        });\n\n        data = await updateSkill(editSkill.id, updatePayload);\n      } else {\n        // Create new skill\n        // Generate displayName from name (e.g., \"test-skill\" -> \"Test Skill\")\n        const displayName = formState.name\n          .split('-')\n          .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n          .join(' ');\n\n        data = await createSkill({\n          name: formState.name,\n          displayName: displayName,\n          description: formState.description,\n          allowedTools: selectedTools.length > 0 ? selectedTools : undefined,\n          disallowedTools: disallowedTools.length > 0 ? disallowedTools : undefined, // Phase 2\n          mcpTools: Object.keys(selectedMCPTools).length > 0 ? selectedMCPTools : undefined,\n          inputFields: inputFields.length > 0 ? inputFields : undefined,\n          skillmd: formState.skillmd,\n          category: formState.category,\n          isPublic: formState.isPublic,\n          version: formState.version,\n          license: formState.license || undefined,\n          // Phase 2: Model configuration\n          modelConfig: modelConfigEnabled ? modelConfig : undefined,\n          // Phase 3: Additional files\n          additionalFiles: additionalFiles.length > 0 ? additionalFiles : undefined,\n        });\n      }\n\n      if (data.success) {\n        setCreationStatus('success');\n        const action = isEditMode ? 'updated' : 'created';\n        setCreationResult(`Skill \"${formState.name}\" ${action} successfully at ${data.path}`);\n        onSkillCreated();\n\n        // Close modal after 2 seconds\n        setTimeout(() => {\n          handleClose();\n        }, 2000);\n      } else {\n        setCreationStatus('error');\n        const action = isEditMode ? 'update' : 'create';\n        setCreationResult(data.error || `Failed to ${action} skill. Please try again.`);\n      }\n    } catch (error) {\n      setCreationStatus('error');\n      setCreationResult(error instanceof Error ? error.message : 'Network error. Please check your connection and try again.');\n      console.error('Skill operation error:', error);\n    }\n  }, [isEditMode, editSkill, formState, selectedTools, disallowedTools, selectedMCPTools, inputFields, modelConfigEnabled, modelConfig, additionalFiles, onSkillCreated]);\n\n  /**\n   * Handles modal close and resets all form state\n   * @internal\n   *\n   * Resets all state to initial values:\n   * - Core form fields (name, description, skillmd, category, isPublic, version, license)\n   * - Tool selections (selectedTools, disallowedTools)\n   * - MCP tools (selectedMCPTools)\n   * - Input fields (inputFields)\n   * - Validation errors (errors)\n   * - Creation status and result\n   * - Model configuration (modelConfigEnabled, modelConfig)\n   * - UI state (showAdvanced, activeToolTab)\n   * - File uploads (additionalFiles, fileUploadLoading)\n   *\n   * Called when:\n   * - User clicks Cancel button\n   * - User clicks backdrop (Dialog onOpenChange)\n   * - Auto-close timeout after success (2s)\n   * - User clicks X button in dialog header\n   */\n  const handleClose = () => {\n    setFormState({\n      name: '',\n      description: '',\n      skillmd: '',\n      category: 'custom',\n      isPublic: true,\n      version: '1.0.0',\n      license: ''\n    });\n    setSelectedTools([]);\n    setDisallowedTools([]); // Phase 2\n    setSelectedMCPTools({});\n    setInputFields([]);\n    setErrors({});\n    setCreationStatus('idle');\n    setCreationResult('');\n    // Phase 2: Reset model config\n    setModelConfigEnabled(false);\n    setModelConfig({\n      model: 'sonnet',\n      temperature: 1.0,\n      maxTokens: undefined,\n      timeout: undefined,\n    });\n    setShowAdvanced(false);\n    setActiveToolTab('allowed');\n    // Phase 3: Reset additional files\n    setAdditionalFiles([]);\n    setFileUploadLoading(false);\n    onClose();\n  };\n\n  /**\n   * Renders color-coded result banner based on creation status\n   * @internal\n   * @returns {JSX.Element | null} Result banner element or null if idle\n   *\n   * Status-based rendering:\n   * - idle: Returns null (no banner)\n   * - loading: Not rendered (spinner shows in submit button instead)\n   * - success: Green banner with CheckCircleIcon and success message\n   * - error: Red banner with XCircleIcon and error message\n   *\n   * Banner styling:\n   * - Success: bg-green-900/50 text-green-300\n   * - Error: bg-red-900/50 text-red-300\n   * - Layout: flex items-start space-x-3 for icon-text alignment\n   */\n  const renderResult = () => {\n    if (creationStatus === 'idle') return null;\n\n    const baseClasses = \"mt-4 p-4 rounded-md text-sm flex items-start space-x-3\";\n\n    if (creationStatus === 'success') {\n      return (\n        <div className={`${baseClasses} bg-green-900/50 text-green-300`}>\n          <CheckCircleIcon className=\"h-5 w-5 mt-0.5 flex-shrink-0\" />\n          <p>{creationResult}</p>\n        </div>\n      );\n    }\n\n    if (creationStatus === 'error') {\n      return (\n        <div className={`${baseClasses} bg-red-900/50 text-red-300`}>\n          <XCircleIcon className=\"h-5 w-5 mt-0.5 flex-shrink-0\" />\n          <p>{creationResult}</p>\n        </div>\n      );\n    }\n\n    return null;\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={(open) => !open && handleClose()}>\n      <DialogContent className=\"sm:max-w-[700px]\">\n        <DialogHeader>\n          <DialogTitle>{isEditMode ? 'Edit Skill' : 'Create New Skill'}</DialogTitle>\n          <DialogDescription>\n            {isEditMode\n              ? 'Update the skill details. The skill name cannot be changed.'\n              : 'Create a new Agent Skill that extends Claude\\'s capabilities. Skills are automatically discovered and used when relevant.'}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"grid gap-4 py-4 max-h-[60vh] overflow-y-auto pr-3\">\n          {/* Name Field */}\n          <div>\n            <label htmlFor=\"name\" className=\"block text-sm font-medium text-muted-foreground mb-1\">\n              Skill Name <span className=\"text-red-400\">*</span>\n            </label>\n            <Input\n              id=\"name\"\n              type=\"text\"\n              value={formState.name}\n              onChange={(e) => handleInputChange('name', e.target.value)}\n              placeholder=\"pdf-processor, git-commit-helper, excel-analyzer...\"\n              className={errors.name ? 'border-red-500' : ''}\n              disabled={isEditMode}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {isEditMode\n                ? 'Skill name cannot be changed (used as directory name and ID)'\n                : 'Use lowercase letters, numbers, and hyphens only (max 64 characters)'}\n            </p>\n            {errors.name && <p className=\"text-red-500 text-xs mt-1\">{errors.name}</p>}\n          </div>\n\n          {/* Description Field */}\n          <div>\n            <label htmlFor=\"description\" className=\"block text-sm font-medium text-muted-foreground mb-1\">\n              Description <span className=\"text-red-400\">*</span>\n            </label>\n            <Textarea\n              id=\"description\"\n              value={formState.description}\n              onChange={(e) => handleInputChange('description', e.target.value)}\n              placeholder='Extract text and tables from PDFs. Use when working with PDF files or document extraction.'\n              rows={3}\n              className={errors.description ? 'border-red-500' : ''}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Describe what the skill does and when to use it (max 1024 characters)\n            </p>\n            {errors.description && <p className=\"text-red-500 text-xs mt-1\">{errors.description}</p>}\n          </div>\n\n          {/* Category Field */}\n          <div>\n            <label htmlFor=\"category\" className=\"block text-sm font-medium text-muted-foreground mb-1\">\n              Category <span className=\"text-red-400\">*</span>\n            </label>\n            <select\n              id=\"category\"\n              value={formState.category}\n              onChange={(e) => handleInputChange('category', e.target.value as any)}\n              className=\"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground\"\n              disabled={creationStatus === 'loading'}\n            >\n              <option value=\"custom\">Custom</option>\n              <option value=\"general-purpose\">General Purpose</option>\n              <option value=\"code-analysis\">Code Analysis</option>\n              <option value=\"data-processing\">Data Processing</option>\n              <option value=\"web-scraping\">Web Scraping</option>\n              <option value=\"file-manipulation\">File Manipulation</option>\n              <option value=\"api-integration\">API Integration</option>\n              <option value=\"browser-automation\">Browser Automation</option>\n              <option value=\"testing\">Testing</option>\n            </select>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Select the category that best describes this skill's purpose\n            </p>\n            {errors.category && <p className=\"text-red-500 text-xs mt-1\">{errors.category}</p>}\n          </div>\n\n          {/* Version and License Row */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            {/* Version Field */}\n            <div>\n              <label htmlFor=\"version\" className=\"block text-sm font-medium text-muted-foreground mb-1\">\n                Version <span className=\"text-red-400\">*</span>\n              </label>\n              <Input\n                id=\"version\"\n                type=\"text\"\n                value={formState.version}\n                onChange={(e) => handleInputChange('version', e.target.value)}\n                placeholder=\"1.0.0\"\n                className={errors.version ? 'border-red-500' : ''}\n                disabled={creationStatus === 'loading'}\n              />\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Semantic versioning (e.g., 1.0.0)\n              </p>\n              {errors.version && <p className=\"text-red-500 text-xs mt-1\">{errors.version}</p>}\n            </div>\n\n            {/* License Field */}\n            <div>\n              <label htmlFor=\"license\" className=\"block text-sm font-medium text-muted-foreground mb-1\">\n                License <span className=\"text-muted-foreground text-xs\">(Optional)</span>\n              </label>\n              <Input\n                id=\"license\"\n                type=\"text\"\n                value={formState.license}\n                onChange={(e) => handleInputChange('license', e.target.value)}\n                placeholder=\"MIT, Apache-2.0, GPL-3.0...\"\n                className={errors.license ? 'border-red-500' : ''}\n                disabled={creationStatus === 'loading'}\n              />\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                License type (max 100 characters)\n              </p>\n              {errors.license && <p className=\"text-red-500 text-xs mt-1\">{errors.license}</p>}\n            </div>\n          </div>\n\n          {/* Is Public Toggle */}\n          <div className=\"flex items-center justify-between p-3 border border-border rounded-md bg-secondary/10\">\n            <div>\n              <label htmlFor=\"isPublic\" className=\"text-sm font-medium\">\n                Public Skill\n              </label>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Make this skill available to all agents in the system\n              </p>\n            </div>\n            <input\n              id=\"isPublic\"\n              type=\"checkbox\"\n              checked={formState.isPublic}\n              onChange={(e) => handleInputChange('isPublic', e.target.checked as any)}\n              disabled={creationStatus === 'loading'}\n              className=\"w-5 h-5\"\n            />\n          </div>\n\n          {/* Tool Configuration - Phase 2: Tab System */}\n          <div>\n            <label className=\"block text-sm font-medium text-muted-foreground mb-1\">\n              Tool Configuration <span className=\"text-muted-foreground text-xs\">(Optional)</span>\n            </label>\n\n            {/* Tab Headers */}\n            <div className=\"flex border-b border-border mb-2\">\n              <button\n                type=\"button\"\n                onClick={() => setActiveToolTab('allowed')}\n                className={`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${\n                  activeToolTab === 'allowed'\n                    ? 'border-primary text-primary'\n                    : 'border-transparent text-muted-foreground hover:text-foreground'\n                }`}\n              >\n                Allowed Tools ({selectedTools.length})\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setActiveToolTab('disallowed')}\n                className={`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${\n                  activeToolTab === 'disallowed'\n                    ? 'border-primary text-primary'\n                    : 'border-transparent text-muted-foreground hover:text-foreground'\n                }`}\n              >\n                Disallowed Tools ({disallowedTools.length})\n              </button>\n            </div>\n\n            {/* Tab Content */}\n            <div className=\"border border-border rounded-md p-3 max-h-48 overflow-y-auto\">\n              {availableTools.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">Loading tools...</p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {activeToolTab === 'allowed' ? (\n                    // Allowed Tools Tab\n                    availableTools.map((tool) => (\n                      <label\n                        key={tool.name}\n                        className=\"flex items-start gap-2 cursor-pointer hover:bg-secondary/50 p-2 rounded\"\n                      >\n                        <input\n                          type=\"checkbox\"\n                          checked={selectedTools.includes(tool.name)}\n                          onChange={() => handleToolToggle(tool.name)}\n                          disabled={creationStatus === 'loading'}\n                          className=\"mt-1 w-4 h-4\"\n                        />\n                        <div className=\"flex-1\">\n                          <div className=\"font-medium text-sm\">{tool.name}</div>\n                          <div className=\"text-xs text-muted-foreground\">{tool.description}</div>\n                        </div>\n                      </label>\n                    ))\n                  ) : (\n                    // Disallowed Tools Tab\n                    availableTools.map((tool) => (\n                      <label\n                        key={tool.name}\n                        className=\"flex items-start gap-2 cursor-pointer hover:bg-secondary/50 p-2 rounded\"\n                      >\n                        <input\n                          type=\"checkbox\"\n                          checked={disallowedTools.includes(tool.name)}\n                          onChange={() => {\n                            if (disallowedTools.includes(tool.name)) {\n                              setDisallowedTools(disallowedTools.filter(t => t !== tool.name));\n                            } else {\n                              setDisallowedTools([...disallowedTools, tool.name]);\n                            }\n                          }}\n                          disabled={creationStatus === 'loading'}\n                          className=\"mt-1 w-4 h-4\"\n                        />\n                        <div className=\"flex-1\">\n                          <div className=\"font-medium text-sm\">{tool.name}</div>\n                          <div className=\"text-xs text-muted-foreground\">{tool.description}</div>\n                        </div>\n                      </label>\n                    ))\n                  )}\n                </div>\n              )}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {activeToolTab === 'allowed'\n                ? (selectedTools.length > 0\n                    ? `Selected: ${selectedTools.join(', ')}`\n                    : 'Leave empty to allow all tools. Select specific tools to restrict what the skill can use.')\n                : (disallowedTools.length > 0\n                    ? `Disallowed: ${disallowedTools.join(', ')}`\n                    : 'Leave empty to allow all tools. Select specific tools to explicitly block.')\n              }\n            </p>\n          </div>\n\n          {/* MCP Server Tools */}\n          <div>\n            <label className=\"block text-sm font-medium text-muted-foreground mb-1\">\n              MCP Server Tools <span className=\"text-muted-foreground text-xs\">(Optional)</span>\n            </label>\n            <MCPToolsSelector\n              selectedMCPTools={selectedMCPTools}\n              onChange={setSelectedMCPTools}\n              disabled={creationStatus === 'loading'}\n              directory={undefined}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Select specific MCP tools this skill can use. Leave empty to allow all MCP tools.\n            </p>\n          </div>\n\n          {/* Input Fields */}\n          <div>\n            <div className=\"flex items-center justify-between mb-2\">\n              <label className=\"block text-sm font-medium text-muted-foreground\">\n                Input Fields <span className=\"text-muted-foreground text-xs\">(Optional)</span>\n              </label>\n              <Button\n                type=\"button\"\n                size=\"sm\"\n                onClick={() => {\n                  setInputFields([...inputFields, {\n                    name: '',\n                    type: 'text',\n                    label: '',\n                    required: false,\n                  }]);\n                }}\n                disabled={creationStatus === 'loading'}\n              >\n                + Add Field\n              </Button>\n            </div>\n\n            {inputFields.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground p-3 border border-dashed border-border rounded\">\n                No input fields defined. Click \"+ Add Field\" to add fields that users will fill when executing this skill.\n              </p>\n            ) : (\n              <div className=\"space-y-3 border border-border rounded p-3\">\n                {inputFields.map((field, index) => (\n                  <div key={index} className=\"border border-border rounded p-3 space-y-2\">\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Field Name *</label>\n                        <Input\n                          type=\"text\"\n                          value={field.name}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].name = e.target.value;\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"target_path\"\n                          disabled={creationStatus === 'loading'}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Label *</label>\n                        <Input\n                          type=\"text\"\n                          value={field.label}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].label = e.target.value;\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"Target Path\"\n                          disabled={creationStatus === 'loading'}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Type *</label>\n                        <select\n                          value={field.type}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].type = e.target.value as any;\n                            setInputFields(newFields);\n                          }}\n                          disabled={creationStatus === 'loading'}\n                          className=\"w-full px-2 py-1 text-sm border border-border rounded-md bg-background\"\n                        >\n                          <option value=\"text\">Text</option>\n                          <option value=\"textarea\">Textarea</option>\n                          <option value=\"dropdown\">Dropdown</option>\n                          <option value=\"multiselect\">Multiselect</option>\n                          <option value=\"checkbox\">Checkbox</option>\n                          <option value=\"number\">Number</option>\n                          <option value=\"filepath\">File Path</option>\n                        </select>\n                      </div>\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Placeholder</label>\n                        <Input\n                          type=\"text\"\n                          value={field.placeholder || ''}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].placeholder = e.target.value;\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"/path/to/file\"\n                          disabled={creationStatus === 'loading'}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                    </div>\n\n                    {(field.type === 'dropdown' || field.type === 'multiselect') && (\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Options (comma-separated) *</label>\n                        <Input\n                          type=\"text\"\n                          value={field.options?.join(', ') || ''}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].options = e.target.value.split(',').map(o => o.trim()).filter(Boolean);\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"json, markdown, html\"\n                          disabled={creationStatus === 'loading'}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                    )}\n\n                    <div>\n                      <label className=\"block text-xs font-medium mb-1\">Description</label>\n                      <Input\n                        type=\"text\"\n                        value={field.description || ''}\n                        onChange={(e) => {\n                          const newFields = [...inputFields];\n                          newFields[index].description = e.target.value;\n                          setInputFields(newFields);\n                        }}\n                        placeholder=\"Additional help text for this field\"\n                        disabled={creationStatus === 'loading'}\n                        className=\"text-sm\"\n                      />\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <label className=\"flex items-center gap-2 text-xs\">\n                        <input\n                          type=\"checkbox\"\n                          checked={field.required || false}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].required = e.target.checked;\n                            setInputFields(newFields);\n                          }}\n                          disabled={creationStatus === 'loading'}\n                          className=\"w-3 h-3\"\n                        />\n                        Required\n                      </label>\n                      <Button\n                        type=\"button\"\n                        size=\"sm\"\n                        variant=\"secondary\"\n                        onClick={() => {\n                          setInputFields(inputFields.filter((_, i) => i !== index));\n                        }}\n                        disabled={creationStatus === 'loading'}\n                      >\n                        Remove\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Define form fields that users will fill when executing this skill. Use template variables like {`{{field_name}}`} in your skill instructions.\n            </p>\n          </div>\n\n          {/* Phase 2: Advanced Settings - Collapsible */}\n          <div className=\"border border-border rounded-md\">\n            <button\n              type=\"button\"\n              onClick={() => setShowAdvanced(!showAdvanced)}\n              className=\"w-full flex items-center justify-between p-3 hover:bg-secondary/50 rounded-t-md transition-colors\"\n            >\n              <span className=\"text-sm font-medium\">\u2699\ufe0f Advanced Settings</span>\n              <span className=\"text-muted-foreground\">{showAdvanced ? '\u25bc' : '\u25b6'}</span>\n            </button>\n\n            {showAdvanced && (\n              <div className=\"p-4 space-y-4 border-t border-border\">\n                {/* Model Configuration */}\n                <div>\n                  <label className=\"flex items-center gap-2 mb-3\">\n                    <input\n                      type=\"checkbox\"\n                      checked={modelConfigEnabled}\n                      onChange={(e) => setModelConfigEnabled(e.target.checked)}\n                      disabled={creationStatus === 'loading'}\n                      className=\"w-4 h-4\"\n                    />\n                    <span className=\"text-sm font-medium\">Override Model Configuration</span>\n                  </label>\n\n                  {modelConfigEnabled && (\n                    <div className=\"ml-6 space-y-3 p-3 border border-border rounded bg-secondary/10\">\n                      {/* Model Selection */}\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Model</label>\n                        <select\n                          value={modelConfig.model}\n                          onChange={(e) => setModelConfig({ ...modelConfig, model: e.target.value as any })}\n                          disabled={creationStatus === 'loading'}\n                          className=\"w-full px-2 py-1 text-sm border border-border rounded-md bg-background\"\n                        >\n                          <option value=\"haiku\">Claude Haiku 3.5</option>\n                          <option value=\"sonnet\">Claude Sonnet 4.5</option>\n                          <option value=\"sonnet-4\">Claude Sonnet 4</option>\n                          <option value=\"opus\">Claude Opus 4</option>\n                          <option value=\"opus-4\">Claude Opus 4 (Latest)</option>\n                        </select>\n                      </div>\n\n                      {/* Temperature Slider */}\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">\n                          Temperature: {modelConfig.temperature.toFixed(2)}\n                        </label>\n                        <input\n                          type=\"range\"\n                          min=\"0\"\n                          max=\"1\"\n                          step=\"0.01\"\n                          value={modelConfig.temperature}\n                          onChange={(e) => setModelConfig({ ...modelConfig, temperature: parseFloat(e.target.value) })}\n                          disabled={creationStatus === 'loading'}\n                          className=\"w-full\"\n                        />\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Lower = more focused and deterministic, Higher = more creative and random\n                        </p>\n                      </div>\n\n                      {/* Max Tokens */}\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Max Tokens (Optional)</label>\n                        <Input\n                          type=\"number\"\n                          value={modelConfig.maxTokens || ''}\n                          onChange={(e) => setModelConfig({ ...modelConfig, maxTokens: e.target.value ? parseInt(e.target.value) : undefined })}\n                          placeholder=\"Leave empty for default\"\n                          disabled={creationStatus === 'loading'}\n                          className=\"text-sm\"\n                          min=\"1\"\n                          max=\"200000\"\n                        />\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Maximum number of tokens to generate (1-200000)\n                        </p>\n                      </div>\n\n                      {/* Timeout */}\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Timeout (ms, Optional)</label>\n                        <Input\n                          type=\"number\"\n                          value={modelConfig.timeout || ''}\n                          onChange={(e) => setModelConfig({ ...modelConfig, timeout: e.target.value ? parseInt(e.target.value) : undefined })}\n                          placeholder=\"Leave empty for default (300000ms)\"\n                          disabled={creationStatus === 'loading'}\n                          className=\"text-sm\"\n                          min=\"1000\"\n                        />\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Request timeout in milliseconds (minimum 1000ms)\n                        </p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Phase 3: Analytics Display (Read-only, Edit Mode Only) */}\n          {isEditMode && editSkill?.analytics && (\n            <div className=\"border border-border rounded-md p-4 bg-secondary/10\">\n              <h3 className=\"text-sm font-medium mb-3\">\ud83d\udcca Analytics</h3>\n              <div className=\"grid grid-cols-2 gap-3 text-xs\">\n                <div>\n                  <span className=\"text-muted-foreground\">Executions:</span>\n                  <span className=\"ml-2 font-medium\">{editSkill.analytics.executionCount}</span>\n                </div>\n                <div>\n                  <span className=\"text-muted-foreground\">Success Rate:</span>\n                  <span className=\"ml-2 font-medium\">{editSkill.analytics.successRate.toFixed(1)}%</span>\n                </div>\n                <div>\n                  <span className=\"text-muted-foreground\">Avg Time:</span>\n                  <span className=\"ml-2 font-medium\">{editSkill.analytics.averageExecutionTime}ms</span>\n                </div>\n                <div>\n                  <span className=\"text-muted-foreground\">Last Executed:</span>\n                  <span className=\"ml-2 font-medium\">\n                    {editSkill.analytics.lastExecutedAt\n                      ? new Date(editSkill.analytics.lastExecutedAt).toLocaleDateString()\n                      : 'Never'}\n                  </span>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Phase 3: Training History Display (Read-only, Edit Mode Only) */}\n          {isEditMode && editSkill?.trainingHistory && editSkill.trainingHistory.length > 0 && (\n            <div className=\"border border-border rounded-md p-4 bg-secondary/10\">\n              <h3 className=\"text-sm font-medium mb-3\">\ud83c\udf93 Training History</h3>\n              <div className=\"space-y-2 max-h-48 overflow-y-auto\">\n                {editSkill.trainingHistory.map((session, idx) => (\n                  <div key={session.id || idx} className=\"border-l-2 border-primary pl-3 py-2 text-xs\">\n                    <div className=\"flex items-center justify-between mb-1\">\n                      <span className=\"font-medium\">{session.trainingType}</span>\n                      <span className={`px-2 py-0.5 rounded ${session.success ? 'bg-green-500/20 text-green-700' : 'bg-red-500/20 text-red-700'}`}>\n                        {session.success ? '\u2713 Success' : '\u2717 Failed'}\n                      </span>\n                    </div>\n                    {session.score !== undefined && (\n                      <div className=\"text-muted-foreground\">Score: {session.score}/100</div>\n                    )}\n                    {session.notes && (\n                      <div className=\"text-muted-foreground mt-1\">{session.notes}</div>\n                    )}\n                    <div className=\"text-muted-foreground text-[10px] mt-1\">\n                      {new Date(session.timestamp).toLocaleString()}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Phase 4: Additional Files (Full File Upload) */}\n          <div className=\"border border-border rounded-md p-4\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h3 className=\"text-sm font-medium\">\ud83d\udcce Additional Files</h3>\n              <Button\n                type=\"button\"\n                size=\"sm\"\n                onClick={() => {\n                  const input = document.createElement('input');\n                  input.type = 'file';\n                  input.accept = '.md,.pdf,.txt,.json';\n                  input.onchange = async (e: Event) => {\n                    const file = (e.target as HTMLInputElement).files?.[0];\n                    if (!file) return;\n\n                    try {\n                      setFileUploadLoading(true);\n                      const uploadedFile = await uploadFile(file);\n\n                      // Use callback to get accurate length\n                      setAdditionalFiles(prev => {\n                        const newFile = {\n                          fileId: uploadedFile.id.toString(),\n                          fileType: 'CUSTOM' as const,\n                          description: '',\n                          displayOrder: prev.length,\n                        };\n\n                        const updated = [...prev, newFile];\n                        console.log('[DEBUG] File added to state:', {\n                          uploadedFile,\n                          newFile,\n                          previousLength: prev.length,\n                          updatedLength: updated.length,\n                          updated\n                        });\n                        return updated;\n                      });\n                    } catch (error: any) {\n                      console.error('File upload error:', error);\n                      alert(`Failed to upload file: ${error.message}`);\n                    } finally {\n                      setFileUploadLoading(false);\n                    }\n                  };\n                  input.click();\n                }}\n                disabled={creationStatus === 'loading' || fileUploadLoading}\n                className=\"h-7 px-3 text-xs\"\n              >\n                {fileUploadLoading ? 'Uploading...' : '+ Upload File'}\n              </Button>\n            </div>\n\n            <p className=\"text-xs text-muted-foreground mb-3\">\n              Upload reference documentation, examples, troubleshooting guides, and other supporting files.\n            </p>\n\n            {additionalFiles.length > 0 ? (\n              <div className=\"space-y-3\">\n                {additionalFiles.map((file, idx) => (\n                  <div key={idx} className=\"border border-border rounded-md p-3 bg-secondary/10\">\n                    <div className=\"grid grid-cols-2 gap-2 mb-2\">\n                      {/* File Type Dropdown */}\n                      <div>\n                        <label className=\"text-xs font-medium text-muted-foreground block mb-1\">\n                          File Type *\n                        </label>\n                        <select\n                          value={file.fileType}\n                          onChange={(e) => {\n                            setAdditionalFiles(prev => {\n                              const newFiles = [...prev];\n                              newFiles[idx].fileType = e.target.value as any;\n                              return newFiles;\n                            });\n                          }}\n                          disabled={creationStatus === 'loading'}\n                          className=\"w-full px-2 py-1 text-xs border border-border rounded-md bg-background\"\n                        >\n                          <option value=\"REFERENCE\">Reference Documentation</option>\n                          <option value=\"EXAMPLES\">Usage Examples</option>\n                          <option value=\"TROUBLESHOOTING\">Troubleshooting Guide</option>\n                          <option value=\"CHANGELOG\">Changelog</option>\n                          <option value=\"FAQ\">FAQ</option>\n                          <option value=\"API_DOCS\">API Documentation</option>\n                          <option value=\"TUTORIAL\">Tutorial</option>\n                          <option value=\"CUSTOM\">Custom</option>\n                        </select>\n                      </div>\n\n                      {/* Remove Button */}\n                      <div className=\"flex items-end\">\n                        <Button\n                          type=\"button\"\n                          variant=\"destructive\"\n                          size=\"sm\"\n                          onClick={async () => {\n                            try {\n                              // Optionally delete from Strapi if already uploaded\n                              // await deleteFile(file.fileId);\n                              setAdditionalFiles(prev => prev.filter((_, i) => i !== idx));\n                            } catch (error: any) {\n                              console.error('File delete error:', error);\n                            }\n                          }}\n                          disabled={creationStatus === 'loading'}\n                          className=\"h-7 px-3 text-xs w-full\"\n                        >\n                          Remove\n                        </Button>\n                      </div>\n                    </div>\n\n                    {/* Description Textarea */}\n                    <div>\n                      <label className=\"text-xs font-medium text-muted-foreground block mb-1\">\n                        Description (Optional)\n                      </label>\n                      <Textarea\n                        value={file.description || ''}\n                        onChange={(e) => {\n                          setAdditionalFiles(prev => {\n                            const newFiles = [...prev];\n                            newFiles[idx].description = e.target.value;\n                            return newFiles;\n                          });\n                        }}\n                        placeholder=\"Brief description of this file...\"\n                        disabled={creationStatus === 'loading'}\n                        className=\"text-xs h-16 resize-none\"\n                      />\n                    </div>\n\n                    {/* File ID Display (for debugging) */}\n                    <div className=\"text-xs text-muted-foreground mt-2\">\n                      File ID: {file.fileId}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-6 border-2 border-dashed border-border rounded-md\">\n                <p className=\"text-xs text-muted-foreground\">No files uploaded yet</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Click \"Upload File\" to add reference documentation\n                </p>\n              </div>\n            )}\n          </div>\n\n          {/* Skill Instructions Field */}\n          <div>\n            <label htmlFor=\"skillmd\" className=\"block text-sm font-medium text-muted-foreground mb-1\">\n              Skill Instructions <span className=\"text-red-400\">*</span>\n            </label>\n            <Textarea\n              id=\"skillmd\"\n              value={formState.skillmd}\n              onChange={(e) => handleInputChange('skillmd', e.target.value)}\n              placeholder={'# Skill Title\\n\\n## Instructions\\n\\n1. Step by step guidance on what Claude should do\\n2. Provide detailed context and requirements\\n3. Include specific examples and use cases\\n\\n## Examples\\n\\nProvide concrete examples and edge cases here...\\n\\n(Minimum 50 characters required)'}\n              rows={10}\n              className={`font-mono text-xs ${errors.skillmd ? 'border-red-500' : ''}`}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Write clear, step-by-step instructions in Markdown format (minimum 50 characters). Include examples and best practices.\n            </p>\n            {errors.skillmd && <p className=\"text-red-500 text-xs mt-1\">{errors.skillmd}</p>}\n          </div>\n        </div>\n\n        {renderResult()}\n\n        <DialogFooter>\n          <Button variant=\"secondary\" onClick={handleClose} disabled={creationStatus === 'loading'}>\n            Cancel\n          </Button>\n          <Button onClick={handleSubmit} disabled={creationStatus === 'loading'}>\n            {creationStatus === 'loading' && <SpinnerIcon className=\"h-4 w-4 mr-2\" />}\n            {isEditMode ? 'Update Skill' : 'Create Skill'}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nSkillCreationModal.displayName = 'SkillCreationModal';\n\nexport default SkillCreationModal;\n",
        "last_modified": "2026-01-02T15:11:36.285125"
      },
      "task_intent": {
        "title": "Document Frontend React Components and Hooks",
        "description": "Add comprehensive JSDoc documentation to all React components and custom hooks in the frontend, including prop types, usage examples, component purposes, state management, and side effects.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T14:01:11.383442",
  "last_updated": "2026-01-02T14:22:14.911900"
}