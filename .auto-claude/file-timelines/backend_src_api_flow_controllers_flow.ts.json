{
  "file_path": "backend/src/api/flow/controllers/flow.ts",
  "main_branch_history": [],
  "task_views": {
    "007-uygulaman-n-genel-yap-s-n-d-zenleyece-iz-yani-uygu": {
      "task_id": "007-uygulaman-n-genel-yap-s-n-d-zenleyece-iz-yani-uygu",
      "branch_point": {
        "commit_hash": "9355e1f79162ecd7611ae3213457e87085b7fe4d",
        "content": "/**\n * Flow controller\n *\n * Enhanced controller for Flow CRUD operations with custom routes\n */\n\nimport { factories } from '@strapi/strapi';\n\nexport default factories.createCoreController('api::flow.flow', ({ strapi }) => ({\n  /**\n   * Find flow by slug\n   * GET /api/flows/by-slug/:slug\n   */\n  async findBySlug(ctx) {\n    const { slug } = ctx.params;\n\n    try {\n      const flowService = strapi.service('api::flow.flow');\n      const flow = await flowService.findBySlug(slug);\n\n      if (!flow) {\n        return ctx.notFound('Flow not found');\n      }\n\n      ctx.send({\n        data: flow,\n      });\n    } catch (error: any) {\n      strapi.log.error('Find by slug failed:', error);\n      return ctx.badRequest('Find by slug failed', { error: error.message });\n    }\n  },\n\n  /**\n   * Get all active flows\n   * GET /api/flows/active\n   */\n  async findActive(ctx) {\n    try {\n      const flowService = strapi.service('api::flow.flow');\n      const flows = await flowService.findActive();\n\n      ctx.send({\n        data: flows,\n      });\n    } catch (error: any) {\n      strapi.log.error('Find active flows failed:', error);\n      return ctx.badRequest('Find active flows failed', { error: error.message });\n    }\n  },\n\n  /**\n   * Toggle flow active state\n   * POST /api/flows/:id/toggle-active\n   */\n  async toggleActive(ctx) {\n    const { id } = ctx.params;\n\n    try {\n      const flowService = strapi.service('api::flow.flow');\n      const flow = await flowService.toggleActive(parseInt(id));\n\n      ctx.send({\n        data: flow,\n        message: `Flow is now ${flow.isActive ? 'active' : 'inactive'}`,\n      });\n    } catch (error: any) {\n      strapi.log.error('Toggle active failed:', error);\n      return ctx.badRequest('Toggle active failed', { error: error.message });\n    }\n  },\n\n  /**\n   * Update flow status\n   * PUT /api/flows/:id/status\n   * Body: { status: \"draft\" | \"active\" | \"paused\" | \"archived\" }\n   */\n  async updateStatus(ctx) {\n    const { id } = ctx.params;\n    const { status } = ctx.request.body;\n\n    if (!status) {\n      return ctx.badRequest('Missing \"status\" in request body');\n    }\n\n    const validStatuses = ['draft', 'active', 'paused', 'archived'];\n    if (!validStatuses.includes(status)) {\n      return ctx.badRequest(`Invalid status. Must be one of: ${validStatuses.join(', ')}`);\n    }\n\n    try {\n      const flowService = strapi.service('api::flow.flow');\n      const flow = await flowService.updateStatus(parseInt(id), status);\n\n      ctx.send({\n        data: flow,\n        message: `Flow status updated to \"${status}\"`,\n      });\n    } catch (error: any) {\n      strapi.log.error('Update status failed:', error);\n      return ctx.badRequest('Update status failed', { error: error.message });\n    }\n  },\n\n  /**\n   * Duplicate a flow\n   * POST /api/flows/:id/duplicate\n   * Body: { name?: string }\n   */\n  async duplicate(ctx) {\n    const { id } = ctx.params;\n    const { name } = ctx.request.body || {};\n\n    try {\n      const flowService = strapi.service('api::flow.flow');\n      const duplicatedFlow = await flowService.duplicateFlow(parseInt(id), name);\n\n      ctx.send({\n        data: duplicatedFlow,\n        message: 'Flow duplicated successfully',\n      });\n    } catch (error: any) {\n      strapi.log.error('Duplicate flow failed:', error);\n      return ctx.badRequest('Duplicate flow failed', { error: error.message });\n    }\n  },\n\n  /**\n   * Validate flow nodes\n   * POST /api/flows/:id/validate\n   */\n  async validate(ctx) {\n    const { id } = ctx.params;\n\n    try {\n      const flow: any = await strapi.entityService.findOne('api::flow.flow', parseInt(id));\n\n      if (!flow) {\n        return ctx.notFound('Flow not found');\n      }\n\n      const flowService = strapi.service('api::flow.flow');\n      const validation = flowService.validateNodes(flow.nodes || []);\n\n      ctx.send({\n        valid: validation.valid,\n        error: validation.error,\n        nodeCount: (flow.nodes || []).length,\n      });\n    } catch (error: any) {\n      strapi.log.error('Validate flow failed:', error);\n      return ctx.badRequest('Validate flow failed', { error: error.message });\n    }\n  },\n\n  /**\n   * Get flow with full relations and execution stats\n   * GET /api/flows/:id/details\n   */\n  async findDetails(ctx) {\n    const { id } = ctx.params;\n\n    try {\n      const flowService = strapi.service('api::flow.flow');\n      const executionService = strapi.service('api::flow-execution.flow-execution');\n\n      const flow = await flowService.findWithFullRelations(parseInt(id));\n\n      if (!flow) {\n        return ctx.notFound('Flow not found');\n      }\n\n      // Get execution statistics\n      let stats = null;\n      try {\n        stats = await executionService.getFlowStats(parseInt(id));\n      } catch (e) {\n        // Stats might fail if no executions yet\n      }\n\n      ctx.send({\n        data: {\n          ...flow,\n          stats,\n        },\n      });\n    } catch (error: any) {\n      strapi.log.error('Find flow details failed:', error);\n      return ctx.badRequest('Find flow details failed', { error: error.message });\n    }\n  },\n\n  /**\n   * Get flows by category\n   * GET /api/flows/category/:category\n   */\n  async findByCategory(ctx) {\n    const { category } = ctx.params;\n\n    try {\n      const flows = await strapi.entityService.findMany('api::flow.flow', {\n        filters: {\n          category: { $eq: category },\n        },\n        sort: { name: 'asc' },\n      });\n\n      ctx.send({\n        data: flows,\n      });\n    } catch (error: any) {\n      strapi.log.error('Find by category failed:', error);\n      return ctx.badRequest('Find by category failed', { error: error.message });\n    }\n  },\n\n  /**\n   * Get recent flows\n   * GET /api/flows/recent\n   */\n  async findRecent(ctx) {\n    const limit = parseInt(ctx.query.limit as string) || 10;\n\n    try {\n      const flows = await strapi.entityService.findMany('api::flow.flow', {\n        sort: { updatedAt: 'desc' },\n        limit,\n      });\n\n      ctx.send({\n        data: flows,\n      });\n    } catch (error: any) {\n      strapi.log.error('Find recent flows failed:', error);\n      return ctx.badRequest('Find recent flows failed', { error: error.message });\n    }\n  },\n\n  /**\n   * Activate a flow (set status to active and isActive to true)\n   * POST /api/flows/:id/activate\n   */\n  async activate(ctx) {\n    const { id } = ctx.params;\n\n    try {\n      const flow = await strapi.entityService.update('api::flow.flow', parseInt(id), {\n        data: {\n          status: 'active',\n          isActive: true,\n        },\n      });\n\n      ctx.send({\n        data: flow,\n        message: 'Flow activated successfully',\n      });\n    } catch (error: any) {\n      strapi.log.error('Activate flow failed:', error);\n      return ctx.badRequest('Activate flow failed', { error: error.message });\n    }\n  },\n\n  /**\n   * Deactivate a flow (set status to paused and isActive to false)\n   * POST /api/flows/:id/deactivate\n   */\n  async deactivate(ctx) {\n    const { id } = ctx.params;\n\n    try {\n      const flow = await strapi.entityService.update('api::flow.flow', parseInt(id), {\n        data: {\n          status: 'paused',\n          isActive: false,\n        },\n      });\n\n      ctx.send({\n        data: flow,\n        message: 'Flow deactivated successfully',\n      });\n    } catch (error: any) {\n      strapi.log.error('Deactivate flow failed:', error);\n      return ctx.badRequest('Deactivate flow failed', { error: error.message });\n    }\n  },\n\n  /**\n   * Archive a flow\n   * POST /api/flows/:id/archive\n   */\n  async archive(ctx) {\n    const { id } = ctx.params;\n\n    try {\n      const flow = await strapi.entityService.update('api::flow.flow', parseInt(id), {\n        data: {\n          status: 'archived',\n          isActive: false,\n        },\n      });\n\n      ctx.send({\n        data: flow,\n        message: 'Flow archived successfully',\n      });\n    } catch (error: any) {\n      strapi.log.error('Archive flow failed:', error);\n      return ctx.badRequest('Archive flow failed', { error: error.message });\n    }\n  },\n}));\n",
        "timestamp": "2026-01-02T15:21:46.864601"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "007-uygulaman-n-genel-yap-s-n-d-zenleyece-iz-yani-uygu",
        "description": "Implement a workflow/flow system for organizing agents and skills into reusable, schedulable processes with input/output handling. This transforms the application from a simple agent manager to a process automation tool where users can define workflows like 'Web Scraper' that take input, run agents with skills, and produce structured outputs.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T15:21:46.931111",
  "last_updated": "2026-01-02T15:21:46.942808"
}