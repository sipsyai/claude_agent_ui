{
  "file_path": "docs/architecture/README.md",
  "main_branch_history": [],
  "task_views": {
    "003-create-architecture-documentation-with-system-diag": {
      "task_id": "003-create-architecture-documentation-with-system-diag",
      "branch_point": {
        "commit_hash": "34a3f60da53773d90bd6579cb1cfd8417a1dd0b9",
        "content": "",
        "timestamp": "2026-01-02T10:53:08.483278"
      },
      "worktree_state": {
        "content": "# Architecture Documentation\n\nWelcome to the Claude Agent UI architecture documentation. This guide provides comprehensive visual documentation of the system's architecture, helping you understand how all components interact.\n\n## \ud83c\udfaf Quick Start\n\n**New to the project?** Start here:\n\n1. **[System Overview](./01-system-overview.md)** - Understand the big picture (5 min read)\n2. **[Data Flow](./02-data-flow.md)** - See how data moves through the system (10 min read)\n3. **[Components](./04-components.md)** - Explore the service and component structure (8 min read)\n\n**Working on deployment?** Check out [Deployment Architecture](./03-deployment.md)\n\n**Need to understand a specific flow?** See [Sequence Diagrams](./05-sequences.md)\n\n---\n\n## \ud83d\udcda Documentation Index\n\n### [1. System Architecture Overview](./01-system-overview.md)\n**What you'll learn:** High-level view of all major components and their interactions\n\nThe foundational diagram showing:\n- 8 major system components (React Frontend, Nginx, Express, Strapi, PostgreSQL, Claude SDK, MCP Servers, External APIs)\n- Docker network topology (frontend/backend separation)\n- Communication protocols (HTTP/REST, SSE, JSON-RPC)\n- Security boundaries and isolation\n\n**Best for:** Getting oriented with the system architecture, understanding service boundaries, onboarding new developers.\n\n---\n\n### [2. Data Flow Architecture](./02-data-flow.md)\n**What you'll learn:** How data flows through the system in different scenarios\n\nFour critical data flow patterns:\n1. **Agent Execution Flow** - Real-time SSE streaming from Claude SDK\n2. **CRUD Operations Flow** - Data persistence through Strapi with caching\n3. **MCP Tool Invocation Flow** - External tool integration via MCP protocol\n4. **Chat/Conversation Flow** - Interactive chat sessions with streaming\n\n**Best for:** Understanding request/response cycles, debugging data flow issues, optimizing performance, implementing new features.\n\n---\n\n### [3. Docker Deployment Architecture](./03-deployment.md)\n**What you'll learn:** Container orchestration, networking, and operational considerations\n\nComprehensive deployment documentation:\n- Production deployment topology (4 containers, 2 networks, 5 volumes)\n- Network architecture with security segmentation\n- Volume management and backup strategies\n- Development vs production configurations\n- Health checks and monitoring\n- Resource allocation and tuning\n- Operational procedures (startup, backup/restore, troubleshooting)\n\n**Best for:** DevOps tasks, deployment configuration, infrastructure debugging, capacity planning, disaster recovery.\n\n---\n\n### [4. Component Architecture](./04-components.md)\n**What you'll learn:** Detailed component structure across all layers\n\nThree component layers documented:\n1. **Express Service Layer** - 26 services organized into 8 categories (Core AI, Data Layer, MCP Integration, Chat, Skills, Infrastructure, Utilities, Training)\n2. **Frontend Component Hierarchy** - 48+ React components organized by feature (Agent, Skill, Chat, UI, Forms)\n3. **Strapi Content Types** - 7 content types with complete ERD showing relationships\n\n**Best for:** Understanding service responsibilities, finding the right component to modify, understanding data models, planning new features.\n\n---\n\n### [5. Sequence Diagrams](./05-sequences.md)\n**What you'll learn:** Step-by-step interactions for critical operations\n\nFour key operational flows:\n1. **Agent Creation and Execution** - Complete lifecycle from configuration to task execution\n2. **MCP Server Connection and Tool Discovery** - Server initialization and tool discovery with 3-tier config\n3. **Skill Management Flow** - Database to filesystem synchronization\n4. **Real-time SSE Communication** - Streaming architecture with keep-alive and reconnection\n\n**Best for:** Understanding temporal flow, debugging complex interactions, implementing similar features, troubleshooting issues.\n\n---\n\n## \ud83c\udfd7\ufe0f System Architecture Summary\n\n### Core Components\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Web Browser (Client)                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502 HTTPS\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Frontend Container (Nginx + React SPA)                      \u2502\n\u2502  \u2022 Vite + React 18 + TypeScript                             \u2502\n\u2502  \u2022 Tailwind CSS + Radix UI                                   \u2502\n\u2502  \u2022 Real-time SSE connections                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502 HTTP/REST + SSE\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Express Container (Business Logic)                          \u2502\n\u2502  \u2022 26 services (AI, MCP, Chat, Skills, Infrastructure)      \u2502\n\u2502  \u2022 Claude SDK integration                                    \u2502\n\u2502  \u2022 SSE streaming engine                                      \u2502\n\u2502  \u2022 MCP protocol handler                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502 REST API\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Strapi Container (Data Layer)                               \u2502\n\u2502  \u2022 Headless CMS with REST API                               \u2502\n\u2502  \u2022 7 content types (Agent, Skill, MCP Server, etc.)         \u2502\n\u2502  \u2022 LRU caching layer                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502 SQL\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PostgreSQL Container (Data Storage)                         \u2502\n\u2502  \u2022 PostgreSQL 16 (Alpine)                                    \u2502\n\u2502  \u2022 Persistent volumes with backups                           \u2502\n\u2502  \u2022 Health checks configured                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nExternal Integrations:\n\u251c\u2500 Anthropic API (Claude models via SDK)\n\u251c\u2500 MCP Servers (stdio/sse/http/sdk transports)\n\u2514\u2500 Filesystem (.mcp.json, .claude/, skills/)\n```\n\n### Technology Stack\n\n| Layer | Technologies |\n|-------|-------------|\n| **Frontend** | React 18, Vite, TypeScript, Tailwind CSS, Radix UI, EventSource (SSE) |\n| **Backend** | Node.js 20, Express, TypeScript, Claude Agent SDK |\n| **Data Layer** | Strapi 4.x, PostgreSQL 16 |\n| **Infrastructure** | Docker, Docker Compose, Nginx |\n| **AI/ML** | Anthropic Claude API, Claude SDK |\n| **Protocols** | REST, SSE (Server-Sent Events), JSON-RPC (MCP) |\n\n---\n\n## \ud83d\udd11 Key Architectural Patterns\n\n### 1. **Hybrid Multi-Service Architecture**\nThe system uses a specialized architecture where:\n- **Strapi** handles all database CRUD operations (data layer)\n- **Express** implements business logic, AI integration, and streaming\n- **Separation of concerns** enables independent scaling and maintenance\n\n### 2. **Real-Time Streaming with SSE**\nServer-Sent Events power real-time features:\n- Agent execution streaming (live output from Claude)\n- Chat message streaming\n- Task execution updates\n- Health monitoring\n\n### 3. **Three-Tier MCP Configuration**\nMCP servers are discovered using a flexible hierarchy:\n1. **Project-level** (`.mcp.json` file-based configuration)\n2. **Agent-level** (agent-specific MCP server associations)\n3. **Skill-level** (skill-specific tool requirements)\n\n### 4. **Service-Oriented Design**\nExpress backend organized into focused service modules:\n- **Core AI Services** - Claude SDK, model routing, response parsing\n- **Data Layer** - Centralized Strapi client with LRU caching\n- **MCP Integration** - Tool discovery and execution\n- **Infrastructure** - Config, health, logging, error handling\n\n### 5. **Docker Network Segmentation**\nTwo-tier network for security:\n- **Frontend Network** - Nginx, Express, Strapi (public-facing)\n- **Backend Network** - PostgreSQL, Strapi, Express (database isolation)\n\n---\n\n## \ud83d\ude80 Common Development Scenarios\n\n### Adding a New API Endpoint\n1. Read [Data Flow Architecture](./02-data-flow.md) to understand request patterns\n2. Review [Component Architecture](./04-components.md) to find relevant services\n3. Check [Sequence Diagrams](./05-sequences.md) for similar flows\n4. Implement following existing patterns in `src/routes/`\n\n### Integrating a New MCP Server\n1. Understand the flow in [Data Flow: MCP Tool Invocation](./02-data-flow.md#3-mcp-tool-invocation-flow)\n2. Review [Sequence Diagrams: MCP Server Connection](./05-sequences.md#2-mcp-server-connection-and-tool-discovery)\n3. Add configuration to `.mcp.json` or Strapi\n4. Test discovery via `/api/mcp/servers` endpoint\n\n### Debugging SSE Streaming Issues\n1. Review [Data Flow: Agent Execution](./02-data-flow.md#1-agent-execution-flow-with-sse-streaming)\n2. Check [Sequence Diagrams: Real-time SSE](./05-sequences.md#4-real-time-sse-communication)\n3. Verify SSE headers in Express route\n4. Check EventSource connection in browser DevTools\n\n### Modifying Database Schema\n1. Review [Component Architecture: Strapi Content Types](./04-components.md#3-strapi-content-types--relationships)\n2. Update Strapi schema in `strapi/src/api/`\n3. Run Strapi rebuild to generate new API\n4. Update TypeScript types in frontend\n\n### Deploying to Production\n1. Review [Deployment Architecture](./03-deployment.md) completely\n2. Configure environment variables per documentation\n3. Follow operational procedures for startup\n4. Set up monitoring and health checks\n5. Configure backup strategy for persistent volumes\n\n---\n\n## \ud83d\udcca Performance Considerations\n\n### Caching Strategy\n- **Strapi Client**: LRU cache with 500-item limit, 5-minute TTL\n- **Express Cache**: In-memory caching for agent configs\n- **Nginx Cache**: Static asset caching with appropriate headers\n\n### Resource Limits\n- **PostgreSQL**: 256M-1G memory, 0.5-2 CPU cores\n- **Strapi**: 512M-1G memory, 0.5-2 CPU cores\n- **Express**: 512M-1G memory, 0.5-2 CPU cores\n- **Frontend**: 64M-256M memory, 0.25-1 CPU cores\n\nSee [Deployment Architecture](./03-deployment.md) for detailed tuning guidance.\n\n---\n\n## \ud83d\udd12 Security Architecture\n\n### Network Isolation\n- **Frontend network**: Public-facing services (Nginx, Express, Strapi)\n- **Backend network**: Database isolation (PostgreSQL accessible only to Strapi/Express)\n- **No direct database access** from frontend or external services\n\n### Authentication & Authorization\n- Strapi admin authentication for CMS access\n- API key authentication for Anthropic API\n- MCP server authentication per transport type\n- Environment-based secrets management\n\n### Data Protection\n- Database credentials in `.env` (not committed)\n- API keys stored in environment variables\n- Sensitive data in PostgreSQL with backup encryption\n- Health check endpoints expose minimal information\n\n---\n\n## \ud83e\uddea Testing Strategy\n\n### Unit Testing\n- Service layer tests for Express services\n- Component tests for React components\n- Strapi content type validation\n\n### Integration Testing\n- API endpoint tests (Express \u2192 Strapi \u2192 Database)\n- SSE streaming tests\n- MCP tool invocation tests\n\n### End-to-End Testing\n- Agent creation and execution flows\n- Skill synchronization\n- Chat session management\n\n---\n\n## \ud83d\udcd6 Additional Resources\n\n### Project Documentation\n- [Main README](../../README.md) - Project overview and setup\n- [.auto-claude/](../../.auto-claude/) - Auto-Claude task specifications\n\n### External Documentation\n- [Anthropic Claude SDK](https://github.com/anthropics/anthropic-sdk-typescript)\n- [Model Context Protocol (MCP)](https://modelcontextprotocol.io/)\n- [Strapi Documentation](https://docs.strapi.io/)\n- [Docker Compose Documentation](https://docs.docker.com/compose/)\n\n---\n\n## \ud83e\udd1d Contributing\n\nWhen contributing to this project:\n\n1. **Understand the architecture** - Read relevant documentation sections first\n2. **Follow existing patterns** - Review [Component Architecture](./04-components.md) for code organization\n3. **Maintain consistency** - Match the style and patterns of similar components\n4. **Update documentation** - Keep architecture docs in sync with code changes\n5. **Test thoroughly** - Verify changes don't break existing flows\n\n---\n\n## \ud83d\udcdd Documentation Maintenance\n\nThis documentation is generated and maintained as part of the project's development workflow. If you notice:\n\n- **Outdated diagrams** - Mermaid diagrams that don't reflect current code\n- **Missing components** - New services or components not documented\n- **Broken links** - Links that don't work\n- **Unclear explanations** - Sections that need clarification\n\nPlease update the relevant documentation file or open an issue.\n\n---\n\n## \ud83d\udca1 Quick Tips\n\n**For visual learners:** All documents include Mermaid diagrams that render in GitHub/GitLab\n\n**For code explorers:** Each document links to relevant source files in the codebase\n\n**For system administrators:** Focus on [Deployment Architecture](./03-deployment.md)\n\n**For frontend developers:** Start with [Components](./04-components.md) \u2192 Frontend section\n\n**For backend developers:** Review [Components](./04-components.md) \u2192 Express section + [Data Flow](./02-data-flow.md)\n\n**For DevOps engineers:** [Deployment](./03-deployment.md) + [System Overview](./01-system-overview.md)\n\n---\n\n**Last Updated:** 2026-01-02\n**Documentation Version:** 1.0\n**System Version:** See [package.json](../../package.json)\n",
        "last_modified": "2026-01-02T15:11:22.013645"
      },
      "task_intent": {
        "title": "003-create-architecture-documentation-with-system-diag",
        "description": "Create comprehensive visual documentation showing how the hybrid architecture components (React + Express + Strapi + PostgreSQL + Claude SDK + MCP) interact, including data flow, service communication, and deployment topology.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T10:53:08.965214",
  "last_updated": "2026-01-02T10:53:08.978760"
}