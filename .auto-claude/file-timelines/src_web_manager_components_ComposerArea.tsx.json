{
  "file_path": "src/web/manager/components/ComposerArea.tsx",
  "main_branch_history": [],
  "task_views": {
    "004-document-frontend-react-components-and-hooks": {
      "task_id": "004-document-frontend-react-components-and-hooks",
      "branch_point": {
        "commit_hash": "34a3f60da53773d90bd6579cb1cfd8417a1dd0b9",
        "content": "import React, { useState, useRef, useEffect } from 'react';\nimport { ComposerPrimitive, ThreadPrimitive } from '@assistant-ui/react';\nimport { PaperclipIcon, SendIcon, XCircleIcon } from './ui/Icons';\n\ninterface FileAttachment {\n  id: string;\n  file: File;\n  preview: string;\n  type: 'image' | 'pdf' | 'text' | 'other';\n}\n\nconst ComposerArea: React.FC = () => {\n  const [attachments, setAttachments] = useState<FileAttachment[]>([]);\n  const [uploading, setUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n\n  // Auto-resize textarea\n  useEffect(() => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      textarea.style.height = 'auto';\n      textarea.style.height = `${Math.min(textarea.scrollHeight, 200)}px`;\n    }\n  }, []);\n\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (!files || files.length === 0) return;\n\n    setUploading(true);\n\n    try {\n      const newAttachments: FileAttachment[] = [];\n\n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n\n        // Validate file type\n        const isImage = file.type.startsWith('image/');\n        const isPDF = file.type === 'application/pdf';\n        const isText = file.type.startsWith('text/');\n\n        let fileType: 'image' | 'pdf' | 'text' | 'other' = 'other';\n        if (isImage) fileType = 'image';\n        else if (isPDF) fileType = 'pdf';\n        else if (isText) fileType = 'text';\n\n        if (!isImage && !isPDF && !isText) {\n          alert(`File type not supported: ${file.type}`);\n          continue;\n        }\n\n        // Validate file size (max 10MB)\n        if (file.size > 10 * 1024 * 1024) {\n          alert(`File too large: ${file.name} (max 10MB)`);\n          continue;\n        }\n\n        // Create preview for images\n        let preview = '';\n        if (isImage) {\n          preview = URL.createObjectURL(file);\n        }\n\n        newAttachments.push({\n          id: `${Date.now()}-${i}`,\n          file,\n          preview,\n          type: fileType,\n        });\n      }\n\n      setAttachments(prev => [...prev, ...newAttachments]);\n    } catch (error) {\n      console.error('Failed to process files:', error);\n      alert('Failed to upload files');\n    } finally {\n      setUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleRemoveAttachment = (id: string) => {\n    setAttachments(prev => {\n      const attachment = prev.find(a => a.id === id);\n      if (attachment?.preview) {\n        URL.revokeObjectURL(attachment.preview);\n      }\n      return prev.filter(a => a.id !== id);\n    });\n  };\n\n  const getFileIcon = (type: string) => {\n    switch (type) {\n      case 'pdf':\n        return (\n          <div className=\"w-10 h-10 rounded bg-red-100 flex items-center justify-center text-red-600\">\n            <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" />\n            </svg>\n          </div>\n        );\n      case 'text':\n        return (\n          <div className=\"w-10 h-10 rounded bg-blue-100 flex items-center justify-center text-blue-600\">\n            <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" clipRule=\"evenodd\" />\n            </svg>\n          </div>\n        );\n      default:\n        return (\n          <div className=\"w-10 h-10 rounded bg-gray-100 flex items-center justify-center text-gray-600\">\n            <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" clipRule=\"evenodd\" />\n            </svg>\n          </div>\n        );\n    }\n  };\n\n  return (\n    <div className=\"border-t border-gray-700 bg-gray-800 p-4\">\n      {/* Attachments Preview */}\n      {attachments.length > 0 && (\n        <div className=\"mb-3 flex flex-wrap gap-2\">\n          {attachments.map((attachment) => (\n            <div\n              key={attachment.id}\n              className=\"relative group bg-gray-900 rounded-lg p-2 flex items-center gap-2 max-w-xs border border-gray-700 hover:border-gray-600 transition-colors\"\n            >\n              {/* File Preview/Icon */}\n              <div className=\"flex-shrink-0\">\n                {attachment.type === 'image' && attachment.preview ? (\n                  <img\n                    src={attachment.preview}\n                    alt={attachment.file.name}\n                    className=\"w-10 h-10 rounded object-cover\"\n                  />\n                ) : (\n                  getFileIcon(attachment.type)\n                )}\n              </div>\n\n              {/* File Info */}\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-sm font-medium text-white truncate\">\n                  {attachment.file.name}\n                </p>\n                <p className=\"text-xs text-gray-400\">\n                  {(attachment.file.size / 1024).toFixed(1)} KB\n                </p>\n              </div>\n\n              {/* Remove Button */}\n              <button\n                onClick={() => handleRemoveAttachment(attachment.id)}\n                className=\"flex-shrink-0 p-1 text-gray-400 hover:text-red-400 transition-colors\"\n                title=\"Remove\"\n              >\n                <XCircleIcon className=\"w-5 h-5\" />\n              </button>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Composer */}\n      <ComposerPrimitive.Root className=\"flex items-end gap-2\">\n        {/* File Upload Button */}\n        <div className=\"flex-shrink-0\">\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            multiple\n            accept=\"image/*,application/pdf,text/*\"\n            onChange={handleFileSelect}\n            className=\"hidden\"\n          />\n          <button\n            onClick={() => fileInputRef.current?.click()}\n            disabled={uploading}\n            className=\"p-2.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            title=\"Attach files (images, PDFs, text)\"\n          >\n            <PaperclipIcon className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {/* Textarea */}\n        <div className=\"flex-1\">\n          <ComposerPrimitive.Input\n            ref={textareaRef}\n            placeholder=\"Type your message... (Shift+Enter for new line)\"\n            className=\"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400 text-sm transition-all min-h-[48px] max-h-[200px]\"\n            rows={1}\n            onInput={(e) => {\n              const target = e.target as HTMLTextAreaElement;\n              target.style.height = 'auto';\n              target.style.height = `${Math.min(target.scrollHeight, 200)}px`;\n            }}\n          />\n        </div>\n\n        {/* Send/Cancel Button */}\n        <div className=\"flex-shrink-0\">\n          {/* Show Cancel button when running */}\n          <ThreadPrimitive.If running={true}>\n            <ComposerPrimitive.Cancel className=\"p-2.5 bg-red-600 text-white hover:bg-red-700 rounded-lg transition-colors flex items-center gap-1.5\">\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n              <span className=\"text-sm font-medium\">Stop</span>\n            </ComposerPrimitive.Cancel>\n          </ThreadPrimitive.If>\n\n          {/* Show Send button when not running */}\n          <ThreadPrimitive.If running={false}>\n            <ComposerPrimitive.Send className=\"p-2.5 bg-blue-600 text-white hover:bg-blue-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors\">\n              <SendIcon className=\"w-5 h-5\" />\n            </ComposerPrimitive.Send>\n          </ThreadPrimitive.If>\n        </div>\n      </ComposerPrimitive.Root>\n\n      {/* Hint */}\n      <div className=\"mt-2 text-xs text-gray-400 px-1\">\n        Press <kbd className=\"px-1.5 py-0.5 bg-gray-700 border border-gray-600 rounded text-xs font-mono text-gray-300\">Enter</kbd> to send,\n        <kbd className=\"ml-1 px-1.5 py-0.5 bg-gray-700 border border-gray-600 rounded text-xs font-mono text-gray-300\">Shift+Enter</kbd> for new line\n      </div>\n    </div>\n  );\n};\n\nexport default ComposerArea;\n",
        "timestamp": "2026-01-02T14:22:14.293924"
      },
      "worktree_state": {
        "content": "/**\n * ComposerArea Component\n *\n * A sophisticated message composition component built on top of assistant-ui primitives.\n * Handles message input, file attachments, and adaptive send/cancel behavior based on\n * conversation state. Features auto-resizing textarea, attachment previews, and\n * comprehensive file validation.\n *\n * ## Features\n * - Message composition using assistant-ui ComposerPrimitive for seamless integration\n * - Auto-resizing textarea (48px min, 200px max)\n * - File attachment support (images, PDFs, text files)\n * - File validation (type checking, size limit 10MB)\n * - Attachment preview with thumbnails for images, icons for other file types\n * - File removal with memory cleanup (URL.revokeObjectURL)\n * - Adaptive buttons: Send when idle, Cancel when running\n * - Keyboard shortcuts hint (Enter to send, Shift+Enter for new line)\n * - Upload state feedback with disabled buttons during processing\n *\n * ## Message Composition\n * The component integrates with assistant-ui's conversation management:\n * - Uses `ComposerPrimitive.Root` to wrap the composition area\n * - Uses `ComposerPrimitive.Input` for the textarea with auto-resize\n * - Uses `ComposerPrimitive.Send` for message submission\n * - Uses `ComposerPrimitive.Cancel` for stopping ongoing operations\n * - Message text is managed by assistant-ui runtime (not local state)\n * - Auto-resize is implemented via `onInput` handler calculating scrollHeight\n *\n * ## Attachments\n * The component manages file attachments through local state:\n *\n * **Upload Workflow** (`handleFileSelect`):\n * 1. Validates file type (images, PDFs, text files only)\n * 2. Validates file size (max 10MB per file)\n * 3. Creates preview URL for images using `URL.createObjectURL`\n * 4. Categorizes file type for icon selection\n * 5. Appends to `attachments` state array\n * 6. Shows uploading state while processing\n * 7. Resets file input value after processing\n *\n * **Supported File Types**:\n * - **Images**: Any mime type starting with `image/` (PNG, JPEG, GIF, WebP, etc.)\n * - **PDFs**: `application/pdf`\n * - **Text files**: Any mime type starting with `text/` (plain text, CSV, etc.)\n *\n * **Preview Display**:\n * - Images: Thumbnail using object URL (10x10 rounded)\n * - PDFs: Red icon with document SVG\n * - Text files: Blue icon with document SVG\n * - Other: Gray icon with document SVG (fallback)\n *\n * **Removal** (`handleRemoveAttachment`):\n * - Revokes object URL to free memory (for image previews)\n * - Removes attachment from state array by ID\n *\n * ## Send Behavior\n * The component adapts its button based on conversation state using `ThreadPrimitive.If`:\n *\n * **When Idle** (running=false):\n * - Shows **Send button** with blue background and send icon\n * - Clicking sends message via `ComposerPrimitive.Send`\n * - Button is disabled when input is empty (handled by assistant-ui)\n *\n * **When Running** (running=true):\n * - Shows **Cancel button** with red background and X icon\n * - Clicking cancels ongoing operation via `ComposerPrimitive.Cancel`\n * - Useful for stopping long-running agent responses or tool executions\n *\n * ## Auto-Resize Behavior\n * The textarea automatically adjusts height based on content:\n * - Minimum height: 48px (approximately 1 line)\n * - Maximum height: 200px (approximately 7-8 lines)\n * - Resize mechanism: `onInput` handler sets `target.style.height`\n * - Calculation: `Math.min(target.scrollHeight, 200)` ensures max constraint\n * - Overflow: When content exceeds 200px, textarea becomes scrollable\n *\n * ## Styling Behavior\n * The component uses Tailwind CSS with:\n * - **Container**: Dark theme with gray-800 background, gray-700 border-top, p-4 padding\n * - **Attachments preview**: Flex wrap with gap-2, mb-3 margin, shown only when attachments exist\n * - **Attachment cards**: Gray-900 background, rounded-lg, border-gray-700, hover effects\n * - **File icons**: Colored backgrounds (red for PDF, blue for text, gray for others)\n * - **Composer layout**: Flex row with items-end alignment, gap-2 between elements\n * - **Textarea**: Gray-700 background, gray-600 border, blue-500 focus ring, rounded-xl\n * - **Buttons**: Consistent 2.5 padding, rounded-lg, hover effects, disabled states\n * - **Hint**: Small gray text with kbd elements styled like keyboard keys\n *\n * @example\n * // Basic usage in chat interface with assistant-ui runtime\n * import { AssistantRuntimeProvider } from '@assistant-ui/react';\n * import ComposerArea from './ComposerArea';\n *\n * function ChatInterface() {\n *   return (\n *     <AssistantRuntimeProvider runtime={myRuntime}>\n *       <div className=\"flex flex-col h-screen\">\n *         <div className=\"flex-1 overflow-y-auto\">\n *         </div>\n *         <ComposerArea />\n *       </div>\n *     </AssistantRuntimeProvider>\n *   );\n * }\n *\n * @example\n * // Integration with ThreadPrimitive for complete chat UI\n * import { ThreadPrimitive, ComposerPrimitive } from '@assistant-ui/react';\n * import ComposerArea from './ComposerArea';\n *\n * function ChatPanel() {\n *   return (\n *     <ThreadPrimitive.Root>\n *       <ThreadPrimitive.Messages className=\"flex-1 overflow-y-auto\">\n *       </ThreadPrimitive.Messages>\n *       <ComposerArea />\n *     </ThreadPrimitive.Root>\n *   );\n * }\n *\n * @example\n * // File attachment handling demonstration\n * // User clicks paperclip button to open file picker\n * // Selects image.png (2MB), document.pdf (5MB), notes.txt (100KB)\n * // All pass validation and appear in preview area\n * // User clicks X on document.pdf to remove it\n * // Clicks Send button to submit message with remaining 2 attachments\n * function AttachmentDemo() {\n *   return (\n *     <div>\n *       <ComposerArea />\n *     </div>\n *   );\n * }\n *\n * @example\n * // Send/Cancel button behavior based on conversation state\n * // When agent is idle, Send button is visible\n * // User types message and clicks Send\n * // While agent is generating response, Cancel button appears\n * // User can click Cancel to stop the response generation\n * function SendCancelDemo() {\n *   return (\n *     <AssistantRuntimeProvider runtime={runtime}>\n *       <ComposerArea />\n *     </AssistantRuntimeProvider>\n *   );\n * }\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { ComposerPrimitive, ThreadPrimitive } from '@assistant-ui/react';\nimport { PaperclipIcon, SendIcon, XCircleIcon } from './ui/Icons';\n\n/**\n * File attachment data structure for managing uploaded files\n *\n * @interface FileAttachment\n * @property {string} id - Unique identifier for the attachment (timestamp-based)\n * @property {File} file - The raw File object from the file input\n * @property {string} preview - Object URL for image previews (created with URL.createObjectURL), empty for non-images\n * @property {'image' | 'pdf' | 'text' | 'other'} type - Categorized file type for icon selection and display\n */\ninterface FileAttachment {\n  id: string;\n  file: File;\n  preview: string;\n  type: 'image' | 'pdf' | 'text' | 'other';\n}\n\nconst ComposerArea: React.FC = () => {\n  const [attachments, setAttachments] = useState<FileAttachment[]>([]);\n  const [uploading, setUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n\n  // Auto-resize textarea on mount\n  useEffect(() => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      textarea.style.height = 'auto';\n      textarea.style.height = `${Math.min(textarea.scrollHeight, 200)}px`;\n    }\n  }, []);\n\n  /**\n   * Handles file selection from the file input\n   *\n   * Processes selected files with validation and creates attachment objects.\n   * Validates file type (images, PDFs, text) and size (max 10MB). Creates\n   * preview URLs for images. Shows alerts for validation failures.\n   *\n   * @internal\n   * @param {React.ChangeEvent<HTMLInputElement>} e - File input change event\n   *\n   * Workflow:\n   * 1. Sets uploading state to true for UI feedback\n   * 2. Iterates through selected files (supports multiple)\n   * 3. Validates file type against allowed types (image/*, application/pdf, text/*)\n   * 4. Validates file size (rejects if > 10MB)\n   * 5. Creates object URL preview for images\n   * 6. Categorizes file type for icon selection\n   * 7. Appends valid files to attachments state\n   * 8. Resets file input value\n   * 9. Sets uploading state to false\n   *\n   * Error handling:\n   * - Shows alert for unsupported file types\n   * - Shows alert for files exceeding 10MB\n   * - Continues processing remaining files after validation failures\n   * - Catches and logs any processing errors\n   */\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (!files || files.length === 0) return;\n\n    setUploading(true);\n\n    try {\n      const newAttachments: FileAttachment[] = [];\n\n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n\n        // Validate file type\n        const isImage = file.type.startsWith('image/');\n        const isPDF = file.type === 'application/pdf';\n        const isText = file.type.startsWith('text/');\n\n        let fileType: 'image' | 'pdf' | 'text' | 'other' = 'other';\n        if (isImage) fileType = 'image';\n        else if (isPDF) fileType = 'pdf';\n        else if (isText) fileType = 'text';\n\n        if (!isImage && !isPDF && !isText) {\n          alert(`File type not supported: ${file.type}`);\n          continue;\n        }\n\n        // Validate file size (max 10MB)\n        if (file.size > 10 * 1024 * 1024) {\n          alert(`File too large: ${file.name} (max 10MB)`);\n          continue;\n        }\n\n        // Create preview for images\n        let preview = '';\n        if (isImage) {\n          preview = URL.createObjectURL(file);\n        }\n\n        newAttachments.push({\n          id: `${Date.now()}-${i}`,\n          file,\n          preview,\n          type: fileType,\n        });\n      }\n\n      setAttachments(prev => [...prev, ...newAttachments]);\n    } catch (error) {\n      console.error('Failed to process files:', error);\n      alert('Failed to upload files');\n    } finally {\n      setUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  /**\n   * Removes an attachment from the list and cleans up resources\n   *\n   * Revokes object URL to free memory (for image previews) and removes\n   * the attachment from the state array.\n   *\n   * @internal\n   * @param {string} id - Unique identifier of the attachment to remove\n   *\n   * Cleanup steps:\n   * 1. Finds attachment by ID\n   * 2. Revokes object URL if preview exists (prevents memory leaks)\n   * 3. Filters attachment out of state array\n   */\n  const handleRemoveAttachment = (id: string) => {\n    setAttachments(prev => {\n      const attachment = prev.find(a => a.id === id);\n      if (attachment?.preview) {\n        URL.revokeObjectURL(attachment.preview);\n      }\n      return prev.filter(a => a.id !== id);\n    });\n  };\n\n  /**\n   * Returns the appropriate icon for a file type\n   *\n   * Renders a colored icon with document SVG based on the file type.\n   * Used in attachment previews for non-image files.\n   *\n   * @internal\n   * @param {string} type - File type ('pdf', 'text', or 'other')\n   * @returns {JSX.Element} Colored icon div with SVG\n   *\n   * Icon colors:\n   * - PDF: Red background (red-100) with red icon (red-600)\n   * - Text: Blue background (blue-100) with blue icon (blue-600)\n   * - Other: Gray background (gray-100) with gray icon (gray-600)\n   */\n  const getFileIcon = (type: string) => {\n    switch (type) {\n      case 'pdf':\n        return (\n          <div className=\"w-10 h-10 rounded bg-red-100 flex items-center justify-center text-red-600\">\n            <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" />\n            </svg>\n          </div>\n        );\n      case 'text':\n        return (\n          <div className=\"w-10 h-10 rounded bg-blue-100 flex items-center justify-center text-blue-600\">\n            <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" clipRule=\"evenodd\" />\n            </svg>\n          </div>\n        );\n      default:\n        return (\n          <div className=\"w-10 h-10 rounded bg-gray-100 flex items-center justify-center text-gray-600\">\n            <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" clipRule=\"evenodd\" />\n            </svg>\n          </div>\n        );\n    }\n  };\n\n  return (\n    <div className=\"border-t border-gray-700 bg-gray-800 p-4\">\n      {/* Attachments Preview */}\n      {attachments.length > 0 && (\n        <div className=\"mb-3 flex flex-wrap gap-2\">\n          {attachments.map((attachment) => (\n            <div\n              key={attachment.id}\n              className=\"relative group bg-gray-900 rounded-lg p-2 flex items-center gap-2 max-w-xs border border-gray-700 hover:border-gray-600 transition-colors\"\n            >\n              {/* File Preview/Icon */}\n              <div className=\"flex-shrink-0\">\n                {attachment.type === 'image' && attachment.preview ? (\n                  <img\n                    src={attachment.preview}\n                    alt={attachment.file.name}\n                    className=\"w-10 h-10 rounded object-cover\"\n                  />\n                ) : (\n                  getFileIcon(attachment.type)\n                )}\n              </div>\n\n              {/* File Info */}\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-sm font-medium text-white truncate\">\n                  {attachment.file.name}\n                </p>\n                <p className=\"text-xs text-gray-400\">\n                  {(attachment.file.size / 1024).toFixed(1)} KB\n                </p>\n              </div>\n\n              {/* Remove Button */}\n              <button\n                onClick={() => handleRemoveAttachment(attachment.id)}\n                className=\"flex-shrink-0 p-1 text-gray-400 hover:text-red-400 transition-colors\"\n                title=\"Remove\"\n              >\n                <XCircleIcon className=\"w-5 h-5\" />\n              </button>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Composer */}\n      <ComposerPrimitive.Root className=\"flex items-end gap-2\">\n        {/* File Upload Button */}\n        <div className=\"flex-shrink-0\">\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            multiple\n            accept=\"image/*,application/pdf,text/*\"\n            onChange={handleFileSelect}\n            className=\"hidden\"\n          />\n          <button\n            onClick={() => fileInputRef.current?.click()}\n            disabled={uploading}\n            className=\"p-2.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            title=\"Attach files (images, PDFs, text)\"\n          >\n            <PaperclipIcon className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {/* Textarea */}\n        <div className=\"flex-1\">\n          <ComposerPrimitive.Input\n            ref={textareaRef}\n            placeholder=\"Type your message... (Shift+Enter for new line)\"\n            className=\"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400 text-sm transition-all min-h-[48px] max-h-[200px]\"\n            rows={1}\n            onInput={(e) => {\n              const target = e.target as HTMLTextAreaElement;\n              target.style.height = 'auto';\n              target.style.height = `${Math.min(target.scrollHeight, 200)}px`;\n            }}\n          />\n        </div>\n\n        {/* Send/Cancel Button */}\n        <div className=\"flex-shrink-0\">\n          {/* Show Cancel button when running */}\n          <ThreadPrimitive.If running={true}>\n            <ComposerPrimitive.Cancel className=\"p-2.5 bg-red-600 text-white hover:bg-red-700 rounded-lg transition-colors flex items-center gap-1.5\">\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n              <span className=\"text-sm font-medium\">Stop</span>\n            </ComposerPrimitive.Cancel>\n          </ThreadPrimitive.If>\n\n          {/* Show Send button when not running */}\n          <ThreadPrimitive.If running={false}>\n            <ComposerPrimitive.Send className=\"p-2.5 bg-blue-600 text-white hover:bg-blue-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors\">\n              <SendIcon className=\"w-5 h-5\" />\n            </ComposerPrimitive.Send>\n          </ThreadPrimitive.If>\n        </div>\n      </ComposerPrimitive.Root>\n\n      {/* Hint */}\n      <div className=\"mt-2 text-xs text-gray-400 px-1\">\n        Press <kbd className=\"px-1.5 py-0.5 bg-gray-700 border border-gray-600 rounded text-xs font-mono text-gray-300\">Enter</kbd> to send,\n        <kbd className=\"ml-1 px-1.5 py-0.5 bg-gray-700 border border-gray-600 rounded text-xs font-mono text-gray-300\">Shift+Enter</kbd> for new line\n      </div>\n    </div>\n  );\n};\n\nComposerArea.displayName = 'ComposerArea';\n\nexport default ComposerArea;\n",
        "last_modified": "2026-01-02T15:11:36.278779"
      },
      "task_intent": {
        "title": "Document Frontend React Components and Hooks",
        "description": "Add comprehensive JSDoc documentation to all React components and custom hooks in the frontend, including prop types, usage examples, component purposes, state management, and side effects.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T14:01:11.137421",
  "last_updated": "2026-01-02T14:22:14.697245"
}