{
  "file_path": "src/web/manager/components/AgentCreatorForm.tsx",
  "main_branch_history": [],
  "task_views": {
    "004-document-frontend-react-components-and-hooks": {
      "task_id": "004-document-frontend-react-components-and-hooks",
      "branch_point": {
        "commit_hash": "34a3f60da53773d90bd6579cb1cfd8417a1dd0b9",
        "content": "import React, { useState, useEffect } from 'react';\nimport * as api from '../services/api';\nimport type { Agent } from '../../../types/agent.types';\nimport { Button } from './ui/Button';\nimport { Input } from './ui/Input';\nimport { XCircleIcon, CpuChipIcon, PuzzlePieceIcon, ServerIcon } from './ui/Icons';\nimport MCPToolsSelector from './MCPToolsSelector';\nimport SkillSelector from './SkillSelector';\n\ninterface AgentCreatorFormProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n  directory?: string;\n  editAgent?: Agent; // If provided, we're in edit mode\n}\n\nconst AgentCreatorForm: React.FC<AgentCreatorFormProps> = ({\n  isOpen,\n  onClose,\n  onSuccess,\n  directory,\n  editAgent,\n}) => {\n  const isEditMode = !!editAgent;\n\n  const [name, setName] = useState('');\n  const [description, setDescription] = useState('');\n  const [systemPrompt, setSystemPrompt] = useState('');\n  const [selectedTools, setSelectedTools] = useState<string[]>([]);\n  const [disallowedTools, setDisallowedTools] = useState<string[]>([]);\n  const [selectedMCPTools, setSelectedMCPTools] = useState<Record<string, string[]>>({});\n  const [selectedSkills, setSelectedSkills] = useState<string[]>([]);\n  const [model, setModel] = useState<'sonnet' | 'opus' | 'haiku' | ''>('');\n  const [inputFields, setInputFields] = useState<api.InputField[]>([]);\n  const [outputSchema, setOutputSchema] = useState('');\n  const [availableTools, setAvailableTools] = useState<api.Tool[]>([]);\n  const [activeToolTab, setActiveToolTab] = useState<'allowed' | 'disallowed'>('allowed');\n  const [isCreating, setIsCreating] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      // Load available tools\n      api.getTools()\n        .then(setAvailableTools)\n        .catch((err) => console.error('Failed to load tools:', err));\n\n      // If editing, populate form with agent data\n      if (editAgent) {\n        setName(editAgent.name);\n        setDescription(editAgent.description || '');\n        setSystemPrompt(editAgent.systemPrompt || '');\n\n        // Transform component-based structure to form state\n        setSelectedTools(editAgent.toolConfig?.allowedTools || []);\n        setDisallowedTools(editAgent.toolConfig?.disallowedTools || []);\n\n        // Transform mcpConfig (component array) to Record<string, string[]>\n        const mcpToolsRecord: Record<string, string[]> = {};\n        if (editAgent.mcpConfig) {\n          editAgent.mcpConfig.forEach((config) => {\n            const serverName = typeof config.mcpServer === 'string' ? config.mcpServer : config.mcpServer.name;\n            if (config.selectedTools) {\n              mcpToolsRecord[serverName] = config.selectedTools.map((toolSel) =>\n                typeof toolSel.mcpTool === 'string' ? toolSel.mcpTool : toolSel.mcpTool.name\n              );\n            }\n          });\n        }\n        setSelectedMCPTools(mcpToolsRecord);\n\n        // Transform skillSelection (component array) to string[]\n        const skillIds = editAgent.skillSelection?.map((selection) =>\n          typeof selection.skill === 'string' ? selection.skill : selection.skill.name\n        ) || [];\n        setSelectedSkills(skillIds);\n\n        // Map ClaudeModel to form model type\n        const modelValue = editAgent.modelConfig?.model || '';\n        const mappedModel = modelValue.startsWith('sonnet') ? 'sonnet'\n          : modelValue.startsWith('opus') ? 'opus'\n          : modelValue.startsWith('haiku') ? 'haiku'\n          : '';\n        setModel(mappedModel);\n\n        // Input fields and output schema are not in Strapi schema yet\n        // TODO: Add these to Strapi schema if needed\n        setInputFields([]);\n        setOutputSchema('');\n      } else {\n        // Reset form for create mode\n        setName('');\n        setDescription('');\n        setSystemPrompt('');\n        setSelectedTools([]);\n        setSelectedMCPTools({});\n        setSelectedSkills([]);\n        setModel('');\n        setInputFields([]);\n        setOutputSchema('');\n      }\n    }\n  }, [isOpen, editAgent]);\n\n  const handleToolToggle = (toolName: string) => {\n    setSelectedTools((prev) =>\n      prev.includes(toolName)\n        ? prev.filter((t) => t !== toolName)\n        : [...prev, toolName]\n    );\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    setSuccess(null);\n\n    // Validation\n    if (!name.trim()) {\n      setError('Agent name is required');\n      return;\n    }\n\n    if (!description.trim()) {\n      setError('Description is required');\n      return;\n    }\n\n    if (!systemPrompt.trim()) {\n      setError('System prompt is required');\n      return;\n    }\n\n    setIsCreating(true);\n\n    try {\n      // Parse output schema if provided\n      let parsedOutputSchema: string | object | undefined;\n\n      if (outputSchema.trim()) {\n        try {\n          parsedOutputSchema = JSON.parse(outputSchema);\n        } catch (e) {\n          setError('Output schema must be valid JSON');\n          setIsCreating(false);\n          return;\n        }\n      }\n\n      // Filter out empty input fields\n      const validInputFields = inputFields.filter(f => f.name && f.type && f.label);\n\n      let result;\n\n      if (isEditMode && editAgent) {\n        // Update existing agent\n        result = await api.updateAgent(\n          editAgent.id,\n          {\n            name: name.trim(),\n            description: description.trim(),\n            systemPrompt: systemPrompt.trim(),\n            tools: selectedTools.length > 0 ? selectedTools : undefined,\n            disallowedTools: disallowedTools.length > 0 ? disallowedTools : undefined,\n            model: model || undefined,\n            inputFields: validInputFields.length > 0 ? validInputFields : undefined,\n            outputSchema: parsedOutputSchema,\n            mcpTools: Object.keys(selectedMCPTools).length > 0 ? selectedMCPTools : undefined,\n            skills: selectedSkills.length > 0 ? selectedSkills : undefined,\n          },\n          directory\n        );\n      } else {\n        // Create new agent\n        result = await api.createAgent(\n          {\n            name: name.trim(),\n            description: description.trim(),\n            systemPrompt: systemPrompt.trim(),\n            tools: selectedTools.length > 0 ? selectedTools : undefined,\n            disallowedTools: disallowedTools.length > 0 ? disallowedTools : undefined,\n            model: model || undefined,\n            inputFields: validInputFields.length > 0 ? validInputFields : undefined,\n            outputSchema: parsedOutputSchema,\n            mcpTools: Object.keys(selectedMCPTools).length > 0 ? selectedMCPTools : undefined,\n            skills: selectedSkills.length > 0 ? selectedSkills : undefined,\n          },\n          directory\n        );\n      }\n\n      setSuccess(result.message);\n\n      // Reset form after 1 second\n      setTimeout(() => {\n        setName('');\n        setDescription('');\n        setSystemPrompt('');\n        setSelectedTools([]);\n        setSelectedMCPTools({});\n        setSelectedSkills([]);\n        setModel('');\n        setError(null);\n        setSuccess(null);\n        onSuccess();\n        onClose();\n      }, 1500);\n\n    } catch (err) {\n      setError(err instanceof Error ? err.message : `Failed to ${isEditMode ? 'update' : 'create'} agent`);\n    } finally {\n      setIsCreating(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 overflow-y-auto\">\n      <div className=\"bg-background border border-border rounded-lg shadow-lg w-full max-w-3xl max-h-[90vh] flex flex-col m-4\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-border\">\n          <div>\n            <h2 className=\"text-xl font-bold\">{isEditMode ? 'Edit Agent' : 'Create New Agent'}</h2>\n            <p className=\"text-sm text-muted-foreground\">\n              {isEditMode\n                ? 'Update agent configuration and behavior'\n                : 'Define a custom agent with specific tools and behavior'}\n            </p>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-muted-foreground hover:text-foreground\"\n          >\n            <XCircleIcon className=\"h-6 w-6\" />\n          </button>\n        </div>\n\n        {/* Form */}\n        <form onSubmit={handleSubmit} className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n          {/* Error/Success Messages */}\n          {error && (\n            <div className=\"bg-red-500/10 border border-red-500/20 rounded p-3 text-sm text-red-500\">\n              {error}\n            </div>\n          )}\n\n          {success && (\n            <div className=\"bg-green-500/10 border border-green-500/20 rounded p-3 text-sm text-green-500\">\n              {success}\n            </div>\n          )}\n\n          {/* Agent Name */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              Agent Name <span className=\"text-red-500\">*</span>\n            </label>\n            <Input\n              type=\"text\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              placeholder=\"e.g., SQL Optimizer, Code Reviewer\"\n              disabled={isCreating || isEditMode}\n              className=\"w-full\"\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {isEditMode\n                ? 'Agent name cannot be changed'\n                : 'Will be converted to kebab-case (e.g., \"SQL Optimizer\" \u2192 \"sql-optimizer\")'}\n            </p>\n          </div>\n\n          {/* Description */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              Description <span className=\"text-red-500\">*</span>\n            </label>\n            <textarea\n              value={description}\n              onChange={(e) => setDescription(e.target.value)}\n              placeholder=\"Use for SQL query optimization and database performance analysis\"\n              disabled={isCreating}\n              rows={2}\n              className=\"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50\"\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Describe WHEN to use this agent. Start with \"Use for...\" or \"Use when...\"\n            </p>\n          </div>\n\n          {/* Claude Built-in Tools */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              Claude Built-in Tools (Optional)\n            </label>\n\n            {/* Tool Tabs */}\n            <div className=\"flex gap-2 mb-2\">\n              <button\n                type=\"button\"\n                onClick={() => setActiveToolTab('allowed')}\n                className={`px-3 py-1.5 text-xs font-medium rounded-md border-b-2 transition-colors ${\n                  activeToolTab === 'allowed'\n                    ? 'border-primary text-primary'\n                    : 'border-transparent text-muted-foreground hover:text-foreground'\n                }`}\n              >\n                Allowed Tools ({selectedTools.length})\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setActiveToolTab('disallowed')}\n                className={`px-3 py-1.5 text-xs font-medium rounded-md border-b-2 transition-colors ${\n                  activeToolTab === 'disallowed'\n                    ? 'border-primary text-primary'\n                    : 'border-transparent text-muted-foreground hover:text-foreground'\n                }`}\n              >\n                Disallowed Tools ({disallowedTools.length})\n              </button>\n            </div>\n\n            {/* Tab Content */}\n            <div className=\"border border-border rounded-md p-3 max-h-48 overflow-y-auto\">\n              {availableTools.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">Loading tools...</p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {activeToolTab === 'allowed' ? (\n                    availableTools.map((tool) => (\n                      <label\n                        key={tool.name}\n                        className=\"flex items-start gap-2 cursor-pointer hover:bg-secondary/50 p-2 rounded\"\n                      >\n                        <input\n                          type=\"checkbox\"\n                          checked={selectedTools.includes(tool.name)}\n                          onChange={() => handleToolToggle(tool.name)}\n                          disabled={isCreating}\n                          className=\"mt-1 w-4 h-4\"\n                        />\n                        <div className=\"flex-1\">\n                          <div className=\"font-medium text-sm\">{tool.name}</div>\n                          <div className=\"text-xs text-muted-foreground\">{tool.description}</div>\n                        </div>\n                      </label>\n                    ))\n                  ) : (\n                    availableTools.map((tool) => (\n                      <label\n                        key={tool.name}\n                        className=\"flex items-start gap-2 cursor-pointer hover:bg-secondary/50 p-2 rounded\"\n                      >\n                        <input\n                          type=\"checkbox\"\n                          checked={disallowedTools.includes(tool.name)}\n                          onChange={() => {\n                            if (disallowedTools.includes(tool.name)) {\n                              setDisallowedTools(disallowedTools.filter(t => t !== tool.name));\n                            } else {\n                              setDisallowedTools([...disallowedTools, tool.name]);\n                            }\n                          }}\n                          disabled={isCreating}\n                          className=\"mt-1 w-4 h-4\"\n                        />\n                        <div className=\"flex-1\">\n                          <div className=\"font-medium text-sm\">{tool.name}</div>\n                          <div className=\"text-xs text-muted-foreground\">{tool.description}</div>\n                        </div>\n                      </label>\n                    ))\n                  )}\n                </div>\n              )}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {activeToolTab === 'allowed'\n                ? (selectedTools.length > 0\n                    ? `Selected: ${selectedTools.join(', ')}`\n                    : 'Leave empty to allow all tools. Select specific tools to restrict what the agent can use.')\n                : (disallowedTools.length > 0\n                    ? `Disallowed: ${disallowedTools.join(', ')}`\n                    : 'Leave empty to allow all tools. Select specific tools to explicitly block.')\n              }\n            </p>\n          </div>\n\n          {/* MCP Tools */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              MCP Server Tools (Optional)\n            </label>\n            <MCPToolsSelector\n              selectedMCPTools={selectedMCPTools}\n              onChange={setSelectedMCPTools}\n              disabled={isCreating}\n              directory={directory}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Select specific tools from your MCP servers. Leave empty to allow all MCP tools.\n            </p>\n          </div>\n\n          {/* Skills */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              Skills (Optional)\n            </label>\n            <SkillSelector\n              selectedSkills={selectedSkills}\n              onChange={setSelectedSkills}\n              disabled={isCreating}\n              directory={directory}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Select skills that this agent can use. Skills provide specialized capabilities and domain knowledge.\n            </p>\n          </div>\n\n          {/* Model */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              Model (Optional)\n            </label>\n            <select\n              value={model}\n              onChange={(e) => setModel(e.target.value as any)}\n              disabled={isCreating}\n              className=\"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50\"\n            >\n              <option value=\"\">Default (inherit from main agent)</option>\n              <option value=\"sonnet\">Sonnet (balanced)</option>\n              <option value=\"opus\">Opus (highest quality)</option>\n              <option value=\"haiku\">Haiku (fast & efficient)</option>\n            </select>\n          </div>\n\n          {/* System Prompt */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              System Prompt <span className=\"text-red-500\">*</span>\n            </label>\n            <textarea\n              value={systemPrompt}\n              onChange={(e) => setSystemPrompt(e.target.value)}\n              placeholder={`You are an expert SQL optimizer.\n\nYour responsibilities:\n- Analyze SQL queries for performance issues\n- Suggest index improvements\n- Identify N+1 query problems\n- Recommend query optimizations\n\nWhen reviewing queries:\n- Focus on execution plan efficiency\n- Check for missing indexes\n- Look for unnecessary JOINs\n- Suggest caching strategies\n\nAlways provide:\n1. Specific optimization recommendations\n2. Expected performance improvement\n3. Implementation steps`}\n              disabled={isCreating}\n              rows={12}\n              className=\"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 font-mono text-sm\"\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Define the agent's role, expertise, and behavior. Be specific and detailed.\n            </p>\n          </div>\n\n          {/* Input Fields */}\n          <div>\n            <div className=\"flex items-center justify-between mb-2\">\n              <label className=\"block text-sm font-medium\">\n                Input Fields (Optional)\n              </label>\n              <Button\n                type=\"button\"\n                size=\"sm\"\n                onClick={() => {\n                  setInputFields([...inputFields, {\n                    name: '',\n                    type: 'text',\n                    label: '',\n                    required: false,\n                  }]);\n                }}\n                disabled={isCreating}\n              >\n                + Add Field\n              </Button>\n            </div>\n\n            {inputFields.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground p-3 border border-dashed border-border rounded\">\n                No input fields defined. Click \"+ Add Field\" to add fields that users will fill when executing this agent.\n              </p>\n            ) : (\n              <div className=\"space-y-3 border border-border rounded p-3\">\n                {inputFields.map((field, index) => (\n                  <div key={index} className=\"border border-border rounded p-3 space-y-2\">\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Field Name *</label>\n                        <Input\n                          type=\"text\"\n                          value={field.name}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].name = e.target.value;\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"url\"\n                          disabled={isCreating}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Label *</label>\n                        <Input\n                          type=\"text\"\n                          value={field.label}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].label = e.target.value;\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"Website URL\"\n                          disabled={isCreating}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Type *</label>\n                        <select\n                          value={field.type}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].type = e.target.value as any;\n                            setInputFields(newFields);\n                          }}\n                          disabled={isCreating}\n                          className=\"w-full px-2 py-1 text-sm border border-border rounded-md bg-background\"\n                        >\n                          <option value=\"text\">Text</option>\n                          <option value=\"textarea\">Textarea</option>\n                          <option value=\"dropdown\">Dropdown</option>\n                          <option value=\"checkbox\">Checkbox</option>\n                          <option value=\"number\">Number</option>\n                        </select>\n                      </div>\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Placeholder</label>\n                        <Input\n                          type=\"text\"\n                          value={field.placeholder || ''}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].placeholder = e.target.value;\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"https://example.com\"\n                          disabled={isCreating}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                    </div>\n\n                    {field.type === 'dropdown' && (\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Options (comma-separated) *</label>\n                        <Input\n                          type=\"text\"\n                          value={field.options?.join(', ') || ''}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].options = e.target.value.split(',').map(o => o.trim()).filter(Boolean);\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"Basic, Detailed, Comprehensive\"\n                          disabled={isCreating}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                    )}\n\n                    <div className=\"flex items-center justify-between\">\n                      <label className=\"flex items-center gap-2 text-xs\">\n                        <input\n                          type=\"checkbox\"\n                          checked={field.required || false}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].required = e.target.checked;\n                            setInputFields(newFields);\n                          }}\n                          disabled={isCreating}\n                          className=\"w-3 h-3\"\n                        />\n                        Required\n                      </label>\n                      <Button\n                        type=\"button\"\n                        size=\"sm\"\n                        variant=\"secondary\"\n                        onClick={() => {\n                          setInputFields(inputFields.filter((_, i) => i !== index));\n                        }}\n                        disabled={isCreating}\n                      >\n                        Remove\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Define form fields that users will fill when executing this agent\n            </p>\n          </div>\n\n          {/* Output Schema */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              Output Schema (Optional)\n            </label>\n            <textarea\n              value={outputSchema}\n              onChange={(e) => setOutputSchema(e.target.value)}\n              placeholder={`{\n  \"type\": \"object\",\n  \"properties\": {\n    \"summary\": {\n      \"type\": \"string\",\n      \"description\": \"Brief summary of findings\"\n    },\n    \"recommendations\": {\n      \"type\": \"array\",\n      \"items\": { \"type\": \"string\" }\n    }\n  }\n}`}\n              disabled={isCreating}\n              rows={8}\n              className=\"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 font-mono text-sm\"\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              JSON Schema defining the expected output format from this agent\n            </p>\n          </div>\n\n          {/* Agent Configuration Preview */}\n          {(selectedTools.length > 0 || Object.keys(selectedMCPTools).length > 0 || selectedSkills.length > 0) && (\n            <div className=\"border-2 border-primary/20 rounded-lg p-4 bg-primary/5\">\n              <h3 className=\"text-sm font-semibold mb-3 flex items-center gap-2\">\n                <span className=\"text-primary\">\ud83d\udc41\ufe0f</span>\n                Agent Configuration Preview\n              </h3>\n\n              <div className=\"space-y-3\">\n                {/* Skills Preview */}\n                {selectedSkills.length > 0 && (\n                  <div>\n                    <div className=\"flex items-center gap-1.5 mb-1.5\">\n                      <PuzzlePieceIcon className=\"h-3.5 w-3.5 text-green-600\" />\n                      <h4 className=\"font-semibold text-xs text-muted-foreground uppercase\">\n                        Skills ({selectedSkills.length})\n                      </h4>\n                    </div>\n                    <div className=\"flex flex-wrap gap-1\">\n                      {selectedSkills.map((skill, idx) => (\n                        <span key={idx} className=\"text-xs bg-green-50 text-green-700 border border-green-200 px-2 py-0.5 rounded font-medium\">\n                          {skill}\n                        </span>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* Built-in Tools Preview */}\n                {selectedTools.length > 0 && (\n                  <div>\n                    <div className=\"flex items-center gap-1.5 mb-1.5\">\n                      <CpuChipIcon className=\"h-3.5 w-3.5 text-blue-600\" />\n                      <h4 className=\"font-semibold text-xs text-muted-foreground uppercase\">\n                        Claude Built-in Tools ({selectedTools.length})\n                      </h4>\n                    </div>\n                    <div className=\"flex flex-wrap gap-1\">\n                      {selectedTools.map((tool, idx) => (\n                        <span key={idx} className=\"text-xs bg-blue-50 text-blue-700 border border-blue-200 px-2 py-0.5 rounded\">\n                          {tool}\n                        </span>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* MCP Tools Preview */}\n                {Object.keys(selectedMCPTools).length > 0 && (\n                  <div>\n                    <div className=\"flex items-center gap-1.5 mb-1.5\">\n                      <ServerIcon className=\"h-3.5 w-3.5 text-indigo-600\" />\n                      <h4 className=\"font-semibold text-xs text-muted-foreground uppercase\">\n                        MCP Tools ({Object.values(selectedMCPTools).reduce((sum, tools) => sum + tools.length, 0)} from {Object.keys(selectedMCPTools).length} server{Object.keys(selectedMCPTools).length !== 1 ? 's' : ''})\n                      </h4>\n                    </div>\n                    <div className=\"space-y-1.5\">\n                      {Object.entries(selectedMCPTools).map(([serverId, tools]) => (\n                        <div key={serverId}>\n                          <div className=\"text-xs font-medium text-indigo-600 mb-0.5\">{serverId}</div>\n                          <div className=\"flex flex-wrap gap-1\">\n                            {tools.map((tool, idx) => (\n                              <span key={idx} className=\"text-xs bg-indigo-50 text-indigo-700 border border-indigo-200 px-2 py-0.5 rounded\">\n                                {tool}\n                              </span>\n                            ))}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n        </form>\n\n        {/* Footer */}\n        <div className=\"p-4 border-t border-border flex justify-end gap-2\">\n          <Button\n            type=\"button\"\n            variant=\"secondary\"\n            onClick={onClose}\n            disabled={isCreating}\n          >\n            Cancel\n          </Button>\n          <Button\n            type=\"submit\"\n            onClick={handleSubmit}\n            disabled={isCreating || !name || !description || !systemPrompt}\n          >\n            {isCreating\n              ? (isEditMode ? 'Updating...' : 'Creating...')\n              : (isEditMode ? 'Update Agent' : 'Create Agent')}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AgentCreatorForm;\n",
        "timestamp": "2026-01-02T14:22:14.293924"
      },
      "worktree_state": {
        "content": "/**\n * @file AgentCreatorForm.tsx\n * @description Comprehensive form component for creating and editing agents with multi-stage\n * configuration including tools, skills, MCP integration, input fields, and output schema.\n *\n * ## Features\n * - Create new agents or edit existing ones (dual-mode component)\n * - Required field validation (name, description, system prompt)\n * - Multi-tab tool selection (allowed/disallowed Claude built-in tools)\n * - MCP server tool integration via MCPToolsSelector\n * - Skill binding via SkillSelector\n * - Model selection (sonnet, opus, haiku)\n * - Dynamic input field builder with 5 field types\n * - JSON schema output configuration\n * - Real-time configuration preview\n * - Form state management with auto-reset\n * - Success/error feedback with auto-close\n *\n * ## Form Fields\n * The component provides comprehensive configuration through multiple sections:\n *\n * ### Core Configuration (Required)\n * 1. **Agent Name** - Unique identifier (converted to kebab-case)\n *    - Required field with red asterisk indicator\n *    - Disabled in edit mode (name cannot be changed)\n *    - Auto-converted to kebab-case (e.g., \"SQL Optimizer\" \u2192 \"sql-optimizer\")\n *\n * 2. **Description** - When to use this agent\n *    - Required field with red asterisk indicator\n *    - Recommended to start with \"Use for...\" or \"Use when...\"\n *    - 2-row textarea for brief explanation\n *\n * 3. **System Prompt** - Agent's role, expertise, and behavior\n *    - Required field with red asterisk indicator\n *    - 12-row textarea with monospace font\n *    - Defines agent responsibilities, workflow, and output format\n *    - Placeholder shows comprehensive example structure\n *\n * ### Tool Configuration (Optional)\n * 4. **Claude Built-in Tools** - Multi-tab selector for built-in tools\n *    - **Allowed Tools Tab**: Whitelist specific tools (leave empty for all)\n *    - **Disallowed Tools Tab**: Blacklist specific tools (leave empty for none)\n *    - Checkbox list with tool name and description\n *    - Active tab count badge display\n *    - Mutually exclusive with disallowed tools (same tool can't be both)\n *\n * 5. **MCP Server Tools** - Integration with Model Context Protocol servers\n *    - Uses MCPToolsSelector component for server-specific tool selection\n *    - Supports multiple servers with independent tool selection\n *    - Leave empty to allow all MCP tools\n *\n * 6. **Skills** - Specialized capabilities and domain knowledge\n *    - Uses SkillSelector component for multi-select skill binding\n *    - Skills provide pre-built functionality to agents\n *    - Leave empty for no skill binding\n *\n * ### Execution Configuration (Optional)\n * 7. **Model** - Claude model selection\n *    - Options: Default (inherit), Sonnet (balanced), Opus (highest quality), Haiku (fast)\n *    - Defaults to inherit from main agent configuration\n *\n * 8. **Input Fields** - Dynamic form builder for agent execution\n *    - Add/remove custom input fields\n *    - Each field has: name, label, type, placeholder, options (for dropdown), required flag\n *    - 5 supported types: text, textarea, dropdown, checkbox, number\n *    - Users fill these fields when executing the agent\n *    - Empty fields filtered out before submission\n *\n * 9. **Output Schema** - JSON schema for expected output format\n *    - Optional JSON schema definition\n *    - 8-row textarea with monospace font\n *    - Validated as valid JSON before submission\n *    - Placeholder shows example schema structure\n *\n * ### Configuration Preview\n * Real-time preview section shows selected configuration:\n * - **Skills**: Green badges with count\n * - **Built-in Tools**: Blue badges with count\n * - **MCP Tools**: Indigo badges grouped by server with total count\n * - Only visible when at least one tool/skill is selected\n *\n * ## Validation\n * The component implements multi-level validation:\n *\n * ### Required Field Validation\n * - **Agent Name**: Cannot be empty, checked on submit\n * - **Description**: Cannot be empty, checked on submit\n * - **System Prompt**: Cannot be empty, checked on submit\n * - Submit button disabled when any required field is empty\n *\n * ### JSON Schema Validation\n * - **Output Schema**: Must be valid JSON if provided (optional field)\n * - Parse error shows message: \"Output schema must be valid JSON\"\n * - Validation runs before submission\n *\n * ### Input Field Validation\n * - Fields must have: name, type, and label to be included\n * - Empty fields automatically filtered out before submission\n * - Dropdown fields require options (comma-separated)\n *\n * ## Agent Creation Workflow\n * The component handles both creation and editing with a unified workflow:\n *\n * ### Create Mode (editAgent = undefined)\n * 1. User opens modal (isOpen = true)\n * 2. Form loads with empty fields\n * 3. Available tools fetched from API\n * 4. User fills required fields (name, description, system prompt)\n * 5. User optionally selects tools, skills, model, input fields, output schema\n * 6. User clicks \"Create Agent\"\n * 7. Validation runs (required fields, JSON schema)\n * 8. If valid, API call to createAgent with all configuration\n * 9. Success message displayed for 1.5 seconds\n * 10. Form resets and modal closes\n * 11. onSuccess callback invoked\n *\n * ### Edit Mode (editAgent provided)\n * 1. User opens modal with existing agent\n * 2. Form populates with agent data:\n *    - Core fields (name, description, system prompt)\n *    - Tool configuration (allowed/disallowed, MCP, skills)\n *    - Model selection\n *    - Input fields and output schema (if supported)\n * 3. Agent name field disabled (cannot change name)\n * 4. User modifies configuration\n * 5. User clicks \"Update Agent\"\n * 6. Validation runs (required fields, JSON schema)\n * 7. If valid, API call to updateAgent with modified configuration\n * 8. Success message displayed for 1.5 seconds\n * 9. Form resets and modal closes\n * 10. onSuccess callback invoked\n *\n * ### Data Transformation\n * The component transforms between Strapi component structure and form state:\n * - **Tools**: Extracts allowedTools and disallowedTools from toolConfig\n * - **MCP Tools**: Converts mcpConfig component array to Record<string, string[]>\n * - **Skills**: Converts skillSelection component array to string[]\n * - **Model**: Maps ClaudeModel to form model type (sonnet/opus/haiku)\n *\n * ## Modal Behavior\n * - **Open State**: Controlled by isOpen prop\n * - **Close Actions**: Close button (X icon) or Cancel button\n * - **Auto-close**: Automatically closes 1.5 seconds after successful create/update\n * - **Form Reset**: All fields reset to initial values on close\n * - **Backdrop**: Semi-transparent black overlay with click-outside disabled\n * - **Responsive**: Max width 3xl (768px), max height 90vh with scrolling\n *\n * ## Styling Behavior\n * The component uses Tailwind CSS for comprehensive styling:\n * - **Modal**: Fixed overlay with centered dialog, z-50 layering\n * - **Header**: Title, subtitle, close button with border-bottom\n * - **Form**: Scrollable body with space-y-4 field spacing\n * - **Required Indicators**: Red asterisk (*) with text-red-500\n * - **Tool Tabs**: Active tab has border-primary and text-primary\n * - **Success Message**: bg-green-500/10 with green-500 text and border\n * - **Error Message**: bg-red-500/10 with red-500 text and border\n * - **Preview Section**: border-2 border-primary/20 with bg-primary/5\n * - **Badge Colors**: Skills (green), Built-in Tools (blue), MCP Tools (indigo)\n * - **Footer**: Border-top with right-aligned action buttons\n * - **Disabled State**: opacity-50 on all disabled inputs\n *\n * @example\n * // Create new agent\n * const [showForm, setShowForm] = useState(false);\n * const [directory, setDirectory] = useState('/home/user/project');\n *\n * <AgentCreatorForm\n *   isOpen={showForm}\n *   onClose={() => setShowForm(false)}\n *   onSuccess={() => {\n *     console.log('Agent created successfully');\n *     // Refresh agent list, navigate to agents page, etc.\n *   }}\n *   directory={directory}\n * />\n *\n * @example\n * // Edit existing agent\n * const [editingAgent, setEditingAgent] = useState<Agent | undefined>(undefined);\n * const agent = {\n *   id: 123,\n *   name: \"sql-optimizer\",\n *   description: \"Use for SQL query optimization and performance analysis\",\n *   systemPrompt: \"You are an expert SQL optimizer...\",\n *   toolConfig: {\n *     allowedTools: [\"bash_20241022\", \"text_editor_20241022\"]\n *   },\n *   modelConfig: { model: \"claude-sonnet-4-20250514\" }\n * };\n *\n * <AgentCreatorForm\n *   isOpen={!!editingAgent}\n *   onClose={() => setEditingAgent(undefined)}\n *   onSuccess={() => {\n *     console.log('Agent updated successfully');\n *     setEditingAgent(undefined);\n *   }}\n *   directory={directory}\n *   editAgent={editingAgent}\n * />\n *\n * @example\n * // Understanding input fields\n * // When creating an agent with custom input fields:\n * // 1. Click \"+ Add Field\" button\n * // 2. Fill in field configuration:\n * //    - Field Name: \"url\" (programmatic identifier)\n * //    - Label: \"Website URL\" (user-facing label)\n * //    - Type: \"text\" (text, textarea, dropdown, checkbox, number)\n * //    - Placeholder: \"https://example.com\" (optional hint)\n * //    - Required: checked (enforce user input)\n * // 3. For dropdown type, add options: \"Basic, Detailed, Comprehensive\"\n * // 4. Click \"Remove\" to delete unwanted fields\n * // 5. When agent is executed, users will fill these fields in AgentConfigModal\n *\n * @example\n * // Understanding tool configuration\n * // The form provides three tool selection mechanisms:\n * // 1. Claude Built-in Tools (Allowed): Whitelist specific tools\n * //    - Select \"bash_20241022\" and \"text_editor_20241022\"\n * //    - Agent can ONLY use these two tools\n * // 2. Claude Built-in Tools (Disallowed): Blacklist specific tools\n * //    - Select \"computer_20241022\"\n * //    - Agent can use ALL tools EXCEPT computer_20241022\n * // 3. MCP Server Tools: Select tools from external servers\n * //    - Select \"github/create-issue\" from GitHub MCP server\n * //    - Select \"jira/create-ticket\" from Jira MCP server\n * //    - Agent can use these MCP tools in addition to built-in tools\n * // 4. Skills: Bind pre-built skills to agent\n * //    - Select \"code-review\" and \"test-generation\" skills\n * //    - Agent inherits capabilities from these skills\n */\n\nimport React, { useState, useEffect } from 'react';\nimport * as api from '../services/api';\nimport type { Agent } from '../../../types/agent.types';\nimport { Button } from './ui/Button';\nimport { Input } from './ui/Input';\nimport { XCircleIcon, CpuChipIcon, PuzzlePieceIcon, ServerIcon } from './ui/Icons';\nimport MCPToolsSelector from './MCPToolsSelector';\nimport SkillSelector from './SkillSelector';\n\n/**\n * Props for the AgentCreatorForm component.\n *\n * @property {boolean} isOpen - Controls modal visibility (true = visible, false = hidden)\n * @property {() => void} onClose - Callback invoked when modal should close (X button or Cancel button clicked)\n * @property {() => void} onSuccess - Callback invoked after successful agent creation/update (before auto-close)\n * @property {string} [directory] - Optional directory path for agent creation/update (used in API calls)\n * @property {Agent} [editAgent] - Optional agent object to edit; if provided, form enters edit mode with pre-populated fields\n */\ninterface AgentCreatorFormProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n  directory?: string;\n  editAgent?: Agent; // If provided, we're in edit mode\n}\n\nconst AgentCreatorForm: React.FC<AgentCreatorFormProps> = ({\n  isOpen,\n  onClose,\n  onSuccess,\n  directory,\n  editAgent,\n}) => {\n  const isEditMode = !!editAgent;\n\n  const [name, setName] = useState('');\n  const [description, setDescription] = useState('');\n  const [systemPrompt, setSystemPrompt] = useState('');\n  const [selectedTools, setSelectedTools] = useState<string[]>([]);\n  const [disallowedTools, setDisallowedTools] = useState<string[]>([]);\n  const [selectedMCPTools, setSelectedMCPTools] = useState<Record<string, string[]>>({});\n  const [selectedSkills, setSelectedSkills] = useState<string[]>([]);\n  const [model, setModel] = useState<'sonnet' | 'opus' | 'haiku' | ''>('');\n  const [inputFields, setInputFields] = useState<api.InputField[]>([]);\n  const [outputSchema, setOutputSchema] = useState('');\n  const [availableTools, setAvailableTools] = useState<api.Tool[]>([]);\n  const [activeToolTab, setActiveToolTab] = useState<'allowed' | 'disallowed'>('allowed');\n  const [isCreating, setIsCreating] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      // Load available tools\n      api.getTools()\n        .then(setAvailableTools)\n        .catch((err) => console.error('Failed to load tools:', err));\n\n      // If editing, populate form with agent data\n      if (editAgent) {\n        setName(editAgent.name);\n        setDescription(editAgent.description || '');\n        setSystemPrompt(editAgent.systemPrompt || '');\n\n        // Transform component-based structure to form state\n        setSelectedTools(editAgent.toolConfig?.allowedTools || []);\n        setDisallowedTools(editAgent.toolConfig?.disallowedTools || []);\n\n        // Transform mcpConfig (component array) to Record<string, string[]>\n        const mcpToolsRecord: Record<string, string[]> = {};\n        if (editAgent.mcpConfig) {\n          editAgent.mcpConfig.forEach((config) => {\n            const serverName = typeof config.mcpServer === 'string' ? config.mcpServer : config.mcpServer.name;\n            if (config.selectedTools) {\n              mcpToolsRecord[serverName] = config.selectedTools.map((toolSel) =>\n                typeof toolSel.mcpTool === 'string' ? toolSel.mcpTool : toolSel.mcpTool.name\n              );\n            }\n          });\n        }\n        setSelectedMCPTools(mcpToolsRecord);\n\n        // Transform skillSelection (component array) to string[]\n        const skillIds = editAgent.skillSelection?.map((selection) =>\n          typeof selection.skill === 'string' ? selection.skill : selection.skill.name\n        ) || [];\n        setSelectedSkills(skillIds);\n\n        // Map ClaudeModel to form model type\n        const modelValue = editAgent.modelConfig?.model || '';\n        const mappedModel = modelValue.startsWith('sonnet') ? 'sonnet'\n          : modelValue.startsWith('opus') ? 'opus'\n          : modelValue.startsWith('haiku') ? 'haiku'\n          : '';\n        setModel(mappedModel);\n\n        // Input fields and output schema are not in Strapi schema yet\n        // TODO: Add these to Strapi schema if needed\n        setInputFields([]);\n        setOutputSchema('');\n      } else {\n        // Reset form for create mode\n        setName('');\n        setDescription('');\n        setSystemPrompt('');\n        setSelectedTools([]);\n        setSelectedMCPTools({});\n        setSelectedSkills([]);\n        setModel('');\n        setInputFields([]);\n        setOutputSchema('');\n      }\n    }\n  }, [isOpen, editAgent]);\n\n  /**\n   * Toggles a Claude built-in tool in the allowed tools list.\n   * @internal\n   *\n   * If tool is currently selected, removes it from the list.\n   * If tool is not selected, adds it to the list.\n   *\n   * @param {string} toolName - Name of the tool to toggle (e.g., \"bash_20241022\")\n   */\n  const handleToolToggle = (toolName: string) => {\n    setSelectedTools((prev) =>\n      prev.includes(toolName)\n        ? prev.filter((t) => t !== toolName)\n        : [...prev, toolName]\n    );\n  };\n\n  /**\n   * Handles form submission for agent creation or update.\n   * @internal\n   *\n   * Workflow:\n   * 1. Prevents default form submission\n   * 2. Validates required fields (name, description, system prompt)\n   * 3. Validates output schema as valid JSON (if provided)\n   * 4. Filters out empty input fields\n   * 5. Calls createAgent or updateAgent API based on mode\n   * 6. Shows success message for 1.5 seconds\n   * 7. Resets form and closes modal\n   * 8. Invokes onSuccess callback\n   *\n   * Error handling:\n   * - Required field missing: Shows error message, prevents submission\n   * - Invalid JSON schema: Shows error message, prevents submission\n   * - API error: Shows error message from API or generic message\n   *\n   * @param {React.FormEvent} e - Form submission event\n   */\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    setSuccess(null);\n\n    // Validation\n    if (!name.trim()) {\n      setError('Agent name is required');\n      return;\n    }\n\n    if (!description.trim()) {\n      setError('Description is required');\n      return;\n    }\n\n    if (!systemPrompt.trim()) {\n      setError('System prompt is required');\n      return;\n    }\n\n    setIsCreating(true);\n\n    try {\n      // Parse output schema if provided\n      let parsedOutputSchema: string | object | undefined;\n\n      if (outputSchema.trim()) {\n        try {\n          parsedOutputSchema = JSON.parse(outputSchema);\n        } catch (e) {\n          setError('Output schema must be valid JSON');\n          setIsCreating(false);\n          return;\n        }\n      }\n\n      // Filter out empty input fields\n      const validInputFields = inputFields.filter(f => f.name && f.type && f.label);\n\n      let result;\n\n      if (isEditMode && editAgent) {\n        // Update existing agent\n        result = await api.updateAgent(\n          editAgent.id,\n          {\n            name: name.trim(),\n            description: description.trim(),\n            systemPrompt: systemPrompt.trim(),\n            tools: selectedTools.length > 0 ? selectedTools : undefined,\n            disallowedTools: disallowedTools.length > 0 ? disallowedTools : undefined,\n            model: model || undefined,\n            inputFields: validInputFields.length > 0 ? validInputFields : undefined,\n            outputSchema: parsedOutputSchema,\n            mcpTools: Object.keys(selectedMCPTools).length > 0 ? selectedMCPTools : undefined,\n            skills: selectedSkills.length > 0 ? selectedSkills : undefined,\n          },\n          directory\n        );\n      } else {\n        // Create new agent\n        result = await api.createAgent(\n          {\n            name: name.trim(),\n            description: description.trim(),\n            systemPrompt: systemPrompt.trim(),\n            tools: selectedTools.length > 0 ? selectedTools : undefined,\n            disallowedTools: disallowedTools.length > 0 ? disallowedTools : undefined,\n            model: model || undefined,\n            inputFields: validInputFields.length > 0 ? validInputFields : undefined,\n            outputSchema: parsedOutputSchema,\n            mcpTools: Object.keys(selectedMCPTools).length > 0 ? selectedMCPTools : undefined,\n            skills: selectedSkills.length > 0 ? selectedSkills : undefined,\n          },\n          directory\n        );\n      }\n\n      setSuccess(result.message);\n\n      // Reset form after 1 second\n      setTimeout(() => {\n        setName('');\n        setDescription('');\n        setSystemPrompt('');\n        setSelectedTools([]);\n        setSelectedMCPTools({});\n        setSelectedSkills([]);\n        setModel('');\n        setError(null);\n        setSuccess(null);\n        onSuccess();\n        onClose();\n      }, 1500);\n\n    } catch (err) {\n      setError(err instanceof Error ? err.message : `Failed to ${isEditMode ? 'update' : 'create'} agent`);\n    } finally {\n      setIsCreating(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 overflow-y-auto\">\n      <div className=\"bg-background border border-border rounded-lg shadow-lg w-full max-w-3xl max-h-[90vh] flex flex-col m-4\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-border\">\n          <div>\n            <h2 className=\"text-xl font-bold\">{isEditMode ? 'Edit Agent' : 'Create New Agent'}</h2>\n            <p className=\"text-sm text-muted-foreground\">\n              {isEditMode\n                ? 'Update agent configuration and behavior'\n                : 'Define a custom agent with specific tools and behavior'}\n            </p>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-muted-foreground hover:text-foreground\"\n          >\n            <XCircleIcon className=\"h-6 w-6\" />\n          </button>\n        </div>\n\n        {/* Form */}\n        <form onSubmit={handleSubmit} className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n          {/* Error/Success Messages */}\n          {error && (\n            <div className=\"bg-red-500/10 border border-red-500/20 rounded p-3 text-sm text-red-500\">\n              {error}\n            </div>\n          )}\n\n          {success && (\n            <div className=\"bg-green-500/10 border border-green-500/20 rounded p-3 text-sm text-green-500\">\n              {success}\n            </div>\n          )}\n\n          {/* Agent Name */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              Agent Name <span className=\"text-red-500\">*</span>\n            </label>\n            <Input\n              type=\"text\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              placeholder=\"e.g., SQL Optimizer, Code Reviewer\"\n              disabled={isCreating || isEditMode}\n              className=\"w-full\"\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {isEditMode\n                ? 'Agent name cannot be changed'\n                : 'Will be converted to kebab-case (e.g., \"SQL Optimizer\" \u2192 \"sql-optimizer\")'}\n            </p>\n          </div>\n\n          {/* Description */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              Description <span className=\"text-red-500\">*</span>\n            </label>\n            <textarea\n              value={description}\n              onChange={(e) => setDescription(e.target.value)}\n              placeholder=\"Use for SQL query optimization and database performance analysis\"\n              disabled={isCreating}\n              rows={2}\n              className=\"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50\"\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Describe WHEN to use this agent. Start with \"Use for...\" or \"Use when...\"\n            </p>\n          </div>\n\n          {/* Claude Built-in Tools */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              Claude Built-in Tools (Optional)\n            </label>\n\n            {/* Tool Tabs */}\n            <div className=\"flex gap-2 mb-2\">\n              <button\n                type=\"button\"\n                onClick={() => setActiveToolTab('allowed')}\n                className={`px-3 py-1.5 text-xs font-medium rounded-md border-b-2 transition-colors ${\n                  activeToolTab === 'allowed'\n                    ? 'border-primary text-primary'\n                    : 'border-transparent text-muted-foreground hover:text-foreground'\n                }`}\n              >\n                Allowed Tools ({selectedTools.length})\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setActiveToolTab('disallowed')}\n                className={`px-3 py-1.5 text-xs font-medium rounded-md border-b-2 transition-colors ${\n                  activeToolTab === 'disallowed'\n                    ? 'border-primary text-primary'\n                    : 'border-transparent text-muted-foreground hover:text-foreground'\n                }`}\n              >\n                Disallowed Tools ({disallowedTools.length})\n              </button>\n            </div>\n\n            {/* Tab Content */}\n            <div className=\"border border-border rounded-md p-3 max-h-48 overflow-y-auto\">\n              {availableTools.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">Loading tools...</p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {activeToolTab === 'allowed' ? (\n                    availableTools.map((tool) => (\n                      <label\n                        key={tool.name}\n                        className=\"flex items-start gap-2 cursor-pointer hover:bg-secondary/50 p-2 rounded\"\n                      >\n                        <input\n                          type=\"checkbox\"\n                          checked={selectedTools.includes(tool.name)}\n                          onChange={() => handleToolToggle(tool.name)}\n                          disabled={isCreating}\n                          className=\"mt-1 w-4 h-4\"\n                        />\n                        <div className=\"flex-1\">\n                          <div className=\"font-medium text-sm\">{tool.name}</div>\n                          <div className=\"text-xs text-muted-foreground\">{tool.description}</div>\n                        </div>\n                      </label>\n                    ))\n                  ) : (\n                    availableTools.map((tool) => (\n                      <label\n                        key={tool.name}\n                        className=\"flex items-start gap-2 cursor-pointer hover:bg-secondary/50 p-2 rounded\"\n                      >\n                        <input\n                          type=\"checkbox\"\n                          checked={disallowedTools.includes(tool.name)}\n                          onChange={() => {\n                            if (disallowedTools.includes(tool.name)) {\n                              setDisallowedTools(disallowedTools.filter(t => t !== tool.name));\n                            } else {\n                              setDisallowedTools([...disallowedTools, tool.name]);\n                            }\n                          }}\n                          disabled={isCreating}\n                          className=\"mt-1 w-4 h-4\"\n                        />\n                        <div className=\"flex-1\">\n                          <div className=\"font-medium text-sm\">{tool.name}</div>\n                          <div className=\"text-xs text-muted-foreground\">{tool.description}</div>\n                        </div>\n                      </label>\n                    ))\n                  )}\n                </div>\n              )}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {activeToolTab === 'allowed'\n                ? (selectedTools.length > 0\n                    ? `Selected: ${selectedTools.join(', ')}`\n                    : 'Leave empty to allow all tools. Select specific tools to restrict what the agent can use.')\n                : (disallowedTools.length > 0\n                    ? `Disallowed: ${disallowedTools.join(', ')}`\n                    : 'Leave empty to allow all tools. Select specific tools to explicitly block.')\n              }\n            </p>\n          </div>\n\n          {/* MCP Tools */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              MCP Server Tools (Optional)\n            </label>\n            <MCPToolsSelector\n              selectedMCPTools={selectedMCPTools}\n              onChange={setSelectedMCPTools}\n              disabled={isCreating}\n              directory={directory}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Select specific tools from your MCP servers. Leave empty to allow all MCP tools.\n            </p>\n          </div>\n\n          {/* Skills */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              Skills (Optional)\n            </label>\n            <SkillSelector\n              selectedSkills={selectedSkills}\n              onChange={setSelectedSkills}\n              disabled={isCreating}\n              directory={directory}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Select skills that this agent can use. Skills provide specialized capabilities and domain knowledge.\n            </p>\n          </div>\n\n          {/* Model */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              Model (Optional)\n            </label>\n            <select\n              value={model}\n              onChange={(e) => setModel(e.target.value as any)}\n              disabled={isCreating}\n              className=\"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50\"\n            >\n              <option value=\"\">Default (inherit from main agent)</option>\n              <option value=\"sonnet\">Sonnet (balanced)</option>\n              <option value=\"opus\">Opus (highest quality)</option>\n              <option value=\"haiku\">Haiku (fast & efficient)</option>\n            </select>\n          </div>\n\n          {/* System Prompt */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              System Prompt <span className=\"text-red-500\">*</span>\n            </label>\n            <textarea\n              value={systemPrompt}\n              onChange={(e) => setSystemPrompt(e.target.value)}\n              placeholder={`You are an expert SQL optimizer.\n\nYour responsibilities:\n- Analyze SQL queries for performance issues\n- Suggest index improvements\n- Identify N+1 query problems\n- Recommend query optimizations\n\nWhen reviewing queries:\n- Focus on execution plan efficiency\n- Check for missing indexes\n- Look for unnecessary JOINs\n- Suggest caching strategies\n\nAlways provide:\n1. Specific optimization recommendations\n2. Expected performance improvement\n3. Implementation steps`}\n              disabled={isCreating}\n              rows={12}\n              className=\"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 font-mono text-sm\"\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Define the agent's role, expertise, and behavior. Be specific and detailed.\n            </p>\n          </div>\n\n          {/* Input Fields */}\n          <div>\n            <div className=\"flex items-center justify-between mb-2\">\n              <label className=\"block text-sm font-medium\">\n                Input Fields (Optional)\n              </label>\n              <Button\n                type=\"button\"\n                size=\"sm\"\n                onClick={() => {\n                  setInputFields([...inputFields, {\n                    name: '',\n                    type: 'text',\n                    label: '',\n                    required: false,\n                  }]);\n                }}\n                disabled={isCreating}\n              >\n                + Add Field\n              </Button>\n            </div>\n\n            {inputFields.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground p-3 border border-dashed border-border rounded\">\n                No input fields defined. Click \"+ Add Field\" to add fields that users will fill when executing this agent.\n              </p>\n            ) : (\n              <div className=\"space-y-3 border border-border rounded p-3\">\n                {inputFields.map((field, index) => (\n                  <div key={index} className=\"border border-border rounded p-3 space-y-2\">\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Field Name *</label>\n                        <Input\n                          type=\"text\"\n                          value={field.name}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].name = e.target.value;\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"url\"\n                          disabled={isCreating}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Label *</label>\n                        <Input\n                          type=\"text\"\n                          value={field.label}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].label = e.target.value;\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"Website URL\"\n                          disabled={isCreating}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Type *</label>\n                        <select\n                          value={field.type}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].type = e.target.value as any;\n                            setInputFields(newFields);\n                          }}\n                          disabled={isCreating}\n                          className=\"w-full px-2 py-1 text-sm border border-border rounded-md bg-background\"\n                        >\n                          <option value=\"text\">Text</option>\n                          <option value=\"textarea\">Textarea</option>\n                          <option value=\"dropdown\">Dropdown</option>\n                          <option value=\"checkbox\">Checkbox</option>\n                          <option value=\"number\">Number</option>\n                        </select>\n                      </div>\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Placeholder</label>\n                        <Input\n                          type=\"text\"\n                          value={field.placeholder || ''}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].placeholder = e.target.value;\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"https://example.com\"\n                          disabled={isCreating}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                    </div>\n\n                    {field.type === 'dropdown' && (\n                      <div>\n                        <label className=\"block text-xs font-medium mb-1\">Options (comma-separated) *</label>\n                        <Input\n                          type=\"text\"\n                          value={field.options?.join(', ') || ''}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].options = e.target.value.split(',').map(o => o.trim()).filter(Boolean);\n                            setInputFields(newFields);\n                          }}\n                          placeholder=\"Basic, Detailed, Comprehensive\"\n                          disabled={isCreating}\n                          className=\"text-sm\"\n                        />\n                      </div>\n                    )}\n\n                    <div className=\"flex items-center justify-between\">\n                      <label className=\"flex items-center gap-2 text-xs\">\n                        <input\n                          type=\"checkbox\"\n                          checked={field.required || false}\n                          onChange={(e) => {\n                            const newFields = [...inputFields];\n                            newFields[index].required = e.target.checked;\n                            setInputFields(newFields);\n                          }}\n                          disabled={isCreating}\n                          className=\"w-3 h-3\"\n                        />\n                        Required\n                      </label>\n                      <Button\n                        type=\"button\"\n                        size=\"sm\"\n                        variant=\"secondary\"\n                        onClick={() => {\n                          setInputFields(inputFields.filter((_, i) => i !== index));\n                        }}\n                        disabled={isCreating}\n                      >\n                        Remove\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Define form fields that users will fill when executing this agent\n            </p>\n          </div>\n\n          {/* Output Schema */}\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">\n              Output Schema (Optional)\n            </label>\n            <textarea\n              value={outputSchema}\n              onChange={(e) => setOutputSchema(e.target.value)}\n              placeholder={`{\n  \"type\": \"object\",\n  \"properties\": {\n    \"summary\": {\n      \"type\": \"string\",\n      \"description\": \"Brief summary of findings\"\n    },\n    \"recommendations\": {\n      \"type\": \"array\",\n      \"items\": { \"type\": \"string\" }\n    }\n  }\n}`}\n              disabled={isCreating}\n              rows={8}\n              className=\"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 font-mono text-sm\"\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              JSON Schema defining the expected output format from this agent\n            </p>\n          </div>\n\n          {/* Agent Configuration Preview */}\n          {(selectedTools.length > 0 || Object.keys(selectedMCPTools).length > 0 || selectedSkills.length > 0) && (\n            <div className=\"border-2 border-primary/20 rounded-lg p-4 bg-primary/5\">\n              <h3 className=\"text-sm font-semibold mb-3 flex items-center gap-2\">\n                <span className=\"text-primary\">\ud83d\udc41\ufe0f</span>\n                Agent Configuration Preview\n              </h3>\n\n              <div className=\"space-y-3\">\n                {/* Skills Preview */}\n                {selectedSkills.length > 0 && (\n                  <div>\n                    <div className=\"flex items-center gap-1.5 mb-1.5\">\n                      <PuzzlePieceIcon className=\"h-3.5 w-3.5 text-green-600\" />\n                      <h4 className=\"font-semibold text-xs text-muted-foreground uppercase\">\n                        Skills ({selectedSkills.length})\n                      </h4>\n                    </div>\n                    <div className=\"flex flex-wrap gap-1\">\n                      {selectedSkills.map((skill, idx) => (\n                        <span key={idx} className=\"text-xs bg-green-50 text-green-700 border border-green-200 px-2 py-0.5 rounded font-medium\">\n                          {skill}\n                        </span>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* Built-in Tools Preview */}\n                {selectedTools.length > 0 && (\n                  <div>\n                    <div className=\"flex items-center gap-1.5 mb-1.5\">\n                      <CpuChipIcon className=\"h-3.5 w-3.5 text-blue-600\" />\n                      <h4 className=\"font-semibold text-xs text-muted-foreground uppercase\">\n                        Claude Built-in Tools ({selectedTools.length})\n                      </h4>\n                    </div>\n                    <div className=\"flex flex-wrap gap-1\">\n                      {selectedTools.map((tool, idx) => (\n                        <span key={idx} className=\"text-xs bg-blue-50 text-blue-700 border border-blue-200 px-2 py-0.5 rounded\">\n                          {tool}\n                        </span>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* MCP Tools Preview */}\n                {Object.keys(selectedMCPTools).length > 0 && (\n                  <div>\n                    <div className=\"flex items-center gap-1.5 mb-1.5\">\n                      <ServerIcon className=\"h-3.5 w-3.5 text-indigo-600\" />\n                      <h4 className=\"font-semibold text-xs text-muted-foreground uppercase\">\n                        MCP Tools ({Object.values(selectedMCPTools).reduce((sum, tools) => sum + tools.length, 0)} from {Object.keys(selectedMCPTools).length} server{Object.keys(selectedMCPTools).length !== 1 ? 's' : ''})\n                      </h4>\n                    </div>\n                    <div className=\"space-y-1.5\">\n                      {Object.entries(selectedMCPTools).map(([serverId, tools]) => (\n                        <div key={serverId}>\n                          <div className=\"text-xs font-medium text-indigo-600 mb-0.5\">{serverId}</div>\n                          <div className=\"flex flex-wrap gap-1\">\n                            {tools.map((tool, idx) => (\n                              <span key={idx} className=\"text-xs bg-indigo-50 text-indigo-700 border border-indigo-200 px-2 py-0.5 rounded\">\n                                {tool}\n                              </span>\n                            ))}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n        </form>\n\n        {/* Footer */}\n        <div className=\"p-4 border-t border-border flex justify-end gap-2\">\n          <Button\n            type=\"button\"\n            variant=\"secondary\"\n            onClick={onClose}\n            disabled={isCreating}\n          >\n            Cancel\n          </Button>\n          <Button\n            type=\"submit\"\n            onClick={handleSubmit}\n            disabled={isCreating || !name || !description || !systemPrompt}\n          >\n            {isCreating\n              ? (isEditMode ? 'Updating...' : 'Creating...')\n              : (isEditMode ? 'Update Agent' : 'Create Agent')}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nAgentCreatorForm.displayName = 'AgentCreatorForm';\n\nexport default AgentCreatorForm;\n",
        "last_modified": "2026-01-02T15:11:36.273881"
      },
      "task_intent": {
        "title": "Document Frontend React Components and Hooks",
        "description": "Add comprehensive JSDoc documentation to all React components and custom hooks in the frontend, including prop types, usage examples, component purposes, state management, and side effects.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T14:01:10.817080",
  "last_updated": "2026-01-02T14:22:14.530122"
}