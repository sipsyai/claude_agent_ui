{
  "file_path": "src/web/manager/components/MCPServersPage.tsx",
  "main_branch_history": [],
  "task_views": {
    "004-document-frontend-react-components-and-hooks": {
      "task_id": "004-document-frontend-react-components-and-hooks",
      "branch_point": {
        "commit_hash": "34a3f60da53773d90bd6579cb1cfd8417a1dd0b9",
        "content": "import React, { useState, useEffect } from 'react';\nimport * as api from '../services/api';\nimport { Card } from './ui/Card';\nimport { Button } from './ui/Button';\nimport { Input } from './ui/Input';\nimport { Select } from './ui/Select';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from './ui/Dialog';\nimport { ArrayEditor } from './ui/ArrayEditor';\nimport { KeyValueEditor } from './ui/KeyValueEditor';\nimport {\n  ServerIcon, PlusIcon, PencilIcon, TrashIcon, GlobeIcon, FolderIcon,\n  PlayCircleIcon, CheckCircleIcon, XCircleIcon, SpinnerIcon\n} from './ui/Icons';\n\ninterface MCPServersPageProps {\n  directory?: string;\n}\n\nconst MCPServersPage: React.FC<MCPServersPageProps> = ({ directory }) => {\n  const [servers, setServers] = useState<api.MCPServer[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Selection for bulk operations\n  const [selectedServers, setSelectedServers] = useState<Set<string>>(new Set());\n\n  // Modal states\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [modalMode, setModalMode] = useState<'create' | 'edit' | 'view'>('view');\n  const [selectedServer, setSelectedServer] = useState<api.MCPServer | null>(null);\n\n  // Quick Add mode\n  const [quickAddMode, setQuickAddMode] = useState(false);\n  const [cliCommand, setCliCommand] = useState('');\n\n  // Form state\n  const [formData, setFormData] = useState<{\n    name: string;\n    command: string;\n    args: string[];\n    env: Record<string, string>;\n    disabled?: boolean;\n    description?: string;\n  }>({\n    name: '',\n    command: '',\n    args: [],\n    env: {},\n    disabled: false,\n    description: '',\n  });\n\n  // Delete confirmation\n  const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false);\n  const [serverToDelete, setServerToDelete] = useState<api.MCPServer | null>(null);\n\n  // Bulk delete confirmation\n  const [bulkDeleteConfirmOpen, setBulkDeleteConfirmOpen] = useState(false);\n\n  // Test modal\n  const [testModalOpen, setTestModalOpen] = useState(false);\n  const [testResult, setTestResult] = useState<{ success: boolean; message: string; error?: string } | null>(null);\n  const [testing, setTesting] = useState(false);\n\n  // Import modal\n  const [importModalOpen, setImportModalOpen] = useState(false);\n  const [importMode, setImportMode] = useState<'merge' | 'overwrite'>('merge');\n  const [importing, setImporting] = useState(false);\n\n  // Toast notification\n  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);\n\n  useEffect(() => {\n    loadServers();\n  }, [directory]);\n\n  useEffect(() => {\n    if (toast) {\n      const timer = setTimeout(() => setToast(null), 5000);\n      return () => clearTimeout(timer);\n    }\n  }, [toast]);\n\n  const showToast = (message: string, type: 'success' | 'error') => {\n    setToast({ message, type });\n  };\n\n  const loadServers = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      const data = await api.getMCPServers(directory);\n      setServers(data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load MCP servers');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const parseCLICommand = (command: string) => {\n    // Format: <name> <command> [args...]\n    // Example: chrome-devtools npx chrome-devtools-mcp@latest\n    const parts = command.trim().split(/\\s+/);\n    if (parts.length < 2) return null;\n\n    const [name, cmd, ...args] = parts;\n    return {\n      name,\n      command: cmd,\n      args: args,\n      env: {},\n      disabled: false,\n      description: '',\n    };\n  };\n\n  const handleQuickAdd = () => {\n    const parsed = parseCLICommand(cliCommand);\n    if (!parsed || !parsed.name || !parsed.command) {\n      showToast('Invalid format. Use: <name> <command> [args...]', 'error');\n      return;\n    }\n    setFormData({\n      name: parsed.name,\n      command: parsed.command,\n      args: parsed.args || [],\n      env: parsed.env || {},\n      disabled: parsed.disabled || false,\n      description: parsed.description || '',\n    });\n    setQuickAddMode(false);\n  };\n\n  const handleCreate = () => {\n    setModalMode('create');\n    setQuickAddMode(false);\n    setCliCommand('');\n    setFormData({\n      name: '',\n      command: '',\n      args: [],\n      env: {},\n      disabled: false,\n      description: '',\n    });\n    setIsModalOpen(true);\n  };\n\n  const handleEdit = (server: api.MCPServer) => {\n    setModalMode('edit');\n    setSelectedServer(server);\n\n    // Extract config based on transport type\n    const config = server.config as api.MCPStdioServerConfig;\n    setFormData({\n      name: server.name,\n      command: config.command || '',\n      args: config.args || [],\n      env: config.env || {},\n      disabled: server.disabled || false,\n      description: '',\n    });\n    setIsModalOpen(true);\n  };\n\n  const handleView = (server: api.MCPServer) => {\n    setModalMode('view');\n    setSelectedServer(server);\n\n    // Extract config based on transport type\n    const config = server.config as api.MCPStdioServerConfig;\n    setFormData({\n      name: server.name,\n      command: config.command || '',\n      args: config.args || [],\n      env: config.env || {},\n      disabled: server.disabled || false,\n      description: '',\n    });\n    setIsModalOpen(true);\n  };\n\n  const handleSave = async () => {\n    try {\n      // Convert formData to MCPServerConfig\n      const config: api.MCPStdioServerConfig = {\n        type: 'stdio',\n        command: formData.command,\n        args: formData.args,\n        env: formData.env,\n        disabled: formData.disabled,\n      };\n\n      if (modalMode === 'create') {\n        await api.createMCPServer(formData.name, config, directory);\n        showToast('MCP server created successfully', 'success');\n      } else if (modalMode === 'edit' && selectedServer) {\n        await api.updateMCPServer(selectedServer.id, config, directory);\n        showToast('MCP server updated successfully', 'success');\n      }\n\n      await loadServers();\n      setIsModalOpen(false);\n      setSelectedServer(null);\n    } catch (err) {\n      showToast(err instanceof Error ? err.message : 'Failed to save MCP server', 'error');\n    }\n  };\n\n  const handleDeleteClick = (server: api.MCPServer) => {\n    setServerToDelete(server);\n    setDeleteConfirmOpen(true);\n  };\n\n  const handleDeleteConfirm = async () => {\n    if (!serverToDelete) return;\n\n    try {\n      await api.deleteMCPServer(serverToDelete.id, directory);\n      showToast('MCP server deleted successfully', 'success');\n      await loadServers();\n      setDeleteConfirmOpen(false);\n      setServerToDelete(null);\n    } catch (err) {\n      showToast(err instanceof Error ? err.message : 'Failed to delete MCP server', 'error');\n    }\n  };\n\n  const handleTest = async (server: api.MCPServer) => {\n    setSelectedServer(server);\n    setTesting(true);\n    setTestResult(null);\n    setTestModalOpen(true);\n\n    try {\n      const result = await api.testMCPServer(server.id, directory);\n      setTestResult(result);\n    } catch (err) {\n      setTestResult({\n        success: false,\n        message: 'Test failed',\n        error: err instanceof Error ? err.message : 'Unknown error',\n      });\n    } finally {\n      setTesting(false);\n    }\n  };\n\n  const handleToggle = async (server: api.MCPServer) => {\n    try {\n      const result = await api.toggleMCPServer(server.id, directory);\n      showToast(result.message, result.success ? 'success' : 'error');\n      if (result.success) {\n        await loadServers();\n      }\n    } catch (err) {\n      showToast(err instanceof Error ? err.message : 'Failed to toggle MCP server', 'error');\n    }\n  };\n\n  const handleLoadTools = async (server: api.MCPServer) => {\n    try {\n      const result = await api.refreshMCPServerTools(server.id, directory);\n      if (result.success) {\n        // Update the server with synced tools from Strapi\n        setServers(prev => prev.map(s =>\n          s.id === server.id\n            ? { ...s, mcpTools: result.tools }\n            : s\n        ));\n        showToast(`Synced ${result.toolsCount} tool(s) to Strapi`, 'success');\n      } else {\n        showToast(result.error || 'Failed to sync tools', 'error');\n      }\n    } catch (err) {\n      showToast(err instanceof Error ? err.message : 'Failed to sync tools', 'error');\n    }\n  };\n\n  const handleExport = async () => {\n    try {\n      const config = await api.exportMCPConfig(directory);\n      const dataStr = JSON.stringify(config, null, 2);\n      const dataBlob = new Blob([dataStr], { type: 'application/json' });\n      const url = URL.createObjectURL(dataBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = 'mcp-config-export.json';\n      link.click();\n      URL.revokeObjectURL(url);\n      showToast('Configuration exported successfully', 'success');\n    } catch (err) {\n      showToast(err instanceof Error ? err.message : 'Failed to export configuration', 'error');\n    }\n  };\n\n  const handleImport = () => {\n    setImportModalOpen(true);\n  };\n\n  const handleImportFile = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = async (e) => {\n      try {\n        setImporting(true);\n        const content = e.target?.result as string;\n        const config = JSON.parse(content);\n\n        await api.importMCPConfig(config, importMode, directory);\n        showToast(`Configuration imported successfully (${importMode})`, 'success');\n        await loadServers();\n        setImportModalOpen(false);\n      } catch (err) {\n        showToast(err instanceof Error ? err.message : 'Failed to import configuration', 'error');\n      } finally {\n        setImporting(false);\n      }\n    };\n    reader.readAsText(file);\n  };\n\n  const handleSelectAll = () => {\n    if (selectedServers.size === servers.length) {\n      setSelectedServers(new Set());\n    } else {\n      setSelectedServers(new Set(servers.map(s => s.id)));\n    }\n  };\n\n  const handleSelectServer = (server: api.MCPServer) => {\n    const newSelected = new Set(selectedServers);\n    if (newSelected.has(server.id)) {\n      newSelected.delete(server.id);\n    } else {\n      newSelected.add(server.id);\n    }\n    setSelectedServers(newSelected);\n  };\n\n  const handleBulkDelete = () => {\n    setBulkDeleteConfirmOpen(true);\n  };\n\n  const handleBulkDeleteConfirm = async () => {\n    const serversToDelete = servers.filter(s => selectedServers.has(s.id));\n    const serverIds = serversToDelete.map(s => s.id);\n\n    try {\n      const result = await api.bulkDeleteMCPServers(serverIds, directory);\n      showToast(result.message, result.failed > 0 ? 'error' : 'success');\n      await loadServers();\n      setSelectedServers(new Set());\n      setBulkDeleteConfirmOpen(false);\n    } catch (err) {\n      showToast(err instanceof Error ? err.message : 'Failed to bulk delete servers', 'error');\n    }\n  };\n\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <SpinnerIcon className=\"h-8 w-8 text-primary\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-64 gap-4\">\n        <p className=\"text-destructive\">{error}</p>\n        <Button onClick={loadServers}>Retry</Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Toast Notification */}\n      {toast && (\n        <div className={`fixed top-4 right-4 z-50 p-4 rounded-md shadow-lg ${\n          toast.type === 'success' ? 'bg-green-600' : 'bg-red-600'\n        } text-white`}>\n          {toast.message}\n        </div>\n      )}\n\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">MCP Servers</h2>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            Manage Model Context Protocol servers from .mcp.json in your project root\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button variant=\"secondary\" onClick={handleExport}>\n            Export\n          </Button>\n          <Button variant=\"secondary\" onClick={handleImport}>\n            Import\n          </Button>\n          <Button onClick={handleCreate}>\n            <PlusIcon className=\"h-4 w-4 mr-2\" />\n            Add Server\n          </Button>\n        </div>\n      </div>\n\n      {/* Bulk Actions */}\n      {selectedServers.size > 0 && (\n        <Card className=\"p-4 bg-secondary/50\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-sm font-medium\">\n              {selectedServers.size} server(s) selected\n            </span>\n            <div className=\"flex gap-2\">\n              <Button variant=\"secondary\" size=\"sm\" onClick={() => setSelectedServers(new Set())}>\n                Clear Selection\n              </Button>\n              <Button variant=\"destructive\" size=\"sm\" onClick={handleBulkDelete}>\n                <TrashIcon className=\"h-4 w-4 mr-2\" />\n                Delete Selected\n              </Button>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      {/* Selection Controls */}\n      {servers.length > 0 && (\n        <div className=\"flex items-center gap-2\">\n          <input\n            type=\"checkbox\"\n            checked={selectedServers.size === servers.length}\n            onChange={handleSelectAll}\n            className=\"rounded\"\n          />\n          <label className=\"text-sm\">Select All</label>\n        </div>\n      )}\n\n      {/* All MCP Servers */}\n      {servers.length > 0 && (\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center gap-2\">\n            <FolderIcon className=\"h-5 w-5 text-muted-foreground\" />\n            <h3 className=\"text-lg font-semibold\">MCP Servers</h3>\n            <span className=\"text-sm text-muted-foreground\">({servers.length})</span>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {servers.map((server) => (\n              <ServerCard\n                key={server.id}\n                server={server}\n                isSelected={selectedServers.has(server.id)}\n                onSelect={() => handleSelectServer(server)}\n                onView={() => handleView(server)}\n                onEdit={() => handleEdit(server)}\n                onDelete={() => handleDeleteClick(server)}\n                onTest={() => handleTest(server)}\n                onToggle={() => handleToggle(server)}\n                onLoadTools={() => handleLoadTools(server)}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Empty State */}\n      {servers.length === 0 && (\n        <Card className=\"p-12\">\n          <div className=\"flex flex-col items-center justify-center text-center\">\n            <ServerIcon className=\"h-12 w-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No MCP Servers Found</h3>\n            <p className=\"text-sm text-muted-foreground mb-6 max-w-md\">\n              You haven't configured any MCP servers yet. Add a server to extend Claude's capabilities.\n            </p>\n            <Button onClick={handleCreate}>\n              <PlusIcon className=\"h-4 w-4 mr-2\" />\n              Add Your First Server\n            </Button>\n          </div>\n        </Card>\n      )}\n\n      {/* Create/Edit Modal */}\n      {isModalOpen && (\n        <Dialog open={isModalOpen} onOpenChange={setIsModalOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>\n                {modalMode === 'create' ? 'Add MCP Server' : modalMode === 'edit' ? 'Edit MCP Server' : 'MCP Server Details'}\n              </DialogTitle>\n            </DialogHeader>\n        <div className=\"space-y-4\">\n          {/* Quick Add Toggle (only for create mode) */}\n          {modalMode === 'create' && (\n            <div className=\"flex items-center gap-2 pb-2 border-b\">\n              <button\n                onClick={() => setQuickAddMode(false)}\n                className={`px-3 py-1.5 text-sm rounded ${\n                  !quickAddMode\n                    ? 'bg-primary text-primary-foreground'\n                    : 'bg-secondary text-secondary-foreground hover:bg-secondary/80'\n                }`}\n              >\n                Manual\n              </button>\n              <button\n                onClick={() => setQuickAddMode(true)}\n                className={`px-3 py-1.5 text-sm rounded ${\n                  quickAddMode\n                    ? 'bg-primary text-primary-foreground'\n                    : 'bg-secondary text-secondary-foreground hover:bg-secondary/80'\n                }`}\n              >\n                Quick Add (CLI)\n              </button>\n            </div>\n          )}\n\n          {/* Quick Add Mode */}\n          {modalMode === 'create' && quickAddMode && (\n            <div className=\"space-y-4\">\n              <div>\n                <p className=\"text-sm text-muted-foreground mb-2\">\n                  Enter a Claude CLI command to quickly add a server:\n                </p>\n                <code className=\"block text-xs bg-secondary p-2 rounded mb-3\">\n                  Format: &lt;name&gt; &lt;command&gt; [args...]\n                  <br />\n                  Example: chrome-devtools npx chrome-devtools-mcp@latest\n                </code>\n                <Input\n                  value={cliCommand}\n                  onChange={(e) => setCliCommand(e.target.value)}\n                  placeholder=\"chrome-devtools npx chrome-devtools-mcp@latest\"\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter') {\n                      handleQuickAdd();\n                    }\n                  }}\n                />\n              </div>\n              <Button onClick={handleQuickAdd} className=\"w-full\">\n                Parse & Fill Form\n              </Button>\n            </div>\n          )}\n\n          {/* Manual Mode / Edit Mode / View Mode */}\n          {(!quickAddMode || modalMode !== 'create') && (\n            <>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Server Name</label>\n                <Input\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"my-mcp-server\"\n                  disabled={modalMode === 'view'}\n                />\n              </div>\n\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">Command</label>\n            <Input\n              value={formData.command}\n              onChange={(e) => setFormData({ ...formData, command: e.target.value })}\n              placeholder=\"node\"\n              disabled={modalMode === 'view'}\n            />\n          </div>\n\n          <ArrayEditor\n            label=\"Arguments\"\n            value={formData.args}\n            onChange={(args) => setFormData({ ...formData, args })}\n            placeholder=\"/path/to/server.js\"\n            disabled={modalMode === 'view'}\n          />\n\n          <KeyValueEditor\n            label=\"Environment Variables\"\n            value={formData.env || {}}\n            onChange={(env) => setFormData({ ...formData, env })}\n            disabled={modalMode === 'view'}\n          />\n\n          <div>\n                <label className=\"block text-sm font-medium mb-2\">Description (optional)</label>\n                <Input\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  placeholder=\"Brief description\"\n                  disabled={modalMode === 'view'}\n                />\n              </div>\n\n              <div className=\"flex gap-2 justify-end pt-4\">\n                <Button variant=\"secondary\" onClick={() => setIsModalOpen(false)}>\n                  {modalMode === 'view' ? 'Close' : 'Cancel'}\n                </Button>\n                {modalMode !== 'view' && (\n                  <Button onClick={handleSave}>\n                    {modalMode === 'create' ? 'Create' : 'Save Changes'}\n                  </Button>\n                )}\n              </div>\n            </>\n          )}\n        </div>\n          </DialogContent>\n        </Dialog>\n      )}\n\n      {/* Delete Confirmation */}\n      {deleteConfirmOpen && (\n        <Dialog open={deleteConfirmOpen} onOpenChange={setDeleteConfirmOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Delete MCP Server</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <p>\n                Are you sure you want to delete <strong>{serverToDelete?.name}</strong>?\n                This action cannot be undone.\n              </p>\n              <div className=\"flex gap-2 justify-end\">\n                <Button variant=\"secondary\" onClick={() => setDeleteConfirmOpen(false)}>\n                  Cancel\n                </Button>\n                <Button variant=\"destructive\" onClick={handleDeleteConfirm}>\n                  Delete\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n\n      {/* Bulk Delete Confirmation */}\n      {bulkDeleteConfirmOpen && (\n        <Dialog open={bulkDeleteConfirmOpen} onOpenChange={setBulkDeleteConfirmOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Delete Multiple Servers</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <p>\n                Are you sure you want to delete {selectedServers.size} server(s)?\n                This action cannot be undone.\n              </p>\n              <div className=\"flex gap-2 justify-end\">\n                <Button variant=\"secondary\" onClick={() => setBulkDeleteConfirmOpen(false)}>\n                  Cancel\n                </Button>\n                <Button variant=\"destructive\" onClick={handleBulkDeleteConfirm}>\n                  Delete All\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n\n      {/* Test Modal */}\n      {testModalOpen && (\n        <Dialog open={testModalOpen} onOpenChange={setTestModalOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Test MCP Server</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-2\">\n                <ServerIcon className=\"h-5 w-5\" />\n                <span className=\"font-medium\">{selectedServer?.name}</span>\n              </div>\n\n              {testing && (\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <SpinnerIcon className=\"h-5 w-5\" />\n                  <span>Testing MCP server...</span>\n                </div>\n              )}\n\n              {!testing && testResult && (\n                <div className={`p-4 rounded-md ${\n                  testResult.success ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'\n                }`}>\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    {testResult.success ? (\n                      <CheckCircleIcon className=\"h-5 w-5\" />\n                    ) : (\n                      <XCircleIcon className=\"h-5 w-5\" />\n                    )}\n                    <span className=\"font-medium\">{testResult.message}</span>\n                  </div>\n                  {testResult.error && (\n                    <p className=\"text-sm mt-2\">{testResult.error}</p>\n                  )}\n                </div>\n              )}\n\n              <div className=\"flex gap-2 justify-end\">\n                <Button variant=\"secondary\" onClick={() => setTestModalOpen(false)}>\n                  Close\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n\n      {/* Import Modal */}\n      {importModalOpen && (\n        <Dialog open={importModalOpen} onOpenChange={setImportModalOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Import MCP Configuration</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Import Mode</label>\n                <Select\n                  value={importMode}\n                  onChange={(e) => setImportMode(e.target.value as 'merge' | 'overwrite')}\n                  disabled={importing}\n                >\n                  <option value=\"merge\">Merge (keep existing servers)</option>\n                  <option value=\"overwrite\">Overwrite (replace all)</option>\n                </Select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Select File</label>\n                <input\n                  type=\"file\"\n                  accept=\".json\"\n                  onChange={handleImportFile}\n                  disabled={importing}\n                  className=\"block w-full text-sm text-muted-foreground\n                    file:mr-4 file:py-2 file:px-4\n                    file:rounded-md file:border-0\n                    file:text-sm file:font-semibold\n                    file:bg-primary file:text-primary-foreground\n                    hover:file:bg-primary/90\"\n                />\n              </div>\n\n              {importing && (\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <SpinnerIcon className=\"h-5 w-5\" />\n                  <span>Importing configuration...</span>\n                </div>\n              )}\n\n              <div className=\"flex gap-2 justify-end\">\n                <Button variant=\"secondary\" onClick={() => setImportModalOpen(false)} disabled={importing}>\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n    </div>\n  );\n};\n\n// Server Card Component\ninterface ServerCardProps {\n  server: api.MCPServer;\n  isSelected: boolean;\n  onSelect: () => void;\n  onView: () => void;\n  onEdit: () => void;\n  onDelete: () => void;\n  onTest: () => void;\n  onToggle: () => void;\n  onLoadTools: () => void;\n}\n\nconst ServerCard: React.FC<ServerCardProps> = ({\n  server,\n  isSelected,\n  onSelect,\n  onView,\n  onEdit,\n  onDelete,\n  onTest,\n  onToggle,\n  onLoadTools,\n}) => {\n  const [showTools, setShowTools] = React.useState(false);\n\n  return (\n    <Card className={`p-4 hover:border-primary cursor-pointer transition-colors ${\n      isSelected ? 'border-primary bg-primary/5' : ''\n    } ${server.disabled ? 'opacity-60' : ''}`}>\n      <div className=\"flex items-start gap-3\">\n        <input\n          type=\"checkbox\"\n          checked={isSelected}\n          onChange={onSelect}\n          onClick={(e) => e.stopPropagation()}\n          className=\"mt-1 rounded\"\n        />\n        <div className=\"flex-1 min-w-0\" onClick={onView}>\n          <div className=\"flex items-start gap-2\">\n            <ServerIcon className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n            <div className=\"flex-1 min-w-0\">\n              <div className=\"flex items-center gap-2 flex-wrap\">\n                <h4 className=\"font-semibold truncate\">{server.name}</h4>\n                {server.disabled && (\n                  <span className=\"text-xs px-2 py-0.5 bg-gray-200 text-gray-600 rounded\">Disabled</span>\n                )}\n                {server.mcpTools && server.mcpTools.length > 0 && (\n                  <span className=\"text-xs px-2 py-0.5 bg-blue-100 text-blue-600 rounded\">\n                    {server.mcpTools.length} {server.mcpTools.length === 1 ? 'tool' : 'tools'}\n                  </span>\n                )}\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-1 truncate\">\n                {server.command}\n              </p>\n              {server.description && (\n                <p className=\"text-xs text-muted-foreground mt-2 line-clamp-2\">\n                  {server.description}\n                </p>\n              )}\n              {server.mcpTools && server.mcpTools.length > 0 && (\n                <div className=\"mt-2\">\n                  <button\n                    onClick={(e) => { e.stopPropagation(); setShowTools(!showTools); }}\n                    className=\"text-xs text-primary hover:underline\"\n                  >\n                    {showTools ? '\u25bc' : '\u25b6'} {server.mcpTools.length} tool(s)\n                  </button>\n                  {showTools && (\n                    <div className=\"mt-1 pl-4 space-y-1\">\n                      {server.mcpTools.map((tool: api.MCPToolType) => (\n                        <div key={tool.id} className=\"text-xs\">\n                          <span className=\"font-mono text-primary\">mcp__{server.name}__{tool.name}</span>\n                          {tool.description && (\n                            <span className=\"text-muted-foreground ml-2\">- {tool.description}</span>\n                          )}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n      <div className=\"flex gap-1 mt-3 pt-3 border-t\">\n        <button\n          onClick={(e) => { e.stopPropagation(); onToggle(); }}\n          className={`flex-1 p-1 rounded text-xs ${\n            server.disabled\n              ? 'hover:bg-green-100 text-green-600'\n              : 'hover:bg-gray-200 text-gray-600'\n          }`}\n          title={server.disabled ? 'Enable' : 'Disable'}\n        >\n          <CheckCircleIcon className=\"h-4 w-4 mx-auto\" />\n        </button>\n        <button\n          onClick={(e) => { e.stopPropagation(); onLoadTools(); }}\n          className=\"flex-1 p-1 hover:bg-blue-100 text-blue-600 rounded text-xs\"\n          title=\"Sync Tools to Strapi\"\n        >\n          <ServerIcon className=\"h-4 w-4 mx-auto\" />\n        </button>\n        <button\n          onClick={(e) => { e.stopPropagation(); onTest(); }}\n          className=\"flex-1 p-1 hover:bg-green-100 text-green-600 rounded text-xs\"\n          title=\"Test\"\n        >\n          <PlayCircleIcon className=\"h-4 w-4 mx-auto\" />\n        </button>\n        <button\n          onClick={(e) => { e.stopPropagation(); onEdit(); }}\n          className=\"flex-1 p-1 hover:bg-secondary rounded text-xs\"\n          title=\"Edit\"\n        >\n          <PencilIcon className=\"h-4 w-4 mx-auto\" />\n        </button>\n        <button\n          onClick={(e) => { e.stopPropagation(); onDelete(); }}\n          className=\"flex-1 p-1 hover:bg-destructive/10 text-destructive rounded text-xs\"\n          title=\"Delete\"\n        >\n          <TrashIcon className=\"h-4 w-4 mx-auto\" />\n        </button>\n      </div>\n    </Card>\n  );\n};\n\nexport default MCPServersPage;\n",
        "timestamp": "2026-01-02T14:22:14.293924"
      },
      "worktree_state": {
        "content": "/**\n * MCPServersPage - Model Context Protocol Server Management\n *\n * A comprehensive page component for managing Model Context Protocol (MCP) servers in the Claude Manager UI.\n * Provides server listing, configuration, testing, tool synchronization, and import/export functionality.\n * MCP servers extend Claude's capabilities by exposing tools through a standardized protocol.\n *\n * ## Features\n *\n * - **Server Listing**: Grid-based display of all configured MCP servers with status and metadata\n * - **CRUD Operations**: Create, Read, Update, Delete MCP server configurations\n * - **Quick Add Mode**: CLI-style command parsing for rapid server setup\n * - **Server Testing**: Test MCP server connectivity and tool availability\n * - **Tool Synchronization**: Load and sync tools from MCP servers to Strapi backend\n * - **Bulk Operations**: Multi-select servers and bulk delete functionality\n * - **Import/Export**: Export/import .mcp.json configuration with merge or overwrite modes\n * - **Enable/Disable**: Toggle server enabled/disabled state without deletion\n * - **Toast Notifications**: User feedback for all operations (success/error messages)\n * - **Directory Integration**: Automatic server loading based on selected directory\n *\n * ## Server Listing\n *\n * Displays MCP servers in a responsive grid layout (1 column mobile, 2 columns tablet, 3 columns desktop).\n * Each server card shows:\n *\n * - **Header**: Server name, disabled badge (if disabled), tool count badge\n * - **Command Display**: Truncated command preview\n * - **Description**: Optional server description (line-clamp-2)\n * - **Tools Section**: Collapsible list of tools with format `mcp__{server}__{tool}` and descriptions\n * - **Selection Checkbox**: For bulk operations (positioned top-left)\n * - **Action Buttons** (5 icons):\n *   * Enable/Disable (CheckCircleIcon, green when disabled, gray when enabled)\n *   * Sync Tools (ServerIcon, blue, syncs tools to Strapi)\n *   * Test (PlayCircleIcon, green, tests server connectivity)\n *   * Edit (PencilIcon, secondary color)\n *   * Delete (TrashIcon, destructive color)\n *\n * ## CRUD Operations\n *\n * ### Create\n * Two creation modes available via \"Add Server\" button:\n *\n * 1. **Manual Mode** (Default):\n *    - Form-based input for all server configuration fields\n *    - Fields: Server Name, Command, Arguments (array), Environment Variables (key-value), Description\n *    - ArrayEditor for arguments, KeyValueEditor for environment variables\n *    - Validates and saves via `api.createMCPServer()`\n *\n * 2. **Quick Add Mode** (CLI Tab):\n *    - Paste CLI command: `<name> <command> [args...]`\n *    - Example: `chrome-devtools npx chrome-devtools-mcp@latest`\n *    - Parses command via `parseCLICommand()` and pre-fills form\n *    - Switches to Manual mode with populated fields for review\n *\n * ### Read\n * - Automatic loading on mount via `loadServers()`\n * - Reloads when `directory` prop changes\n * - Displays all servers from `.mcp.json` in project root\n * - Shows count in header (\"MCP Servers (N)\")\n *\n * ### Update (Edit)\n * - Click Edit button on any server card\n * - Opens modal with pre-populated form fields\n * - Extracts stdio config (command, args, env, disabled)\n * - Saves changes via `api.updateMCPServer()`\n *\n * ### Delete\n * - Single Delete: Click delete icon \u2192 confirmation dialog \u2192 `api.deleteMCPServer()`\n * - Bulk Delete: Select multiple servers \u2192 \"Delete Selected\" \u2192 confirmation \u2192 `api.bulkDeleteMCPServers()`\n *\n * ## Quick Add Mode\n *\n * CLI-style command parsing for rapid server configuration:\n *\n * ### Input Format\n * - Pattern: `<name> <command> [arg1] [arg2] ...`\n * - Example: `chrome-devtools npx chrome-devtools-mcp@latest`\n * - Splits on whitespace: first part = name, second = command, rest = args\n *\n * ### Parsing Workflow\n * 1. User enters CLI command in input field\n * 2. Clicks \"Parse & Fill Form\" button (or presses Enter)\n * 3. `parseCLICommand()` validates format (minimum 2 parts required)\n * 4. Creates formData object: `{ name, command, args, env: {}, disabled: false }`\n * 5. Switches to Manual mode with pre-populated fields\n * 6. User can review/modify before saving\n *\n * ### Validation\n * - Minimum 2 parts required (name + command)\n * - Shows error toast if format is invalid\n * - Empty args array if no arguments provided\n *\n * ## Server Testing\n *\n * Test MCP server connectivity and functionality:\n *\n * ### Test Workflow\n * 1. User clicks Test button on server card\n * 2. Test modal opens with server name display\n * 3. API call: `api.testMCPServer(serverId, directory)`\n * 4. Shows spinner during test execution\n * 5. Displays result with color-coded feedback:\n *    - Success: Green background, CheckCircleIcon\n *    - Failure: Red background, XCircleIcon, error message\n * 6. User closes modal\n *\n * ### Test Result Interface\n * - `success`: Boolean indicating test outcome\n * - `message`: Human-readable result message\n * - `error`: Optional error details on failure\n *\n * ## Tool Synchronization\n *\n * Load and sync tools from MCP servers to Strapi backend:\n *\n * ### Sync Workflow\n * 1. User clicks Sync Tools button (ServerIcon, blue)\n * 2. API call: `api.refreshMCPServerTools(serverId, directory)`\n * 3. Backend discovers tools from MCP server\n * 4. Creates/updates MCPTool records in Strapi\n * 5. Returns synced tools array and count\n * 6. Updates server card with new tool count and list\n * 7. Shows success toast: \"Synced N tool(s) to Strapi\"\n *\n * ### Tool Display\n * - Badge shows total tool count\n * - Collapsible section with arrow indicator (\u25b6/\u25bc)\n * - Each tool: `mcp__{serverName}__{toolName}` with description\n * - Displayed in monospace font with primary color\n *\n * ## Bulk Operations\n *\n * Multi-select functionality for batch server management:\n *\n * ### Selection Workflow\n * 1. User clicks \"Select All\" checkbox to select/deselect all servers\n * 2. Or clicks individual server checkboxes\n * 3. Selected servers tracked in Set (selectedServers state)\n * 4. Bulk Actions card appears when selectedServers.size > 0\n *\n * ### Bulk Actions Card\n * - Displays count: \"N server(s) selected\"\n * - Actions:\n *   * Clear Selection: Resets selectedServers to empty Set\n *   * Delete Selected: Opens bulk delete confirmation dialog\n *\n * ### Bulk Delete\n * 1. User clicks \"Delete Selected\" button\n * 2. Confirmation dialog shows count to delete\n * 3. On confirm: `api.bulkDeleteMCPServers(serverIds, directory)`\n * 4. Shows toast with result (success count, failure count)\n * 5. Reloads server list\n * 6. Clears selection\n *\n * ## Import/Export Configuration\n *\n * Export and import .mcp.json configuration files:\n *\n * ### Export Workflow\n * 1. User clicks \"Export\" button in header\n * 2. API call: `api.exportMCPConfig(directory)`\n * 3. Returns entire .mcp.json configuration\n * 4. Creates JSON blob and triggers browser download\n * 5. Downloads as \"mcp-config-export.json\"\n * 6. Shows success toast\n *\n * ### Import Workflow\n * 1. User clicks \"Import\" button \u2192 Import modal opens\n * 2. User selects import mode (dropdown):\n *    - Merge: Keep existing servers, add new ones (default)\n *    - Overwrite: Replace all existing servers\n * 3. User selects JSON file via file input\n * 4. FileReader reads file content\n * 5. JSON.parse() parses configuration\n * 6. API call: `api.importMCPConfig(config, mode, directory)`\n * 7. Backend processes import based on mode\n * 8. Reloads server list\n * 9. Shows success toast with mode\n * 10. Modal closes\n *\n * ### Import Modes\n * - **merge**: Adds new servers, updates existing by name, preserves others\n * - **overwrite**: Deletes all existing servers, replaces with imported config\n *\n * ## Enable/Disable Toggle\n *\n * Toggle server state without deletion:\n *\n * ### Toggle Workflow\n * 1. User clicks Enable/Disable button (CheckCircleIcon)\n * 2. Icon color: Green when disabled (to enable), Gray when enabled (to disable)\n * 3. API call: `api.toggleMCPServer(serverId, directory)`\n * 4. Backend updates server.disabled property in .mcp.json\n * 5. Returns result with success flag and message\n * 6. Shows toast with result message\n * 7. Reloads server list if successful\n * 8. Disabled servers display with opacity-60 and \"Disabled\" badge\n *\n * ## Toast Notifications\n *\n * User feedback for all operations:\n *\n * ### Toast Display\n * - Fixed position: top-right corner (top-4 right-4)\n * - Auto-dismiss: 5-second timeout (useEffect cleanup)\n * - Color-coded: Green background for success, Red for error\n * - Z-index: 50 for overlay visibility\n * - Shows operation result messages\n *\n * ### Toast Types\n * - **success**: Green background, white text, success messages\n * - **error**: Red background, white text, error messages\n *\n * ## State Management\n *\n * The component manages ten categories of state:\n *\n * 1. **Server List State** (`servers`, `loading`, `error`):\n *    - Fetched from API on mount and directory changes\n *    - Loading spinner during fetch\n *    - Error display with retry button\n *\n * 2. **Selection State** (`selectedServers`):\n *    - Set of server IDs for bulk operations\n *    - Updated via checkbox interactions\n *    - Cleared after bulk operations\n *\n * 3. **Modal State** (`isModalOpen`, `modalMode`, `selectedServer`):\n *    - Controls create/edit/view modal visibility\n *    - Mode: 'create' | 'edit' | 'view'\n *    - Tracks server being viewed/edited\n *\n * 4. **Quick Add State** (`quickAddMode`, `cliCommand`):\n *    - Toggle between Manual and Quick Add tabs\n *    - Stores CLI command string\n *\n * 5. **Form State** (`formData`):\n *    - Server configuration: name, command, args, env, disabled, description\n *    - Updated via form inputs\n *    - Reset on modal close\n *\n * 6. **Delete State** (`deleteConfirmOpen`, `serverToDelete`):\n *    - Single server delete confirmation\n *    - Tracks server pending deletion\n *\n * 7. **Bulk Delete State** (`bulkDeleteConfirmOpen`):\n *    - Bulk delete confirmation dialog\n *    - Uses selectedServers for server IDs\n *\n * 8. **Test State** (`testModalOpen`, `testResult`, `testing`):\n *    - Test modal visibility\n *    - Test execution status (loading)\n *    - Test result object (success, message, error)\n *\n * 9. **Import State** (`importModalOpen`, `importMode`, `importing`):\n *    - Import modal visibility\n *    - Import mode selection (merge/overwrite)\n *    - Import execution status (loading)\n *\n * 10. **Toast State** (`toast`):\n *     - Notification message and type\n *     - Auto-cleared after 5 seconds\n *\n * ## Directory Integration\n *\n * The component automatically loads servers based on the `directory` prop:\n *\n * 1. **Initial Load**: Fetches servers from API on mount\n * 2. **Directory Changes**: Reloads servers when directory prop changes (useEffect dependency)\n * 3. **API Integration**: Uses `api.getMCPServers(directory)` for data fetching\n * 4. **Error Handling**: Sets error state, displays error message with retry button\n * 5. **Loading States**: Shows spinner during fetch operations\n *\n * ## Styling Behavior\n *\n * The component uses Tailwind CSS classes for styling:\n *\n * - **Container**: `space-y-6` for vertical spacing between sections\n * - **Header**: `flex items-center justify-between` with title and action buttons\n * - **Grid Layout**: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`\n * - **Server Cards**: `hover:border-primary transition-colors` for interactive feedback\n * - **Disabled Servers**: `opacity-60` for visual indication\n * - **Selected Servers**: `border-primary bg-primary/5` for selection highlight\n * - **Badges**: Color-coded (gray for disabled, blue for tools)\n * - **Toast**: Fixed top-right with green/red backgrounds\n * - **Modal Tabs**: Active tab with primary background, inactive with secondary\n * - **Action Buttons**: Color-coded icons (green=test/enable, blue=sync, red=delete, gray=edit)\n * - **Empty State**: Centered layout with icon, heading, description, and CTA button\n * - **Loading State**: Centered spinner with primary color\n * - **Error State**: Centered error message with retry button\n *\n * @example\n * // Basic usage in ManagerApp dashboard phase\n * import MCPServersPage from './components/MCPServersPage';\n *\n * function ManagerApp() {\n *   const [activeView, setActiveView] = useState<DashboardView>('MCP Servers');\n *   const [directory, setDirectory] = useState('/path/to/project');\n *\n *   return (\n *     <Layout sidebarProps={{ activeView, onNavigate: setActiveView }}>\n *       {activeView === 'MCP Servers' && (\n *         <MCPServersPage directory={directory} />\n *       )}\n *     </Layout>\n *   );\n * }\n *\n * @example\n * // Understanding server creation workflow (Quick Add mode)\n * // 1. User clicks \"Add Server\" button\n * //    \u2192 handleCreate() opens modal in 'create' mode\n * // 2. User switches to \"Quick Add (CLI)\" tab\n * //    \u2192 setQuickAddMode(true)\n * // 3. User enters CLI command: \"chrome-devtools npx chrome-devtools-mcp@latest\"\n * //    \u2192 Updates cliCommand state\n * // 4. User presses Enter or clicks \"Parse & Fill Form\"\n * //    \u2192 parseCLICommand() parses: { name: \"chrome-devtools\", command: \"npx\", args: [\"chrome-devtools-mcp@latest\"] }\n * //    \u2192 setFormData() with parsed values\n * //    \u2192 setQuickAddMode(false) switches to Manual mode\n * // 5. User reviews pre-filled form, modifies if needed\n * // 6. User clicks \"Create\" button\n * //    \u2192 handleSave() calls api.createMCPServer()\n * //    \u2192 Shows success toast\n * //    \u2192 loadServers() refreshes list\n * //    \u2192 Modal closes\n *\n * @example\n * // Understanding server testing workflow\n * // 1. User clicks Test button (PlayCircleIcon) on server card\n * //    \u2192 handleTest(server) called\n * //    \u2192 setSelectedServer(server), setTestModalOpen(true), setTesting(true)\n * // 2. Test modal opens showing server name and spinner\n * //    \u2192 api.testMCPServer(serverId, directory) executes\n * // 3. Test completes (success or failure)\n * //    \u2192 setTestResult({ success, message, error })\n * //    \u2192 setTesting(false)\n * // 4. Result displays with color-coded background\n * //    \u2192 Success: Green with CheckCircleIcon\n * //    \u2192 Failure: Red with XCircleIcon and error details\n * // 5. User clicks \"Close\" button\n * //    \u2192 setTestModalOpen(false)\n *\n * @example\n * // Understanding tool synchronization workflow\n * // 1. User clicks Sync Tools button (ServerIcon, blue) on server card\n * //    \u2192 handleLoadTools(server) called\n * // 2. API discovers tools from MCP server\n * //    \u2192 api.refreshMCPServerTools(serverId, directory)\n * // 3. Backend creates/updates MCPTool records in Strapi\n * //    \u2192 Returns { success, tools, toolsCount }\n * // 4. Component updates server with synced tools\n * //    \u2192 setServers(prev => prev.map(...)) updates mcpTools array\n * // 5. Server card updates to show tool count badge and tool list\n * //    \u2192 Badge: \"5 tools\"\n * //    \u2192 Collapsible section with tool names and descriptions\n * // 6. Success toast displays\n * //    \u2192 \"Synced 5 tool(s) to Strapi\"\n *\n * @example\n * // Understanding bulk delete workflow\n * // 1. User selects multiple servers via checkboxes\n * //    \u2192 handleSelectServer() adds IDs to selectedServers Set\n * // 2. Bulk Actions card appears\n * //    \u2192 Shows count: \"3 server(s) selected\"\n * // 3. User clicks \"Delete Selected\" button\n * //    \u2192 handleBulkDelete() opens confirmation dialog\n * // 4. Confirmation dialog shows: \"Delete 3 server(s)?\"\n * // 5. User confirms deletion\n * //    \u2192 handleBulkDeleteConfirm() extracts server IDs from Set\n * //    \u2192 api.bulkDeleteMCPServers(serverIds, directory)\n * // 6. Backend processes deletions, returns result\n * //    \u2192 { message, deleted: 3, failed: 0 }\n * // 7. Shows toast with result\n * //    \u2192 \"Successfully deleted 3 server(s)\"\n * // 8. Reloads server list and clears selection\n * //    \u2192 loadServers(), setSelectedServers(new Set())\n */\n\nimport React, { useState, useEffect } from 'react';\nimport * as api from '../services/api';\nimport { Card } from './ui/Card';\nimport { Button } from './ui/Button';\nimport { Input } from './ui/Input';\nimport { Select } from './ui/Select';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from './ui/Dialog';\nimport { ArrayEditor } from './ui/ArrayEditor';\nimport { KeyValueEditor } from './ui/KeyValueEditor';\nimport {\n  ServerIcon, PlusIcon, PencilIcon, TrashIcon, GlobeIcon, FolderIcon,\n  PlayCircleIcon, CheckCircleIcon, XCircleIcon, SpinnerIcon\n} from './ui/Icons';\n\n/**\n * Props for the MCPServersPage component.\n *\n * @property {string} [directory] - Optional directory path for filtering MCP servers (e.g., \"/path/to/project\").\n *                                   When provided, loads servers from .mcp.json in that directory's root.\n *                                   All CRUD operations are scoped to this directory.\n */\ninterface MCPServersPageProps {\n  directory?: string;\n}\n\nconst MCPServersPage: React.FC<MCPServersPageProps> = ({ directory }) => {\n  const [servers, setServers] = useState<api.MCPServer[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Selection for bulk operations\n  const [selectedServers, setSelectedServers] = useState<Set<string>>(new Set());\n\n  // Modal states\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [modalMode, setModalMode] = useState<'create' | 'edit' | 'view'>('view');\n  const [selectedServer, setSelectedServer] = useState<api.MCPServer | null>(null);\n\n  // Quick Add mode\n  const [quickAddMode, setQuickAddMode] = useState(false);\n  const [cliCommand, setCliCommand] = useState('');\n\n  // Form state\n  const [formData, setFormData] = useState<{\n    name: string;\n    command: string;\n    args: string[];\n    env: Record<string, string>;\n    disabled?: boolean;\n    description?: string;\n  }>({\n    name: '',\n    command: '',\n    args: [],\n    env: {},\n    disabled: false,\n    description: '',\n  });\n\n  // Delete confirmation\n  const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false);\n  const [serverToDelete, setServerToDelete] = useState<api.MCPServer | null>(null);\n\n  // Bulk delete confirmation\n  const [bulkDeleteConfirmOpen, setBulkDeleteConfirmOpen] = useState(false);\n\n  // Test modal\n  const [testModalOpen, setTestModalOpen] = useState(false);\n  const [testResult, setTestResult] = useState<{ success: boolean; message: string; error?: string } | null>(null);\n  const [testing, setTesting] = useState(false);\n\n  // Import modal\n  const [importModalOpen, setImportModalOpen] = useState(false);\n  const [importMode, setImportMode] = useState<'merge' | 'overwrite'>('merge');\n  const [importing, setImporting] = useState(false);\n\n  // Toast notification\n  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);\n\n  useEffect(() => {\n    loadServers();\n  }, [directory]);\n\n  /**\n   * Auto-dismiss toast notification after 5 seconds.\n   *\n   * Sets up a timeout to clear the toast state after 5000ms. Cleanup function\n   * clears the timeout if the toast state changes or component unmounts.\n   */\n  useEffect(() => {\n    if (toast) {\n      const timer = setTimeout(() => setToast(null), 5000);\n      return () => clearTimeout(timer);\n    }\n  }, [toast]);\n\n  /**\n   * Displays a toast notification with the specified message and type.\n   *\n   * Toast appears in the top-right corner with color-coded background (green for success,\n   * red for error). Auto-dismisses after 5 seconds via useEffect hook.\n   *\n   * @internal\n   * @param {string} message - The notification message to display\n   * @param {'success' | 'error'} type - The notification type determining background color\n   */\n  const showToast = (message: string, type: 'success' | 'error') => {\n    setToast({ message, type });\n  };\n\n  /**\n   * Loads MCP servers from the API based on the current directory.\n   *\n   * Fetches servers from the backend API (.mcp.json in directory root) and updates the local state.\n   * Shows loading spinner during fetch and handles errors with error message display.\n   *\n   * @internal\n   * @async\n   * @returns {Promise<void>}\n   */\n  const loadServers = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      const data = await api.getMCPServers(directory);\n      setServers(data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load MCP servers');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  /**\n   * Parses a CLI-style command string into server configuration object.\n   *\n   * Expected format: `<name> <command> [args...]`\n   * Example: `chrome-devtools npx chrome-devtools-mcp@latest`\n   *\n   * Splits command on whitespace and extracts:\n   * - First part: Server name\n   * - Second part: Command executable\n   * - Remaining parts: Command arguments (optional)\n   *\n   * @internal\n   * @param {string} command - The CLI command string to parse\n   * @returns {Object|null} Parsed configuration object or null if invalid format\n   * @returns {string} return.name - Server name\n   * @returns {string} return.command - Command executable\n   * @returns {string[]} return.args - Command arguments array\n   * @returns {Record<string, string>} return.env - Empty environment variables object\n   * @returns {boolean} return.disabled - Disabled flag (always false)\n   * @returns {string} return.description - Empty description string\n   */\n  const parseCLICommand = (command: string) => {\n    // Format: <name> <command> [args...]\n    // Example: chrome-devtools npx chrome-devtools-mcp@latest\n    const parts = command.trim().split(/\\s+/);\n    if (parts.length < 2) return null;\n\n    const [name, cmd, ...args] = parts;\n    return {\n      name,\n      command: cmd,\n      args: args,\n      env: {},\n      disabled: false,\n      description: '',\n    };\n  };\n\n  /**\n   * Handles Quick Add form submission by parsing CLI command and populating form fields.\n   *\n   * Validates CLI command format (minimum 2 parts: name and command), parses into\n   * configuration object, and switches to Manual mode with pre-populated form.\n   * Shows error toast if format is invalid.\n   *\n   * @internal\n   */\n  const handleQuickAdd = () => {\n    const parsed = parseCLICommand(cliCommand);\n    if (!parsed || !parsed.name || !parsed.command) {\n      showToast('Invalid format. Use: <name> <command> [args...]', 'error');\n      return;\n    }\n    setFormData({\n      name: parsed.name,\n      command: parsed.command,\n      args: parsed.args || [],\n      env: parsed.env || {},\n      disabled: parsed.disabled || false,\n      description: parsed.description || '',\n    });\n    setQuickAddMode(false);\n  };\n\n  /**\n   * Opens the create server modal with empty form fields.\n   *\n   * Resets all form state (formData, quickAddMode, cliCommand), sets modal mode to 'create',\n   * and opens the modal dialog.\n   *\n   * @internal\n   */\n  const handleCreate = () => {\n    setModalMode('create');\n    setQuickAddMode(false);\n    setCliCommand('');\n    setFormData({\n      name: '',\n      command: '',\n      args: [],\n      env: {},\n      disabled: false,\n      description: '',\n    });\n    setIsModalOpen(true);\n  };\n\n  /**\n   * Opens the edit server modal with pre-populated form fields.\n   *\n   * Extracts server configuration from stdio config (command, args, env, disabled),\n   * sets modal mode to 'edit', and opens the modal dialog with populated form.\n   *\n   * @internal\n   * @param {api.MCPServer} server - The server to edit\n   */\n  const handleEdit = (server: api.MCPServer) => {\n    setModalMode('edit');\n    setSelectedServer(server);\n\n    // Extract config based on transport type\n    const config = server.config as api.MCPStdioServerConfig;\n    setFormData({\n      name: server.name,\n      command: config.command || '',\n      args: config.args || [],\n      env: config.env || {},\n      disabled: server.disabled || false,\n      description: '',\n    });\n    setIsModalOpen(true);\n  };\n\n  /**\n   * Opens the view server modal with read-only form fields.\n   *\n   * Similar to handleEdit but sets modal mode to 'view', which disables all form inputs.\n   * Used for displaying server details without allowing edits.\n   *\n   * @internal\n   * @param {api.MCPServer} server - The server to view\n   */\n  const handleView = (server: api.MCPServer) => {\n    setModalMode('view');\n    setSelectedServer(server);\n\n    // Extract config based on transport type\n    const config = server.config as api.MCPStdioServerConfig;\n    setFormData({\n      name: server.name,\n      command: config.command || '',\n      args: config.args || [],\n      env: config.env || {},\n      disabled: server.disabled || false,\n      description: '',\n    });\n    setIsModalOpen(true);\n  };\n\n  /**\n   * Saves server configuration (create or update) via API.\n   *\n   * Converts formData to MCPStdioServerConfig and calls appropriate API method based on\n   * modal mode ('create' or 'edit'). Shows success toast, reloads server list, and closes\n   * modal on success. Shows error toast on failure.\n   *\n   * @internal\n   * @async\n   */\n  const handleSave = async () => {\n    try {\n      // Convert formData to MCPServerConfig\n      const config: api.MCPStdioServerConfig = {\n        type: 'stdio',\n        command: formData.command,\n        args: formData.args,\n        env: formData.env,\n        disabled: formData.disabled,\n      };\n\n      if (modalMode === 'create') {\n        await api.createMCPServer(formData.name, config, directory);\n        showToast('MCP server created successfully', 'success');\n      } else if (modalMode === 'edit' && selectedServer) {\n        await api.updateMCPServer(selectedServer.id, config, directory);\n        showToast('MCP server updated successfully', 'success');\n      }\n\n      await loadServers();\n      setIsModalOpen(false);\n      setSelectedServer(null);\n    } catch (err) {\n      showToast(err instanceof Error ? err.message : 'Failed to save MCP server', 'error');\n    }\n  };\n\n  /**\n   * Opens the delete confirmation dialog for a single server.\n   *\n   * Sets serverToDelete state and opens the confirmation dialog. Actual deletion\n   * occurs in handleDeleteConfirm after user confirmation.\n   *\n   * @internal\n   * @param {api.MCPServer} server - The server to delete\n   */\n  const handleDeleteClick = (server: api.MCPServer) => {\n    setServerToDelete(server);\n    setDeleteConfirmOpen(true);\n  };\n\n  /**\n   * Confirms and executes single server deletion.\n   *\n   * Deletes the server via API, shows success toast, reloads server list, and closes\n   * the confirmation dialog. Shows error toast on failure.\n   *\n   * @internal\n   * @async\n   */\n  const handleDeleteConfirm = async () => {\n    if (!serverToDelete) return;\n\n    try {\n      await api.deleteMCPServer(serverToDelete.id, directory);\n      showToast('MCP server deleted successfully', 'success');\n      await loadServers();\n      setDeleteConfirmOpen(false);\n      setServerToDelete(null);\n    } catch (err) {\n      showToast(err instanceof Error ? err.message : 'Failed to delete MCP server', 'error');\n    }\n  };\n\n  /**\n   * Tests MCP server connectivity and functionality.\n   *\n   * Opens test modal, shows spinner during test execution, and displays color-coded\n   * result (green for success, red for failure with error details). Updates testResult\n   * state with API response.\n   *\n   * @internal\n   * @async\n   * @param {api.MCPServer} server - The server to test\n   */\n  const handleTest = async (server: api.MCPServer) => {\n    setSelectedServer(server);\n    setTesting(true);\n    setTestResult(null);\n    setTestModalOpen(true);\n\n    try {\n      const result = await api.testMCPServer(server.id, directory);\n      setTestResult(result);\n    } catch (err) {\n      setTestResult({\n        success: false,\n        message: 'Test failed',\n        error: err instanceof Error ? err.message : 'Unknown error',\n      });\n    } finally {\n      setTesting(false);\n    }\n  };\n\n  /**\n   * Toggles MCP server enabled/disabled state.\n   *\n   * Calls API to toggle server.disabled property in .mcp.json. Shows toast with result\n   * message and reloads server list on success. Disabled servers display with opacity-60.\n   *\n   * @internal\n   * @async\n   * @param {api.MCPServer} server - The server to toggle\n   */\n  const handleToggle = async (server: api.MCPServer) => {\n    try {\n      const result = await api.toggleMCPServer(server.id, directory);\n      showToast(result.message, result.success ? 'success' : 'error');\n      if (result.success) {\n        await loadServers();\n      }\n    } catch (err) {\n      showToast(err instanceof Error ? err.message : 'Failed to toggle MCP server', 'error');\n    }\n  };\n\n  /**\n   * Loads and synchronizes tools from MCP server to Strapi backend.\n   *\n   * Calls API to discover tools from MCP server, creates/updates MCPTool records in Strapi,\n   * and updates server card with synced tool list and count. Shows success toast with\n   * tool count.\n   *\n   * @internal\n   * @async\n   * @param {api.MCPServer} server - The server to load tools from\n   */\n  const handleLoadTools = async (server: api.MCPServer) => {\n    try {\n      const result = await api.refreshMCPServerTools(server.id, directory);\n      if (result.success) {\n        // Update the server with synced tools from Strapi\n        setServers(prev => prev.map(s =>\n          s.id === server.id\n            ? { ...s, mcpTools: result.tools }\n            : s\n        ));\n        showToast(`Synced ${result.toolsCount} tool(s) to Strapi`, 'success');\n      } else {\n        showToast(result.error || 'Failed to sync tools', 'error');\n      }\n    } catch (err) {\n      showToast(err instanceof Error ? err.message : 'Failed to sync tools', 'error');\n    }\n  };\n\n  /**\n   * Exports MCP configuration to JSON file.\n   *\n   * Fetches entire .mcp.json configuration from API, creates JSON blob, and triggers\n   * browser download as \"mcp-config-export.json\". Shows success toast on completion.\n   *\n   * @internal\n   * @async\n   */\n  const handleExport = async () => {\n    try {\n      const config = await api.exportMCPConfig(directory);\n      const dataStr = JSON.stringify(config, null, 2);\n      const dataBlob = new Blob([dataStr], { type: 'application/json' });\n      const url = URL.createObjectURL(dataBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = 'mcp-config-export.json';\n      link.click();\n      URL.revokeObjectURL(url);\n      showToast('Configuration exported successfully', 'success');\n    } catch (err) {\n      showToast(err instanceof Error ? err.message : 'Failed to export configuration', 'error');\n    }\n  };\n\n  /**\n   * Opens the import configuration modal.\n   *\n   * Sets importModalOpen to true, allowing user to select import mode (merge/overwrite)\n   * and JSON file for import.\n   *\n   * @internal\n   */\n  const handleImport = () => {\n    setImportModalOpen(true);\n  };\n\n  /**\n   * Handles file selection for configuration import.\n   *\n   * Reads selected JSON file via FileReader, parses configuration, and calls API to\n   * import with selected mode (merge or overwrite). Shows success toast with mode,\n   * reloads server list, and closes modal. Shows error toast on parse or API failure.\n   *\n   * @internal\n   * @param {React.ChangeEvent<HTMLInputElement>} event - File input change event\n   */\n  const handleImportFile = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = async (e) => {\n      try {\n        setImporting(true);\n        const content = e.target?.result as string;\n        const config = JSON.parse(content);\n\n        await api.importMCPConfig(config, importMode, directory);\n        showToast(`Configuration imported successfully (${importMode})`, 'success');\n        await loadServers();\n        setImportModalOpen(false);\n      } catch (err) {\n        showToast(err instanceof Error ? err.message : 'Failed to import configuration', 'error');\n      } finally {\n        setImporting(false);\n      }\n    };\n    reader.readAsText(file);\n  };\n\n  /**\n   * Toggles selection of all servers.\n   *\n   * If all servers are selected, clears selection. Otherwise, selects all servers by\n   * adding all server IDs to selectedServers Set.\n   *\n   * @internal\n   */\n  const handleSelectAll = () => {\n    if (selectedServers.size === servers.length) {\n      setSelectedServers(new Set());\n    } else {\n      setSelectedServers(new Set(servers.map(s => s.id)));\n    }\n  };\n\n  /**\n   * Toggles selection of a single server.\n   *\n   * If server is already selected, removes from Set. Otherwise, adds to Set.\n   * Triggers Bulk Actions card to appear/disappear based on selection count.\n   *\n   * @internal\n   * @param {api.MCPServer} server - The server to toggle selection for\n   */\n  const handleSelectServer = (server: api.MCPServer) => {\n    const newSelected = new Set(selectedServers);\n    if (newSelected.has(server.id)) {\n      newSelected.delete(server.id);\n    } else {\n      newSelected.add(server.id);\n    }\n    setSelectedServers(newSelected);\n  };\n\n  /**\n   * Opens the bulk delete confirmation dialog.\n   *\n   * Sets bulkDeleteConfirmOpen to true, showing confirmation for deleting all\n   * selected servers.\n   *\n   * @internal\n   */\n  const handleBulkDelete = () => {\n    setBulkDeleteConfirmOpen(true);\n  };\n\n  /**\n   * Confirms and executes bulk server deletion.\n   *\n   * Filters servers by selectedServers Set, extracts server IDs, and calls API to\n   * delete all selected servers. Shows toast with result (success count, failure count),\n   * reloads server list, clears selection, and closes confirmation dialog.\n   *\n   * @internal\n   * @async\n   */\n  const handleBulkDeleteConfirm = async () => {\n    const serversToDelete = servers.filter(s => selectedServers.has(s.id));\n    const serverIds = serversToDelete.map(s => s.id);\n\n    try {\n      const result = await api.bulkDeleteMCPServers(serverIds, directory);\n      showToast(result.message, result.failed > 0 ? 'error' : 'success');\n      await loadServers();\n      setSelectedServers(new Set());\n      setBulkDeleteConfirmOpen(false);\n    } catch (err) {\n      showToast(err instanceof Error ? err.message : 'Failed to bulk delete servers', 'error');\n    }\n  };\n\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <SpinnerIcon className=\"h-8 w-8 text-primary\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-64 gap-4\">\n        <p className=\"text-destructive\">{error}</p>\n        <Button onClick={loadServers}>Retry</Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Toast Notification */}\n      {toast && (\n        <div className={`fixed top-4 right-4 z-50 p-4 rounded-md shadow-lg ${\n          toast.type === 'success' ? 'bg-green-600' : 'bg-red-600'\n        } text-white`}>\n          {toast.message}\n        </div>\n      )}\n\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">MCP Servers</h2>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            Manage Model Context Protocol servers from .mcp.json in your project root\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button variant=\"secondary\" onClick={handleExport}>\n            Export\n          </Button>\n          <Button variant=\"secondary\" onClick={handleImport}>\n            Import\n          </Button>\n          <Button onClick={handleCreate}>\n            <PlusIcon className=\"h-4 w-4 mr-2\" />\n            Add Server\n          </Button>\n        </div>\n      </div>\n\n      {/* Bulk Actions */}\n      {selectedServers.size > 0 && (\n        <Card className=\"p-4 bg-secondary/50\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-sm font-medium\">\n              {selectedServers.size} server(s) selected\n            </span>\n            <div className=\"flex gap-2\">\n              <Button variant=\"secondary\" size=\"sm\" onClick={() => setSelectedServers(new Set())}>\n                Clear Selection\n              </Button>\n              <Button variant=\"destructive\" size=\"sm\" onClick={handleBulkDelete}>\n                <TrashIcon className=\"h-4 w-4 mr-2\" />\n                Delete Selected\n              </Button>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      {/* Selection Controls */}\n      {servers.length > 0 && (\n        <div className=\"flex items-center gap-2\">\n          <input\n            type=\"checkbox\"\n            checked={selectedServers.size === servers.length}\n            onChange={handleSelectAll}\n            className=\"rounded\"\n          />\n          <label className=\"text-sm\">Select All</label>\n        </div>\n      )}\n\n      {/* All MCP Servers */}\n      {servers.length > 0 && (\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center gap-2\">\n            <FolderIcon className=\"h-5 w-5 text-muted-foreground\" />\n            <h3 className=\"text-lg font-semibold\">MCP Servers</h3>\n            <span className=\"text-sm text-muted-foreground\">({servers.length})</span>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {servers.map((server) => (\n              <ServerCard\n                key={server.id}\n                server={server}\n                isSelected={selectedServers.has(server.id)}\n                onSelect={() => handleSelectServer(server)}\n                onView={() => handleView(server)}\n                onEdit={() => handleEdit(server)}\n                onDelete={() => handleDeleteClick(server)}\n                onTest={() => handleTest(server)}\n                onToggle={() => handleToggle(server)}\n                onLoadTools={() => handleLoadTools(server)}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Empty State */}\n      {servers.length === 0 && (\n        <Card className=\"p-12\">\n          <div className=\"flex flex-col items-center justify-center text-center\">\n            <ServerIcon className=\"h-12 w-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No MCP Servers Found</h3>\n            <p className=\"text-sm text-muted-foreground mb-6 max-w-md\">\n              You haven't configured any MCP servers yet. Add a server to extend Claude's capabilities.\n            </p>\n            <Button onClick={handleCreate}>\n              <PlusIcon className=\"h-4 w-4 mr-2\" />\n              Add Your First Server\n            </Button>\n          </div>\n        </Card>\n      )}\n\n      {/* Create/Edit Modal */}\n      {isModalOpen && (\n        <Dialog open={isModalOpen} onOpenChange={setIsModalOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>\n                {modalMode === 'create' ? 'Add MCP Server' : modalMode === 'edit' ? 'Edit MCP Server' : 'MCP Server Details'}\n              </DialogTitle>\n            </DialogHeader>\n        <div className=\"space-y-4\">\n          {/* Quick Add Toggle (only for create mode) */}\n          {modalMode === 'create' && (\n            <div className=\"flex items-center gap-2 pb-2 border-b\">\n              <button\n                onClick={() => setQuickAddMode(false)}\n                className={`px-3 py-1.5 text-sm rounded ${\n                  !quickAddMode\n                    ? 'bg-primary text-primary-foreground'\n                    : 'bg-secondary text-secondary-foreground hover:bg-secondary/80'\n                }`}\n              >\n                Manual\n              </button>\n              <button\n                onClick={() => setQuickAddMode(true)}\n                className={`px-3 py-1.5 text-sm rounded ${\n                  quickAddMode\n                    ? 'bg-primary text-primary-foreground'\n                    : 'bg-secondary text-secondary-foreground hover:bg-secondary/80'\n                }`}\n              >\n                Quick Add (CLI)\n              </button>\n            </div>\n          )}\n\n          {/* Quick Add Mode */}\n          {modalMode === 'create' && quickAddMode && (\n            <div className=\"space-y-4\">\n              <div>\n                <p className=\"text-sm text-muted-foreground mb-2\">\n                  Enter a Claude CLI command to quickly add a server:\n                </p>\n                <code className=\"block text-xs bg-secondary p-2 rounded mb-3\">\n                  Format: &lt;name&gt; &lt;command&gt; [args...]\n                  <br />\n                  Example: chrome-devtools npx chrome-devtools-mcp@latest\n                </code>\n                <Input\n                  value={cliCommand}\n                  onChange={(e) => setCliCommand(e.target.value)}\n                  placeholder=\"chrome-devtools npx chrome-devtools-mcp@latest\"\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter') {\n                      handleQuickAdd();\n                    }\n                  }}\n                />\n              </div>\n              <Button onClick={handleQuickAdd} className=\"w-full\">\n                Parse & Fill Form\n              </Button>\n            </div>\n          )}\n\n          {/* Manual Mode / Edit Mode / View Mode */}\n          {(!quickAddMode || modalMode !== 'create') && (\n            <>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Server Name</label>\n                <Input\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"my-mcp-server\"\n                  disabled={modalMode === 'view'}\n                />\n              </div>\n\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">Command</label>\n            <Input\n              value={formData.command}\n              onChange={(e) => setFormData({ ...formData, command: e.target.value })}\n              placeholder=\"node\"\n              disabled={modalMode === 'view'}\n            />\n          </div>\n\n          <ArrayEditor\n            label=\"Arguments\"\n            value={formData.args}\n            onChange={(args) => setFormData({ ...formData, args })}\n            placeholder=\"/path/to/server.js\"\n            disabled={modalMode === 'view'}\n          />\n\n          <KeyValueEditor\n            label=\"Environment Variables\"\n            value={formData.env || {}}\n            onChange={(env) => setFormData({ ...formData, env })}\n            disabled={modalMode === 'view'}\n          />\n\n          <div>\n                <label className=\"block text-sm font-medium mb-2\">Description (optional)</label>\n                <Input\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  placeholder=\"Brief description\"\n                  disabled={modalMode === 'view'}\n                />\n              </div>\n\n              <div className=\"flex gap-2 justify-end pt-4\">\n                <Button variant=\"secondary\" onClick={() => setIsModalOpen(false)}>\n                  {modalMode === 'view' ? 'Close' : 'Cancel'}\n                </Button>\n                {modalMode !== 'view' && (\n                  <Button onClick={handleSave}>\n                    {modalMode === 'create' ? 'Create' : 'Save Changes'}\n                  </Button>\n                )}\n              </div>\n            </>\n          )}\n        </div>\n          </DialogContent>\n        </Dialog>\n      )}\n\n      {/* Delete Confirmation */}\n      {deleteConfirmOpen && (\n        <Dialog open={deleteConfirmOpen} onOpenChange={setDeleteConfirmOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Delete MCP Server</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <p>\n                Are you sure you want to delete <strong>{serverToDelete?.name}</strong>?\n                This action cannot be undone.\n              </p>\n              <div className=\"flex gap-2 justify-end\">\n                <Button variant=\"secondary\" onClick={() => setDeleteConfirmOpen(false)}>\n                  Cancel\n                </Button>\n                <Button variant=\"destructive\" onClick={handleDeleteConfirm}>\n                  Delete\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n\n      {/* Bulk Delete Confirmation */}\n      {bulkDeleteConfirmOpen && (\n        <Dialog open={bulkDeleteConfirmOpen} onOpenChange={setBulkDeleteConfirmOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Delete Multiple Servers</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <p>\n                Are you sure you want to delete {selectedServers.size} server(s)?\n                This action cannot be undone.\n              </p>\n              <div className=\"flex gap-2 justify-end\">\n                <Button variant=\"secondary\" onClick={() => setBulkDeleteConfirmOpen(false)}>\n                  Cancel\n                </Button>\n                <Button variant=\"destructive\" onClick={handleBulkDeleteConfirm}>\n                  Delete All\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n\n      {/* Test Modal */}\n      {testModalOpen && (\n        <Dialog open={testModalOpen} onOpenChange={setTestModalOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Test MCP Server</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-2\">\n                <ServerIcon className=\"h-5 w-5\" />\n                <span className=\"font-medium\">{selectedServer?.name}</span>\n              </div>\n\n              {testing && (\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <SpinnerIcon className=\"h-5 w-5\" />\n                  <span>Testing MCP server...</span>\n                </div>\n              )}\n\n              {!testing && testResult && (\n                <div className={`p-4 rounded-md ${\n                  testResult.success ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'\n                }`}>\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    {testResult.success ? (\n                      <CheckCircleIcon className=\"h-5 w-5\" />\n                    ) : (\n                      <XCircleIcon className=\"h-5 w-5\" />\n                    )}\n                    <span className=\"font-medium\">{testResult.message}</span>\n                  </div>\n                  {testResult.error && (\n                    <p className=\"text-sm mt-2\">{testResult.error}</p>\n                  )}\n                </div>\n              )}\n\n              <div className=\"flex gap-2 justify-end\">\n                <Button variant=\"secondary\" onClick={() => setTestModalOpen(false)}>\n                  Close\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n\n      {/* Import Modal */}\n      {importModalOpen && (\n        <Dialog open={importModalOpen} onOpenChange={setImportModalOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Import MCP Configuration</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Import Mode</label>\n                <Select\n                  value={importMode}\n                  onChange={(e) => setImportMode(e.target.value as 'merge' | 'overwrite')}\n                  disabled={importing}\n                >\n                  <option value=\"merge\">Merge (keep existing servers)</option>\n                  <option value=\"overwrite\">Overwrite (replace all)</option>\n                </Select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Select File</label>\n                <input\n                  type=\"file\"\n                  accept=\".json\"\n                  onChange={handleImportFile}\n                  disabled={importing}\n                  className=\"block w-full text-sm text-muted-foreground\n                    file:mr-4 file:py-2 file:px-4\n                    file:rounded-md file:border-0\n                    file:text-sm file:font-semibold\n                    file:bg-primary file:text-primary-foreground\n                    hover:file:bg-primary/90\"\n                />\n              </div>\n\n              {importing && (\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <SpinnerIcon className=\"h-5 w-5\" />\n                  <span>Importing configuration...</span>\n                </div>\n              )}\n\n              <div className=\"flex gap-2 justify-end\">\n                <Button variant=\"secondary\" onClick={() => setImportModalOpen(false)} disabled={importing}>\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n    </div>\n  );\n};\n\n/**\n * ServerCard - MCP Server Display Card\n *\n * Individual server card component displaying MCP server information, tools, and action buttons.\n * Supports selection for bulk operations, collapsible tool list, and five action buttons\n * (enable/disable, sync tools, test, edit, delete).\n *\n * ## Features\n *\n * - **Server Display**: Name, command, description, status badges (disabled, tool count)\n * - **Selection**: Checkbox for bulk operations\n * - **Tools Display**: Collapsible section with tool list (format: `mcp__{server}__{tool}`)\n * - **Action Buttons**: 5 icon buttons with hover effects and tooltips\n * - **Status Indicators**: Disabled badge, tool count badge, opacity-60 when disabled\n * - **Interactive**: Click card to view details, click checkbox for selection\n *\n * ## Props\n *\n * @property {api.MCPServer} server - The MCP server object to display\n * @property {boolean} isSelected - Selection state for bulk operations (highlights card border)\n * @property {() => void} onSelect - Callback for checkbox selection toggle\n * @property {() => void} onView - Callback for card click to view server details\n * @property {() => void} onEdit - Callback for edit button click\n * @property {() => void} onDelete - Callback for delete button click\n * @property {() => void} onTest - Callback for test button click\n * @property {() => void} onToggle - Callback for enable/disable toggle button\n * @property {() => void} onLoadTools - Callback for sync tools button click\n */\ninterface ServerCardProps {\n  server: api.MCPServer;\n  isSelected: boolean;\n  onSelect: () => void;\n  onView: () => void;\n  onEdit: () => void;\n  onDelete: () => void;\n  onTest: () => void;\n  onToggle: () => void;\n  onLoadTools: () => void;\n}\n\n/**\n * ServerCard component renders an individual MCP server card.\n *\n * Displays server information (name, command, description, tools) with interactive\n * elements (checkbox, action buttons, collapsible tool list). Card appearance changes\n * based on selection state (border highlight) and disabled state (opacity-60).\n *\n * @param {ServerCardProps} props - Component props\n * @returns {JSX.Element} Rendered server card\n */\nconst ServerCard: React.FC<ServerCardProps> = ({\n  server,\n  isSelected,\n  onSelect,\n  onView,\n  onEdit,\n  onDelete,\n  onTest,\n  onToggle,\n  onLoadTools,\n}) => {\n  const [showTools, setShowTools] = React.useState(false);\n\n  return (\n    <Card className={`p-4 hover:border-primary cursor-pointer transition-colors ${\n      isSelected ? 'border-primary bg-primary/5' : ''\n    } ${server.disabled ? 'opacity-60' : ''}`}>\n      <div className=\"flex items-start gap-3\">\n        <input\n          type=\"checkbox\"\n          checked={isSelected}\n          onChange={onSelect}\n          onClick={(e) => e.stopPropagation()}\n          className=\"mt-1 rounded\"\n        />\n        <div className=\"flex-1 min-w-0\" onClick={onView}>\n          <div className=\"flex items-start gap-2\">\n            <ServerIcon className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n            <div className=\"flex-1 min-w-0\">\n              <div className=\"flex items-center gap-2 flex-wrap\">\n                <h4 className=\"font-semibold truncate\">{server.name}</h4>\n                {server.disabled && (\n                  <span className=\"text-xs px-2 py-0.5 bg-gray-200 text-gray-600 rounded\">Disabled</span>\n                )}\n                {server.mcpTools && server.mcpTools.length > 0 && (\n                  <span className=\"text-xs px-2 py-0.5 bg-blue-100 text-blue-600 rounded\">\n                    {server.mcpTools.length} {server.mcpTools.length === 1 ? 'tool' : 'tools'}\n                  </span>\n                )}\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-1 truncate\">\n                {server.command}\n              </p>\n              {server.description && (\n                <p className=\"text-xs text-muted-foreground mt-2 line-clamp-2\">\n                  {server.description}\n                </p>\n              )}\n              {server.mcpTools && server.mcpTools.length > 0 && (\n                <div className=\"mt-2\">\n                  <button\n                    onClick={(e) => { e.stopPropagation(); setShowTools(!showTools); }}\n                    className=\"text-xs text-primary hover:underline\"\n                  >\n                    {showTools ? '\u25bc' : '\u25b6'} {server.mcpTools.length} tool(s)\n                  </button>\n                  {showTools && (\n                    <div className=\"mt-1 pl-4 space-y-1\">\n                      {server.mcpTools.map((tool: api.MCPToolType) => (\n                        <div key={tool.id} className=\"text-xs\">\n                          <span className=\"font-mono text-primary\">mcp__{server.name}__{tool.name}</span>\n                          {tool.description && (\n                            <span className=\"text-muted-foreground ml-2\">- {tool.description}</span>\n                          )}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n      <div className=\"flex gap-1 mt-3 pt-3 border-t\">\n        <button\n          onClick={(e) => { e.stopPropagation(); onToggle(); }}\n          className={`flex-1 p-1 rounded text-xs ${\n            server.disabled\n              ? 'hover:bg-green-100 text-green-600'\n              : 'hover:bg-gray-200 text-gray-600'\n          }`}\n          title={server.disabled ? 'Enable' : 'Disable'}\n        >\n          <CheckCircleIcon className=\"h-4 w-4 mx-auto\" />\n        </button>\n        <button\n          onClick={(e) => { e.stopPropagation(); onLoadTools(); }}\n          className=\"flex-1 p-1 hover:bg-blue-100 text-blue-600 rounded text-xs\"\n          title=\"Sync Tools to Strapi\"\n        >\n          <ServerIcon className=\"h-4 w-4 mx-auto\" />\n        </button>\n        <button\n          onClick={(e) => { e.stopPropagation(); onTest(); }}\n          className=\"flex-1 p-1 hover:bg-green-100 text-green-600 rounded text-xs\"\n          title=\"Test\"\n        >\n          <PlayCircleIcon className=\"h-4 w-4 mx-auto\" />\n        </button>\n        <button\n          onClick={(e) => { e.stopPropagation(); onEdit(); }}\n          className=\"flex-1 p-1 hover:bg-secondary rounded text-xs\"\n          title=\"Edit\"\n        >\n          <PencilIcon className=\"h-4 w-4 mx-auto\" />\n        </button>\n        <button\n          onClick={(e) => { e.stopPropagation(); onDelete(); }}\n          className=\"flex-1 p-1 hover:bg-destructive/10 text-destructive rounded text-xs\"\n          title=\"Delete\"\n        >\n          <TrashIcon className=\"h-4 w-4 mx-auto\" />\n        </button>\n      </div>\n    </Card>\n  );\n};\n\nServerCard.displayName = 'ServerCard';\nMCPServersPage.displayName = 'MCPServersPage';\n\nexport default MCPServersPage;\n",
        "last_modified": "2026-01-02T15:11:36.281296"
      },
      "task_intent": {
        "title": "Document Frontend React Components and Hooks",
        "description": "Add comprehensive JSDoc documentation to all React components and custom hooks in the frontend, including prop types, usage examples, component purposes, state management, and side effects.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T14:01:11.284832",
  "last_updated": "2026-01-02T14:22:14.831595"
}