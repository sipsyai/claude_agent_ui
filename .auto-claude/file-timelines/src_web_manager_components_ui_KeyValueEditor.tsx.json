{
  "file_path": "src/web/manager/components/ui/KeyValueEditor.tsx",
  "main_branch_history": [],
  "task_views": {
    "004-document-frontend-react-components-and-hooks": {
      "task_id": "004-document-frontend-react-components-and-hooks",
      "branch_point": {
        "commit_hash": "34a3f60da53773d90bd6579cb1cfd8417a1dd0b9",
        "content": "import React from 'react';\nimport { Input } from './Input';\nimport { Button } from './Button';\nimport { PlusIcon, TrashIcon } from './Icons';\n\ninterface KeyValueEditorProps {\n  value: Record<string, string>;\n  onChange: (value: Record<string, string>) => void;\n  disabled?: boolean;\n  label?: string;\n  keyPlaceholder?: string;\n  valuePlaceholder?: string;\n}\n\nexport const KeyValueEditor: React.FC<KeyValueEditorProps> = ({\n  value,\n  onChange,\n  disabled = false,\n  label,\n  keyPlaceholder = 'KEY',\n  valuePlaceholder = 'value',\n}) => {\n  const entries = Object.entries(value);\n\n  const handleAdd = () => {\n    onChange({ ...value, '': '' });\n  };\n\n  const handleRemove = (key: string) => {\n    const newValue = { ...value };\n    delete newValue[key];\n    onChange(newValue);\n  };\n\n  const handleKeyChange = (oldKey: string, newKey: string) => {\n    const newValue = { ...value };\n    const val = newValue[oldKey];\n    delete newValue[oldKey];\n    newValue[newKey] = val;\n    onChange(newValue);\n  };\n\n  const handleValueChange = (key: string, newVal: string) => {\n    onChange({ ...value, [key]: newVal });\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      {label && <label className=\"block text-sm font-medium mb-2\">{label}</label>}\n\n      {entries.length === 0 && !disabled && (\n        <div className=\"text-sm text-muted-foreground text-center py-4 border border-dashed rounded-md\">\n          No variables. Click \"Add Variable\" to add one.\n        </div>\n      )}\n\n      {entries.length > 0 && (\n        <div className=\"border rounded-md\">\n          <table className=\"w-full\">\n            <thead className=\"bg-secondary/50\">\n              <tr>\n                <th className=\"text-left p-2 text-xs font-medium\">Key</th>\n                <th className=\"text-left p-2 text-xs font-medium\">Value</th>\n                {!disabled && <th className=\"w-12\"></th>}\n              </tr>\n            </thead>\n            <tbody>\n              {entries.map(([key, val], index) => (\n                <tr key={index} className=\"border-t\">\n                  <td className=\"p-2\">\n                    <Input\n                      value={key}\n                      onChange={(e) => handleKeyChange(key, e.target.value)}\n                      placeholder={keyPlaceholder}\n                      disabled={disabled}\n                      className=\"font-mono text-sm\"\n                    />\n                  </td>\n                  <td className=\"p-2\">\n                    <Input\n                      value={val}\n                      onChange={(e) => handleValueChange(key, e.target.value)}\n                      placeholder={valuePlaceholder}\n                      disabled={disabled}\n                      className=\"font-mono text-sm\"\n                    />\n                  </td>\n                  {!disabled && (\n                    <td className=\"p-2\">\n                      <button\n                        type=\"button\"\n                        onClick={() => handleRemove(key)}\n                        className=\"p-2 hover:bg-destructive/10 text-destructive rounded transition-colors\"\n                        title=\"Remove\"\n                      >\n                        <TrashIcon className=\"h-4 w-4\" />\n                      </button>\n                    </td>\n                  )}\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {!disabled && (\n        <Button\n          type=\"button\"\n          variant=\"secondary\"\n          size=\"sm\"\n          onClick={handleAdd}\n          className=\"w-full\"\n        >\n          <PlusIcon className=\"h-4 w-4 mr-2\" />\n          Add Variable\n        </Button>\n      )}\n    </div>\n  );\n};\n",
        "timestamp": "2026-01-02T14:22:14.293924"
      },
      "worktree_state": {
        "content": "/**\n * KeyValueEditor Component\n *\n * A dynamic key-value pair editor that allows users to manage environment variables,\n * configuration settings, or any key-value data structure. Provides an intuitive table-based\n * interface with inline editing, add/remove capabilities, and full keyboard navigation.\n *\n * ## Features\n * - Interactive table-based UI for key-value pair management\n * - Add new key-value pairs with a single click\n * - Remove individual pairs with confirmation-free delete\n * - Inline editing of both keys and values using Input components\n * - Empty state message when no pairs exist\n * - Customizable placeholders for keys and values\n * - Optional label for the entire editor\n * - Disabled state that prevents all modifications\n * - Monospace font for keys and values for better readability\n * - Full width \"Add Variable\" button for easy access\n *\n * ## Key-Value Pair Management\n * The component manages a `Record<string, string>` data structure:\n * - **Add**: Creates a new pair with empty key and value ('')\n * - **Remove**: Deletes a pair by key, triggering onChange with updated object\n * - **Change Key**: Renames a key while preserving its value, updates object structure\n * - **Change Value**: Updates the value for a given key, preserves object structure\n * - **Uniqueness**: Keys can be duplicated during editing (no automatic deduplication)\n * - **Empty Keys**: The component allows empty string keys temporarily during editing\n *\n * ## State Management\n * This is a controlled component that requires parent state management:\n * - Parent must provide current `value` (Record<string, string>)\n * - Parent must handle `onChange` callback to update state\n * - All modifications immediately trigger onChange with new complete object\n * - Component does not maintain internal state for the key-value pairs\n *\n * ## Styling Behavior\n * The component uses Tailwind CSS with a structured layout:\n * - **Outer container**: Space-y-2 for vertical spacing\n * - **Table**: Bordered, rounded container with semantic header styling\n * - **Header row**: Secondary background (bg-secondary/50) with uppercase labels\n * - **Input cells**: Full width inputs with monospace font\n * - **Delete button**: Hover effect with destructive color on interaction\n * - **Empty state**: Centered text with dashed border indicating actionable area\n * - **Add button**: Full width secondary button with plus icon\n *\n * When disabled, the editor:\n * - Hides all delete buttons\n * - Hides the \"Add Variable\" button\n * - Disables all Input fields (via Input component's disabled prop)\n * - Does not show empty state message\n *\n * ## Common Usage Patterns\n * The KeyValueEditor is typically used for:\n * - Environment variable configuration in agent/skill settings\n * - HTTP headers management for API integrations\n * - Custom metadata or tag editing\n * - Configuration key-value storage\n * - Form fields that require dynamic key-value inputs\n *\n * @example\n * // Basic usage with controlled state\n * const [envVars, setEnvVars] = useState({ NODE_ENV: 'production' });\n * <KeyValueEditor\n *   value={envVars}\n *   onChange={setEnvVars}\n *   label=\"Environment Variables\"\n * />\n *\n * @example\n * // Custom placeholders for specific use case\n * <KeyValueEditor\n *   value={headers}\n *   onChange={setHeaders}\n *   label=\"HTTP Headers\"\n *   keyPlaceholder=\"Header-Name\"\n *   valuePlaceholder=\"header value\"\n * />\n *\n * @example\n * // Disabled/read-only mode for viewing\n * <KeyValueEditor\n *   value={config}\n *   onChange={() => {}}\n *   disabled\n *   label=\"Configuration (Read-Only)\"\n * />\n *\n * @example\n * // Starting with empty state\n * const [metadata, setMetadata] = useState({});\n * <KeyValueEditor\n *   value={metadata}\n *   onChange={setMetadata}\n *   label=\"Custom Metadata\"\n *   keyPlaceholder=\"property\"\n *   valuePlaceholder=\"value\"\n * />\n *\n * @example\n * // Integration with form handling\n * const [formData, setFormData] = useState({ vars: {} });\n * const handleVarsChange = (newVars: Record<string, string>) => {\n *   setFormData({ ...formData, vars: newVars });\n * };\n * <KeyValueEditor\n *   value={formData.vars}\n *   onChange={handleVarsChange}\n *   label=\"Variables\"\n * />\n */\n\nimport React from 'react';\nimport { Input } from './Input';\nimport { Button } from './Button';\nimport { PlusIcon, TrashIcon } from './Icons';\n\n/**\n * Props for the KeyValueEditor component\n *\n * This component is fully controlled - the parent must manage state via value and onChange.\n * All modifications (add, remove, edit) trigger the onChange callback with a new object.\n */\ninterface KeyValueEditorProps {\n  /**\n   * Current key-value pairs to display and edit\n   *\n   * Represents the data structure being managed. Each key is a string that maps to a string value.\n   * Parent component is responsible for maintaining this state.\n   *\n   * @example { NODE_ENV: 'production', API_URL: 'https://api.example.com' }\n   */\n  value: Record<string, string>;\n\n  /**\n   * Callback fired when the key-value pairs change\n   *\n   * Receives the complete updated Record<string, string> object after any modification:\n   * - Adding a new pair (with empty key and value)\n   * - Removing an existing pair\n   * - Changing a key name (old key deleted, new key added with same value)\n   * - Changing a value (key preserved, value updated)\n   *\n   * Parent should update their state with this new value.\n   *\n   * @param value - The new complete key-value object after modification\n   */\n  onChange: (value: Record<string, string>) => void;\n\n  /**\n   * Whether the editor is in read-only/disabled mode\n   *\n   * When true:\n   * - All Input fields are disabled\n   * - Delete buttons are hidden\n   * - \"Add Variable\" button is hidden\n   * - Empty state message is hidden\n   *\n   * Use this for viewing existing configuration without modification.\n   *\n   * @default false\n   */\n  disabled?: boolean;\n\n  /**\n   * Optional label displayed above the editor\n   *\n   * Provides context for what key-value pairs are being edited.\n   * Rendered as a medium-weight text with bottom margin.\n   *\n   * @example \"Environment Variables\"\n   * @example \"HTTP Headers\"\n   * @example \"Custom Metadata\"\n   */\n  label?: string;\n\n  /**\n   * Placeholder text for key input fields\n   *\n   * Shown when a key field is empty. Typically uppercase or follows\n   * naming convention for the specific use case.\n   *\n   * @default 'KEY'\n   */\n  keyPlaceholder?: string;\n\n  /**\n   * Placeholder text for value input fields\n   *\n   * Shown when a value field is empty. Typically lowercase to distinguish\n   * from key placeholder.\n   *\n   * @default 'value'\n   */\n  valuePlaceholder?: string;\n}\n\nexport const KeyValueEditor: React.FC<KeyValueEditorProps> = ({\n  value,\n  onChange,\n  disabled = false,\n  label,\n  keyPlaceholder = 'KEY',\n  valuePlaceholder = 'value',\n}) => {\n  const entries = Object.entries(value);\n\n  /**\n   * Adds a new key-value pair with empty strings\n   *\n   * Creates a new entry with both key and value set to empty string ('').\n   * User can then edit the key and value inline. Triggers onChange with\n   * the updated object including the new empty pair.\n   */\n  const handleAdd = () => {\n    onChange({ ...value, '': '' });\n  };\n\n  /**\n   * Removes a key-value pair by key\n   *\n   * Deletes the specified key from the object and triggers onChange with\n   * the updated object. Uses object spread and delete to create new object.\n   *\n   * @param key - The key of the pair to remove\n   */\n  const handleRemove = (key: string) => {\n    const newValue = { ...value };\n    delete newValue[key];\n    onChange(newValue);\n  };\n\n  /**\n   * Renames a key while preserving its value\n   *\n   * Removes the old key and adds a new key with the same value. This allows\n   * users to edit key names inline. Triggers onChange with updated object.\n   * Note: If newKey already exists, its value will be overwritten.\n   *\n   * @param oldKey - The current key to rename\n   * @param newKey - The new key name\n   */\n  const handleKeyChange = (oldKey: string, newKey: string) => {\n    const newValue = { ...value };\n    const val = newValue[oldKey];\n    delete newValue[oldKey];\n    newValue[newKey] = val;\n    onChange(newValue);\n  };\n\n  /**\n   * Updates the value for a given key\n   *\n   * Modifies the value associated with the specified key and triggers onChange\n   * with the updated object. Preserves all other key-value pairs.\n   *\n   * @param key - The key whose value to update\n   * @param newVal - The new value to set\n   */\n  const handleValueChange = (key: string, newVal: string) => {\n    onChange({ ...value, [key]: newVal });\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      {label && <label className=\"block text-sm font-medium mb-2\">{label}</label>}\n\n      {entries.length === 0 && !disabled && (\n        <div className=\"text-sm text-muted-foreground text-center py-4 border border-dashed rounded-md\">\n          No variables. Click \"Add Variable\" to add one.\n        </div>\n      )}\n\n      {entries.length > 0 && (\n        <div className=\"border rounded-md\">\n          <table className=\"w-full\">\n            <thead className=\"bg-secondary/50\">\n              <tr>\n                <th className=\"text-left p-2 text-xs font-medium\">Key</th>\n                <th className=\"text-left p-2 text-xs font-medium\">Value</th>\n                {!disabled && <th className=\"w-12\"></th>}\n              </tr>\n            </thead>\n            <tbody>\n              {entries.map(([key, val], index) => (\n                <tr key={index} className=\"border-t\">\n                  <td className=\"p-2\">\n                    <Input\n                      value={key}\n                      onChange={(e) => handleKeyChange(key, e.target.value)}\n                      placeholder={keyPlaceholder}\n                      disabled={disabled}\n                      className=\"font-mono text-sm\"\n                    />\n                  </td>\n                  <td className=\"p-2\">\n                    <Input\n                      value={val}\n                      onChange={(e) => handleValueChange(key, e.target.value)}\n                      placeholder={valuePlaceholder}\n                      disabled={disabled}\n                      className=\"font-mono text-sm\"\n                    />\n                  </td>\n                  {!disabled && (\n                    <td className=\"p-2\">\n                      <button\n                        type=\"button\"\n                        onClick={() => handleRemove(key)}\n                        className=\"p-2 hover:bg-destructive/10 text-destructive rounded transition-colors\"\n                        title=\"Remove\"\n                      >\n                        <TrashIcon className=\"h-4 w-4\" />\n                      </button>\n                    </td>\n                  )}\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {!disabled && (\n        <Button\n          type=\"button\"\n          variant=\"secondary\"\n          size=\"sm\"\n          onClick={handleAdd}\n          className=\"w-full\"\n        >\n          <PlusIcon className=\"h-4 w-4 mr-2\" />\n          Add Variable\n        </Button>\n      )}\n    </div>\n  );\n};\n",
        "last_modified": "2026-01-02T15:11:36.295145"
      },
      "task_intent": {
        "title": "Document Frontend React Components and Hooks",
        "description": "Add comprehensive JSDoc documentation to all React components and custom hooks in the frontend, including prop types, usage examples, component purposes, state management, and side effects.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T14:01:11.868818",
  "last_updated": "2026-01-02T14:22:15.296706"
}