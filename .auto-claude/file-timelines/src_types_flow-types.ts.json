{
  "file_path": "src/types/flow-types.ts",
  "main_branch_history": [],
  "task_views": {
    "007-uygulaman-n-genel-yap-s-n-d-zenleyece-iz-yani-uygu": {
      "task_id": "007-uygulaman-n-genel-yap-s-n-d-zenleyece-iz-yani-uygu",
      "branch_point": {
        "commit_hash": "9355e1f79162ecd7611ae3213457e87085b7fe4d",
        "content": "/**\n * Claude Agent UI - Flow Domain Types\n *\n * This file contains all flow-related domain entity types for the workflow system.\n * Flows orchestrate agents and skills into reusable, schedulable processes.\n *\n * @see backend/src/api/flow/content-types/flow/schema.json for Strapi schema\n * @see backend/src/api/flow-execution/content-types/flow-execution/schema.json\n * @see backend/src/components/flow/* for node component definitions\n */\n\nimport type { Agent, ClaudeModel } from './agent.types';\n\n// =============================================================================\n// FLOW STATUS & CATEGORY ENUMS\n// =============================================================================\n\n/**\n * Flow lifecycle status\n */\nexport type FlowStatus = 'draft' | 'active' | 'paused' | 'archived';\n\n/**\n * Flow category for organization and filtering\n */\nexport type FlowCategory =\n  | 'web-scraping'\n  | 'data-processing'\n  | 'api-integration'\n  | 'file-manipulation'\n  | 'automation'\n  | 'custom';\n\n/**\n * Flow execution status\n */\nexport type FlowExecutionStatus =\n  | 'pending'\n  | 'running'\n  | 'completed'\n  | 'failed'\n  | 'cancelled';\n\n/**\n * How the flow execution was triggered\n */\nexport type FlowTriggerType = 'manual' | 'schedule' | 'webhook' | 'api';\n\n/**\n * Output delivery type\n */\nexport type FlowOutputType = 'response' | 'file' | 'database' | 'webhook' | 'email';\n\n/**\n * Output format type\n */\nexport type FlowOutputFormat = 'json' | 'markdown' | 'text' | 'html' | 'csv' | 'zip';\n\n/**\n * Model override options for agent nodes\n */\nexport type FlowModelOverride = 'default' | ClaudeModel;\n\n/**\n * Node type discriminator\n */\nexport type FlowNodeType = 'input' | 'agent' | 'output';\n\n// =============================================================================\n// INPUT FIELD TYPES\n// =============================================================================\n\n/**\n * Input field type for flow input nodes\n */\nexport type InputFieldType =\n  | 'text'\n  | 'textarea'\n  | 'number'\n  | 'url'\n  | 'email'\n  | 'file'\n  | 'select'\n  | 'multiselect'\n  | 'checkbox'\n  | 'date'\n  | 'datetime';\n\n/**\n * Input field definition for flow input nodes\n */\nexport interface FlowInputField {\n  /** Unique field name (used as identifier) */\n  name: string;\n\n  /** Field type */\n  type: InputFieldType;\n\n  /** Display label */\n  label: string;\n\n  /** Whether the field is required */\n  required: boolean;\n\n  /** Help text or description */\n  description?: string;\n\n  /** Placeholder text */\n  placeholder?: string;\n\n  /** Default value */\n  defaultValue?: any;\n\n  /** Options for select/multiselect types */\n  options?: string[];\n\n  /** Validation pattern (regex) */\n  pattern?: string;\n\n  /** Minimum value (for number) or length (for text) */\n  min?: number;\n\n  /** Maximum value (for number) or length (for text) */\n  max?: number;\n}\n\n// =============================================================================\n// NODE POSITION\n// =============================================================================\n\n/**\n * UI position coordinates for node rendering\n */\nexport interface NodePosition {\n  x: number;\n  y: number;\n}\n\n// =============================================================================\n// BASE NODE INTERFACE\n// =============================================================================\n\n/**\n * Base interface for all flow nodes\n */\nexport interface FlowNodeBase {\n  /** Unique identifier for this node within the flow */\n  nodeId: string;\n\n  /** Node type discriminator */\n  type: FlowNodeType;\n\n  /** Display name for this node */\n  name: string;\n\n  /** Description of what this node does */\n  description?: string;\n\n  /** UI position coordinates */\n  position: NodePosition;\n\n  /** ID of the next node in the flow sequence (null for terminal nodes) */\n  nextNodeId?: string | null;\n\n  /** Additional metadata */\n  metadata?: Record<string, any>;\n}\n\n// =============================================================================\n// INPUT NODE\n// =============================================================================\n\n/**\n * Input node for defining flow inputs\n */\nexport interface InputNode extends FlowNodeBase {\n  type: 'input';\n\n  /** Array of input field definitions */\n  inputFields: FlowInputField[];\n\n  /** Custom validation rules */\n  validationRules?: Record<string, any>;\n}\n\n// =============================================================================\n// AGENT NODE\n// =============================================================================\n\n/**\n * Agent node for executing an agent with configured skills\n */\nexport interface AgentNode extends FlowNodeBase {\n  type: 'agent';\n\n  /** Agent ID to execute */\n  agentId: string;\n\n  /** Populated agent object (when fetched with relations) */\n  agent?: Agent;\n\n  /** Prompt template with variable interpolation support ({{variableName}}) */\n  promptTemplate: string;\n\n  /** Array of skill IDs to enable for this agent execution */\n  skills: string[];\n\n  /** Override the agent's default model */\n  modelOverride: FlowModelOverride;\n\n  /** Maximum tokens for the agent response */\n  maxTokens?: number;\n\n  /** Timeout in milliseconds for agent execution */\n  timeout: number;\n\n  /** Whether to retry on error */\n  retryOnError: boolean;\n\n  /** Maximum number of retries on error */\n  maxRetries: number;\n}\n\n// =============================================================================\n// OUTPUT NODE\n// =============================================================================\n\n/**\n * Output node for defining how results are delivered\n */\nexport interface OutputNode extends FlowNodeBase {\n  type: 'output';\n\n  /** How to deliver the output */\n  outputType: FlowOutputType;\n\n  /** Output format for the result */\n  format: FlowOutputFormat;\n\n  /** Whether to save output to a file */\n  saveToFile: boolean;\n\n  /** File path template for saving output (supports {{variableName}}) */\n  filePath?: string;\n\n  /** File name template for saving output */\n  fileName?: string;\n\n  /** Whether to include execution metadata in output */\n  includeMetadata: boolean;\n\n  /** Whether to include timestamp in output */\n  includeTimestamp: boolean;\n\n  /** Optional template for transforming the final output */\n  transformTemplate?: string;\n\n  /** Webhook URL for outputType=webhook */\n  webhookUrl?: string;\n\n  /** Headers to send with webhook request */\n  webhookHeaders?: Record<string, string>;\n}\n\n// =============================================================================\n// FLOW NODE UNION TYPE\n// =============================================================================\n\n/**\n * Union type for all flow node types\n */\nexport type FlowNode = InputNode | AgentNode | OutputNode;\n\n// =============================================================================\n// FLOW DEFINITION\n// =============================================================================\n\n/**\n * Input schema definition for flow validation\n */\nexport interface FlowInputSchema {\n  /** JSON Schema properties */\n  properties: Record<string, {\n    type: string;\n    description?: string;\n    default?: any;\n    enum?: any[];\n  }>;\n\n  /** Required field names */\n  required?: string[];\n}\n\n/**\n * Output schema definition for flow results\n */\nexport interface FlowOutputSchema {\n  /** JSON Schema properties */\n  properties: Record<string, {\n    type: string;\n    description?: string;\n  }>;\n}\n\n/**\n * Core Flow interface representing a workflow definition\n */\nexport interface Flow {\n  /** Unique identifier (documentId from Strapi) */\n  id: string;\n\n  /** Human-readable flow name (unique) */\n  name: string;\n\n  /** URL-friendly slug (auto-generated from name) */\n  slug: string;\n\n  /** Description of what this flow does */\n  description?: string;\n\n  /** Array of flow nodes defining the workflow */\n  nodes: FlowNode[];\n\n  /** Flow lifecycle status */\n  status: FlowStatus;\n\n  /** Schema defining expected input fields */\n  inputSchema: FlowInputSchema;\n\n  /** Schema defining expected output structure */\n  outputSchema: FlowOutputSchema;\n\n  /** Whether the flow is currently active and executable */\n  isActive: boolean;\n\n  /** Semantic version (format: x.y.z) */\n  version: string;\n\n  /** Flow category for organization */\n  category: FlowCategory;\n\n  /** Additional metadata */\n  metadata?: Record<string, any>;\n\n  /** Creation timestamp */\n  createdAt?: Date;\n\n  /** Last update timestamp */\n  updatedAt?: Date;\n}\n\n// =============================================================================\n// FLOW EXECUTION LOG\n// =============================================================================\n\n/**\n * Log level for execution logs\n */\nexport type LogLevel = 'debug' | 'info' | 'warn' | 'error';\n\n/**\n * Execution log entry\n */\nexport interface FlowExecutionLog {\n  /** Timestamp of the log entry */\n  timestamp: Date;\n\n  /** Log level */\n  level: LogLevel;\n\n  /** Log message */\n  message: string;\n\n  /** Node ID that generated this log (optional) */\n  nodeId?: string;\n\n  /** Additional context data */\n  data?: Record<string, any>;\n}\n\n// =============================================================================\n// NODE EXECUTION STATE\n// =============================================================================\n\n/**\n * Status of individual node execution\n */\nexport type NodeExecutionStatus = 'pending' | 'running' | 'completed' | 'failed' | 'skipped';\n\n/**\n * Tracks execution state of a single node\n */\nexport interface NodeExecution {\n  /** Node ID */\n  nodeId: string;\n\n  /** Node type */\n  nodeType: FlowNodeType;\n\n  /** Current status */\n  status: NodeExecutionStatus;\n\n  /** When node execution started */\n  startedAt?: Date;\n\n  /** When node execution completed */\n  completedAt?: Date;\n\n  /** Execution time in milliseconds */\n  executionTime?: number;\n\n  /** Input data for this node */\n  input?: Record<string, any>;\n\n  /** Output data from this node */\n  output?: Record<string, any>;\n\n  /** Error message if failed */\n  error?: string;\n\n  /** Error details if failed */\n  errorDetails?: Record<string, any>;\n\n  /** Tokens used (for agent nodes) */\n  tokensUsed?: number;\n\n  /** Cost (for agent nodes) */\n  cost?: number;\n\n  /** Retry count */\n  retryCount?: number;\n}\n\n// =============================================================================\n// FLOW EXECUTION\n// =============================================================================\n\n/**\n * Flow execution record tracking a single run of a flow\n */\nexport interface FlowExecution {\n  /** Unique identifier (documentId from Strapi) */\n  id: string;\n\n  /** Flow ID that was executed */\n  flowId: string;\n\n  /** Populated flow object (when fetched with relations) */\n  flow?: Flow;\n\n  /** Current execution status */\n  status: FlowExecutionStatus;\n\n  /** Input data provided to start the execution */\n  input?: Record<string, any>;\n\n  /** Final output data from the execution */\n  output?: Record<string, any>;\n\n  /** Array of log entries */\n  logs: FlowExecutionLog[];\n\n  /** Error message if failed */\n  error?: string;\n\n  /** Detailed error information */\n  errorDetails?: Record<string, any>;\n\n  /** When execution started */\n  startedAt?: Date;\n\n  /** When execution completed (success or failure) */\n  completedAt?: Date;\n\n  /** Total execution time in milliseconds */\n  executionTime?: number;\n\n  /** Array tracking each node's execution state */\n  nodeExecutions: NodeExecution[];\n\n  /** ID of the currently executing node */\n  currentNodeId?: string;\n\n  /** Total tokens consumed during execution */\n  tokensUsed: number;\n\n  /** Estimated cost of the execution */\n  cost: number;\n\n  /** How the execution was triggered */\n  triggeredBy: FlowTriggerType;\n\n  /** Additional trigger context (webhook payload, schedule info, etc.) */\n  triggerData?: Record<string, any>;\n\n  /** Number of retry attempts made */\n  retryCount: number;\n\n  /** Reference to parent execution if this is a retry */\n  parentExecutionId?: string;\n\n  /** Additional metadata */\n  metadata?: Record<string, any>;\n\n  /** Creation timestamp */\n  createdAt?: Date;\n\n  /** Last update timestamp */\n  updatedAt?: Date;\n}\n\n// =============================================================================\n// EXECUTION CONTEXT\n// =============================================================================\n\n/**\n * Runtime context passed through node execution chain\n */\nexport interface FlowExecutionContext {\n  /** Current execution record */\n  execution: FlowExecution;\n\n  /** Flow definition being executed */\n  flow: Flow;\n\n  /** Accumulated data from all previous nodes */\n  data: Record<string, any>;\n\n  /** Original input data */\n  input: Record<string, any>;\n\n  /** Variable registry for template interpolation */\n  variables: Record<string, any>;\n\n  /** Execution start timestamp */\n  startTime: Date;\n\n  /** Logger function for adding execution logs */\n  log: (level: LogLevel, message: string, nodeId?: string, data?: Record<string, any>) => void;\n\n  /** Flag to signal execution cancellation */\n  isCancelled: boolean;\n\n  /** Callback for SSE updates */\n  onUpdate?: (update: FlowExecutionUpdate) => void;\n}\n\n// =============================================================================\n// EXECUTION RESULT\n// =============================================================================\n\n/**\n * Result returned by individual node handlers\n */\nexport interface NodeExecutionResult {\n  /** Whether the node execution was successful */\n  success: boolean;\n\n  /** Output data from the node */\n  output?: Record<string, any>;\n\n  /** Error message if failed */\n  error?: string;\n\n  /** Error details if failed */\n  errorDetails?: Record<string, any>;\n\n  /** Updated data to merge into context */\n  data?: Record<string, any>;\n\n  /** Tokens used (for agent nodes) */\n  tokensUsed?: number;\n\n  /** Cost (for agent nodes) */\n  cost?: number;\n\n  /** Whether to continue to next node (default: true) */\n  continueExecution?: boolean;\n}\n\n/**\n * Final result of a complete flow execution\n */\nexport interface FlowExecutionResult {\n  /** Execution ID */\n  executionId: string;\n\n  /** Whether the execution was successful */\n  success: boolean;\n\n  /** Final status */\n  status: FlowExecutionStatus;\n\n  /** Final output data */\n  output?: Record<string, any>;\n\n  /** Error message if failed */\n  error?: string;\n\n  /** Error details if failed */\n  errorDetails?: Record<string, any>;\n\n  /** Total execution time in milliseconds */\n  executionTime: number;\n\n  /** Total tokens consumed */\n  tokensUsed: number;\n\n  /** Total cost */\n  cost: number;\n\n  /** Node execution summaries */\n  nodeExecutions: NodeExecution[];\n}\n\n// =============================================================================\n// SSE UPDATE EVENTS\n// =============================================================================\n\n/**\n * Update type for SSE streaming\n */\nexport type FlowExecutionUpdateType =\n  | 'execution_started'\n  | 'execution_completed'\n  | 'execution_failed'\n  | 'execution_cancelled'\n  | 'node_started'\n  | 'node_completed'\n  | 'node_failed'\n  | 'log';\n\n/**\n * SSE update event for real-time execution monitoring\n */\nexport interface FlowExecutionUpdate {\n  /** Update type */\n  type: FlowExecutionUpdateType;\n\n  /** Execution ID */\n  executionId: string;\n\n  /** Timestamp */\n  timestamp: Date;\n\n  /** Node ID (for node-specific updates) */\n  nodeId?: string;\n\n  /** Node type (for node-specific updates) */\n  nodeType?: FlowNodeType;\n\n  /** Update data */\n  data?: {\n    status?: FlowExecutionStatus | NodeExecutionStatus;\n    output?: Record<string, any>;\n    error?: string;\n    log?: FlowExecutionLog;\n    tokensUsed?: number;\n    cost?: number;\n    executionTime?: number;\n  };\n}\n\n// =============================================================================\n// FLOW EXECUTION REQUEST\n// =============================================================================\n\n/**\n * Request to start a flow execution\n */\nexport interface StartFlowExecutionRequest {\n  /** Flow ID to execute */\n  flowId: string;\n\n  /** Input data matching flow's input schema */\n  input: Record<string, any>;\n\n  /** How the execution was triggered (default: 'manual') */\n  triggeredBy?: FlowTriggerType;\n\n  /** Additional trigger data */\n  triggerData?: Record<string, any>;\n\n  /** Whether to wait for completion (default: false for SSE streaming) */\n  waitForCompletion?: boolean;\n}\n\n/**\n * Response from starting a flow execution\n */\nexport interface StartFlowExecutionResponse {\n  /** Execution ID */\n  executionId: string;\n\n  /** SSE stream URL for real-time updates */\n  streamUrl?: string;\n\n  /** Execution status */\n  status: FlowExecutionStatus;\n\n  /** Execution result (only if waitForCompletion=true) */\n  result?: FlowExecutionResult;\n}\n\n// =============================================================================\n// FLOW STATISTICS\n// =============================================================================\n\n/**\n * Statistics for a single flow\n */\nexport interface FlowStats {\n  /** Flow ID */\n  flowId: string;\n\n  /** Total number of executions */\n  totalExecutions: number;\n\n  /** Number of successful executions */\n  successCount: number;\n\n  /** Number of failed executions */\n  failedCount: number;\n\n  /** Number of cancelled executions */\n  cancelledCount: number;\n\n  /** Success rate percentage (0-100) */\n  successRate: number;\n\n  /** Average execution time in milliseconds */\n  averageExecutionTime: number;\n\n  /** Total tokens used across all executions */\n  totalTokensUsed: number;\n\n  /** Total cost across all executions */\n  totalCost: number;\n\n  /** Last execution timestamp */\n  lastExecutedAt?: Date;\n}\n\n/**\n * Global statistics across all flows\n */\nexport interface GlobalFlowStats {\n  /** Total number of flows */\n  totalFlows: number;\n\n  /** Number of active flows */\n  activeFlows: number;\n\n  /** Total executions across all flows */\n  totalExecutions: number;\n\n  /** Currently running executions */\n  runningExecutions: number;\n\n  /** Total success count */\n  successCount: number;\n\n  /** Total failure count */\n  failedCount: number;\n\n  /** Overall success rate */\n  successRate: number;\n\n  /** Total tokens used */\n  totalTokensUsed: number;\n\n  /** Total cost */\n  totalCost: number;\n}\n\n// =============================================================================\n// TYPE GUARDS\n// =============================================================================\n\n/**\n * Type guard to check if a node is an InputNode\n */\nexport function isInputNode(node: FlowNode): node is InputNode {\n  return node.type === 'input';\n}\n\n/**\n * Type guard to check if a node is an AgentNode\n */\nexport function isAgentNode(node: FlowNode): node is AgentNode {\n  return node.type === 'agent';\n}\n\n/**\n * Type guard to check if a node is an OutputNode\n */\nexport function isOutputNode(node: FlowNode): node is OutputNode {\n  return node.type === 'output';\n}\n\n// =============================================================================\n// UTILITY TYPES\n// =============================================================================\n\n/**\n * Partial flow for creation/update operations\n */\nexport type FlowCreateInput = Omit<Flow, 'id' | 'createdAt' | 'updatedAt'>;\n\n/**\n * Partial flow for update operations\n */\nexport type FlowUpdateInput = Partial<Omit<Flow, 'id' | 'createdAt' | 'updatedAt'>>;\n\n/**\n * Flow with populated agent relations in nodes\n */\nexport interface FlowWithRelations extends Flow {\n  nodes: (InputNode | (AgentNode & { agent: Agent }) | OutputNode)[];\n}\n",
        "timestamp": "2026-01-02T15:21:46.864601"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "007-uygulaman-n-genel-yap-s-n-d-zenleyece-iz-yani-uygu",
        "description": "Implement a workflow/flow system for organizing agents and skills into reusable, schedulable processes with input/output handling. This transforms the application from a simple agent manager to a process automation tool where users can define workflows like 'Web Scraper' that take input, run agents with skills, and produce structured outputs.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-02T15:21:46.864638",
  "last_updated": "2026-01-02T15:21:46.876261"
}